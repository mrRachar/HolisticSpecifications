<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">com.chainmail.safe</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="com.chainmail.common.html#"><span class="id" title="library">common</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="com.chainmail.loo_def.html#"><span class="id" title="library">loo_def</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">loo_properties</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="com.chainmail.loo_reduction_properties.html#"><span class="id" title="library">loo_reduction_properties</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="com.chainmail.decoupled_classical_properties.html#"><span class="id" title="library">decoupled_classical_properties</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="com.chainmail.decoupling.html#"><span class="id" title="library">decoupling</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="com.chainmail.sbst_decoupled.html#"><span class="id" title="library">sbst_decoupled</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="com.chainmail.function_operations.html#"><span class="id" title="library">function_operations</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="com.chainmail.hoare.html#"><span class="id" title="library">hoare</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="com.chainmail.CpdtTactics.html#"><span class="id" title="library">CpdtTactics</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Logic.FunctionalExtensionality.html#"><span class="id" title="library">Coq.Logic.FunctionalExtensionality</span></a>.<br/>

<br/>
<span class="comment">(*Lemma&nbsp;pair_reduction_nil_tail_implies_pair_reduction&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;χ&nbsp;ϕ&nbsp;σ,&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;nil)&nbsp;⤳&nbsp;σ&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;ψ,&nbsp;exists&nbsp;σ',&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;⤳&nbsp;σ'.<br/>
Proof.<br/>
Admitted.<br/>
<br/>
Lemma&nbsp;pair_reduction_nil_tail_same_heap&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;σ,&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;⤳&nbsp;σ&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;σ',&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;nil)&nbsp;⤳&nbsp;σ'&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fst&nbsp;σ&nbsp;=&nbsp;fst&nbsp;σ'.<br/>
Proof.<br/>
Admitted.<br/>
<br/>
Lemma&nbsp;hoare_pr_fieldHeapUpdated_nil&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;P&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;α&nbsp;f&nbsp;v,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;{pre:P}&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;{post:fieldHeapUpdated&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;α&nbsp;f&nbsp;v}&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;{pre:P}&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;nil)&nbsp;{post:fieldHeapUpdated&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;nil)&nbsp;α&nbsp;f&nbsp;v}.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M1&nbsp;M2&nbsp;P&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;α&nbsp;f&nbsp;v&nbsp;Hhoare&nbsp;HP.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;apply&nbsp;ht_pr;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros.<br/>
<br/>
&nbsp;&nbsp;let&nbsp;σ&nbsp;:=&nbsp;fresh&nbsp;"σ"&nbsp;in<br/>
&nbsp;&nbsp;destruct&nbsp;(pair_reduction_nil_tail_implies_pair_reduction&nbsp;M1&nbsp;M2&nbsp;χ&nbsp;ϕ&nbsp;σ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(ψ:=ψ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;<span class="inlinecode">σ</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;hoare_inversion.<br/>
<br/>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;inversion&nbsp;Hhoare;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;speciali<br/>
Qed.*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="head_pair_reduction"><span class="id" title="lemma">head_pair_reduction</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> χ <span class="id" title="var">ϕ</span> χ' ψ', <a class="idref" href="com.chainmail.safe.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="com.chainmail.loo_def.html#400139144b0aa6b3b29c58b97cf21976"><span class="id" title="notation">⦂</span></a> <a class="idref" href="com.chainmail.safe.html#M2"><span class="id" title="variable">M2</span></a> <a class="idref" href="com.chainmail.loo_def.html#400139144b0aa6b3b29c58b97cf21976"><span class="id" title="notation">⦿</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="com.chainmail.safe.html#cc5ca45a7ef59e588af3bf66d6f125ef"><span class="id" title="variable">χ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="com.chainmail.safe.html#6c4dbec1c9102e1076a6a6ca04576cf0"><span class="id" title="variable">ϕ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="com.chainmail.loo_def.html#400139144b0aa6b3b29c58b97cf21976"><span class="id" title="notation">⤳</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="com.chainmail.safe.html#adfdac893eba58f9376b4ba8fdb610f5"><span class="id" title="variable">χ'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="com.chainmail.safe.html#83abdf60aef333c8e5128c17ddc747cb"><span class="id" title="variable">ψ'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> ψ, <a class="idref" href="com.chainmail.safe.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="com.chainmail.loo_def.html#400139144b0aa6b3b29c58b97cf21976"><span class="id" title="notation">⦂</span></a> <a class="idref" href="com.chainmail.safe.html#M2"><span class="id" title="variable">M2</span></a> <a class="idref" href="com.chainmail.loo_def.html#400139144b0aa6b3b29c58b97cf21976"><span class="id" title="notation">⦿</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="com.chainmail.safe.html#cc5ca45a7ef59e588af3bf66d6f125ef"><span class="id" title="variable">χ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="com.chainmail.safe.html#6c4dbec1c9102e1076a6a6ca04576cf0"><span class="id" title="variable">ϕ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="com.chainmail.safe.html#6f9d76259b18aa9d2bd5fca149b789ed"><span class="id" title="variable">ψ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="com.chainmail.loo_def.html#400139144b0aa6b3b29c58b97cf21976"><span class="id" title="notation">⤳</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="com.chainmail.safe.html#adfdac893eba58f9376b4ba8fdb610f5"><span class="id" title="variable">χ'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="com.chainmail.safe.html#83abdf60aef333c8e5128c17ddc747cb"><span class="id" title="variable">ψ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="com.chainmail.safe.html#6f9d76259b18aa9d2bd5fca149b789ed"><span class="id" title="variable">ψ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>

<br/>
<span class="id" title="var">Admitted</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="fieldHeapUpdated_independent_of_stack_1"><span class="id" title="lemma">fieldHeapUpdated_independent_of_stack_1</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> σ1 <span class="id" title="var">α</span> <span class="id" title="var">f</span> <span class="id" title="var">v</span> σ2, <a class="idref" href="com.chainmail.hoare.html#fieldHeapUpdated"><span class="id" title="definition">fieldHeapUpdated</span></a> <a class="idref" href="com.chainmail.safe.html#1cc6be414ab52727f77057b4b030dde0"><span class="id" title="variable">σ1</span></a> <a class="idref" href="com.chainmail.safe.html#ab410a966ac148e9b78c65c6cdf301fd"><span class="id" title="variable">α</span></a> <a class="idref" href="com.chainmail.safe.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="com.chainmail.safe.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="com.chainmail.safe.html#a4d9266a5be6c0504292c8910a50c288"><span class="id" title="variable">σ2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (σ : <a class="idref" href="com.chainmail.loo_def.html#config"><span class="id" title="definition">config</span></a>), <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="com.chainmail.safe.html#3122c41ebe889f745cb9bbe1c92165c3"><span class="id" title="variable">σ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="com.chainmail.safe.html#1cc6be414ab52727f77057b4b030dde0"><span class="id" title="variable">σ1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="com.chainmail.hoare.html#fieldHeapUpdated"><span class="id" title="definition">fieldHeapUpdated</span></a> <a class="idref" href="com.chainmail.safe.html#3122c41ebe889f745cb9bbe1c92165c3"><span class="id" title="variable">σ</span></a> <a class="idref" href="com.chainmail.safe.html#ab410a966ac148e9b78c65c6cdf301fd"><span class="id" title="variable">α</span></a> <a class="idref" href="com.chainmail.safe.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="com.chainmail.safe.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="com.chainmail.safe.html#a4d9266a5be6c0504292c8910a50c288"><span class="id" title="variable">σ2</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> σ1 <span class="id" title="var">α</span> <span class="id" title="var">f</span> <span class="id" title="var">v</span> σ2 <span class="id" title="var">Hupdate</span> σ <span class="id" title="var">Hfst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="com.chainmail.hoare.html#fieldHeapUpdated"><span class="id" title="definition">fieldHeapUpdated</span></a> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">destruct_exists_loo</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="com.chainmail.hoare.html#heapUpdated"><span class="id" title="definition">heapUpdated</span></a> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Hfst</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> χ1 := <span class="id" title="tactic">fresh</span> "χ" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> ψ1 := <span class="id" title="tactic">fresh</span> "ψ" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> χ := <span class="id" title="tactic">fresh</span> "χ" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> ψ := <span class="id" title="tactic">fresh</span> "ψ" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> σ <span class="id" title="keyword">as</span> [χ ψ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> σ1 <span class="id" title="keyword">as</span> [χ1 ψ1];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="fieldHeapUpdated_independent_of_stack_2"><span class="id" title="lemma">fieldHeapUpdated_independent_of_stack_2</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> σ1 <span class="id" title="var">α</span> <span class="id" title="var">f</span> <span class="id" title="var">v</span> σ2, <a class="idref" href="com.chainmail.hoare.html#fieldHeapUpdated"><span class="id" title="definition">fieldHeapUpdated</span></a> <a class="idref" href="com.chainmail.safe.html#1cc6be414ab52727f77057b4b030dde0"><span class="id" title="variable">σ1</span></a> <a class="idref" href="com.chainmail.safe.html#ab410a966ac148e9b78c65c6cdf301fd"><span class="id" title="variable">α</span></a> <a class="idref" href="com.chainmail.safe.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="com.chainmail.safe.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="com.chainmail.safe.html#a4d9266a5be6c0504292c8910a50c288"><span class="id" title="variable">σ2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (σ : <a class="idref" href="com.chainmail.loo_def.html#config"><span class="id" title="definition">config</span></a>), <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="com.chainmail.safe.html#3122c41ebe889f745cb9bbe1c92165c3"><span class="id" title="variable">σ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="com.chainmail.safe.html#a4d9266a5be6c0504292c8910a50c288"><span class="id" title="variable">σ2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="com.chainmail.hoare.html#fieldHeapUpdated"><span class="id" title="definition">fieldHeapUpdated</span></a> <a class="idref" href="com.chainmail.safe.html#1cc6be414ab52727f77057b4b030dde0"><span class="id" title="variable">σ1</span></a> <a class="idref" href="com.chainmail.safe.html#ab410a966ac148e9b78c65c6cdf301fd"><span class="id" title="variable">α</span></a> <a class="idref" href="com.chainmail.safe.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="com.chainmail.safe.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="com.chainmail.safe.html#3122c41ebe889f745cb9bbe1c92165c3"><span class="id" title="variable">σ</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> σ1 <span class="id" title="var">α</span> <span class="id" title="var">f</span> <span class="id" title="var">v</span> σ2 <span class="id" title="var">Hupdate</span> σ <span class="id" title="var">Hfst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="com.chainmail.hoare.html#fieldHeapUpdated"><span class="id" title="definition">fieldHeapUpdated</span></a> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">destruct_exists_loo</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="com.chainmail.hoare.html#heapUpdated"><span class="id" title="definition">heapUpdated</span></a> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Hfst</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="hoare_pr_trans"><span class="id" title="lemma">hoare_pr_trans</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> <span class="id" title="var">P</span> σ <span class="id" title="var">Q</span>, <a class="idref" href="com.chainmail.safe.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">⦂</span></a> <a class="idref" href="com.chainmail.safe.html#M2"><span class="id" title="variable">M2</span></a> <a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">⦿</span></a> <a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">{</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">pre</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">:</span></a> <a class="idref" href="com.chainmail.safe.html#P"><span class="id" title="variable">P</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">}</span></a> <a class="idref" href="com.chainmail.safe.html#3122c41ebe889f745cb9bbe1c92165c3"><span class="id" title="variable">σ</span></a> <a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">{</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">post</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">:</span></a> <a class="idref" href="com.chainmail.safe.html#Q"><span class="id" title="variable">Q</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">}</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">Q'</span> : <a class="idref" href="com.chainmail.loo_def.html#config"><span class="id" title="definition">config</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <span class="id" title="keyword">Prop</span>), <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> σ', <a class="idref" href="com.chainmail.safe.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="com.chainmail.safe.html#4394a2ef16b8915a5209b8b27258ea45"><span class="id" title="variable">σ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="com.chainmail.safe.html#Q'"><span class="id" title="variable">Q'</span></a> <a class="idref" href="com.chainmail.safe.html#4394a2ef16b8915a5209b8b27258ea45"><span class="id" title="variable">σ'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="com.chainmail.safe.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">⦂</span></a> <a class="idref" href="com.chainmail.safe.html#M2"><span class="id" title="variable">M2</span></a> <a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">⦿</span></a> <a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">{</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">pre</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">:</span></a> <a class="idref" href="com.chainmail.safe.html#P"><span class="id" title="variable">P</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">}</span></a> <a class="idref" href="com.chainmail.safe.html#3122c41ebe889f745cb9bbe1c92165c3"><span class="id" title="variable">σ</span></a> <a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">{</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">post</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">:</span></a> <a class="idref" href="com.chainmail.safe.html#Q'"><span class="id" title="variable">Q'</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> <span class="id" title="var">P</span> σ <span class="id" title="var">Q</span> <span class="id" title="var">Hhoare</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hhoare</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="com.chainmail.hoare.html#ht_pr"><span class="id" title="constructor">ht_pr</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="changes_to"><span class="id" title="definition">changes_to</span></a> (<span class="id" title="var">α</span> : <a class="idref" href="com.chainmail.loo_def.html#addr"><span class="id" title="inductive">addr</span></a>)(<span class="id" title="var">f</span> : <a class="idref" href="com.chainmail.loo_def.html#fld"><span class="id" title="inductive">fld</span></a>)(<span class="id" title="var">v</span> : <a class="idref" href="com.chainmail.loo_def.html#value"><span class="id" title="inductive">value</span></a>) : <a class="idref" href="com.chainmail.decoupling.html#asrt"><span class="id" title="inductive">asrt</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="com.chainmail.decoupling.html#7a630e21245026e1b75685a10a5ca45a"><span class="id" title="notation">(</span></a><a class="idref" href="com.chainmail.decoupling.html#ex_acc_f"><span class="id" title="constructor">ex_acc_f</span></a> (<a class="idref" href="com.chainmail.decoupling.html#c377bb8a5db12bc37fe71aa687bd07f4"><span class="id" title="notation">e_</span></a> <a class="idref" href="com.chainmail.safe.html#ab410a966ac148e9b78c65c6cdf301fd"><span class="id" title="variable">α</span></a>) <a class="idref" href="com.chainmail.safe.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="com.chainmail.decoupling.html#e012dd22701105158bada96277455119"><span class="id" title="notation">⩶̸</span></a> <a class="idref" href="com.chainmail.decoupling.html#e012dd22701105158bada96277455119"><span class="id" title="notation">(</span></a><a class="idref" href="com.chainmail.decoupling.html#ex_val"><span class="id" title="constructor">ex_val</span></a> <a class="idref" href="com.chainmail.safe.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="com.chainmail.decoupling.html#e012dd22701105158bada96277455119"><span class="id" title="notation">)</span></a><a class="idref" href="com.chainmail.decoupling.html#7a630e21245026e1b75685a10a5ca45a"><span class="id" title="notation">)</span></a> <a class="idref" href="com.chainmail.decoupling.html#7a630e21245026e1b75685a10a5ca45a"><span class="id" title="notation">∧</span></a> <a class="idref" href="com.chainmail.decoupling.html#7a630e21245026e1b75685a10a5ca45a"><span class="id" title="notation">(</span></a><a class="idref" href="com.chainmail.decoupling.html#a_next"><span class="id" title="constructor">a_next</span></a> (<a class="idref" href="com.chainmail.decoupling.html#ex_acc_f"><span class="id" title="constructor">ex_acc_f</span></a> (<a class="idref" href="com.chainmail.decoupling.html#c377bb8a5db12bc37fe71aa687bd07f4"><span class="id" title="notation">e_</span></a> <a class="idref" href="com.chainmail.safe.html#ab410a966ac148e9b78c65c6cdf301fd"><span class="id" title="variable">α</span></a>) <a class="idref" href="com.chainmail.safe.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="com.chainmail.decoupling.html#159d48044f32869d402ca464bc5a897a"><span class="id" title="notation">⩶</span></a> <a class="idref" href="com.chainmail.decoupling.html#159d48044f32869d402ca464bc5a897a"><span class="id" title="notation">(</span></a><a class="idref" href="com.chainmail.decoupling.html#ex_val"><span class="id" title="constructor">ex_val</span></a> <a class="idref" href="com.chainmail.safe.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="com.chainmail.decoupling.html#159d48044f32869d402ca464bc5a897a"><span class="id" title="notation">)</span></a>)<a class="idref" href="com.chainmail.decoupling.html#7a630e21245026e1b75685a10a5ca45a"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="comment">(*&nbsp;TODO:&nbsp;This&nbsp;desperately&nbsp;needs&nbsp;to&nbsp;be&nbsp;rewritten.&nbsp;Very&nbsp;fragile!!!!!!&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a name="changes_to_fieldHeapUpdatedTo"><span class="id" title="lemma">changes_to_fieldHeapUpdatedTo</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> <span class="id" title="var">P</span> σ <span class="id" title="var">α</span> <span class="id" title="var">f</span> <span class="id" title="var">v</span>, <a class="idref" href="com.chainmail.safe.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">⦂</span></a> <a class="idref" href="com.chainmail.safe.html#M2"><span class="id" title="variable">M2</span></a> <a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">⦿</span></a> <a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">{</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">pre</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">:</span></a> <a class="idref" href="com.chainmail.safe.html#P"><span class="id" title="variable">P</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">}</span></a> <a class="idref" href="com.chainmail.safe.html#3122c41ebe889f745cb9bbe1c92165c3"><span class="id" title="variable">σ</span></a> <a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">{</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">post</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">:</span></a> <a class="idref" href="com.chainmail.hoare.html#fieldHeapUpdated"><span class="id" title="definition">fieldHeapUpdated</span></a> <a class="idref" href="com.chainmail.safe.html#3122c41ebe889f745cb9bbe1c92165c3"><span class="id" title="variable">σ</span></a> <a class="idref" href="com.chainmail.safe.html#ab410a966ac148e9b78c65c6cdf301fd"><span class="id" title="variable">α</span></a> <a class="idref" href="com.chainmail.safe.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="com.chainmail.safe.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="com.chainmail.hoare.html#49b1084da4c3c507ead05fb35e702ca9"><span class="id" title="notation">}</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="com.chainmail.safe.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="com.chainmail.safe.html#3122c41ebe889f745cb9bbe1c92165c3"><span class="id" title="variable">σ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> σ0 <span class="id" title="var">α'</span> <span class="id" title="var">f'</span> <span class="id" title="var">v'</span>, <a class="idref" href="com.chainmail.safe.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="com.chainmail.decoupling.html#92126faa01a88940ffb765b6467f96a7"><span class="id" title="notation">⦂</span></a> <a class="idref" href="com.chainmail.safe.html#M2"><span class="id" title="variable">M2</span></a> <a class="idref" href="com.chainmail.decoupling.html#92126faa01a88940ffb765b6467f96a7"><span class="id" title="notation">◎</span></a> <a class="idref" href="com.chainmail.safe.html#ffc94b899901fdc1d2be18dbabbd34ae"><span class="id" title="variable">σ0</span></a> <a class="idref" href="com.chainmail.decoupling.html#92126faa01a88940ffb765b6467f96a7"><span class="id" title="notation">…</span></a> <a class="idref" href="com.chainmail.safe.html#3122c41ebe889f745cb9bbe1c92165c3"><span class="id" title="variable">σ</span></a> <a class="idref" href="com.chainmail.decoupling.html#92126faa01a88940ffb765b6467f96a7"><span class="id" title="notation">⊨</span></a> <a class="idref" href="com.chainmail.safe.html#changes_to"><span class="id" title="definition">changes_to</span></a> <a class="idref" href="com.chainmail.safe.html#16501cc3ed1b4eca902eac9ccf08adb4"><span class="id" title="variable">α'</span></a> <a class="idref" href="com.chainmail.safe.html#f'"><span class="id" title="variable">f'</span></a> <a class="idref" href="com.chainmail.safe.html#v'"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="com.chainmail.safe.html#ab410a966ac148e9b78c65c6cdf301fd"><span class="id" title="variable">α</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="com.chainmail.safe.html#16501cc3ed1b4eca902eac9ccf08adb4"><span class="id" title="variable">α'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="com.chainmail.safe.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="com.chainmail.safe.html#f'"><span class="id" title="variable">f'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="com.chainmail.safe.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="com.chainmail.safe.html#v'"><span class="id" title="variable">v'</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> <span class="id" title="var">P</span> σ <span class="id" title="var">α</span> <span class="id" title="var">f</span> <span class="id" title="var">v</span> <span class="id" title="var">Hhoare</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hhoare</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <span class="id" title="var">_</span> <a class="idref" href="com.chainmail.decoupling.html#92126faa01a88940ffb765b6467f96a7"><span class="id" title="notation">⦂</span></a> <span class="id" title="var">_</span> <a class="idref" href="com.chainmail.decoupling.html#92126faa01a88940ffb765b6467f96a7"><span class="id" title="notation">◎</span></a> <span class="id" title="var">_</span> <a class="idref" href="com.chainmail.decoupling.html#92126faa01a88940ffb765b6467f96a7"><span class="id" title="notation">…</span></a> <span class="id" title="var">_</span> <a class="idref" href="com.chainmail.decoupling.html#92126faa01a88940ffb765b6467f96a7"><span class="id" title="notation">⊨</span></a> <a class="idref" href="com.chainmail.safe.html#changes_to"><span class="id" title="definition">changes_to</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H8</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <a class="idref" href="com.chainmail.decoupling.html#is_exp"><span class="id" title="inductive">is_exp</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H11</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H10</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H7</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H13</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H5</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H6</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H9</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H21</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">link_unique_auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <span class="id" title="var">is_exp</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H23</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H22</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H20</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H17</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> χ' := <span class="id" title="tactic">fresh</span> "χ" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> ψ' := <span class="id" title="tactic">fresh</span> "ψ" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> σ' <span class="id" title="keyword">as</span> [χ' ψ'].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">head_pair_reduction</span> <span class="id" title="keyword">with</span> (ψ:=ψ) <span class="id" title="tactic">in</span> <span class="id" title="var">H12</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> (χ0, ψ0 ++ ψ));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">auto_specialize</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">fieldHeapUpdated</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">destruct_exists_loo</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">heapUpdated</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hb0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hb0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eq_dec</span> <span class="id" title="var">α</span> <span class="id" title="var">α1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eq_dec</span> <span class="id" title="var">f</span> <span class="id" title="var">f'</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eq_dec</span> <span class="id" title="var">v</span> <span class="id" title="var">v0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>|].<br/>

<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H16</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Ha</span>; <span class="id" title="var">simpl_crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H18</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Ha0</span>; <span class="id" title="var">simpl_crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mapp</span>, <span class="id" title="var">configMapHeap</span>, <span class="id" title="var">fst</span>, <span class="id" title="var">update</span>, <span class="id" title="var">t_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H25</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eq_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">o0</span> = {| <span class="id" title="var">cname</span> := <span class="id" title="var">cname</span> <span class="id" title="var">o1</span>; <span class="id" title="var">flds</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> : <span class="id" title="var">fld</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">f'</span> <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">v</span> <span class="id" title="keyword">else</span> <span class="id" title="var">flds</span> <span class="id" title="var">o1</span> <span class="id" title="var">x</span> |});<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">simpl_crush</span>; <span class="id" title="tactic">auto</span>|<span class="id" title="tactic">subst</span> <span class="id" title="var">o0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">flds</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H27</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eq_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H27</span>; <span class="id" title="tactic">auto</span>.<br/>

<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H16</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Ha</span>; <span class="id" title="var">simpl_crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mapp</span>, <span class="id" title="var">configMapHeap</span>, <span class="id" title="var">fst</span>, <span class="id" title="var">update</span>, <span class="id" title="var">t_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H25</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eq_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">o0</span> = {| <span class="id" title="var">cname</span> := <span class="id" title="var">cname</span> <span class="id" title="var">o1</span>; <span class="id" title="var">flds</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> : <span class="id" title="var">fld</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">f</span> <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">v</span> <span class="id" title="keyword">else</span> <span class="id" title="var">flds</span> <span class="id" title="var">o1</span> <span class="id" title="var">x</span> |});<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">simpl_crush</span>; <span class="id" title="tactic">auto</span>|<span class="id" title="tactic">subst</span> <span class="id" title="var">o0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">flds</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H27</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eq_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">v1</span> = <span class="id" title="var">v0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">destruct</span> <span class="id" title="var">o1</span>; <span class="id" title="var">crush</span>|<span class="id" title="tactic">subst</span> <span class="id" title="var">v1</span>; <span class="id" title="var">crush</span>].<br/>

<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">crush</span>.<br/>

<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">internal_independent_of_initial</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ0 σ <span class="id" title="var">α</span>, <span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ0 … σ ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">internal</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> σ0', <span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ0' … σ ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">internal</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ0 σ <span class="id" title="var">α</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_intrn</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">external_independent_of_initial</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ0 σ <span class="id" title="var">α</span>, <span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ0 … σ ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">external</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> σ0', <span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ0' … σ ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">external</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ0 σ <span class="id" title="var">α</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_extrn</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">internal_unchanged_by_reduction</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ1 σ2, <span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ⦿ σ1 ⤳⋆ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> σ σ' <span class="id" title="var">α</span>, <span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ … σ1 ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">internal</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ' … σ2 ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">internal</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ1 σ2 <span class="id" title="var">Hred</span> σ σ' <span class="id" title="var">α</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pair_reductions_preserves_addr_classes</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">destruct_exists_loo</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_intrn</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">external_unchanged_by_reduction</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ1 σ2, <span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ⦿ σ1 ⤳⋆ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> σ σ' <span class="id" title="var">α</span>, <span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ … σ1 ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">external</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ' … σ2 ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">external</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ1 σ2 <span class="id" title="var">Hred</span> σ σ' <span class="id" title="var">α</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pair_reductions_preserves_addr_classes</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">destruct_exists_loo</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_extrn</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">internal_stack_head_1</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ0 χ <span class="id" title="var">ϕ</span> ψ <span class="id" title="var">α</span>, <span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ0 … (χ, <span class="id" title="var">ϕ</span> :: ψ) ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">internal</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ0 … (χ, <span class="id" title="var">ϕ</span> :: <span class="id" title="var">nil</span>) ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">internal</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ0 χ <span class="id" title="var">ϕ</span> ψ <span class="id" title="var">α</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_intrn</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">internal_stack_head_2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ0 χ <span class="id" title="var">ϕ</span> ψ <span class="id" title="var">α</span>, <span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ0 … (χ, <span class="id" title="var">ϕ</span> :: <span class="id" title="var">nil</span>) ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">internal</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ0 … (χ, <span class="id" title="var">ϕ</span> :: ψ) ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">internal</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ0 χ <span class="id" title="var">ϕ</span> ψ <span class="id" title="var">α</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_intrn</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">external_stack_head_1</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ0 χ <span class="id" title="var">ϕ</span> ψ <span class="id" title="var">α</span>, <span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ0 … (χ, <span class="id" title="var">ϕ</span> :: ψ) ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">external</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ0 … (χ, <span class="id" title="var">ϕ</span> :: <span class="id" title="var">nil</span>) ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">external</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ0 χ <span class="id" title="var">ϕ</span> ψ <span class="id" title="var">α</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_extrn</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">external_stack_head_2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ0 χ <span class="id" title="var">ϕ</span> ψ <span class="id" title="var">α</span>, <span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ0 … (χ, <span class="id" title="var">ϕ</span> :: <span class="id" title="var">nil</span>) ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">external</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ σ0 … (χ, <span class="id" title="var">ϕ</span> :: ψ) ⊨ (<span class="id" title="var">α</span> <span class="id" title="var">external</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span> σ0 χ <span class="id" title="var">ϕ</span> ψ <span class="id" title="var">α</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hsat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_extrn</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">SafeExample</span>.<br/>

<br/>
</div>

<div class="doc">
∀s.<span class="inlinecode"><a class="idref" href="com.chainmail.loo_def.html#s"><span class="id" title="variable">s</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="com.chainmail.safe_internal.html#SafeExample.Safe"><span class="id" title="definition">Safe</span></a></span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">s.treasure</span></span> <span class="inlinecode">&lt;&gt;</span> <span class="inlinecode"><span class="id" title="var">null</span></span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">will</span>(<span class="id" title="var">s.treasure</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">null</span>)</span> 
        <span class="inlinecode">⟶</span> <span class="inlinecode">∃<a class="idref" href="com.chainmail.loo_def.html#o"><span class="id" title="variable">o</span></a>.[<span class="id" title="var">external</span>(<a class="idref" href="com.chainmail.loo_def.html#o"><span class="id" title="variable">o</span></a>)</span> <span class="inlinecode">∧</span> <span class="inlinecode">(<a class="idref" href="com.chainmail.loo_def.html#o"><span class="id" title="variable">o</span></a></span> <span class="inlinecode"><span class="id" title="var">access</span></span> <span class="inlinecode"><span class="id" title="var">s.secret</span>)]</span>
   
<div class="paragraph"> </div>

 <h1>Module Definitions</h1> 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Safe</span> := <span class="id" title="var">classID</span> 1.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">treasure</span> := <span class="id" title="var">fieldID</span> 0.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">secret</span> := <span class="id" title="var">fieldID</span> 1.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">take</span> := <span class="id" title="var">methID</span> 0.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">scr</span> := <span class="id" title="var">bnd</span> 1.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">x</span> := <span class="id" title="var">bnd</span> 2.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">y</span> := <span class="id" title="var">bnd</span> 3.<br/>

<br/>
</div>

<div class="doc">
     <h2>Safe 1</h2> - Simple safe that allows the treasure to be removed if the secret is known - GOOD
   
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">takeBody1</span> := ((<span class="id" title="var">r_</span> <span class="id" title="var">x</span>) ≔ (<span class="id" title="var">r_exp</span> (<span class="id" title="var">e_val</span> (<span class="id" title="var">v_null</span>)))) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(((<span class="id" title="var">r_</span> <span class="id" title="var">y</span>) ≔ (<span class="id" title="var">this</span> ◌ <span class="id" title="var">treasure</span>)) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">s_if</span> ((<span class="id" title="var">e_var</span> <span class="id" title="var">scr</span>) ⩵ (<span class="id" title="var">e_acc_f</span> (<span class="id" title="var">e_var</span> <span class="id" title="var">this</span>) <span class="id" title="var">secret</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(((<span class="id" title="var">this</span> ◌ <span class="id" title="var">treasure</span>) ≔ (<span class="id" title="var">r_</span> <span class="id" title="var">x</span>)) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_rtrn</span> <span class="id" title="var">y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_rtrn</span> <span class="id" title="var">x</span>)) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_rtrn</span> <span class="id" title="var">x</span>))).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">SafeDef1</span> := <span class="id" title="var">clazz</span> <span class="id" title="var">Safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">treasure</span> :: <span class="id" title="var">secret</span> :: <span class="id" title="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">take</span> (<span class="id" title="var">scr</span> :: <span class="id" title="var">nil</span>, <span class="id" title="var">takeBody1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">MyModule1</span> := (<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Safe</span> <span class="id" title="var">SafeDef1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>).<br/>

<br/>
</div>

<div class="doc">
     <h2>Safe 2</h2> - Allows client to change secret if they know the secret - GOOD
   
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">changeSecret</span> := <span class="id" title="var">methID</span> 1.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">newSecret</span> := <span class="id" title="var">bnd</span> 4.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">changeSecretBody2</span> := ((<span class="id" title="var">r_</span> <span class="id" title="var">x</span>) ≔ (<span class="id" title="var">r_exp</span> (<span class="id" title="var">e_val</span> (<span class="id" title="var">v_null</span>)))) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">s_if</span> ((<span class="id" title="var">e_var</span> <span class="id" title="var">scr</span>) ⩵ (<span class="id" title="var">e_acc_f</span> (<span class="id" title="var">e_var</span> <span class="id" title="var">this</span>) <span class="id" title="var">secret</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(((<span class="id" title="var">this</span> ◌ <span class="id" title="var">secret</span>) ≔ (<span class="id" title="var">r_</span> <span class="id" title="var">newSecret</span>)) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_rtrn</span> <span class="id" title="var">x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_rtrn</span> <span class="id" title="var">x</span>)) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_rtrn</span> <span class="id" title="var">x</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">SafeDef2</span> := <span class="id" title="var">clazz</span> <span class="id" title="var">Safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">treasure</span> :: <span class="id" title="var">secret</span> :: <span class="id" title="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">take</span> (<span class="id" title="var">scr</span> :: <span class="id" title="var">nil</span>, <span class="id" title="var">takeBody1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">changeSecret</span> (<span class="id" title="var">scr</span> :: <span class="id" title="var">newSecret</span> :: <span class="id" title="var">nil</span>, <span class="id" title="var">changeSecretBody2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">MyModule2</span> := (<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Safe</span> <span class="id" title="var">SafeDef2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>).<br/>

<br/>
</div>

<div class="doc">
     <h2>Safe 3</h2> - Allows indiscriminate overwriting of the secret even if the secret is not known - BAD
   
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">changeSecretBody3</span> := ((<span class="id" title="var">r_</span> <span class="id" title="var">x</span>) ≔ (<span class="id" title="var">r_exp</span> (<span class="id" title="var">e_val</span> (<span class="id" title="var">v_null</span>)))) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">this</span> ◌ <span class="id" title="var">secret</span>) ≔ (<span class="id" title="var">r_</span> <span class="id" title="var">newSecret</span>) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_rtrn</span> <span class="id" title="var">x</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">SafeDef3</span> := <span class="id" title="var">clazz</span> <span class="id" title="var">Safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">treasure</span> :: <span class="id" title="var">secret</span> :: <span class="id" title="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">take</span> (<span class="id" title="var">scr</span> :: <span class="id" title="var">nil</span>, <span class="id" title="var">takeBody1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">changeSecret</span> (<span class="id" title="var">scr</span> :: <span class="id" title="var">newSecret</span> :: <span class="id" title="var">nil</span>, <span class="id" title="var">changeSecretBody3</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">MyModule3</span> := (<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Safe</span> <span class="id" title="var">SafeDef3</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>).<br/>

<br/>
</div>

<div class="doc">
     <h2>Safe 4</h2> - allows the secret to be leaked - BAD
   
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">leak</span> := <span class="id" title="var">methID</span> 2.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">leakBody4</span> := ((<span class="id" title="var">r_</span> <span class="id" title="var">x</span>) ≔ (<span class="id" title="var">this</span> ◌ <span class="id" title="var">treasure</span>)) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_rtrn</span> <span class="id" title="var">x</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">SafeDef4</span> := <span class="id" title="var">clazz</span> <span class="id" title="var">Safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">treasure</span> :: <span class="id" title="var">secret</span> :: <span class="id" title="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">take</span> (<span class="id" title="var">scr</span> :: <span class="id" title="var">nil</span>, <span class="id" title="var">takeBody1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">leak</span> (<span class="id" title="var">nil</span>, <span class="id" title="var">leakBody4</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">MyModule4</span> := (<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Safe</span> <span class="id" title="var">SafeDef4</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>).<br/>

<br/>
</div>

<div class="doc">
     <h2>Safe 5</h2> - a safe that can leak the secrets of any safe - BAD
   
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">anotherSafe</span> := <span class="id" title="var">bnd</span> 5.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">leakBody5</span> := ((<span class="id" title="var">r_</span> <span class="id" title="var">x</span>) ≔ (<span class="id" title="var">anotherSafe</span> ◌ <span class="id" title="var">secret</span>)) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_rtrn</span> <span class="id" title="var">x</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">SafeDef5</span> := <span class="id" title="var">clazz</span> <span class="id" title="var">Safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">treasure</span> :: <span class="id" title="var">secret</span> :: <span class="id" title="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">take</span> (<span class="id" title="var">scr</span> :: <span class="id" title="var">nil</span>, <span class="id" title="var">takeBody1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">leak</span> (<span class="id" title="var">nil</span>, <span class="id" title="var">leakBody5</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">MyModule5</span> := (<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Safe</span> <span class="id" title="var">SafeDef5</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>).<br/>

<br/>
</div>

<div class="doc">
     <h2>Safe 6</h2> - a safe that can steal the treasure of any other safe - BAD
   
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">steal</span> := <span class="id" title="var">methID</span> 3.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">stealBody6</span> := ((<span class="id" title="var">r_</span> <span class="id" title="var">x</span>) ≔ (<span class="id" title="var">anotherSafe</span> ◌ <span class="id" title="var">treasure</span>)) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_rtrn</span> <span class="id" title="var">x</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">SafeDef6</span> := <span class="id" title="var">clazz</span> <span class="id" title="var">Safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">treasure</span> :: <span class="id" title="var">secret</span> :: <span class="id" title="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">take</span> (<span class="id" title="var">scr</span> :: <span class="id" title="var">nil</span>, <span class="id" title="var">takeBody1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">steal</span> (<span class="id" title="var">anotherSafe</span> :: <span class="id" title="var">nil</span>, <span class="id" title="var">stealBody6</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">MyModule6</span> := (<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Safe</span> <span class="id" title="var">SafeDef6</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>).<br/>

<br/>
</div>

<div class="doc">
     <h2>Safe 7</h2> - a variant of Safe 5 that can leak the secret of any safe that is
                           not this one. - BAD
   
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">leakBody7</span> := (<span class="id" title="var">r_</span> <span class="id" title="var">x</span>) ≔ (<span class="id" title="var">r_exp</span> (<span class="id" title="var">e_null</span>)) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">s_if</span> (<span class="id" title="var">e_var</span> <span class="id" title="var">this</span> ⩵ (<span class="id" title="var">e_var</span> <span class="id" title="var">anotherSafe</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_rtrn</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">r_</span> <span class="id" title="var">x</span>) ≔ (<span class="id" title="var">anotherSafe</span> ◌ <span class="id" title="var">secret</span>))) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s_rtrn</span> <span class="id" title="var">x</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">SafeDef7</span> := <span class="id" title="var">clazz</span> <span class="id" title="var">Safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">treasure</span> :: <span class="id" title="var">secret</span> :: <span class="id" title="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">take</span> (<span class="id" title="var">scr</span> :: <span class="id" title="var">nil</span>, <span class="id" title="var">takeBody1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">leak</span> (<span class="id" title="var">anotherSafe</span> :: <span class="id" title="var">nil</span>, <span class="id" title="var">leakBody7</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">MyModule7</span> := (<span class="id" title="var">update</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Safe</span> <span class="id" title="var">SafeDef7</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>).<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">internal_to</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">a_var</span>) : <span class="id" title="var">asrt</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">ex_var</span> <span class="id" title="var">x</span>) ⩶ (<span class="id" title="var">ex_var</span> <span class="id" title="var">y</span>)) ∨<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">ex_var</span> <span class="id" title="var">x</span>) <span class="id" title="var">secret</span>) ⩶ (<span class="id" title="var">ex_var</span> <span class="id" title="var">y</span>)).<br/>

<br/>
</div>

<div class="doc">
     <h1>Specifications</h1>
   
<div class="paragraph"> </div>


<div class="paragraph"> </div>

     SPEC4 :
     Using set comprehensions we can define the internal_to predicate
   
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">SPEC4</span> := (∀<span class="id" title="var">x</span>∙ (∀<span class="id" title="var">x</span>∙(((¬ <span class="id" title="var">internal_to</span> (<span class="id" title="var">a</span>♢ 1) (<span class="id" title="var">a_</span> 0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a_class</span> (<span class="id" title="var">a</span>♢1) <span class="id" title="var">Safe</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">secret</span>) ⩶ (<span class="id" title="var">e</span>♢0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">treasure</span>) ⩶̸ (<span class="id" title="var">ex_null</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a_will</span> ((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">treasure</span>) ⩶ (<span class="id" title="var">ex_null</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⟶<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(∃<span class="id" title="var">x</span>∙ ((¬ <span class="id" title="var">internal_to</span> (<span class="id" title="var">a</span>♢2) (<span class="id" title="var">a</span>♢0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">a</span>♢0) <span class="id" title="var">access</span> (<span class="id" title="var">a</span>♢1))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))).<br/>

<br/>
</div>

<div class="doc">
     <h2>SPEC 1</h2> - Too Strong
<ul class="doclist">
<li> Original FASE 2020 Safe. 

<div class="paragraph"> </div>

       s.treasure =/= null &amp; Will &lt;s.treasure = null &gt;
<ul class="doclist">
<li>---&gt;

</li>
</ul>
       exists o. <span class="inlinecode"></span> <span class="inlinecode"><span class="id" title="var">External</span>&lt;<a class="idref" href="com.chainmail.loo_def.html#o"><span class="id" title="variable">o</span></a>&gt;</span> <span class="inlinecode">&amp;</span> <span class="inlinecode"><span class="id" title="var">Access</span>&lt;<a class="idref" href="com.chainmail.loo_def.html#o"><span class="id" title="variable">o</span></a>,</span> <span class="inlinecode"><span class="id" title="var">s.secret</span>&gt;</span> <span class="inlinecode"></span>

<div class="paragraph"> </div>

       This spec is too strong. It is not satisfied by either Safe 1 or Safe 2
       because the secret might not be externally known, i.e. it might be stored within another safe, 
       and recursively accessible by an external object.

</li>
</ul>
   
</div>
<div class="code">

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">SPEC1</span> := (∀<span class="id" title="var">x</span>∙ (∀<span class="id" title="var">x</span>∙(((<span class="id" title="var">a_class</span> (<span class="id" title="var">a</span>♢1) <span class="id" title="var">Safe</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">secret</span>) ⩶ (<span class="id" title="var">e</span>♢0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">treasure</span>) ⩶̸ (<span class="id" title="var">ex_null</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a_will</span> ((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">treasure</span>) ⩶ (<span class="id" title="var">ex_null</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⟶<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(∃<span class="id" title="var">x</span>∙ (((<span class="id" title="var">a</span>♢0) <span class="id" title="var">external</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">a</span>♢0) <span class="id" title="var">access</span> (<span class="id" title="var">a</span>♢1))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="var">SPEC1_CounterExample</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> χ0<span class="id" title="var">_SPEC1</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> (<span class="id" title="var">address</span> 0) (<span class="id" title="var">new</span> <span class="id" title="var">Object</span> <span class="id" title="var">empty</span>) <span class="id" title="var">empty</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">β0_SPEC1</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">this</span> (<span class="id" title="var">v_addr</span> (<span class="id" title="var">address</span> 0)) <span class="id" title="var">empty</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">s1</span> := <span class="id" title="var">bnd</span> 101.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">s2</span> := <span class="id" title="var">bnd</span> 102.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">a</span> := <span class="id" title="var">bnd</span> 201.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">b</span> := <span class="id" title="var">bnd</span> 202.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">c</span> := <span class="id" title="var">bnd</span> 203.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">αthis</span> := <span class="id" title="var">address</span> 0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">αa</span> := <span class="id" title="var">address</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">αb</span> := <span class="id" title="var">address</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">αs1</span> := <span class="id" title="var">address</span> 3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">αs2</span> := <span class="id" title="var">address</span> 4.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">s0_SPEC1</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s_new</span> <span class="id" title="var">a</span> <span class="id" title="var">Object</span> <span class="id" title="var">empty</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_new</span> <span class="id" title="var">b</span> <span class="id" title="var">Object</span> <span class="id" title="var">empty</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_new</span> <span class="id" title="var">s1</span> <span class="id" title="var">Safe</span> (<span class="id" title="var">update</span> <span class="id" title="var">secret</span> <span class="id" title="var">a</span> (<span class="id" title="var">update</span> <span class="id" title="var">treasure</span> <span class="id" title="var">a</span> <span class="id" title="var">empty</span>)) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_new</span> <span class="id" title="var">s2</span> <span class="id" title="var">Safe</span> (<span class="id" title="var">update</span> <span class="id" title="var">secret</span> <span class="id" title="var">b</span> (<span class="id" title="var">update</span> <span class="id" title="var">treasure</span> <span class="id" title="var">a</span> <span class="id" title="var">empty</span>)) ;; <span class="comment">(*&nbsp;(A)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_meth</span> <span class="id" title="var">c</span> <span class="id" title="var">s2</span> <span class="id" title="var">take</span> (<span class="id" title="var">update</span> <span class="id" title="var">scr</span> <span class="id" title="var">b</span> <span class="id" title="var">empty</span>) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_meth</span> <span class="id" title="var">c</span> <span class="id" title="var">s1</span> <span class="id" title="var">take</span> (<span class="id" title="var">update</span> <span class="id" title="var">scr</span> <span class="id" title="var">c</span> <span class="id" title="var">empty</span>) ;;                   <span class="comment">(*&nbsp;(B)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s_rtrn</span> <span class="id" title="var">c</span>))))).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">ϕ0_SPEC1</span> := <span class="id" title="var">frm</span> <span class="id" title="var">β0_SPEC1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c_stmt</span> <span class="id" title="var">s0_SPEC1</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> σ0<span class="id" title="var">_SPEC1</span> := (χ0<span class="id" title="var">_SPEC1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ϕ0_SPEC1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id" title="var">nil</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">newObj</span> := <span class="id" title="var">new</span> <span class="id" title="var">Object</span> <span class="id" title="var">empty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">safeObj1</span> := (<span class="id" title="var">new</span> <span class="id" title="var">Safe</span> (<span class="id" title="var">update</span> <span class="id" title="var">secret</span> (<span class="id" title="var">v_addr</span> <span class="id" title="var">αa</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span> <span class="id" title="var">treasure</span> (<span class="id" title="var">v_addr</span> <span class="id" title="var">αa</span>) <span class="id" title="var">empty</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">safeObj2</span> := (<span class="id" title="var">new</span> <span class="id" title="var">Safe</span> (<span class="id" title="var">update</span> <span class="id" title="var">secret</span> (<span class="id" title="var">v_addr</span> <span class="id" title="var">αb</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span> <span class="id" title="var">treasure</span> (<span class="id" title="var">v_addr</span> <span class="id" title="var">αa</span>) <span class="id" title="var">empty</span>))).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> χ<span class="id" title="var">_A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">αs2</span> <span class="id" title="var">safeObj2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span> <span class="id" title="var">αs1</span> <span class="id" title="var">safeObj1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span> <span class="id" title="var">αb</span> <span class="id" title="var">newObj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span> <span class="id" title="var">αa</span> <span class="id" title="var">newObj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span> <span class="id" title="var">αthis</span> <span class="id" title="var">newObj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span>)))).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">β_A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">s2</span> (<span class="id" title="var">v_addr</span> <span class="id" title="var">αs2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span> <span class="id" title="var">s1</span> (<span class="id" title="var">v_addr</span> <span class="id" title="var">αs1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span> <span class="id" title="var">b</span> (<span class="id" title="var">v_addr</span> <span class="id" title="var">αb</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span> <span class="id" title="var">a</span> (<span class="id" title="var">v_addr</span> <span class="id" title="var">αa</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">β0_SPEC1</span>))).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">s_A</span> := <span class="id" title="var">s_meth</span> <span class="id" title="var">c</span> <span class="id" title="var">s2</span> <span class="id" title="var">take</span> (<span class="id" title="var">update</span> <span class="id" title="var">scr</span> <span class="id" title="var">b</span> <span class="id" title="var">empty</span>) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s_meth</span> <span class="id" title="var">c</span> <span class="id" title="var">s1</span> <span class="id" title="var">take</span> (<span class="id" title="var">update</span> <span class="id" title="var">scr</span> <span class="id" title="var">c</span> <span class="id" title="var">empty</span>) ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s_rtrn</span> <span class="id" title="var">c</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">ϕ_A</span> := <span class="id" title="var">frm</span> <span class="id" title="var">β_A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c_stmt</span> <span class="id" title="var">s_A</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> σ<span class="id" title="var">_A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(χ<span class="id" title="var">_A</span>, <span class="id" title="var">ϕ_A</span> :: <span class="id" title="var">nil</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> χ<span class="id" title="var">_B</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">αs1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">new</span> <span class="id" title="var">Safe</span> (<span class="id" title="var">update</span> <span class="id" title="var">treasure</span> <span class="id" title="var">v_null</span> (<span class="id" title="var">flds</span> <span class="id" title="var">safeObj1</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span> <span class="id" title="var">αs2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">new</span> <span class="id" title="var">Safe</span> (<span class="id" title="var">update</span> <span class="id" title="var">treasure</span> <span class="id" title="var">v_null</span> (<span class="id" title="var">flds</span> <span class="id" title="var">safeObj2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ<span class="id" title="var">_A</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">β_B</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">v_addr</span> <span class="id" title="var">αa</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">β_A</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">s_B</span> := <span class="id" title="var">s_rtrn</span> <span class="id" title="var">c</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">ϕ_B</span> := <span class="id" title="var">frm</span> <span class="id" title="var">β_B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c_stmt</span> <span class="id" title="var">s_B</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> σ<span class="id" title="var">_B</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(χ<span class="id" title="var">_B</span>, <span class="id" title="var">ϕ_B</span> :: <span class="id" title="var">nil</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">ExtModule1</span> := (<span class="id" title="var">update</span> <span class="id" title="var">Object</span> <span class="id" title="var">ObjectDefn</span> <span class="id" title="var">empty</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">MyModule1_linked</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MyModule1</span> ⋄ <span class="id" title="var">ExtModule1</span> ≜ (<span class="id" title="var">MyModule1</span> ∪ <span class="id" title="var">ExtModule1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">m_link</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">MyModule1</span>, <span class="id" title="var">ExtModule1</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">eq_dec</span> <span class="id" title="var">C</span> <span class="id" title="var">Safe</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>; <span class="id" title="var">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">exists_linking_MyModule1</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">M</span>, <span class="id" title="var">MyModule1</span> ⋄ <span class="id" title="var">ExtModule1</span> ≜ <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">MyModule1</span> ∪ <span class="id" title="var">ExtModule1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">MyModule1_linked</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> σ0<span class="id" title="var">_SPEC1_is_initial</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">initial</span> σ0<span class="id" title="var">_SPEC1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">initial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">address</span> 0), <span class="id" title="var">ϕ0_SPEC1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">β0_SPEC1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">finite_</span>σ, <span class="id" title="var">finite_</span>ψ, <span class="id" title="var">finite_ϕ</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id" title="var">crush</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">fin_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">map_db</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">not_stuck_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> σ0<span class="id" title="var">_SPEC1_reduces_to_</span>σ<span class="id" title="var">_A</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MyModule1</span> ⦂ <span class="id" title="var">ExtModule1</span> ⦿ σ0<span class="id" title="var">_SPEC1</span> ⤳⋆ σ<span class="id" title="var">_A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">αs2_mapsto_safeObj2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⟦ <span class="id" title="var">αs2</span> ↦ <span class="id" title="var">safeObj2</span> ⟧ ∈ σ<span class="id" title="var">_A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> χ<span class="id" title="var">_A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">αthis_mapsto_newObj</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⟦ <span class="id" title="var">αthis</span> ↦ <span class="id" title="var">newObj</span> ⟧ ∈ σ<span class="id" title="var">_A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> χ<span class="id" title="var">_A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">αa_mapsto_newObj</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⟦ <span class="id" title="var">αa</span> ↦ <span class="id" title="var">newObj</span> ⟧ ∈ σ<span class="id" title="var">_A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> χ<span class="id" title="var">_A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">explode_</span>χ<span class="id" title="var">_A</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">α</span> <span class="id" title="var">o</span>, ⟦ <span class="id" title="var">α</span> ↦ <span class="id" title="var">o</span> ⟧ ∈ σ<span class="id" title="var">_A</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">α</span> = <span class="id" title="var">αthis</span> /\ <span class="id" title="var">o</span> = <span class="id" title="var">newObj</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">α</span> = <span class="id" title="var">αa</span> /\ <span class="id" title="var">o</span> = <span class="id" title="var">newObj</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">α</span> = <span class="id" title="var">αb</span> /\ <span class="id" title="var">o</span> = <span class="id" title="var">newObj</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">α</span> = <span class="id" title="var">αs1</span> /\ <span class="id" title="var">o</span> = <span class="id" title="var">safeObj1</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">α</span> = <span class="id" title="var">αs2</span> /\ <span class="id" title="var">o</span> = <span class="id" title="var">safeObj2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> σ<span class="id" title="var">_A</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> χ<span class="id" title="var">_A</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eq_dec</span> <span class="id" title="var">α</span> <span class="id" title="var">αs2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">simpl_crush</span>; <span class="id" title="var">crush</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eq_dec</span> <span class="id" title="var">α</span> <span class="id" title="var">αs1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">simpl_crush</span>; <span class="id" title="var">crush</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eq_dec</span> <span class="id" title="var">α</span> <span class="id" title="var">αb</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">simpl_crush</span>; <span class="id" title="var">crush</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eq_dec</span> <span class="id" title="var">α</span> <span class="id" title="var">αa</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">simpl_crush</span>; <span class="id" title="var">crush</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eq_dec</span> <span class="id" title="var">α</span> <span class="id" title="var">αthis</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">simpl_crush</span>; <span class="id" title="var">crush</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SPEC1_not_satified_MyModule1</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">MyModule1</span> ⊨<span class="id" title="var">m</span> <span class="id" title="var">SPEC1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mdl_sat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">Hcontra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hcontra</span> <span class="id" title="var">ExtModule1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hcontra</span> σ0<span class="id" title="var">_SPEC1</span> σ<span class="id" title="var">_A</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hcontra</span> <span class="id" title="var">exists_linking_MyModule1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hcontra</span> σ0<span class="id" title="var">_SPEC1_is_initial</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hcontra</span> σ0<span class="id" title="var">_SPEC1_reduces_to_</span>σ<span class="id" title="var">_A</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H4</span> <span class="id" title="var">αs2</span> <span class="id" title="var">safeObj2</span> <span class="id" title="var">αs2_mapsto_safeObj2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H5</span> <span class="id" title="var">αa</span> <span class="id" title="var">newObj</span> <span class="id" title="var">αa_mapsto_newObj</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H5</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H6</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">explode_</span>χ<span class="id" title="var">_A</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a_prop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <span class="id" title="var">_</span> \/ <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">unfold</span> <span class="id" title="var">αthis</span>, <span class="id" title="var">αa</span> <span class="id" title="tactic">in</span> *; <span class="id" title="var">crush</span>| |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">admit</span>.<br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;inversion&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">αa</span>,</span> <span class="inlinecode"><span class="id" title="var">αa</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode">*;</span> <span class="inlinecode"><span class="id" title="var">crush</span>|</span> <span class="inlinecode">|</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;admit.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;admit.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;inversion&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">αb</span>,</span> <span class="inlinecode"><span class="id" title="var">αs2</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode">*;</span> <span class="inlinecode"><span class="id" title="var">crush</span>|</span> <span class="inlinecode">|</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;admit.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;admit.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;χ_A&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(eqb&nbsp;αs1&nbsp;αs2);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl_crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;MyModule1&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;χ_A&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl_crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;MyModule1&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-*)</span><br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">SPEC1_CounterExample</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SPEC1_not_satified_MyModule2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">MyModule2</span> ⊨<span class="id" title="var">m</span> <span class="id" title="var">SPEC1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
</div>

<div class="doc">
     <h2>SPEC 2</h2> - Too Weak.
     An attempt to exclude the case where secret is stored within another safe.

<div class="paragraph"> </div>

     s.treasure ≠ null &amp; Will &lt;s.treasure = null &gt;
        &amp; (∀ s’. s' = s \/ ¬ internal s' \/ ¬ Access&lt;s', s.secret&gt;)
     ⟶
     ∃ o. <span class="inlinecode"></span> <span class="inlinecode"><span class="id" title="var">External</span>&lt;<a class="idref" href="com.chainmail.loo_def.html#o"><span class="id" title="variable">o</span></a>&gt;</span> <span class="inlinecode">&amp;</span> <span class="inlinecode"><span class="id" title="var">Access</span>&lt;<a class="idref" href="com.chainmail.loo_def.html#o"><span class="id" title="variable">o</span></a>,</span> <span class="inlinecode"><span class="id" title="var">s.secret</span>&gt;</span> <span class="inlinecode"></span>

<div class="paragraph"> </div>

     This spec is too weak.
     It does not make any claims about what happens when a secret is stored within another safe.
     i.e. if the client is using one safe as a password manager, then we make no assurances.
     It is satisfied by Safe 1 and Safe 2, but not Safe 3, Safe 4, Safe 5, or Safe 6.
   
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">SPEC2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(∀<span class="id" title="var">x</span>∙ (∀<span class="id" title="var">x</span>∙((((<span class="id" title="var">a_class</span> (<span class="id" title="var">a</span>♢1) <span class="id" title="var">Safe</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">secret</span>) ⩶ (<span class="id" title="var">e</span>♢0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">treasure</span>) ⩶̸ (<span class="id" title="var">ex_null</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a_will</span> ((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">treasure</span>) ⩶ (<span class="id" title="var">ex_null</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(∀<span class="id" title="var">x</span>∙((<span class="id" title="var">e</span>♢ 0) ⩶ (<span class="id" title="var">e</span>♢ 2) ∨<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(¬ ((<span class="id" title="var">a</span>♢ 0) <span class="id" title="var">internal</span>)) ∨<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(¬ ((<span class="id" title="var">a</span>♢ 0) <span class="id" title="var">access</span> (<span class="id" title="var">a</span>♢ 1)))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⟶<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(∃<span class="id" title="var">x</span>∙ (((<span class="id" title="var">a</span>♢0) <span class="id" title="var">external</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">a</span>♢0) <span class="id" title="var">access</span> (<span class="id" title="var">a</span>♢1))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;)))).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SPEC2_satisfied_MyModule1</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MyModule1</span> ⊨<span class="id" title="var">m</span> <span class="id" title="var">SPEC2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SPEC2_satisfied_MyModule2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MyModule2</span> ⊨<span class="id" title="var">m</span> <span class="id" title="var">SPEC2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SPEC2_satisfied_MyModule3</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">MyModule3</span> ⊨<span class="id" title="var">m</span> <span class="id" title="var">SPEC2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SPEC2_satisfied_MyModule4</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">MyModule4</span> ⊨<span class="id" title="var">m</span> <span class="id" title="var">SPEC2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SPEC2_satisfied_MyModule5</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">MyModule5</span> ⊨<span class="id" title="var">m</span> <span class="id" title="var">SPEC2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SPEC2_satisfied_MyModule6</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">MyModule6</span> ⊨<span class="id" title="var">m</span> <span class="id" title="var">SPEC2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
</div>

<div class="doc">
     <h2>SPEC 3</h2> - 
     Specification of leaking.

<div class="paragraph"> </div>

     ∀ s. s : Safe /\
          ∀ x m β y. x calls s ▸ m (β) /\
                    ~ y access s.secret
         ⟶
                    next &lt;~ y access s.secret&gt;

<div class="paragraph"> </div>

     SPEC2 specifies that any method call to a safe will never result in the exposure
     of the secret.
     It is satisfied by Safe 1 and Safe 2, but not Safe 3, Safe 4, Safe 5, or Safe 6.
     It is also satisfied by Safe 7. i.e. a safe cannot expose its own secret, but it
     can expose any other safe's secret.
   
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">a_expose</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">a_var</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(∃<span class="id" title="var">m</span>∙ (∃<span class="id" title="var">x</span>∙ ((¬ ((<span class="id" title="var">a</span>♢ 0) <span class="id" title="var">access</span> <span class="id" title="var">y</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;x 'exposes' y" := (<span class="id" title="var">a_expose</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">SPEC3</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(∀<span class="id" title="var">x</span>∙ (∀<span class="id" title="var">x</span>∙((((<span class="id" title="var">a_class</span> (<span class="id" title="var">a</span>♢1) <span class="id" title="var">Safe</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">secret</span>) ⩶ (<span class="id" title="var">e</span>♢0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">treasure</span>) ⩶̸ (<span class="id" title="var">ex_null</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a_will</span> ((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">treasure</span>) ⩶ (<span class="id" title="var">ex_null</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(∀<span class="id" title="var">x</span>∙((<span class="id" title="var">e</span>♢ 0) ⩶ (<span class="id" title="var">e</span>♢ 2) ∨<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(¬ ((<span class="id" title="var">a</span>♢ 0) <span class="id" title="var">internal</span>)) ∨<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(¬ ((<span class="id" title="var">a</span>♢ 0) <span class="id" title="var">access</span> (<span class="id" title="var">a</span>♢ 1)))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⟶<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(∃<span class="id" title="var">x</span>∙ (((<span class="id" title="var">a</span>♢0) <span class="id" title="var">external</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">a</span>♢0) <span class="id" title="var">access</span> (<span class="id" title="var">a</span>♢1))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;)))).<br/>

<br/>
</div>

<div class="doc">
MyModule Definition 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">link_MyModule1_Safe</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M'</span> <span class="id" title="var">M</span>, <span class="id" title="var">MyModule1</span> ⋄ <span class="id" title="var">M'</span> ≜ <span class="id" title="var">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">M</span> <span class="id" title="var">Safe</span> = <span class="id" title="var">Some</span> <span class="id" title="var">SafeDef1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">MyModule1</span>, <span class="id" title="var">extend</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">pr_linking</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">Hred</span> : ?<span class="id" title="var">Ma</span> ⦂ ?<span class="id" title="var">Mb</span> ⦿ ?σ ⤳ ?σ' |- <span class="id" title="var">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">M</span> := <span class="id" title="tactic">fresh</span> "M'" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span> : <span class="id" title="tactic">exists</span> <span class="id" title="var">M'</span>, <span class="id" title="var">Ma</span> ⋄ <span class="id" title="var">Mb</span> ≜ <span class="id" title="var">M'</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hred</span>; <span class="id" title="tactic">eauto</span>|<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">M'</span>]]<br/>
      <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">hoare_pair_reduction_step</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [|- ?<span class="id" title="var">Ma</span> ⦂ ?<span class="id" title="var">Mb</span> ⦿ {<span class="id" title="var">pre</span>: ?<span class="id" title="var">P</span>} ?σ<span class="id" title="var">a</span> {<span class="id" title="var">post</span>: ?<span class="id" title="var">Q</span>}] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">excluded_middle</span> (<span class="id" title="tactic">exists</span> σ', <span class="id" title="var">Ma</span> ⦂ <span class="id" title="var">Mb</span> ⦿ σ<span class="id" title="var">a</span> ⤳ σ')) <span class="id" title="keyword">as</span> [|<span class="id" title="var">Hcontra</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">destruct_exists_loo</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">apply</span> <span class="id" title="var">ht_pr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span> <span class="id" title="var">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_reductions_implies_pair_reduction</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pr_linking</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">link_unique_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">Hlink</span> : <span class="id" title="var">Ma</span> ⋄ <span class="id" title="var">Mb</span> ≜ ?<span class="id" title="var">Mc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hred</span> : <span class="id" title="var">Ma</span> ⦂ <span class="id" title="var">Mb</span> ⦿ σ<span class="id" title="var">a</span> ⤳ ?σ<span class="id" title="var">b</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_reductions_implies_pair_reduction</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">M</span>:=<span class="id" title="var">Mc</span>)(σ2:=σ<span class="id" title="var">b</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">internal_MyModule1_is_take</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M</span> σ, <span class="id" title="var">internal_step</span> <span class="id" title="var">MyModule1</span> <span class="id" title="var">M</span> σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M'</span>, <span class="id" title="var">MyModule1</span> ⋄ <span class="id" title="var">M</span> ≜ <span class="id" title="var">M'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">mySecret</span> <span class="id" title="var">s</span>, <span class="id" title="var">contn_is</span> (<span class="id" title="var">s_meth</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">take</span> (<span class="id" title="var">update</span> <span class="id" title="var">scr</span> <span class="id" title="var">mySecret</span> <span class="id" title="var">empty</span>) ;; <span class="id" title="var">s</span>) σ /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">classOf</span> <span class="id" title="var">y</span> σ <span class="id" title="var">Safe</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">M'</span> ∙ σ ⊢ (<span class="id" title="var">e_var</span> <span class="id" title="var">mySecret</span> ⩵ (<span class="id" title="var">e_acc_f</span> (<span class="id" title="var">e_var</span> <span class="id" title="var">y</span>) <span class="id" title="var">secret</span>)) ↪ <span class="id" title="var">v_true</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">M'</span> ∙ σ ⊢ (<span class="id" title="var">e_var</span> <span class="id" title="var">mySecret</span> ⩵ (<span class="id" title="var">e_acc_f</span> (<span class="id" title="var">e_var</span> <span class="id" title="var">y</span>) <span class="id" title="var">secret</span>)) ↪ <span class="id" title="var">v_false</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <span class="id" title="var">take_correct_secret_unchanged_heap</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M</span> <span class="id" title="var">M'</span>, <span class="id" title="var">MyModule1</span> ⋄ <span class="id" title="var">M</span> ≜ <span class="id" title="var">M'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> σ <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">mySecret</span> <span class="id" title="var">s</span> <span class="id" title="var">α</span> , <span class="id" title="var">MyModule1</span> ⦂ <span class="id" title="var">M</span> ⦿<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">pre</span>: <span class="id" title="keyword">fun</span> σ =&gt; <span class="id" title="var">contn_is</span> ((<span class="id" title="var">s_meth</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">take</span> (<span class="id" title="var">update</span> <span class="id" title="var">scr</span> <span class="id" title="var">mySecret</span> <span class="id" title="var">empty</span>) ;; <span class="id" title="var">s</span>)) σ /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⟦ <span class="id" title="var">y</span> ↦ (<span class="id" title="var">v_addr</span> <span class="id" title="var">α</span>) ⟧ ∈ σ /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">classOf</span> <span class="id" title="var">y</span> σ <span class="id" title="var">Safe</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">M'</span> ∙ σ ⊢ (<span class="id" title="var">e_var</span> <span class="id" title="var">mySecret</span> ⩵ (<span class="id" title="var">e_acc_f</span> (<span class="id" title="var">e_var</span> <span class="id" title="var">y</span>) <span class="id" title="var">secret</span>)) ↪ <span class="id" title="var">v_true</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">post</span>: <span class="id" title="var">fieldUpdatedValue</span> σ <span class="id" title="var">y</span> <span class="id" title="var">secret</span> <span class="id" title="var">v_null</span>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <span class="id" title="var">take_incorrect_secret_unchanged_heap</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">M</span> <span class="id" title="var">M'</span>, <span class="id" title="var">MyModule1</span> ⋄ <span class="id" title="var">M</span> ≜ <span class="id" title="var">M'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> σ <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">mySecret</span> <span class="id" title="var">s</span>, <span class="id" title="var">MyModule1</span> ⦂ <span class="id" title="var">M</span> ⦿<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">pre</span>: <span class="id" title="keyword">fun</span> σ =&gt; <span class="id" title="var">contn_is</span> ((<span class="id" title="var">s_meth</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">take</span> (<span class="id" title="var">update</span> <span class="id" title="var">scr</span> <span class="id" title="var">mySecret</span> <span class="id" title="var">empty</span>) ;; <span class="id" title="var">s</span>)) σ /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">classOf</span> <span class="id" title="var">y</span> σ <span class="id" title="var">Safe</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">M'</span> ∙ σ ⊢ (<span class="id" title="var">e_var</span> <span class="id" title="var">mySecret</span> ⩵ (<span class="id" title="var">e_acc_f</span> (<span class="id" title="var">e_var</span> <span class="id" title="var">y</span>) <span class="id" title="var">secret</span>)) ↪ <span class="id" title="var">v_false</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">post</span>: <span class="id" title="var">heapUnchanged</span> σ}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">HolisticSpec</span> := (∀<span class="id" title="var">x</span>∙ (∀<span class="id" title="var">x</span>∙(((<span class="id" title="var">a_class</span> (<span class="id" title="var">a</span>♢1) <span class="id" title="var">Safe</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">secret</span>) ⩶ (<span class="id" title="var">e</span>♢0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">treasure</span>) ⩶̸ (<span class="id" title="var">ex_null</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a_will</span> ((<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e</span>♢1) <span class="id" title="var">treasure</span>) ⩶ (<span class="id" title="var">ex_null</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⟶<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a_will</span> (∃<span class="id" title="var">x</span>∙ (((<span class="id" title="var">a</span>♢0) <span class="id" title="var">external</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">a</span>♢0) <span class="id" title="var">access</span> (<span class="id" title="var">a</span>♢1))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∨<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(∃<span class="id" title="var">x</span>∙ (((<span class="id" title="var">a</span>♢0) <span class="id" title="var">external</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">a</span>♢0) <span class="id" title="var">access</span> (<span class="id" title="var">a</span>♢1))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)))).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <span class="id" title="var">safe_example</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MyModule1</span> ⊨<span class="id" title="var">m</span> <span class="id" title="var">HolisticSpec</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mdl_sat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_exists_loo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">HolisticSpec</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a_intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a_prop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H5</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> σ := <span class="id" title="tactic">fresh</span> "σ" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">pair_reduction_change</span> <span class="id" title="var">MyModule1</span> <span class="id" title="var">M'</span> (χ, <span class="id" title="var">ϕ</span> :: <span class="id" title="var">nil</span>) σ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="var">P</span> := <span class="id" title="keyword">fun</span> (<span class="id" title="var">M1</span> <span class="id" title="var">M2</span> : <span class="id" title="var">mdl</span>)(σ : <span class="id" title="var">config</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">M1</span> ⦂ <span class="id" title="var">M2</span> ◎ (χ, <span class="id" title="var">ϕ</span> :: <span class="id" title="var">nil</span>) … σ ⊨ (<span class="id" title="var">ex_acc_f</span> (<span class="id" title="var">e_</span> <span class="id" title="var">α</span>) <span class="id" title="var">treasure</span> ⩶̸ (<span class="id" title="var">ex_null</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [σ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_head_exp</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_initial_exp</span>; <span class="id" title="tactic">eauto</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">Hcontra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H15</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">link_unique_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <span class="id" title="var">is_exp</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">e'</span> |- <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H20</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H18</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eval_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">crush</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">destruct_exists_loo</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">pair_reduction_inversion_hoare</span> <span class="id" title="var">MyModule1</span> <span class="id" title="var">M'</span> σ σ1); <span class="id" title="tactic">auto</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <span class="id" title="var">external_step_leaves_internal_field_unchanged</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ':=σ1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span> <span class="id" title="var">Ha2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">contradiction</span> <span class="id" title="var">Hb0</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">assert</span> (<span class="id" title="var">MyModule1</span> ⦂ <span class="id" title="var">M'</span> ◎ σ0 … (χ, <span class="id" title="var">ϕ</span> :: ψ) ⊨ ((<span class="id" title="var">a_</span> <span class="id" title="var">α</span>) <span class="id" title="var">internal</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H4</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">sat_intrn</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">o</span>:=<span class="id" title="var">o1</span>)(<span class="id" title="var">C</span>:=<span class="id" title="var">Safe</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">MyModule1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">destruct</span> <span class="id" title="var">Ha</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">eapply</span> <span class="id" title="var">internal_stack_head_1</span>, <span class="id" title="var">internal_independent_of_initial</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">eapply</span> <span class="id" title="var">internal_unchanged_by_reduction</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">internal_stack_head_1</span>; <span class="id" title="tactic">eauto</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <span class="id" title="var">internal_MyModule1_is_take</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">M'</span>:=<span class="id" title="var">M</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H8</span>; <span class="id" title="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">destruct_exists_loo</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hb1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">assert</span> (<span class="id" title="var">fieldUpdatedValue</span> σ <span class="id" title="var">x1</span> <span class="id" title="var">secret</span> <span class="id" title="var">v_null</span> σ1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Ha4</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<span class="id" title="var">hoare_triple_pr_inversion</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span>:=<span class="id" title="keyword">fun</span> σ =&gt; <span class="id" title="var">contn_is</span> ((<span class="id" title="var">s_meth</span> <span class="id" title="var">x0</span> <span class="id" title="var">x1</span> <span class="id" title="var">take</span> (<span class="id" title="var">update</span> <span class="id" title="var">scr</span> <span class="id" title="var">x2</span> <span class="id" title="var">empty</span>) ;; <span class="id" title="var">s</span>)) σ /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⟦ <span class="id" title="var">x1</span> ↦ (<span class="id" title="var">v_addr</span> <span class="id" title="var">α1</span>) ⟧ ∈ σ /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">classOf</span> <span class="id" title="var">x1</span> σ <span class="id" title="var">Safe</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">M</span> ∙ σ ⊢ (<span class="id" title="var">e_var</span> <span class="id" title="var">x2</span> ⩵ (<span class="id" title="var">e_acc_f</span> (<span class="id" title="var">e_var</span> <span class="id" title="var">x1</span>) <span class="id" title="var">secret</span>)) ↪ <span class="id" title="var">v_true</span>); <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">apply</span> <span class="id" title="var">take_correct_secret_unchanged_heap</span>; <span class="id" title="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H9</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">auto</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Ha</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">right</span>|<span class="id" title="tactic">left</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Hex</span> : <span class="id" title="var">external_self</span> <span class="id" title="var">MyModule1</span> <span class="id" title="var">M'</span> (χ, <span class="id" title="var">ϕ</span> :: ψ));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">eapply</span> <span class="id" title="var">external_self_head1</span>, <span class="id" title="var">pair_reductions_external_self1</span>; <span class="id" title="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">unfold</span> <span class="id" title="var">external_self</span>, <span class="id" title="var">is_external</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hex</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">destruct_exists_loo</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">andDestruct</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">sat_ex_x</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">α</span>:=<span class="id" title="var">α1</span>)(<span class="id" title="var">o</span>:=<span class="id" title="var">o1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">a_prop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_extrn</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">inversion</span> <span class="id" title="var">Ha3</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">simpl_crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_access3</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">x</span>:=<span class="id" title="var">x2</span>); <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">loo_db</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">apply</span> <span class="id" title="var">in_stmts_1</span>, <span class="id" title="var">in_meth_3</span>; <span class="id" title="tactic">exists</span> <span class="id" title="var">scr</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">apply</span> <span class="id" title="var">sat_will</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">ϕ</span>:=<span class="id" title="var">ϕ</span>)(ψ:=ψ)(χ:=χ)(σ':=σ);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Hex</span> : <span class="id" title="var">external_self</span> <span class="id" title="var">MyModule1</span> <span class="id" title="var">M'</span> σ);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">eapply</span> <span class="id" title="var">pair_reductions_external_self2</span>; <span class="id" title="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">unfold</span> <span class="id" title="var">external_self</span>, <span class="id" title="var">is_external</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hex</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">destruct_exists_loo</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">andDestruct</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">sat_ex_x</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">α</span>:=<span class="id" title="var">α1</span>)(<span class="id" title="var">o</span>:=<span class="id" title="var">o1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">a_prop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_extrn</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">inversion</span> <span class="id" title="var">Ha3</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> σ <span class="id" title="keyword">as</span> [χ' ψ'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">simpl_crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sat_access3</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">x</span>:=<span class="id" title="var">x2</span>); <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">loo_db</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">apply</span> <span class="id" title="var">in_stmts_1</span>, <span class="id" title="var">in_meth_3</span>; <span class="id" title="tactic">exists</span> <span class="id" title="var">scr</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="var">map_rewrite</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">contradiction</span> (<span class="id" title="var">fieldChange_not_heapUnchanged</span> <span class="id" title="var">MyModule1</span> <span class="id" title="var">M'</span> (χ, <span class="id" title="var">ϕ</span> :: <span class="id" title="var">nil</span>) σ <span class="id" title="var">α</span> <span class="id" title="var">treasure</span> (<span class="id" title="var">ex_null</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (σ':=σ1); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">apply</span> <span class="id" title="var">ht_pr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unique_reduction_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">not_neq_implies_eq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_triple_pr_inversion</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">M1</span>:=<span class="id" title="var">MyModule1</span>)(<span class="id" title="var">M2</span>:=<span class="id" title="var">M'</span>)(σ:=σ);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">take_incorrect_secret_unchanged_heap</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">SafeExample</span>.<br/>

<br/>
<span class="comment">(*Lemma&nbsp;linked_class&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;M,&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;C&nbsp;Def,&nbsp;C&nbsp;&lt;&gt;&nbsp;ObjectName&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;C&nbsp;=&nbsp;Some&nbsp;Def&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;C&nbsp;=&nbsp;Some&nbsp;Def.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M1&nbsp;M2&nbsp;M&nbsp;Hlink;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hlink;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;extend;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;substmt_trans&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;s2&nbsp;s3,&nbsp;substmt&nbsp;s2&nbsp;s3&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;s1,&nbsp;substmt&nbsp;s1&nbsp;s2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substmt&nbsp;s1&nbsp;s3.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;s2&nbsp;s3&nbsp;Hsub;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hsub;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;apply&nbsp;sub_if1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;apply&nbsp;sub_if2;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;apply&nbsp;sub_stmt1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;apply&nbsp;sub_stmt2;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
<br/>
Qed.<br/>
<br/>
Hint&nbsp;Resolve&nbsp;substmt_trans&nbsp;:&nbsp;loo_db.<br/>
<br/>
Lemma&nbsp;reduction_field_change&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ1&nbsp;ϕ1&nbsp;ψ1&nbsp;χ2&nbsp;ϕ2&nbsp;ψ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;ψ1)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2&nbsp;=&nbsp;(χ2,&nbsp;ϕ2&nbsp;::&nbsp;ψ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;α&nbsp;o1&nbsp;o2&nbsp;f&nbsp;v1&nbsp;v2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapp&nbsp;σ1&nbsp;α&nbsp;=&nbsp;Some&nbsp;o1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapp&nbsp;σ2&nbsp;α&nbsp;=&nbsp;Some&nbsp;o2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;o1&nbsp;f&nbsp;=&nbsp;Some&nbsp;v1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;o2&nbsp;f&nbsp;=&nbsp;Some&nbsp;v2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v1&nbsp;&lt;&gt;&nbsp;v2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;x&nbsp;y&nbsp;s&nbsp;C,&nbsp;contn&nbsp;ϕ1&nbsp;=&nbsp;c_stmt&nbsp;((x&nbsp;◌&nbsp;f)&nbsp;≔&nbsp;(r_&nbsp;y)&nbsp;;;&nbsp;s)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊&nbsp;x&nbsp;⌋&nbsp;σ1&nbsp;≜&nbsp;(v_addr&nbsp;α)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classOf&nbsp;this&nbsp;σ1&nbsp;C&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classOf&nbsp;x&nbsp;σ1&nbsp;C&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊&nbsp;y&nbsp;⌋&nbsp;σ1&nbsp;≜&nbsp;v2.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">simpl_crush</span>;</span>
               <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">map_rewrite</span>;</span>
               <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode">*;</span>
               <span class="inlinecode"><span class="id" title="var">crush</span></span>.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;subst;&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(eq_dec&nbsp;α&nbsp;α0);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;destruct&nbsp;(eq_dec&nbsp;f0&nbsp;f);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;exists&nbsp;y,&nbsp;x,&nbsp;s,&nbsp;C;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;H5&nbsp;in&nbsp;H13;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H13;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(Htmp&nbsp;:&nbsp;o2&nbsp;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|&nbsp;cname&nbsp;:=&nbsp;cname&nbsp;o1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;:=&nbsp;fun&nbsp;x&nbsp;:&nbsp;fld&nbsp;=&gt;&nbsp;if&nbsp;eqb&nbsp;x&nbsp;f&nbsp;then&nbsp;Some&nbsp;v&nbsp;else&nbsp;flds&nbsp;o1&nbsp;x&nbsp;|});<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span>|<span class="id" title="tactic">rewrite</span></span> <span class="inlinecode"><span class="id" title="var">Htmp</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">H16</span>;</span> <span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">flds</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode">*</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(Hflds&nbsp;:&nbsp;(let&nbsp;(_,&nbsp;flds)&nbsp;:=&nbsp;o1&nbsp;in&nbsp;flds)&nbsp;=&nbsp;(flds&nbsp;o1));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">auto</span>|<span class="id" title="tactic">rewrite</span></span> <span class="inlinecode"><span class="id" title="var">Hflds</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">H16</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;H5&nbsp;in&nbsp;H13;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H13;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(Htmp&nbsp;:&nbsp;o2&nbsp;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|&nbsp;cname&nbsp;:=&nbsp;cname&nbsp;o1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;:=&nbsp;fun&nbsp;x&nbsp;:&nbsp;fld&nbsp;=&gt;&nbsp;if&nbsp;eqb&nbsp;x&nbsp;f&nbsp;then&nbsp;Some&nbsp;v&nbsp;else&nbsp;flds&nbsp;o1&nbsp;x&nbsp;|});<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span>|<span class="id" title="tactic">rewrite</span></span> <span class="inlinecode"><span class="id" title="var">Htmp</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">H16</span>;</span> <span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">flds</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode">*</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(Hflds&nbsp;:&nbsp;(let&nbsp;(_,&nbsp;flds)&nbsp;:=&nbsp;o1&nbsp;in&nbsp;flds)&nbsp;=&nbsp;(flds&nbsp;o1));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">auto</span>|<span class="id" title="tactic">rewrite</span></span> <span class="inlinecode"><span class="id" title="var">Hflds</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">H16</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;subst;&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(eq_dec&nbsp;α&nbsp;α0);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;eapply&nbsp;fresh_heap_some_contradiction;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
Qed.<br/>
<br/>
Lemma&nbsp;reductions_prop_change&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;P,&nbsp;~&nbsp;P&nbsp;σ1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;σ&nbsp;σ',&nbsp;M&nbsp;∙&nbsp;σ&nbsp;⤳&nbsp;σ'&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;P&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;σ'&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(reductions&nbsp;M&nbsp;σ1&nbsp;σ&nbsp;\/&nbsp;σ1&nbsp;=&nbsp;σ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(reductions&nbsp;M&nbsp;σ'&nbsp;σ2&nbsp;\/&nbsp;σ2&nbsp;=&nbsp;σ').<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;repeat&nbsp;eexists;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;destruct&nbsp;(excluded_middle&nbsp;(P&nbsp;σ2))&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">Hprop</span>|<span class="id" title="var">Hprop</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;destruct&nbsp;(IHHred&nbsp;P);&nbsp;auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">reductions</span></span> <span class="inlinecode">?<span class="id" title="var">M</span></span> <span class="inlinecode">?σ1</span> <span class="inlinecode">?σ</span> <span class="inlinecode">\/</span> <span class="inlinecode">?σ1</span> <span class="inlinecode">=</span> <span class="inlinecode">?σ,</span>
              <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">reductions</span></span> <span class="inlinecode">?<span class="id" title="var">M</span></span> <span class="inlinecode">?σ'</span> <span class="inlinecode">?σ2</span> <span class="inlinecode">\/</span> <span class="inlinecode">?σ2</span> <span class="inlinecode">=</span> <span class="inlinecode">?σ'</span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Ha,&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="tactic">eexists</span>;</span> <span class="inlinecode"><span class="id" title="tactic">eauto</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode"><span class="id" title="var">loo_db</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;repeat&nbsp;eexists;&nbsp;eauto.<br/>
<br/>
Qed.<br/>
<br/>
Check&nbsp;reduction_field_change.<br/>
<br/>
<br/>
Inductive&nbsp;stmt_in_method&nbsp;:&nbsp;mdl&nbsp;-&gt;&nbsp;heap&nbsp;-&gt;&nbsp;addr&nbsp;-&gt;&nbsp;mth&nbsp;-&gt;&nbsp;stmt&nbsp;-&gt;&nbsp;Prop&nbsp;:=<br/>
|&nbsp;in_mth&nbsp;:&nbsp;forall&nbsp;χ&nbsp;α&nbsp;m&nbsp;o&nbsp;M&nbsp;C&nbsp;CDef&nbsp;zs&nbsp;sm&nbsp;s,&nbsp;χ&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cname&nbsp;o&nbsp;=&nbsp;C&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;C&nbsp;=&nbsp;Some&nbsp;CDef&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c_meths&nbsp;CDef&nbsp;m&nbsp;=&nbsp;Some&nbsp;(zs,&nbsp;sm)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substmt&nbsp;s&nbsp;sm&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ&nbsp;α&nbsp;m&nbsp;s.<br/>
<br/>
Inductive&nbsp;method_is_called&nbsp;:&nbsp;config&nbsp;-&gt;&nbsp;var&nbsp;-&gt;&nbsp;addr&nbsp;-&gt;&nbsp;mth&nbsp;-&gt;&nbsp;partial_map&nbsp;var&nbsp;value&nbsp;-&gt;&nbsp;Prop&nbsp;:=<br/>
|&nbsp;meth_called&nbsp;:&nbsp;forall&nbsp;x&nbsp;y&nbsp;m&nbsp;β&nbsp;s&nbsp;α&nbsp;ϕ&nbsp;χ&nbsp;ψ,&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;(s_meth&nbsp;x&nbsp;y&nbsp;m&nbsp;β&nbsp;;;&nbsp;s)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊&nbsp;y&nbsp;⌋&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;≜&nbsp;(v_addr&nbsp;α)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method_is_called&nbsp;(χ,&nbsp;ϕ::ψ)&nbsp;x&nbsp;α&nbsp;m&nbsp;(β&nbsp;∘&nbsp;(vMap&nbsp;ϕ)).<br/>
<br/>
Hint&nbsp;Constructors&nbsp;method_is_called&nbsp;stmt_in_method&nbsp;:&nbsp;loo_db.<br/>
<br/>
Lemma&nbsp;arising_frame_is_method_call_reduction&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ1&nbsp;χ2&nbsp;ϕ1&nbsp;ϕ2&nbsp;ψ1&nbsp;ψ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;ψ1)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2&nbsp;=&nbsp;(χ2,&nbsp;ϕ2&nbsp;::&nbsp;ψ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;length&nbsp;(snd&nbsp;σ1)&nbsp;&lt;&nbsp;length&nbsp;(snd&nbsp;σ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;s,&nbsp;method_is_called&nbsp;σ1&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ1&nbsp;α&nbsp;m&nbsp;s).<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
<br/>
&nbsp;&nbsp;exists&nbsp;x,&nbsp;α,&nbsp;m,&nbsp;(ps&nbsp;∘&nbsp;vMap&nbsp;ϕ1),&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eauto&nbsp;with&nbsp;loo_db.<br/>
&nbsp;&nbsp;eapply&nbsp;meth_called;&nbsp;eauto.<br/>
<br/>
Qed.<br/>
<br/>
<span class="comment">(*Lemma&nbsp;arising_frame_is_method_call_reduction'&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ1&nbsp;χ2&nbsp;ψ1&nbsp;ψ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ψ1)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2&nbsp;=&nbsp;(χ2,&nbsp;ψ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(forall&nbsp;ϕ1,&nbsp;In&nbsp;ϕ1&nbsp;ψ1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;ψ',&nbsp;ψ1&nbsp;=&nbsp;ψ'&nbsp;++&nbsp;ϕ1&nbsp;::&nbsp;nil)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;α&nbsp;m&nbsp;β&nbsp;s,&nbsp;method_is_called&nbsp;σ1&nbsp;α&nbsp;m&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ1&nbsp;α&nbsp;m&nbsp;s)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;α&nbsp;m&nbsp;β&nbsp;s,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions&nbsp;M&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;σ2&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method_is_called&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;α&nbsp;m&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;\/&nbsp;exists&nbsp;x,&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_hole&nbsp;x&nbsp;s)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ&nbsp;α&nbsp;m&nbsp;s))&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;ϕ2,&nbsp;In&nbsp;ϕ2&nbsp;ψ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;ψ',&nbsp;ψ2&nbsp;=&nbsp;ψ'&nbsp;++&nbsp;ϕ2&nbsp;::&nbsp;nil)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;α&nbsp;m&nbsp;β&nbsp;s,&nbsp;method_is_called&nbsp;σ1&nbsp;α&nbsp;m&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ1&nbsp;α&nbsp;m&nbsp;s)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;α&nbsp;m&nbsp;β&nbsp;s,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions&nbsp;M&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;σ2&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method_is_called&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;α&nbsp;m&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;\/&nbsp;exists&nbsp;x,&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_hole&nbsp;x&nbsp;s)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ&nbsp;α&nbsp;m&nbsp;s).<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;admit.<br/>
<br/>
Qed.*)</span><br/>
<br/>
Lemma&nbsp;arising_frame_is_method_call_reductions&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ1&nbsp;χ2&nbsp;ϕ1&nbsp;ψ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;nil)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2&nbsp;=&nbsp;(χ2,&nbsp;ψ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;ϕ2,&nbsp;In&nbsp;ϕ2&nbsp;ψ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;ψ',&nbsp;ψ2&nbsp;=&nbsp;ψ'&nbsp;++&nbsp;ϕ2&nbsp;::&nbsp;nil)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;s,&nbsp;method_is_called&nbsp;σ1&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ1&nbsp;α&nbsp;m&nbsp;s)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;s,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions&nbsp;M&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;σ2&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method_is_called&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;\/&nbsp;exists&nbsp;y,&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_hole&nbsp;y&nbsp;s)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ&nbsp;α&nbsp;m&nbsp;s).<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="tactic">left</span>;</span>
                 <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="keyword">goal</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span>
                 <span class="inlinecode">|</span> <span class="inlinecode">[<span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">In</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">(?<span class="id" title="var">ϕ'</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span>)|-</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
                   <span class="inlinecode"><span class="id" title="tactic">inversion</span></span> <span class="inlinecode"><span class="id" title="var">H</span>;</span>
                   <span class="inlinecode"><span class="id" title="tactic">subst</span>;</span> <span class="inlinecode">[|<span class="id" title="var">crush</span>]</span>
                 <span class="inlinecode"><span class="id" title="keyword">end</span>;</span>
                 <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="keyword">goal</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span>
                 <span class="inlinecode">|</span> <span class="inlinecode">[|-</span> <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode">ψ',</span> <span class="inlinecode">?<span class="id" title="var">ϕ2</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">=</span> <span class="inlinecode">ψ'</span> <span class="inlinecode">++</span> <span class="inlinecode">?<span class="id" title="var">ϕ2</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">]</span> <span class="inlinecode">=&gt;</span>
                   <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode"><span class="id" title="var">nil</span>;</span>
                   <span class="inlinecode"><span class="id" title="tactic">simpl</span>;</span>
                   <span class="inlinecode"><span class="id" title="tactic">eauto</span></span>
                 <span class="inlinecode"><span class="id" title="keyword">end</span></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;inversion&nbsp;H2;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">right</span>;</span> <span class="inlinecode"><span class="id" title="tactic">left</span>|<span class="id" title="tactic">left</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;repeat&nbsp;eexists;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto;&nbsp;<span class="inlinecode">|<span class="id" title="var">crush</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H6;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl_crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;inversion&nbsp;H0;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode">|<span class="id" title="var">crush</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode">ψ',</span> <span class="inlinecode">?<span class="id" title="var">ϕ1</span></span> <span class="inlinecode">::</span> <span class="inlinecode">?<span class="id" title="var">ϕ2</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">=</span> <span class="inlinecode">ψ'</span> <span class="inlinecode">++</span> <span class="inlinecode">?<span class="id" title="var">ϕ2</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode"></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;(ϕ1&nbsp;::&nbsp;nil);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;admit.<br/>
Admitted.<br/>
<br/>
<span class="comment">(*Lemma&nbsp;arising_frame_is_method_call_reductions&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ1&nbsp;χ2&nbsp;ϕ1&nbsp;ϕ2&nbsp;ψ1&nbsp;ψ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;ψ1)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2&nbsp;=&nbsp;(χ2,&nbsp;ϕ2&nbsp;::&nbsp;ψ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;length&nbsp;(snd&nbsp;σ1)&nbsp;&lt;&nbsp;length&nbsp;(snd&nbsp;σ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;α&nbsp;m&nbsp;β&nbsp;s,&nbsp;method_is_called&nbsp;σ1&nbsp;α&nbsp;m&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ1&nbsp;α&nbsp;m&nbsp;s)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;α&nbsp;m&nbsp;β&nbsp;s,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method_is_called&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;α&nbsp;m&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ&nbsp;α&nbsp;m&nbsp;s).<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;left;&nbsp;eapply&nbsp;arising_frame_is_method_call_reduction;&nbsp;simpl;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;inversion&nbsp;H;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;eexists;&nbsp;eauto&nbsp;with&nbsp;loo_db.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H7;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl_crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(IHHred&nbsp;χ1&nbsp;χ2&nbsp;ϕ1&nbsp;ϕ&nbsp;ψ1&nbsp;ψ2)&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span>|<span class="id" title="var">Ha</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;left;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;α,&nbsp;m,&nbsp;β,&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha0&nbsp;in&nbsp;H7;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H7;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;right.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;χ,&nbsp;ϕ0,&nbsp;ψ,&nbsp;α,&nbsp;m,&nbsp;β,&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha1&nbsp;in&nbsp;H7;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H7;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(IHHred&nbsp;χ1&nbsp;χ2&nbsp;ϕ1&nbsp;ϕ&nbsp;ψ1&nbsp;ψ2)&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span>|<span class="id" title="var">Ha</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;left;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;α0,&nbsp;m,&nbsp;β,&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha0&nbsp;in&nbsp;H6;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H6;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;right.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;χ,&nbsp;ϕ0,&nbsp;ψ,&nbsp;α0,&nbsp;m,&nbsp;β,&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha1&nbsp;in&nbsp;H6;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H6;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(IHHred&nbsp;χ1&nbsp;χ&nbsp;ϕ1&nbsp;ϕ&nbsp;ψ1&nbsp;ψ)&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span>|<span class="id" title="var">Ha</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;left;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;α0,&nbsp;m,&nbsp;β,&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha0&nbsp;in&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;right.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;χ0,&nbsp;ϕ0,&nbsp;ψ0,&nbsp;α0,&nbsp;m,&nbsp;β,&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha1&nbsp;in&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(IHHred&nbsp;χ1&nbsp;χ&nbsp;ϕ1&nbsp;ϕ&nbsp;ψ1&nbsp;ψ)&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span>|<span class="id" title="var">Ha</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;left;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;α0,&nbsp;m,&nbsp;β,&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha0&nbsp;in&nbsp;H3;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H3;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;right.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;χ0,&nbsp;ϕ0,&nbsp;ψ0,&nbsp;α0,&nbsp;m,&nbsp;β,&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha1&nbsp;in&nbsp;H3;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H3;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(IHHred&nbsp;χ1&nbsp;χ2&nbsp;ϕ1&nbsp;ϕ&nbsp;ψ1&nbsp;ψ2)&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span>|<span class="id" title="var">Ha</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;left;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;α,&nbsp;m,&nbsp;β,&nbsp;s1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha0&nbsp;in&nbsp;H5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;right.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;χ,&nbsp;ϕ0,&nbsp;ψ,&nbsp;α,&nbsp;m,&nbsp;β,&nbsp;s1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha1&nbsp;in&nbsp;H5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(IHHred&nbsp;χ1&nbsp;χ2&nbsp;ϕ1&nbsp;ϕ&nbsp;ψ1&nbsp;ψ2)&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span>|<span class="id" title="var">Ha</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;left;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;α,&nbsp;m,&nbsp;β,&nbsp;s2;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha0&nbsp;in&nbsp;H5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;right.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;χ,&nbsp;ϕ0,&nbsp;ψ,&nbsp;α,&nbsp;m,&nbsp;β,&nbsp;s2;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha1&nbsp;in&nbsp;H5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(IHHred&nbsp;χ1&nbsp;χ2&nbsp;ϕ1&nbsp;ϕ&nbsp;ψ1&nbsp;(ϕ'::ψ2))&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span>|<span class="id" title="var">Ha</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;left;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;α0,&nbsp;m,&nbsp;β,&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha0&nbsp;in&nbsp;H5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;right.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;χ,&nbsp;ϕ0,&nbsp;ψ,&nbsp;α0,&nbsp;m,&nbsp;β,&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha1&nbsp;in&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(IHHred&nbsp;χ1&nbsp;χ2&nbsp;ϕ1&nbsp;ϕ&nbsp;ψ1&nbsp;(ϕ'::ψ2))&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span>|<span class="id" title="var">Ha</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;left;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;α0,&nbsp;m,&nbsp;β,&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha1&nbsp;in&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;right.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;χ,&nbsp;ϕ0,&nbsp;ψ,&nbsp;α0,&nbsp;m,&nbsp;β,&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;in_mth;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;substmt_trans;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha1&nbsp;in&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
Qed.*)</span><br/>
<br/>
Lemma&nbsp;bottom_frame_remains_in_stack_reduction&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ1&nbsp;ϕ1&nbsp;ψ1,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ψ1&nbsp;++&nbsp;ϕ1&nbsp;::&nbsp;nil)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;ψ&nbsp;ϕ,&nbsp;(snd&nbsp;σ2)&nbsp;=&nbsp;(ψ&nbsp;++&nbsp;ϕ&nbsp;::&nbsp;nil)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vMap&nbsp;ϕ&nbsp;this&nbsp;=&nbsp;vMap&nbsp;ϕ1&nbsp;this.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="keyword">goal</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span>
                      <span class="inlinecode">|</span> <span class="inlinecode">[<span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">ϕ1</span></span> <span class="inlinecode">::</span> <span class="inlinecode">?ψ1</span> <span class="inlinecode">=</span> <span class="inlinecode">?ψ2</span> <span class="inlinecode">++</span> <span class="inlinecode">?<span class="id" title="var">ϕ2</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
                        <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">ϕ</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="tactic">fresh</span></span> <span class="inlinecode">&quot;<span class="id" title="var">ϕ</span>&quot;</span> <span class="inlinecode"><span class="id" title="tactic">in</span></span>
                        <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode">ψ</span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="tactic">fresh</span></span> <span class="inlinecode">&quot;ψ&quot;</span> <span class="inlinecode"><span class="id" title="tactic">in</span></span>
                        <span class="inlinecode"><span class="id" title="tactic">destruct</span></span> <span class="inlinecode">ψ2</span> <span class="inlinecode"><span class="id" title="keyword">as</span></span> <span class="inlinecode">[|<span class="id" title="var">ϕ</span></span> <span class="inlinecode">ψ];</span> <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">H</span>;</span> <span class="inlinecode"><span class="id" title="tactic">inversion</span></span> <span class="inlinecode"><span class="id" title="var">H</span>;</span> <span class="inlinecode"><span class="id" title="tactic">subst</span></span>
                      <span class="inlinecode"><span class="id" title="keyword">end</span>;</span>
               <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="keyword">goal</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span>
               <span class="inlinecode">|</span> <span class="inlinecode">[|-</span> <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode">ψ</span> <span class="inlinecode"><span class="id" title="var">ϕ</span>,</span> <span class="inlinecode">?<span class="id" title="var">ϕ'</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">=</span> <span class="inlinecode">ψ</span> <span class="inlinecode">++</span> <span class="inlinecode"><span class="id" title="var">ϕ</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">/\</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
                 <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode"><span class="id" title="var">nil</span>,</span> <span class="inlinecode"><span class="id" title="var">ϕ'</span></span>
               <span class="inlinecode">|</span> <span class="inlinecode">[|-</span> <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode">ψ</span> <span class="inlinecode"><span class="id" title="var">ϕ</span>,</span> <span class="inlinecode">?<span class="id" title="var">ϕ''</span></span> <span class="inlinecode">::</span> <span class="inlinecode">?ψ'</span> <span class="inlinecode">++</span> <span class="inlinecode">?<span class="id" title="var">ϕ'</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">=</span> <span class="inlinecode">ψ</span> <span class="inlinecode">++</span> <span class="inlinecode"><span class="id" title="var">ϕ</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">/\</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
                 <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode">(<span class="id" title="var">ϕ''</span>::ψ'),</span> <span class="inlinecode"><span class="id" title="var">ϕ'</span></span>
               <span class="inlinecode">|</span> <span class="inlinecode">[|-</span> <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode">ψ</span> <span class="inlinecode"><span class="id" title="var">ϕ</span>,</span> <span class="inlinecode">?<span class="id" title="var">ϕ''</span></span> <span class="inlinecode">::</span> <span class="inlinecode">?<span class="id" title="var">ϕ'</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">=</span> <span class="inlinecode">ψ</span> <span class="inlinecode">++</span> <span class="inlinecode"><span class="id" title="var">ϕ</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">/\</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
                 <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode">(<span class="id" title="var">ϕ''</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span>),</span> <span class="inlinecode"><span class="id" title="var">ϕ'</span></span>
               <span class="inlinecode">|</span> <span class="inlinecode">[|-</span> <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode">ψ</span> <span class="inlinecode"><span class="id" title="var">ϕ</span>,</span> <span class="inlinecode">?<span class="id" title="var">ϕ''</span></span> <span class="inlinecode">::</span> <span class="inlinecode">?<span class="id" title="var">ϕ'</span></span> <span class="inlinecode">::</span> <span class="inlinecode">?ψ'</span> <span class="inlinecode">++</span> <span class="inlinecode">?<span class="id" title="var">ϕ'''</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">=</span> <span class="inlinecode">ψ</span> <span class="inlinecode">++</span> <span class="inlinecode"><span class="id" title="var">ϕ</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">/\</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
                 <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode">(<span class="id" title="var">ϕ''</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">ϕ'</span></span> <span class="inlinecode">::</span> <span class="inlinecode">ψ'),</span> <span class="inlinecode"><span class="id" title="var">ϕ'''</span></span>
               <span class="inlinecode">|</span> <span class="inlinecode">[|-</span> <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode">ψ</span> <span class="inlinecode"><span class="id" title="var">ϕ</span>,</span> <span class="inlinecode">?<span class="id" title="var">ϕ''</span></span> <span class="inlinecode">::</span> <span class="inlinecode">?<span class="id" title="var">ϕ'</span></span> <span class="inlinecode">::</span> <span class="inlinecode">?ψ'</span> <span class="inlinecode">=</span> <span class="inlinecode">ψ</span> <span class="inlinecode">++</span> <span class="inlinecode"><span class="id" title="var">ϕ</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">/\</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
                 <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode">(<span class="id" title="var">ϕ''</span>::ψ'),</span> <span class="inlinecode"><span class="id" title="var">ϕ'</span></span>
               <span class="inlinecode"><span class="id" title="keyword">end</span>;</span>
               <span class="inlinecode"><span class="id" title="tactic">split</span>;</span>
               <span class="inlinecode"><span class="id" title="tactic">auto</span>;</span>
               <span class="inlinecode"><span class="id" title="tactic">simpl</span>;</span> <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">map_rewrite</span></span>.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;bottom_frame_remains_in_stack_reductions&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ1&nbsp;ϕ1&nbsp;ψ1,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ψ1&nbsp;++&nbsp;ϕ1&nbsp;::&nbsp;nil)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;ψ&nbsp;ϕ,&nbsp;(snd&nbsp;σ2)&nbsp;=&nbsp;(ψ&nbsp;++&nbsp;ϕ&nbsp;::&nbsp;nil)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vMap&nbsp;ϕ&nbsp;this&nbsp;=&nbsp;vMap&nbsp;ϕ1&nbsp;this.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;eapply&nbsp;bottom_frame_remains_in_stack_reduction;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;destruct&nbsp;(IHHred&nbsp;χ1&nbsp;ϕ1&nbsp;ψ1);&nbsp;auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;σ2&nbsp;as&nbsp;<span class="inlinecode">χ</span> <span class="inlinecode">ψ</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;&lt;-&nbsp;Hb.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;(bottom_frame_remains_in_stack_reduction&nbsp;M&nbsp;(χ,&nbsp;x++ϕ&nbsp;::&nbsp;nil))&nbsp;with&nbsp;(χ1:=χ)(ψ1:=x);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;different_this_implies_larger_stack_reductions&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ_wf&nbsp;σ1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ1&nbsp;ϕ1,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;nil)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;v1&nbsp;v2,&nbsp;⌊&nbsp;this&nbsp;⌋&nbsp;σ1&nbsp;≜&nbsp;v1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊&nbsp;this&nbsp;⌋&nbsp;σ2&nbsp;≜&nbsp;v2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(length&nbsp;(snd&nbsp;σ1)&nbsp;&lt;&nbsp;length&nbsp;(snd&nbsp;σ2))&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v1&nbsp;=&nbsp;v2&nbsp;/\&nbsp;length&nbsp;(snd&nbsp;σ1)&nbsp;=&nbsp;length&nbsp;(snd&nbsp;σ2)).<br/>
Proof.<br/>
&nbsp;&nbsp;intros.<br/>
&nbsp;&nbsp;destruct&nbsp;(bottom_frame_remains_in_stack_reductions&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;H&nbsp;χ1&nbsp;ϕ1&nbsp;nil)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;<span class="inlinecode">ψ</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;destruct&nbsp;σ2&nbsp;as&nbsp;<span class="inlinecode">χ2</span> <span class="inlinecode">ψ2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
<br/>
&nbsp;&nbsp;destruct&nbsp;ψ&nbsp;as&nbsp;<span class="inlinecode">|<span class="id" title="var">ϕ'</span></span> <span class="inlinecode">ψ'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;-&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">⌊</span> <span class="inlinecode">?<span class="id" title="var">x</span></span> <span class="inlinecode">⌋</span> <span class="inlinecode">?σ1</span> <span class="inlinecode">≜</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
            <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">⌊</span> <span class="inlinecode">?<span class="id" title="var">x</span></span> <span class="inlinecode">⌋</span> <span class="inlinecode">?σ2</span> <span class="inlinecode">≜</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;simpl;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;app_length;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;reduction_implies_non_empty_stack_1&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;χ1&nbsp;ϕ1&nbsp;ψ1,&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;ψ1).<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;reduction_implies_non_empty_stack_2&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;χ2&nbsp;ϕ2&nbsp;ψ2,&nbsp;σ2&nbsp;=&nbsp;(χ2,&nbsp;ϕ2&nbsp;::&nbsp;ψ2).<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;reduction_preserves_heap_locations&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;α&nbsp;(o&nbsp;:&nbsp;obj),&nbsp;mapp&nbsp;σ1&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;o',&nbsp;mapp&nbsp;σ2&nbsp;α&nbsp;=&nbsp;Some&nbsp;o'.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="tactic">eexists</span>;</span>
               <span class="inlinecode"><span class="id" title="var">crush</span>;</span>
               <span class="inlinecode"><span class="id" title="tactic">eauto</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="tactic">destruct</span></span> <span class="inlinecode">(<span class="id" title="var">eq_dec</span></span> <span class="inlinecode"><span class="id" title="var">α</span></span> <span class="inlinecode"><span class="id" title="var">α0</span>);</span>
               <span class="inlinecode"><span class="id" title="tactic">subst</span>;</span>
               <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">map_rewrite</span>;</span>
               <span class="inlinecode"><span class="id" title="tactic">eauto</span></span>.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;reductions_preserves_heap_locations_classes&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;α&nbsp;(o&nbsp;:&nbsp;obj),&nbsp;mapp&nbsp;σ1&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;o',&nbsp;mapp&nbsp;σ2&nbsp;α&nbsp;=&nbsp;Some&nbsp;o'&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cname&nbsp;o'&nbsp;=&nbsp;cname&nbsp;o.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;eapply&nbsp;reduction_preserves_addr_classes;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;specialize&nbsp;(IHHred&nbsp;α&nbsp;o);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto_specialize;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;reduction_preserves_addr_classes<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(α:=α)(o1:=o0)&nbsp;in&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eexists;&nbsp;split;&nbsp;eauto;&nbsp;crush.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;reduction_preserves_fields&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;α&nbsp;o&nbsp;f&nbsp;v,&nbsp;mapp&nbsp;σ1&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;o&nbsp;f&nbsp;=&nbsp;Some&nbsp;v&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;o'&nbsp;v',&nbsp;mapp&nbsp;σ2&nbsp;α&nbsp;=&nbsp;Some&nbsp;o'&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;o'&nbsp;f&nbsp;=&nbsp;Some&nbsp;v'.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="tactic">eexists</span>;</span> <span class="inlinecode"><span class="id" title="var">crush</span>;</span> <span class="inlinecode"><span class="id" title="tactic">eauto</span></span>.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;destruct&nbsp;(eq_dec&nbsp;α&nbsp;α0);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(eq_dec&nbsp;f0&nbsp;f);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;repeat&nbsp;eexists;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;flds;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode"><span class="id" title="var">o'</span></span> <span class="inlinecode"><span class="id" title="var">_</span>,</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">?<span class="id" title="var">o</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">o'</span></span> <span class="inlinecode">/\</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;o<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;v0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;flds;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">?<span class="id" title="var">a</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
              <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">?<span class="id" title="var">a</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;o0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(eq_dec&nbsp;α&nbsp;α0);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;fresh_heap_some_contradiction;&nbsp;eauto.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;reductions_preserves_fields&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;α&nbsp;o&nbsp;f&nbsp;v,&nbsp;mapp&nbsp;σ1&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;o&nbsp;f&nbsp;=&nbsp;Some&nbsp;v&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;o'&nbsp;v',&nbsp;mapp&nbsp;σ2&nbsp;α&nbsp;=&nbsp;Some&nbsp;o'&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;o'&nbsp;f&nbsp;=&nbsp;Some&nbsp;v'.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;eapply&nbsp;reduction_preserves_fields;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;specialize&nbsp;(IHHred&nbsp;α&nbsp;o&nbsp;f&nbsp;v);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;auto_specialize;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;reduction_preserves_fields;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;reductions_field_change&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ1&nbsp;ϕ1&nbsp;ψ1&nbsp;χ2&nbsp;ϕ2&nbsp;ψ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;ψ1)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2&nbsp;=&nbsp;(χ2,&nbsp;ϕ2&nbsp;::&nbsp;ψ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;α&nbsp;o1&nbsp;o2&nbsp;f&nbsp;v1&nbsp;v2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapp&nbsp;σ1&nbsp;α&nbsp;=&nbsp;Some&nbsp;o1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapp&nbsp;σ2&nbsp;α&nbsp;=&nbsp;Some&nbsp;o2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;o1&nbsp;f&nbsp;=&nbsp;Some&nbsp;v1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;o2&nbsp;f&nbsp;=&nbsp;Some&nbsp;v2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v1&nbsp;&lt;&gt;&nbsp;v2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;χ&nbsp;ϕ&nbsp;ψ,&nbsp;(reductions&nbsp;M&nbsp;σ1&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;\/&nbsp;σ1&nbsp;=&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ))&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;&nbsp;x&nbsp;y&nbsp;s&nbsp;C,&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;((x&nbsp;◌&nbsp;f)&nbsp;≔&nbsp;(r_&nbsp;y)&nbsp;;;&nbsp;s)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊&nbsp;x&nbsp;⌋&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;≜&nbsp;(v_addr&nbsp;α)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classOf&nbsp;this&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;C&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classOf&nbsp;x&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;C&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊&nbsp;y&nbsp;⌋&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;≜&nbsp;v2.<br/>
Proof.<br/>
&nbsp;&nbsp;intros.<br/>
&nbsp;&nbsp;destruct&nbsp;(reductions_prop_change&nbsp;M&nbsp;σ1&nbsp;σ2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(P:=&nbsp;fun&nbsp;σ&nbsp;:&nbsp;config&nbsp;=&gt;&nbsp;forall&nbsp;o,&nbsp;mapp&nbsp;σ&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;-&gt;&nbsp;flds&nbsp;o&nbsp;f&nbsp;=&nbsp;Some&nbsp;v2);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;-&nbsp;intros&nbsp;Hcontra;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specialize&nbsp;(Hcontra&nbsp;o1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto_specialize;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;x&nbsp;as&nbsp;<span class="inlinecode">χ<span class="id" title="var">a</span></span> <span class="inlinecode">ψ<span class="id" title="var">a</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;σ&nbsp;as&nbsp;<span class="inlinecode">χ<span class="id" title="var">b</span></span> <span class="inlinecode">ψ<span class="id" title="var">b</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;edestruct&nbsp;(reduction_implies_non_empty_stack_1&nbsp;M&nbsp;(χa,&nbsp;ψa));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;edestruct&nbsp;(reduction_implies_non_empty_stack_2&nbsp;M&nbsp;(χa,&nbsp;ψa)&nbsp;(χb,&nbsp;ψb));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;x,&nbsp;ϕ0,&nbsp;ψ0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"></span> <span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">reductions</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">\/</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
             <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">reductions</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">\/</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Ha,&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;destruct&nbsp;(reductions_preserves_fields&nbsp;M&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;ψ1)&nbsp;(x,&nbsp;ϕ0&nbsp;::&nbsp;ψ0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(α:=α)(o:=o1)(f:=f)(v:=v1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto&nbsp;with&nbsp;loo_db;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(reduction_preserves_fields&nbsp;M&nbsp;(x,&nbsp;ϕ0&nbsp;::&nbsp;ψ0)&nbsp;(x0,&nbsp;ϕ&nbsp;::&nbsp;ψ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(α:=α)(o:=x1)(f:=f)(v:=v);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto&nbsp;with&nbsp;loo_db;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;(reduction_field_change&nbsp;M&nbsp;(x,&nbsp;ϕ0&nbsp;::&nbsp;ψ0)&nbsp;(x0,&nbsp;ϕ&nbsp;::&nbsp;ψ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(χ1:=x)(ψ1:=ψ0)(χ2:=x0);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;Hcontra;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contradiction&nbsp;Ha0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha2&nbsp;in&nbsp;H7;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H7;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(reductions_preserves_fields&nbsp;M&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;ψ1)&nbsp;(x,&nbsp;ϕ0&nbsp;::&nbsp;ψ0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(α:=α)(o:=o1)(f:=f)(v:=v1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto&nbsp;with&nbsp;loo_db;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(reduction_preserves_fields&nbsp;M&nbsp;(x,&nbsp;ϕ0&nbsp;::&nbsp;ψ0)&nbsp;(x0,&nbsp;ϕ&nbsp;::&nbsp;ψ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(α:=α)(o:=x1)(f:=f)(v:=v);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto&nbsp;with&nbsp;loo_db;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;(reduction_field_change&nbsp;M&nbsp;(x,&nbsp;ϕ0&nbsp;::&nbsp;ψ0)&nbsp;(x0,&nbsp;ϕ&nbsp;::&nbsp;ψ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(χ1:=x)(ψ1:=ψ0)(χ2:=x0);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;Hcontra;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contradiction&nbsp;Ha0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha2&nbsp;in&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(reduction_preserves_fields&nbsp;M&nbsp;(x,&nbsp;ϕ0&nbsp;::&nbsp;ψ0)&nbsp;(x0,&nbsp;ϕ&nbsp;::&nbsp;ψ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(α:=α)(o:=o1)(f:=f)(v:=v1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto&nbsp;with&nbsp;loo_db;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(reductions_preserves_fields&nbsp;M&nbsp;(x0,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;(χ2,&nbsp;ϕ2&nbsp;::&nbsp;ψ2))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(α:=α)(o:=x1)(f:=f)(v:=v);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto&nbsp;with&nbsp;loo_db;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;(reduction_field_change&nbsp;M&nbsp;(x,&nbsp;ϕ0&nbsp;::&nbsp;ψ0)&nbsp;(x0,&nbsp;ϕ&nbsp;::&nbsp;ψ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(χ1:=x)(ψ1:=ψ0)(χ2:=x0);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;reduction_field_change;&nbsp;eauto.<br/>
<br/>
Qed.<br/>
<br/>
Lemma&nbsp;frame_arising_from_single_frame_is_method_call_reductions&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ1&nbsp;ϕ1,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;nil)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapp&nbsp;σ1&nbsp;this&nbsp;&lt;&gt;&nbsp;mapp&nbsp;σ2&nbsp;this&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ2&nbsp;ϕ2&nbsp;ψ2,&nbsp;σ2&nbsp;=&nbsp;(χ2,&nbsp;ϕ2&nbsp;::&nbsp;ψ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;s,&nbsp;method_is_called&nbsp;σ1&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ1&nbsp;α&nbsp;m&nbsp;s)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;s,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method_is_called&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ&nbsp;α&nbsp;m&nbsp;s).<br/>
Proof.<br/>
&nbsp;&nbsp;intros.<br/>
<span class="comment">(*&nbsp;&nbsp;destruct&nbsp;(arising_frame_is_method_call_reductions&nbsp;M&nbsp;σ1&nbsp;σ2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(χ1:=χ1)(χ2:=χ2)(ϕ1:=ϕ1)(ϕ2:=ϕ2)(ψ1:=@nil&nbsp;frame)(ψ2:=ψ2);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;let&nbsp;ψ&nbsp;:=&nbsp;fresh&nbsp;"ψ"&nbsp;in<br/>
&nbsp;&nbsp;let&nbsp;ϕ&nbsp;:=&nbsp;fresh&nbsp;"ϕ"&nbsp;in<br/>
&nbsp;&nbsp;edestruct&nbsp;(bottom_frame_remains_in_stack_reductions&nbsp;M&nbsp;σ1&nbsp;σ2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ψ1:=@nil&nbsp;frame)&nbsp;as&nbsp;<span class="inlinecode">ψ</span> <span class="inlinecode"><span class="id" title="var">Htmp</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Htmp&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">ϕ</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
<br/>
&nbsp;&nbsp;let&nbsp;ϕ'&nbsp;:=&nbsp;fresh&nbsp;"ϕ"&nbsp;in<br/>
&nbsp;&nbsp;let&nbsp;ψ'&nbsp;:=&nbsp;fresh&nbsp;"ψ"&nbsp;in<br/>
&nbsp;&nbsp;destruct&nbsp;ψ&nbsp;as&nbsp;<span class="inlinecode">|<span class="id" title="var">ϕ'</span></span> <span class="inlinecode">ψ'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl_crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;rewrite&nbsp;app_length;&nbsp;crush.*)</span><br/>
Admitted.<br/>
<br/>
Lemma&nbsp;reductions_field_change_not_this&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ1&nbsp;ϕ1&nbsp;ψ1&nbsp;χ2&nbsp;ϕ2&nbsp;ψ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;ψ1)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2&nbsp;=&nbsp;(χ2,&nbsp;ϕ2&nbsp;::&nbsp;ψ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;α&nbsp;o1&nbsp;o2&nbsp;f&nbsp;v1&nbsp;v2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapp&nbsp;σ1&nbsp;α&nbsp;=&nbsp;Some&nbsp;o1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapp&nbsp;σ2&nbsp;α&nbsp;=&nbsp;Some&nbsp;o2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;o1&nbsp;f&nbsp;=&nbsp;Some&nbsp;v1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;o2&nbsp;f&nbsp;=&nbsp;Some&nbsp;v2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v1&nbsp;&lt;&gt;&nbsp;v2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(forall&nbsp;C,&nbsp;classOf&nbsp;this&nbsp;σ1&nbsp;C&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cname&nbsp;o1&nbsp;&lt;&gt;&nbsp;C)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;x&nbsp;y&nbsp;s&nbsp;C,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;((x&nbsp;◌&nbsp;f)&nbsp;≔&nbsp;(r_&nbsp;y)&nbsp;;;&nbsp;s)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊&nbsp;x&nbsp;⌋&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;≜&nbsp;(v_addr&nbsp;α)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classOf&nbsp;this&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;C&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classOf&nbsp;x&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;C&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊&nbsp;y&nbsp;⌋&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;≜&nbsp;v2.<br/>
Proof.<br/>
&nbsp;&nbsp;intros.<br/>
&nbsp;&nbsp;let&nbsp;χ&nbsp;:=&nbsp;fresh&nbsp;"χ"&nbsp;in<br/>
&nbsp;&nbsp;edestruct&nbsp;(reductions_field_change&nbsp;M&nbsp;σ1&nbsp;σ2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;<span class="inlinecode">χ</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;exists&nbsp;χ,&nbsp;ϕ,&nbsp;ψ,&nbsp;x,&nbsp;x0,&nbsp;s,&nbsp;C;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;destruct&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;specialize&nbsp;(H7&nbsp;C);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;auto_specialize.<br/>
&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;inversion&nbsp;Ha3;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;interpretation_rewrite.<br/>
&nbsp;&nbsp;inversion&nbsp;H0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;rewrite&nbsp;H2&nbsp;in&nbsp;H8;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H8;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;pair_reductions_is_external_1&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;σ1&nbsp;⤳⋆&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external_self&nbsp;M1&nbsp;M2&nbsp;σ1.<br/>
Proof.<br/>
Admitted.<br/>
<br/>
Lemma&nbsp;pair_reductions_is_external_2&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;σ1&nbsp;⤳⋆&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external_self&nbsp;M1&nbsp;M2&nbsp;σ2.<br/>
Proof.<br/>
Admitted.<br/>
<br/>
Lemma&nbsp;frame_arising_from_single_frame_external_internal_is_method_call_reductions&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ1&nbsp;ϕ1,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;nil)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external_self&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ2&nbsp;ϕ2&nbsp;ψ2,&nbsp;σ2&nbsp;=&nbsp;(χ2,&nbsp;ϕ2&nbsp;::&nbsp;ψ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;s,&nbsp;method_is_called&nbsp;σ1&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ1&nbsp;α&nbsp;m&nbsp;s)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;s,&nbsp;reductions&nbsp;M&nbsp;σ1&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method_is_called&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;x&nbsp;α&nbsp;m&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt_in_method&nbsp;M&nbsp;χ&nbsp;α&nbsp;m&nbsp;s).<br/>
Proof.<br/>
&nbsp;&nbsp;intros.<br/>
&nbsp;&nbsp;eapply&nbsp;frame_arising_from_single_frame_is_method_call_reductions;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;unfold&nbsp;external_self,&nbsp;is_external,&nbsp;internal_self,&nbsp;is_internal&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;intros&nbsp;Hcontra;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Hcontra&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;rewrite&nbsp;Ha0&nbsp;in&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
<br/>
&nbsp;&nbsp;let&nbsp;o'&nbsp;:=&nbsp;fresh&nbsp;"o"&nbsp;in<br/>
&nbsp;&nbsp;destruct&nbsp;(reductions_preserves_heap_locations_classes&nbsp;M&nbsp;(χ1,&nbsp;ϕ1::nil)(χ2,&nbsp;ϕ2&nbsp;::&nbsp;ψ2))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(α:=α)(o:=o0)&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">o'</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;rewrite&nbsp;Ha1&nbsp;in&nbsp;Ha3;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Ha3;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;rewrite&nbsp;Hb1&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;is_external_self_implies_not_is_internal&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ,&nbsp;external_self&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ.<br/>
Proof.<br/>
&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;internal_self,&nbsp;external_self,&nbsp;is_internal,&nbsp;is_external&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intro&nbsp;Hcontra;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;is_internal_self_implies_not_is_external&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ,&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;external_self&nbsp;M1&nbsp;M2&nbsp;σ.<br/>
Proof.<br/>
&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intro&nbsp;Hcontra;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;internal_self,&nbsp;external_self,&nbsp;is_internal,&nbsp;is_external&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;is_external_implies_not_is_internal&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;α,&nbsp;is_external&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;α&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;is_internal&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;α.<br/>
Proof.<br/>
&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;is_internal,&nbsp;is_external&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intro&nbsp;Hcontra;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;is_internal_implies_not_is_external&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;α,&nbsp;is_internal&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;α&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;is_external&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;α.<br/>
Proof.<br/>
&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intro&nbsp;Hcontra;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;internal_self,&nbsp;external_self,&nbsp;is_internal,&nbsp;is_external&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
Qed.<br/>
<br/>
Inductive&nbsp;stack_trace&nbsp;:&nbsp;mdl&nbsp;-&gt;&nbsp;mdl&nbsp;-&gt;&nbsp;config&nbsp;-&gt;&nbsp;Prop&nbsp;:=<br/>
|&nbsp;trace_initial&nbsp;:&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;χ&nbsp;ϕ&nbsp;x&nbsp;s,&nbsp;external_self&nbsp;M1&nbsp;M2&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;nil)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classOf&nbsp;this&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;nil)&nbsp;ObjectName&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_hole&nbsp;x&nbsp;s&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stack_trace&nbsp;M1&nbsp;M2&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;nil)<br/>
|&nbsp;trace_internal&nbsp;:&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;x&nbsp;s&nbsp;C&nbsp;CDef&nbsp;m&nbsp;zs&nbsp;body,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;stack_trace&nbsp;M1&nbsp;M2&nbsp;(χ,&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_hole&nbsp;x&nbsp;s&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;classOf&nbsp;this&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;C&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;C&nbsp;=&nbsp;Some&nbsp;CDef&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;M2&nbsp;C&nbsp;=&nbsp;None&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;c_meths&nbsp;CDef&nbsp;m&nbsp;=&nbsp;Some&nbsp;(zs,&nbsp;body)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;substmt&nbsp;s&nbsp;body&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;stack_trace&nbsp;M1&nbsp;M2&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)<br/>
|&nbsp;trace_external&nbsp;:&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;χ&nbsp;ϕ&nbsp;ϕ'&nbsp;ψ&nbsp;x&nbsp;s&nbsp;C&nbsp;CDef&nbsp;m&nbsp;zs&nbsp;body,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;stack_trace&nbsp;M1&nbsp;M2&nbsp;(χ,&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_hole&nbsp;x&nbsp;s&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;classOf&nbsp;this&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ϕ'&nbsp;::&nbsp;ψ)&nbsp;C&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;C&nbsp;=&nbsp;None&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;M2&nbsp;C&nbsp;=&nbsp;Some&nbsp;CDef&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;c_meths&nbsp;CDef&nbsp;m&nbsp;=&nbsp;Some&nbsp;(zs,&nbsp;body)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;substmt&nbsp;s&nbsp;body&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;stack_trace&nbsp;M1&nbsp;M2&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ϕ'&nbsp;::&nbsp;ψ).<br/>
<br/>
Inductive&nbsp;valid_stack_trace&nbsp;:&nbsp;mdl&nbsp;-&gt;&nbsp;mdl&nbsp;-&gt;&nbsp;config&nbsp;-&gt;&nbsp;Prop&nbsp;:=<br/>
|&nbsp;int_head&nbsp;:&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;s&nbsp;C&nbsp;CDef&nbsp;m&nbsp;zs&nbsp;body,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;stack_trace&nbsp;M1&nbsp;M2&nbsp;(χ,&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;classOf&nbsp;this&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;C&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;C&nbsp;=&nbsp;Some&nbsp;CDef&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;M2&nbsp;C&nbsp;=&nbsp;None&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;c_meths&nbsp;CDef&nbsp;m&nbsp;=&nbsp;Some&nbsp;(zs,&nbsp;body)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;substmt&nbsp;s&nbsp;body&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;valid_stack_trace&nbsp;M1&nbsp;M2&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)<br/>
|&nbsp;ext_head&nbsp;:&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;s&nbsp;C&nbsp;CDef&nbsp;m&nbsp;zs&nbsp;body,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;stack_trace&nbsp;M1&nbsp;M2&nbsp;(χ,&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;s&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;classOf&nbsp;this&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;C&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;C&nbsp;=&nbsp;None&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;M2&nbsp;C&nbsp;=&nbsp;Some&nbsp;CDef&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;c_meths&nbsp;CDef&nbsp;m&nbsp;=&nbsp;Some&nbsp;(zs,&nbsp;body)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;substmt&nbsp;s&nbsp;body&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;valid_stack_trace&nbsp;M1&nbsp;M2&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ).<br/>
<br/>
Hint&nbsp;Constructors&nbsp;valid_stack_trace&nbsp;stack_trace&nbsp;:&nbsp;loo_db.<br/>
<br/>
Lemma&nbsp;valid_program_trace_reduction&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M_wf&nbsp;M1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid_stack_trace&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid_stack_trace&nbsp;M1&nbsp;M2&nbsp;σ2.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;admit.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">valid_stack_trace</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">?<span class="id" title="var">C</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">?<span class="id" title="var">CDef</span>,</span>
              <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M2</span></span> <span class="inlinecode">?<span class="id" title="var">C</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">None</span>,</span>
                   <span class="inlinecode"><span class="id" title="var">Hc</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">c_meths</span></span> <span class="inlinecode">?<span class="id" title="var">CDef</span></span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">(?<span class="id" title="var">zs</span>,</span> <span class="inlinecode">?<span class="id" title="var">body</span>),</span>
                        <span class="inlinecode"><span class="id" title="var">Hd</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">c_stmt</span></span> <span class="inlinecode">(<span class="id" title="var">_</span></span> <span class="inlinecode">;;</span> <span class="inlinecode">?<span class="id" title="var">s</span>)</span>
         <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">valid_stack_trace</span></span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">?<span class="id" title="var">M2</span></span> <span class="inlinecode">(<span class="id" title="var">_</span>,</span> <span class="inlinecode"><span class="id" title="var">_</span>)</span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;(int_head&nbsp;M1&nbsp;M2&nbsp;χ)&nbsp;with&nbsp;(C:=C)(CDef:=CDef)(m:=m)(s:=s)(zs:=zs)(body:=body);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">?<span class="id" title="var">C</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">None</span>,</span>
              <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M2</span></span> <span class="inlinecode">?<span class="id" title="var">C</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">?<span class="id" title="var">CDef</span>,</span>
                   <span class="inlinecode"><span class="id" title="var">Hc</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">c_meths</span></span> <span class="inlinecode">?<span class="id" title="var">CDef</span></span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">(?<span class="id" title="var">zs</span>,</span> <span class="inlinecode">?<span class="id" title="var">body</span>),</span>
                        <span class="inlinecode"><span class="id" title="var">Hd</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">c_stmt</span></span> <span class="inlinecode">(<span class="id" title="var">_</span></span> <span class="inlinecode">;;</span> <span class="inlinecode">?<span class="id" title="var">s</span>)</span>
         <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">valid_stack_trace</span></span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">?<span class="id" title="var">M2</span></span> <span class="inlinecode">(<span class="id" title="var">_</span>,</span> <span class="inlinecode"><span class="id" title="var">_</span>)</span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;(ext_head&nbsp;M1&nbsp;M2&nbsp;χ)&nbsp;with&nbsp;(C:=C)(CDef:=CDef)(m:=m)(s:=s)(zs:=zs)(body:=body);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="keyword">goal</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span>
                 <span class="inlinecode">|</span> <span class="inlinecode">[<span class="id" title="var">Hcls</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">classOf</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
                   <span class="inlinecode"><span class="id" title="tactic">inversion</span></span> <span class="inlinecode"><span class="id" title="var">Hcls</span>;</span>
                   <span class="inlinecode"><span class="id" title="tactic">subst</span>;</span>
                   <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode">*</span>
                 <span class="inlinecode"><span class="id" title="keyword">end</span>;</span>
                 <span class="inlinecode"><span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">cls_of</span>;</span> <span class="inlinecode"><span class="id" title="tactic">simpl</span>;</span> <span class="inlinecode"><span class="id" title="tactic">eauto</span>;</span>
                 <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="keyword">goal</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span>
                 <span class="inlinecode">|</span> <span class="inlinecode">[<span class="id" title="keyword">Hint</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">interpret_x</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
                   <span class="inlinecode"><span class="id" title="tactic">inversion</span></span> <span class="inlinecode"><span class="id" title="keyword">Hint</span>;</span>
                   <span class="inlinecode"><span class="id" title="tactic">subst</span>;</span>
                   <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode">*;</span>
                   <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">simpl_crush</span></span>
                 <span class="inlinecode"><span class="id" title="keyword">end</span>;</span>
                 <span class="inlinecode"><span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">int_x</span>;</span> <span class="inlinecode"><span class="id" title="tactic">simpl</span>;</span> <span class="inlinecode"><span class="id" title="tactic">eauto</span>;</span> <span class="inlinecode"><span class="id" title="tactic">simpl</span>;</span>
                 <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">map_rewrite</span>;</span>
                 <span class="inlinecode"><span class="id" title="tactic">auto</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"></span> <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="keyword">goal</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span>
                  <span class="inlinecode">|</span> <span class="inlinecode">[<span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
                          <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
                               <span class="inlinecode"><span class="id" title="var">Hsub</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">substmt</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
                    <span class="inlinecode"><span class="id" title="tactic">rewrite</span></span> <span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">Hb</span>;</span>
                    <span class="inlinecode"><span class="id" title="tactic">inversion</span></span> <span class="inlinecode"><span class="id" title="var">Hb</span>;</span>
                    <span class="inlinecode"><span class="id" title="tactic">subst</span></span>
                  <span class="inlinecode"><span class="id" title="keyword">end</span>;</span>
                  <span class="inlinecode"><span class="id" title="tactic">apply</span></span> <span class="inlinecode"><span class="id" title="var">substmt_trans</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode">(<span class="id" title="var">s2</span>:=</span> <span class="inlinecode">(<span class="id" title="var">x</span></span> <span class="inlinecode">≔′</span> <span class="inlinecode"><span class="id" title="var">e</span>)</span> <span class="inlinecode">;;</span> <span class="inlinecode"><span class="id" title="var">s</span>);</span>
                  <span class="inlinecode"><span class="id" title="var">crush</span></span>.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">valid_stack_trace</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">?<span class="id" title="var">C'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">?<span class="id" title="var">CDef</span>,</span>
              <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M2</span></span> <span class="inlinecode">?<span class="id" title="var">C'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">None</span>,</span>
                   <span class="inlinecode"><span class="id" title="var">Hc</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">c_meths</span></span> <span class="inlinecode">?<span class="id" title="var">CDef</span></span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">(?<span class="id" title="var">zs</span>,</span> <span class="inlinecode">?<span class="id" title="var">body</span>),</span>
                        <span class="inlinecode"><span class="id" title="var">Hd</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">c_stmt</span></span> <span class="inlinecode">(<span class="id" title="var">_</span></span> <span class="inlinecode">;;</span> <span class="inlinecode">?<span class="id" title="var">s</span>)</span>
         <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">valid_stack_trace</span></span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">?<span class="id" title="var">M2</span></span> <span class="inlinecode">(<span class="id" title="var">_</span>,</span> <span class="inlinecode"><span class="id" title="var">_</span>)</span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;(int_head&nbsp;M1&nbsp;M2&nbsp;χ)&nbsp;with&nbsp;(C:=C')(CDef:=CDef)(m:=m)(s:=s)(zs:=zs)(body:=body);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">?<span class="id" title="var">C'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">None</span>,</span>
              <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M2</span></span> <span class="inlinecode">?<span class="id" title="var">C'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">?<span class="id" title="var">CDef</span>,</span>
                   <span class="inlinecode"><span class="id" title="var">Hc</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">c_meths</span></span> <span class="inlinecode">?<span class="id" title="var">CDef</span></span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">(?<span class="id" title="var">zs</span>,</span> <span class="inlinecode">?<span class="id" title="var">body</span>),</span>
                        <span class="inlinecode"><span class="id" title="var">Hd</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">c_stmt</span></span> <span class="inlinecode">(<span class="id" title="var">_</span></span> <span class="inlinecode">;;</span> <span class="inlinecode">?<span class="id" title="var">s</span>)</span>
         <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">valid_stack_trace</span></span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">?<span class="id" title="var">M2</span></span> <span class="inlinecode">(<span class="id" title="var">_</span>,</span> <span class="inlinecode"><span class="id" title="var">_</span>)</span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;(ext_head&nbsp;M1&nbsp;M2&nbsp;χ)&nbsp;with&nbsp;(C:=C')(CDef:=CDef)(m:=m)(s:=s)(zs:=zs)(body:=body);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="keyword">goal</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span>
                 <span class="inlinecode">|</span> <span class="inlinecode">[<span class="id" title="var">Hcls</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">classOf</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
                   <span class="inlinecode"><span class="id" title="tactic">inversion</span></span> <span class="inlinecode"><span class="id" title="var">Hcls</span>;</span>
                   <span class="inlinecode"><span class="id" title="tactic">subst</span>;</span>
                   <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode">*</span>
                 <span class="inlinecode"><span class="id" title="keyword">end</span>;</span>
                 <span class="inlinecode"><span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">cls_of</span>;</span> <span class="inlinecode"><span class="id" title="tactic">simpl</span>;</span> <span class="inlinecode"><span class="id" title="tactic">eauto</span>;</span>
                 <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="keyword">goal</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span>
                 <span class="inlinecode">|</span> <span class="inlinecode">[<span class="id" title="keyword">Hint</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">interpret_x</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
                   <span class="inlinecode"><span class="id" title="tactic">inversion</span></span> <span class="inlinecode"><span class="id" title="keyword">Hint</span>;</span>
                   <span class="inlinecode"><span class="id" title="tactic">subst</span>;</span>
                   <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode">*;</span>
                   <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">simpl_crush</span></span>
                 <span class="inlinecode"><span class="id" title="keyword">end</span>;</span>
                 <span class="inlinecode"><span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">int_x</span>;</span> <span class="inlinecode"><span class="id" title="tactic">simpl</span>;</span> <span class="inlinecode"><span class="id" title="tactic">eauto</span>;</span> <span class="inlinecode"><span class="id" title="tactic">simpl</span>;</span>
                 <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">map_rewrite</span>;</span>
                 <span class="inlinecode"><span class="id" title="tactic">auto</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"></span> <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="keyword">goal</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span>
                  <span class="inlinecode">|</span> <span class="inlinecode">[<span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
                          <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
                               <span class="inlinecode"><span class="id" title="var">Hsub</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">substmt</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
                    <span class="inlinecode"><span class="id" title="tactic">rewrite</span></span> <span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">Hb</span>;</span>
                    <span class="inlinecode"><span class="id" title="tactic">inversion</span></span> <span class="inlinecode"><span class="id" title="var">Hb</span>;</span>
                    <span class="inlinecode"><span class="id" title="tactic">subst</span></span>
                  <span class="inlinecode"><span class="id" title="keyword">end</span>;</span>
                  <span class="inlinecode"><span class="id" title="tactic">apply</span></span> <span class="inlinecode"><span class="id" title="var">substmt_trans</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode">(<span class="id" title="var">s2</span>:=</span> <span class="inlinecode">((<span class="id" title="var">r_</span></span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode">≔</span> <span class="inlinecode">(<span class="id" title="var">y</span></span> <span class="inlinecode">◌</span> <span class="inlinecode"><span class="id" title="var">f</span>))</span> <span class="inlinecode">;;</span> <span class="inlinecode"><span class="id" title="var">s</span>);</span>
                  <span class="inlinecode"><span class="id" title="var">crush</span></span>.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;<span class="comment">(*match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">valid_stack_trace</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">Ma</span></span> <span class="inlinecode">?<span class="id" title="var">C'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">?<span class="id" title="var">CDef'</span>,</span>
              <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">Mb</span></span> <span class="inlinecode">?<span class="id" title="var">C'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">None</span>,</span>
                   <span class="inlinecode"><span class="id" title="var">Hc</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">c_meths</span></span> <span class="inlinecode">?<span class="id" title="var">CDef'</span></span> <span class="inlinecode">?<span class="id" title="var">m'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">(?<span class="id" title="var">zs'</span>,</span> <span class="inlinecode">?<span class="id" title="var">body'</span>),</span>
                        <span class="inlinecode"><span class="id" title="var">Hd</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">c_stmt</span></span> <span class="inlinecode">(<span class="id" title="var">_</span></span> <span class="inlinecode">;;</span> <span class="inlinecode">?<span class="id" title="var">s'</span>)</span>
         <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">valid_stack_trace</span></span> <span class="inlinecode">?<span class="id" title="var">Ma</span></span> <span class="inlinecode">?<span class="id" title="var">Mb</span></span> <span class="inlinecode">(?χ',</span> <span class="inlinecode"><span class="id" title="var">_</span>)</span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;(int_head&nbsp;Ma&nbsp;Mb&nbsp;χ')&nbsp;with&nbsp;(C:=C')(CDef:=CDef')(m:=m')(s:=s')(zs:=zs')(body:=body');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">Ma</span></span> <span class="inlinecode">?<span class="id" title="var">C'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">None</span>,</span>
              <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">Mb</span></span> <span class="inlinecode">?<span class="id" title="var">C'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">?<span class="id" title="var">CDef'</span>,</span>
                   <span class="inlinecode"><span class="id" title="var">Hc</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">c_meths</span></span> <span class="inlinecode">?<span class="id" title="var">CDef'</span></span> <span class="inlinecode">?<span class="id" title="var">m'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">(?<span class="id" title="var">zs'</span>,</span> <span class="inlinecode">?<span class="id" title="var">body'</span>),</span>
                        <span class="inlinecode"><span class="id" title="var">Hd</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">c_stmt</span></span> <span class="inlinecode">(<span class="id" title="var">_</span></span> <span class="inlinecode">;;</span> <span class="inlinecode">?<span class="id" title="var">s'</span>)</span>
         <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">valid_stack_trace</span></span> <span class="inlinecode">?<span class="id" title="var">Ma</span></span> <span class="inlinecode">?<span class="id" title="var">Mb</span></span> <span class="inlinecode">(?χ',</span> <span class="inlinecode"><span class="id" title="var">_</span>)</span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;(ext_head&nbsp;Ma&nbsp;Mb&nbsp;χ')&nbsp;with&nbsp;(C:=C')(CDef:=CDef')(m:=m')(s:=s')(zs:=zs')(body:=body');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;admit.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;admit.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;<br/>
<br/>
<br/>
Admitted.<br/>
<br/>
Lemma&nbsp;reduction_internal_external&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M_wf&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ1&nbsp;ϕ1&nbsp;ψ1&nbsp;χ2&nbsp;ϕ2&nbsp;ψ2,&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;ψ1)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2&nbsp;=&nbsp;(χ2,&nbsp;ϕ2&nbsp;::&nbsp;ψ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2,&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external_self&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(external_self&nbsp;M1&nbsp;M2&nbsp;σ2&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(internal_self&nbsp;M1&nbsp;M2&nbsp;σ2&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;C&nbsp;CDef&nbsp;m&nbsp;zs&nbsp;s&nbsp;s',&nbsp;classOf&nbsp;this&nbsp;σ2&nbsp;C&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;C&nbsp;=&nbsp;Some&nbsp;CDef&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c_meths&nbsp;CDef&nbsp;m&nbsp;=&nbsp;Some&nbsp;(zs,&nbsp;s)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s'&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substmt&nbsp;s'&nbsp;s)).<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="tactic">left</span>;</span>
               <span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">is_external</span>;</span>
               <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode">(<span class="id" title="var">map_rewrite</span>;</span> <span class="inlinecode"><span class="id" title="tactic">simpl</span>)</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span>;</span> <span class="inlinecode"><span class="id" title="tactic">eauto</span></span>.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;<span class="comment">(*destruct&nbsp;(partial_map_dec&nbsp;(cname&nbsp;o)&nbsp;M1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">destruct_exists_loo</span>;</span> <span class="inlinecode"><span class="id" title="tactic">right</span>;</span> <span class="inlinecode"><span class="id" title="tactic">left</span>|<span class="id" title="tactic">left</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;split;&nbsp;<span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">is_internal</span>|</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;repeat&nbsp;map_rewrite;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;eexists;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;exists&nbsp;(cname&nbsp;o),&nbsp;C,&nbsp;m,&nbsp;zs,&nbsp;s,&nbsp;s;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**&nbsp;eapply&nbsp;cls_of;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;int_x;&nbsp;simpl;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**&nbsp;inversion&nbsp;H12;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;extend&nbsp;in&nbsp;H4;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;H0&nbsp;in&nbsp;H4;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H4;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**&nbsp;apply&nbsp;sub_refl.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;unfold&nbsp;is_external;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;eexists;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;left;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;is_external.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;α,&nbsp;{|&nbsp;cname&nbsp;:=&nbsp;cname&nbsp;o;&nbsp;flds&nbsp;:=&nbsp;update&nbsp;f&nbsp;v&nbsp;(flds&nbsp;o);&nbsp;meths&nbsp;:=&nbsp;meths&nbsp;o&nbsp;|};&nbsp;simpl;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;(map_rewrite;&nbsp;simpl);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;(map_rewrite;&nbsp;simpl).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.*)</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
Admitted.<br/>
<br/>
Definition&nbsp;meth_func&nbsp;:=<br/>
&nbsp;&nbsp;fun&nbsp;(M&nbsp;:&nbsp;mdl)(x&nbsp;:&nbsp;var)(α&nbsp;:&nbsp;addr)(m&nbsp;:&nbsp;mth)(β&nbsp;:&nbsp;partial_map&nbsp;var&nbsp;var)(σ&nbsp;:&nbsp;config)&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;(χ,&nbsp;ψ)&nbsp;:=&nbsp;σ&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;ψ&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;ϕ&nbsp;::&nbsp;ψ'&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;c&nbsp;:=&nbsp;contn&nbsp;ϕ&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;β'&nbsp;:=&nbsp;vMap&nbsp;ϕ&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;c&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;c_stmt&nbsp;(s_meth&nbsp;_&nbsp;_&nbsp;_&nbsp;_&nbsp;;;&nbsp;s')&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;χ&nbsp;α&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Some&nbsp;o&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;M&nbsp;(cname&nbsp;o)&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Some&nbsp;CDef&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;(c_meths&nbsp;CDef)&nbsp;m&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Some&nbsp;(zs,&nbsp;body)&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Some&nbsp;(χ,&nbsp;(frm&nbsp;(update&nbsp;this&nbsp;(v_addr&nbsp;α)&nbsp;(β&nbsp;∘&nbsp;β'))&nbsp;(c_stmt&nbsp;body))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;(frm&nbsp;β'&nbsp;(c_hole&nbsp;x&nbsp;s'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;ψ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
Definition&nbsp;assgn_func&nbsp;:=<br/>
&nbsp;&nbsp;fun&nbsp;(x&nbsp;:&nbsp;var)(v&nbsp;:&nbsp;value)(σ&nbsp;:&nbsp;config)&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;(χ,&nbsp;ψ)&nbsp;:=&nbsp;σ&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;ψ&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;ϕ&nbsp;::&nbsp;ψ'&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;c&nbsp;:=&nbsp;contn&nbsp;ϕ&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;β&nbsp;:=&nbsp;vMap&nbsp;ϕ&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;c&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;c_stmt&nbsp;s&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;s&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;s_asgn&nbsp;_&nbsp;_&nbsp;;;&nbsp;s&nbsp;=&gt;&nbsp;Some&nbsp;(χ,&nbsp;(frm&nbsp;(update&nbsp;x&nbsp;v&nbsp;β)&nbsp;(c_stmt&nbsp;s))&nbsp;::&nbsp;ψ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
Definition&nbsp;new_func&nbsp;:=<br/>
&nbsp;&nbsp;fun&nbsp;(x&nbsp;:&nbsp;var)(o&nbsp;:&nbsp;obj)(α&nbsp;:&nbsp;addr)(σ&nbsp;:&nbsp;config)&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;(χ,&nbsp;ψ)&nbsp;:=&nbsp;σ&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;ψ&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;ϕ&nbsp;::&nbsp;ψ'&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;c&nbsp;:=&nbsp;contn&nbsp;ϕ&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;β&nbsp;:=&nbsp;vMap&nbsp;ϕ&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;c&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;c_stmt&nbsp;s&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;s&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;s_new&nbsp;_&nbsp;_&nbsp;_&nbsp;;;&nbsp;s&nbsp;=&gt;&nbsp;Some&nbsp;(update&nbsp;α&nbsp;o&nbsp;χ,&nbsp;(frm&nbsp;(update&nbsp;x&nbsp;(v_addr&nbsp;α)&nbsp;β)&nbsp;(c_stmt&nbsp;s))&nbsp;::&nbsp;ψ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
Definition&nbsp;if_func&nbsp;:&nbsp;value&nbsp;-&gt;&nbsp;config&nbsp;-&gt;&nbsp;option&nbsp;config&nbsp;:=<br/>
&nbsp;&nbsp;fun&nbsp;(v&nbsp;:&nbsp;value)(σ&nbsp;:&nbsp;config)&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;(χ,&nbsp;ψ)&nbsp;:=&nbsp;σ&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;ψ&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;ϕ&nbsp;::&nbsp;ψ'&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;c&nbsp;:=&nbsp;contn&nbsp;ϕ&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;β&nbsp;:=&nbsp;vMap&nbsp;ϕ&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;c&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;c_stmt&nbsp;s&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;s&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;s_if&nbsp;_&nbsp;s1&nbsp;s2&nbsp;;;&nbsp;s&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;v&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;v_true&nbsp;=&gt;&nbsp;Some&nbsp;(χ,&nbsp;frm&nbsp;β&nbsp;(c_stmt&nbsp;(s1&nbsp;;;&nbsp;s))&nbsp;::&nbsp;ψ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;v_false&nbsp;=&gt;&nbsp;Some&nbsp;(χ,&nbsp;frm&nbsp;β&nbsp;(c_stmt&nbsp;(s2&nbsp;;;&nbsp;s))&nbsp;::&nbsp;ψ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
Definition&nbsp;ret_func&nbsp;:=<br/>
&nbsp;&nbsp;fun&nbsp;(v&nbsp;:&nbsp;value)(σ&nbsp;:&nbsp;config)&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;(χ,&nbsp;ψ)&nbsp;:=&nbsp;σ&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;ψ&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;ϕ1&nbsp;::&nbsp;ϕ2&nbsp;::&nbsp;ψ'&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;c1&nbsp;:=&nbsp;contn&nbsp;ϕ1&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;c2&nbsp;:=&nbsp;contn&nbsp;ϕ2&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;β&nbsp;:=&nbsp;vMap&nbsp;ϕ2&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;c2&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;c_hole&nbsp;x&nbsp;s&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;c1&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;c_stmt&nbsp;(s_rtrn&nbsp;_)&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Some&nbsp;(χ,&nbsp;frm&nbsp;(update&nbsp;x&nbsp;v&nbsp;β)&nbsp;(c_stmt&nbsp;s))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;c_stmt&nbsp;((s_rtrn&nbsp;_)&nbsp;;;&nbsp;_)&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Some&nbsp;(χ,&nbsp;frm&nbsp;(update&nbsp;x&nbsp;v&nbsp;β)&nbsp;(c_stmt&nbsp;s))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;_&nbsp;=&gt;&nbsp;None<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
<br/>
Lemma&nbsp;reduction_function&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;f,&nbsp;f&nbsp;M&nbsp;σ1&nbsp;=&nbsp;σ2.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="tactic">exists</span></span> <span class="inlinecode"><span class="id" title="var">f</span>,</span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">=</span> <span class="inlinecode">?σ</span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;(fun&nbsp;_&nbsp;_&nbsp;=&gt;&nbsp;σ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
<br/>
Qed.<br/>
<br/>
<br/>
<br/>
Definition&nbsp;internal_obj&nbsp;(M1&nbsp;M2&nbsp;:&nbsp;mdl)(o&nbsp;:&nbsp;obj)&nbsp;:&nbsp;Prop&nbsp;:=<br/>
&nbsp;&nbsp;exists&nbsp;CDef,&nbsp;M1&nbsp;(cname&nbsp;o)&nbsp;=&nbsp;CDef.<br/>
<br/>
Definition&nbsp;external_obj&nbsp;(M1&nbsp;M2&nbsp;:&nbsp;mdl)(o&nbsp;:&nbsp;obj)&nbsp;:&nbsp;Prop&nbsp;:=<br/>
&nbsp;&nbsp;exists&nbsp;CDef,&nbsp;M2&nbsp;(cname&nbsp;o)&nbsp;=&nbsp;CDef.<br/>
<br/>
Definition&nbsp;internal_addr&nbsp;(M1&nbsp;M2&nbsp;:&nbsp;mdl)(σ&nbsp;:&nbsp;config)(α&nbsp;:&nbsp;addr)&nbsp;:&nbsp;Prop&nbsp;:=<br/>
&nbsp;&nbsp;exists&nbsp;o,&nbsp;mapp&nbsp;σ&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal_obj&nbsp;M1&nbsp;M2&nbsp;o.<br/>
<br/>
Definition&nbsp;external_addr&nbsp;(M1&nbsp;M2&nbsp;:&nbsp;mdl)(σ&nbsp;:&nbsp;config)(α&nbsp;:&nbsp;addr)&nbsp;:&nbsp;Prop&nbsp;:=<br/>
&nbsp;&nbsp;exists&nbsp;o,&nbsp;mapp&nbsp;σ&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external_obj&nbsp;M1&nbsp;M2&nbsp;o.<br/>
<br/>
Definition&nbsp;no_external_calls&nbsp;(M1&nbsp;M2&nbsp;:&nbsp;mdl)(m&nbsp;:&nbsp;mth)&nbsp;:&nbsp;Prop&nbsp;:=<br/>
&nbsp;&nbsp;forall&nbsp;σ1&nbsp;σ2,&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;σ0&nbsp;α1&nbsp;α2&nbsp;&nbsp;β,&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;◎&nbsp;σ0&nbsp;…&nbsp;σ1&nbsp;⊨&nbsp;(α1&nbsp;calls&nbsp;α2&nbsp;▸&nbsp;m&nbsp;⟨&nbsp;β&nbsp;⟩)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;χ1&nbsp;ϕ1&nbsp;ψ1&nbsp;χ2&nbsp;ϕ2&nbsp;ψ2&nbsp;s&nbsp;x&nbsp;y&nbsp;β',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ1,&nbsp;ϕ1&nbsp;::&nbsp;ψ1)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2&nbsp;=&nbsp;(χ2,&nbsp;ϕ2&nbsp;::&nbsp;ψ2)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;length&nbsp;ψ1&nbsp;=&nbsp;length&nbsp;ψ2&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vMap&nbsp;ϕ1&nbsp;this&nbsp;=&nbsp;vMap&nbsp;ϕ2&nbsp;this&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ1&nbsp;=&nbsp;c_stmt&nbsp;(s_meth&nbsp;x&nbsp;y&nbsp;m&nbsp;β'&nbsp;;;&nbsp;s)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_stmt&nbsp;s.<br/>
<br/>
Definition&nbsp;classic_spec&nbsp;(M1&nbsp;M2&nbsp;:&nbsp;mdl)(α1&nbsp;α2&nbsp;:&nbsp;addr)(m&nbsp;:&nbsp;mth)(β&nbsp;:&nbsp;partial_map&nbsp;var&nbsp;a_var)(A1&nbsp;A2&nbsp;:&nbsp;asrt)&nbsp;:=<br/>
&nbsp;&nbsp;forall&nbsp;σ1&nbsp;σ2,&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(length&nbsp;(snd&nbsp;σ1))&nbsp;=&nbsp;length&nbsp;(snd&nbsp;σ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;σ0,&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;◎&nbsp;σ0&nbsp;…&nbsp;σ1&nbsp;⊨&nbsp;((a_&nbsp;α1)&nbsp;calls&nbsp;(a_&nbsp;α2)&nbsp;▸&nbsp;m&nbsp;⟨&nbsp;β&nbsp;⟩)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;◎&nbsp;σ0&nbsp;…&nbsp;σ1&nbsp;⊨&nbsp;A1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;◎&nbsp;σ0&nbsp;…&nbsp;σ2&nbsp;⊨&nbsp;A2.<br/>
<br/>
Definition&nbsp;classic_spec_prop&nbsp;(M1&nbsp;M2&nbsp;:&nbsp;mdl)(C&nbsp;:&nbsp;cls)(m&nbsp;:&nbsp;mth)(P&nbsp;Q&nbsp;:&nbsp;mdl&nbsp;-&gt;&nbsp;mdl&nbsp;-&gt;&nbsp;config&nbsp;-&gt;&nbsp;Prop)&nbsp;:=<br/>
&nbsp;&nbsp;forall&nbsp;σ1&nbsp;σ2,&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(length&nbsp;(snd&nbsp;σ1))&nbsp;=&nbsp;length&nbsp;(snd&nbsp;σ2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;CDef&nbsp;body,&nbsp;M1&nbsp;C&nbsp;=&nbsp;Some&nbsp;CDef&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c_meths&nbsp;CDef&nbsp;m&nbsp;=&nbsp;body)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;σ0&nbsp;α1&nbsp;α2&nbsp;β&nbsp;o,&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;◎&nbsp;σ0&nbsp;…&nbsp;σ1&nbsp;⊨&nbsp;((a_&nbsp;α1)&nbsp;calls&nbsp;(a_&nbsp;α2)&nbsp;▸&nbsp;m&nbsp;⟨&nbsp;β&nbsp;⟩)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapp&nbsp;σ1&nbsp;α1&nbsp;=&nbsp;Some&nbsp;o&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cname&nbsp;o&nbsp;=&nbsp;C&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q&nbsp;M1&nbsp;M2&nbsp;σ2.<br/>
<br/>
Inductive&nbsp;reductions_alt&nbsp;:&nbsp;mdl&nbsp;-&gt;&nbsp;mdl&nbsp;-&gt;&nbsp;config&nbsp;-&gt;&nbsp;config&nbsp;-&gt;&nbsp;Prop&nbsp;:=<br/>
|&nbsp;ra_single&nbsp;:&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external_self&nbsp;M1&nbsp;M2&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2<br/>
|&nbsp;ra_trans&nbsp;:&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;M&nbsp;σ1&nbsp;σ2&nbsp;σ,&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ2&nbsp;σ&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ.<br/>
<br/>
Inductive&nbsp;pair_reduction_alt&nbsp;:&nbsp;mdl&nbsp;-&gt;&nbsp;mdl&nbsp;-&gt;&nbsp;config&nbsp;-&gt;&nbsp;config&nbsp;-&gt;&nbsp;Prop&nbsp;:=<br/>
|&nbsp;pra&nbsp;:&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;M&nbsp;σ1&nbsp;σ&nbsp;σ2,&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external_self&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pair_reduction_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2.<br/>
<br/>
Inductive&nbsp;pair_reductions_alt&nbsp;:&nbsp;mdl&nbsp;-&gt;&nbsp;mdl&nbsp;-&gt;&nbsp;config&nbsp;-&gt;&nbsp;config&nbsp;-&gt;&nbsp;Prop&nbsp;:=<br/>
|&nbsp;pra_single&nbsp;:&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;pair_reduction_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pair_reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2<br/>
|&nbsp;pra_trans&nbsp;:&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ&nbsp;σ2,&nbsp;pair_reduction_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pair_reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pair_reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2.<br/>
<br/>
Hint&nbsp;Constructors&nbsp;pair_reductions_alt.<br/>
<br/>
Lemma&nbsp;reductions_step_e_assgn&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;M&nbsp;x&nbsp;e&nbsp;v&nbsp;s,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;((r_&nbsp;x)&nbsp;≔&nbsp;(r_exp&nbsp;e)&nbsp;;;&nbsp;s)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⊢&nbsp;e&nbsp;↪&nbsp;v&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;σ,&nbsp;assgn_func&nbsp;x&nbsp;v&nbsp;σ1&nbsp;=&nbsp;Some&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;σ2.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⤳</span> <span class="inlinecode"><span class="id" title="var">_</span>|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
            <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">external_self</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;is_external_self_implies_not_is_internal&nbsp;in&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contradiction&nbsp;Ha<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;internal_self,&nbsp;is_internal&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;vMap&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;eq_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;eexists;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⤳</span> <span class="inlinecode"><span class="id" title="var">_</span>|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
            <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;assgn_func.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="keyword">context</span></span> <span class="inlinecode">[<span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span>]</span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha;&nbsp;simpl<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;link_unique_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eval_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eexists;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;reductions_step_assgn&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;M&nbsp;x&nbsp;e&nbsp;v&nbsp;s,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;(((r_&nbsp;x)&nbsp;≔&nbsp;(r_exp&nbsp;e))&nbsp;;;&nbsp;s)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⊢&nbsp;e&nbsp;↪&nbsp;v&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;σ,&nbsp;assgn_func&nbsp;x&nbsp;v&nbsp;σ1&nbsp;=&nbsp;Some&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;σ2.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⤳</span> <span class="inlinecode"><span class="id" title="var">_</span>|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
            <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">external_self</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;is_external_self_implies_not_is_internal&nbsp;in&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contradiction&nbsp;Ha<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;internal_self,&nbsp;is_internal&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;vMap&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;eq_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;eexists;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⤳</span> <span class="inlinecode"><span class="id" title="var">_</span>|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
            <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;assgn_func.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="keyword">context</span></span> <span class="inlinecode">[<span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span>]</span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha;&nbsp;simpl<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;link_unique_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eval_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eexists;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
Qed.<br/>
<br/>
<span class="comment">(*Lemma&nbsp;reductions_step_if&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;M&nbsp;e&nbsp;s1&nbsp;s2&nbsp;s,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;((s_if&nbsp;e&nbsp;s1&nbsp;s2)&nbsp;;;&nbsp;s)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;σ,&nbsp;if_func&nbsp;v_true&nbsp;σ1&nbsp;=&nbsp;Some&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;σ2&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⊢&nbsp;e&nbsp;↪&nbsp;v_true)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;σ,&nbsp;if_func&nbsp;v_false&nbsp;σ1&nbsp;=&nbsp;Some&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;σ2&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⊢&nbsp;e&nbsp;↪&nbsp;v_false).<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⤳</span> <span class="inlinecode"><span class="id" title="var">_</span>|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
              <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">is_external</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;is_external_implies_not_is_internal&nbsp;in&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contradiction&nbsp;Ha<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
              <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">is_external</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;is_external_implies_not_is_internal&nbsp;in&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contradiction&nbsp;Ha<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⤳</span> <span class="inlinecode"><span class="id" title="var">_</span>|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
              <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;if_func.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="keyword">context</span></span> <span class="inlinecode">[<span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span>]</span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha;&nbsp;simpl<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;link_unique_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eexists;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
              <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;if_func.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="keyword">context</span></span> <span class="inlinecode">[<span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span>]</span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha;&nbsp;simpl<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;link_unique_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eexists;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
Qed.*)</span><br/>
<br/>
Lemma&nbsp;pair_reduction_change_alt&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;pair_reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;(P&nbsp;:&nbsp;mdl&nbsp;-&gt;&nbsp;mdl&nbsp;-&gt;&nbsp;config&nbsp;-&gt;&nbsp;Prop),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;P&nbsp;M1&nbsp;M2&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;σ&nbsp;σ',&nbsp;(σ&nbsp;=&nbsp;σ1&nbsp;\/&nbsp;pair_reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pair_reduction_alt&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;σ'&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ'&nbsp;=&nbsp;σ2&nbsp;\/&nbsp;pair_reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ'&nbsp;σ2)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;P&nbsp;M1&nbsp;M2&nbsp;σ'.<br/>
Proof.<br/>
&nbsp;&nbsp;intros&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;auto&nbsp;with&nbsp;loo_db.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;exists&nbsp;σ1,&nbsp;σ2;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;destruct&nbsp;(excluded_middle&nbsp;(P&nbsp;M1&nbsp;M2&nbsp;σ)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;specialize&nbsp;(IHHred&nbsp;P);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;auto_specialize;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;σ0,&nbsp;σ3;&nbsp;repeat&nbsp;split;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;exists&nbsp;σ1,&nbsp;σ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
Qed.<br/>
<br/>
<br/>
Lemma&nbsp;pair_reduction_alt_equiv_1&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;pair_reduction_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;σ1&nbsp;⤳&nbsp;σ2.<br/>
Proof.<br/>
<br/>
Admitted.<br/>
<br/>
Lemma&nbsp;pair_reductions_alt_equiv_1&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;pair_reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;σ1&nbsp;⤳⋆&nbsp;σ2.<br/>
Proof.<br/>
Admitted.<br/>
<br/>
<br/>
Lemma&nbsp;pair_reduction_alt_equiv_2&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pair_reduction_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2.<br/>
Proof.<br/>
<br/>
Admitted.<br/>
<br/>
Lemma&nbsp;pair_reductions_alt_equiv_2&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;σ1&nbsp;⤳⋆&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pair_reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2.<br/>
Proof.<br/>
Admitted.<br/>
<br/>
Lemma&nbsp;pair_reduction_change&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;σ1&nbsp;⤳⋆&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;(P&nbsp;:&nbsp;mdl&nbsp;-&gt;&nbsp;mdl&nbsp;-&gt;&nbsp;config&nbsp;-&gt;&nbsp;Prop),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;P&nbsp;M1&nbsp;M2&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;σ&nbsp;σ',&nbsp;(σ&nbsp;=&nbsp;σ1&nbsp;\/&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;σ1&nbsp;⤳⋆&nbsp;σ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;σ&nbsp;⤳&nbsp;σ'&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ'&nbsp;=&nbsp;σ2&nbsp;\/&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;⦿&nbsp;σ'&nbsp;⤳⋆&nbsp;σ2)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;P&nbsp;M1&nbsp;M2&nbsp;σ'.<br/>
Proof.<br/>
&nbsp;&nbsp;intros.<br/>
&nbsp;&nbsp;destruct&nbsp;(pair_reduction_change_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(P:=P)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;<span class="inlinecode">σ</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;apply&nbsp;pair_reductions_alt_equiv_2;&nbsp;auto.<br/>
&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;exists&nbsp;σ,&nbsp;σ0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;+&nbsp;destruct&nbsp;Ha;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;right;&nbsp;apply&nbsp;pair_reductions_alt_equiv_1;&nbsp;auto.<br/>
&nbsp;&nbsp;+&nbsp;apply&nbsp;pair_reduction_alt_equiv_1;&nbsp;auto.<br/>
&nbsp;&nbsp;+&nbsp;destruct&nbsp;Ha1;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;right;&nbsp;apply&nbsp;pair_reductions_alt_equiv_1;&nbsp;auto.<br/>
Qed.<br/>
<br/>
Lemma&nbsp;asgn_reduction_step&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ&nbsp;ϕ&nbsp;ψ,&nbsp;σ1&nbsp;=&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;x&nbsp;r&nbsp;s,&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;(((r_&nbsp;x)&nbsp;≔&nbsp;r)&nbsp;;;&nbsp;s)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;v,&nbsp;σ2&nbsp;=&nbsp;(χ,&nbsp;frm&nbsp;(update&nbsp;x&nbsp;v&nbsp;(vMap&nbsp;ϕ))&nbsp;(c_stmt&nbsp;s)&nbsp;::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((exists&nbsp;y,&nbsp;r&nbsp;=&nbsp;r_var&nbsp;y&nbsp;/\&nbsp;vMap&nbsp;ϕ&nbsp;y&nbsp;=&nbsp;Some&nbsp;v)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;e,&nbsp;r&nbsp;=&nbsp;r_exp&nbsp;e&nbsp;/\&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⊢&nbsp;e&nbsp;↪&nbsp;v)).<br/>
Proof.<br/>
<br/>
Admitted.<br/>
<br/>
Lemma&nbsp;if_reduction_step&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ&nbsp;ϕ&nbsp;ψ,&nbsp;σ1&nbsp;=&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;e&nbsp;s1&nbsp;s2&nbsp;s,&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;((s_if&nbsp;e&nbsp;s1&nbsp;s2)&nbsp;;;&nbsp;s)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ2&nbsp;=&nbsp;(χ,&nbsp;frm&nbsp;(vMap&nbsp;ϕ)&nbsp;(c_stmt&nbsp;(s1&nbsp;;;&nbsp;s))&nbsp;::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⊢&nbsp;e&nbsp;↪&nbsp;v_true)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ2&nbsp;=&nbsp;(χ,&nbsp;frm&nbsp;(vMap&nbsp;ϕ)&nbsp;(c_stmt&nbsp;(s2&nbsp;;;&nbsp;s))&nbsp;::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⊢&nbsp;e&nbsp;↪&nbsp;v_false).<br/>
Proof.<br/>
<br/>
Admitted.<br/>
<br/>
Lemma&nbsp;vAssgn_reductions_step&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;M&nbsp;χ&nbsp;ϕ&nbsp;ψ,&nbsp;σ1&nbsp;=&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;x&nbsp;r&nbsp;s,&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;(((r_&nbsp;x)&nbsp;≔&nbsp;r)&nbsp;;;&nbsp;s)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;σ&nbsp;v,&nbsp;σ&nbsp;=&nbsp;(χ,&nbsp;frm&nbsp;(update&nbsp;x&nbsp;v&nbsp;(vMap&nbsp;ϕ))&nbsp;(c_stmt&nbsp;s)&nbsp;::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((exists&nbsp;e,&nbsp;r&nbsp;=&nbsp;r_exp&nbsp;e&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⊢&nbsp;e&nbsp;↪&nbsp;v)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;y&nbsp;f&nbsp;α&nbsp;o,&nbsp;r&nbsp;=&nbsp;r_fld&nbsp;y&nbsp;f&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vMap&nbsp;ϕ&nbsp;y&nbsp;=&nbsp;Some&nbsp;(v_addr&nbsp;α)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;o&nbsp;f&nbsp;=&nbsp;Some&nbsp;v))&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;σ2&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ.<br/>
Proof.<br/>
<br/>
Admitted.<br/>
<br/>
Lemma&nbsp;fAssgn_reductions_step&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;M&nbsp;χ&nbsp;ϕ&nbsp;ψ,&nbsp;σ1&nbsp;=&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;x&nbsp;f&nbsp;y&nbsp;s,&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;((x&nbsp;◌&nbsp;f&nbsp;≔&nbsp;(r_&nbsp;y))&nbsp;;;&nbsp;s)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;σ&nbsp;v&nbsp;α&nbsp;o,&nbsp;σ&nbsp;=&nbsp;(update&nbsp;α&nbsp;(new&nbsp;(cname&nbsp;o)&nbsp;(update&nbsp;f&nbsp;v&nbsp;(flds&nbsp;o)))&nbsp;χ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frm&nbsp;(vMap&nbsp;ϕ)&nbsp;(c_stmt&nbsp;s)::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vMap&nbsp;ϕ&nbsp;y&nbsp;=&nbsp;Some&nbsp;v&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vMap&nbsp;ϕ&nbsp;x&nbsp;=&nbsp;Some&nbsp;(v_addr&nbsp;α)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(exists&nbsp;v',&nbsp;flds&nbsp;o&nbsp;f&nbsp;=&nbsp;Some&nbsp;v')&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;σ2&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ.<br/>
Proof.<br/>
<br/>
Admitted.<br/>
<br/>
Lemma&nbsp;if_reductions_step&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;M&nbsp;χ&nbsp;ϕ&nbsp;ψ,&nbsp;σ1&nbsp;=&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;e&nbsp;s1&nbsp;s2&nbsp;s,&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;((s_if&nbsp;e&nbsp;s1&nbsp;s2)&nbsp;;;&nbsp;s)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;σ,&nbsp;((σ&nbsp;=&nbsp;(χ,&nbsp;frm&nbsp;(vMap&nbsp;ϕ)&nbsp;(c_stmt&nbsp;(merge&nbsp;s1&nbsp;s))&nbsp;::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⊢&nbsp;e&nbsp;↪&nbsp;v_true)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ&nbsp;=&nbsp;(χ,&nbsp;frm&nbsp;(vMap&nbsp;ϕ)&nbsp;(c_stmt&nbsp;(merge&nbsp;s2&nbsp;s))&nbsp;::&nbsp;ψ)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⊢&nbsp;e&nbsp;↪&nbsp;v_false))&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;σ2&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ.<br/>
Proof.<br/>
<br/>
Admitted.<br/>
<br/>
Lemma&nbsp;rtrn_1_reductions_step&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;M&nbsp;χ&nbsp;ϕ1&nbsp;ϕ2&nbsp;ψ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ,&nbsp;ϕ1&nbsp;::&nbsp;ϕ2&nbsp;::&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⋄&nbsp;M2&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;x1&nbsp;s1&nbsp;x2&nbsp;s2,&nbsp;contn&nbsp;ϕ1&nbsp;=&nbsp;c_stmt&nbsp;((s_rtrn&nbsp;x1)&nbsp;;;&nbsp;s1)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ2&nbsp;=&nbsp;c_hole&nbsp;x2&nbsp;s2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;σ&nbsp;v,&nbsp;(σ&nbsp;=&nbsp;(χ,&nbsp;frm&nbsp;(update&nbsp;x2&nbsp;v&nbsp;(vMap&nbsp;ϕ2))&nbsp;(c_stmt&nbsp;s2)&nbsp;::&nbsp;ψ))&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vMap&nbsp;ϕ1&nbsp;x1&nbsp;=&nbsp;Some&nbsp;v)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(M&nbsp;∙&nbsp;σ1&nbsp;⤳&nbsp;σ)&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((reductions_alt&nbsp;M1&nbsp;M2&nbsp;σ&nbsp;σ2&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ)&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ2&nbsp;=&nbsp;σ&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal_self&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external_self&nbsp;M1&nbsp;M2&nbsp;σ)).<br/>
Proof.<br/>
<br/>
Admitted.<br/>
<br/>
Ltac&nbsp;reduction_step&nbsp;:=<br/>
&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">reductions_alt</span></span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">?<span class="id" title="var">M2</span></span>
                        <span class="inlinecode">(?χ',</span> <span class="inlinecode">{|</span> <span class="inlinecode"><span class="id" title="var">vMap</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">?<span class="id" title="var">β</span>;</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">(<span class="id" title="var">c_stmt</span></span> <span class="inlinecode">((?<span class="id" title="var">x'</span></span> <span class="inlinecode">◌</span> <span class="inlinecode">?<span class="id" title="var">f'</span></span> <span class="inlinecode">≔</span> <span class="inlinecode">(<span class="id" title="var">r_</span></span> <span class="inlinecode">?<span class="id" title="var">y'</span>))</span> <span class="inlinecode">;;</span> <span class="inlinecode">?<span class="id" title="var">s</span>))</span> <span class="inlinecode">|}</span> <span class="inlinecode">::</span> <span class="inlinecode">?ψ')</span>
                        <span class="inlinecode">?σ2,</span>
         <span class="inlinecode"><span class="id" title="var">Hlink</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">⋄</span> <span class="inlinecode">?<span class="id" title="var">M2</span></span> <span class="inlinecode">≜</span> <span class="inlinecode">?<span class="id" title="var">M</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;σ&nbsp;:=&nbsp;fresh&nbsp;"σ"&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;edestruct<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(fAssgn_reductions_step<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;M2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(χ',&nbsp;{|&nbsp;vMap&nbsp;:=&nbsp;β;&nbsp;contn&nbsp;:=&nbsp;(c_stmt&nbsp;((x'&nbsp;◌&nbsp;f'&nbsp;≔&nbsp;(r_&nbsp;y'))&nbsp;;;&nbsp;s))&nbsp;|}&nbsp;::&nbsp;ψ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;H)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ϕ:={|&nbsp;vMap&nbsp;:=&nbsp;β;&nbsp;contn&nbsp;:=&nbsp;(c_stmt&nbsp;((x'&nbsp;◌&nbsp;f'&nbsp;≔&nbsp;(r_&nbsp;y'))&nbsp;;;&nbsp;s))&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(M:=M)(χ:=χ')(ψ:=ψ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;<span class="inlinecode">σ</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;H<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">reductions_alt</span></span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">?<span class="id" title="var">M2</span></span>
                        <span class="inlinecode">(?χ',</span> <span class="inlinecode">{|</span> <span class="inlinecode"><span class="id" title="var">vMap</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">?<span class="id" title="var">β</span>;</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">(<span class="id" title="var">c_stmt</span></span> <span class="inlinecode">((?<span class="id" title="var">y</span></span> <span class="inlinecode">≔</span> <span class="inlinecode">?<span class="id" title="var">r'</span>)</span> <span class="inlinecode">;;</span> <span class="inlinecode">?<span class="id" title="var">s</span>))</span> <span class="inlinecode">|}</span> <span class="inlinecode">::</span> <span class="inlinecode">?ψ')</span>
                        <span class="inlinecode">?σ2,</span>
         <span class="inlinecode"><span class="id" title="var">Hlink</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">⋄</span> <span class="inlinecode">?<span class="id" title="var">M2</span></span> <span class="inlinecode">≜</span> <span class="inlinecode">?<span class="id" title="var">M</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;σ&nbsp;:=&nbsp;fresh&nbsp;"σ"&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;edestruct<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vAssgn_reductions_step<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;M2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(χ',&nbsp;{|&nbsp;vMap&nbsp;:=&nbsp;β;&nbsp;contn&nbsp;:=&nbsp;(c_stmt&nbsp;((y&nbsp;≔&nbsp;r')&nbsp;;;&nbsp;s))&nbsp;|}&nbsp;::&nbsp;ψ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;H)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ϕ:={|&nbsp;vMap&nbsp;:=&nbsp;β;&nbsp;contn&nbsp;:=&nbsp;(c_stmt&nbsp;((y&nbsp;≔&nbsp;r')&nbsp;;;&nbsp;s))&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(r:=r')(M:=M)(χ:=χ')(ψ:=ψ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;<span class="inlinecode">σ</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;H<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">reductions_alt</span></span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">?<span class="id" title="var">M2</span></span>
                        <span class="inlinecode">(?χ',</span> <span class="inlinecode">{|</span> <span class="inlinecode"><span class="id" title="var">vMap</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">?<span class="id" title="var">β</span>;</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">(<span class="id" title="var">c_stmt</span></span> <span class="inlinecode">((<span class="id" title="var">s_if</span></span> <span class="inlinecode">?<span class="id" title="var">e'</span></span> <span class="inlinecode">?<span class="id" title="var">s1'</span></span> <span class="inlinecode">?<span class="id" title="var">s2'</span>)</span> <span class="inlinecode">;;</span> <span class="inlinecode">?<span class="id" title="var">s'</span>))</span> <span class="inlinecode">|}</span> <span class="inlinecode">::</span> <span class="inlinecode">?ψ')</span>
                        <span class="inlinecode">?σ2,</span>
         <span class="inlinecode"><span class="id" title="var">Hlink</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">⋄</span> <span class="inlinecode">?<span class="id" title="var">M2</span></span> <span class="inlinecode">≜</span> <span class="inlinecode">?<span class="id" title="var">M</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;σ&nbsp;:=&nbsp;fresh&nbsp;"σ"&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;edestruct<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(if_reductions_step<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;M2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(χ',&nbsp;{|&nbsp;vMap&nbsp;:=&nbsp;β;&nbsp;contn&nbsp;:=&nbsp;(c_stmt&nbsp;((s_if&nbsp;e'&nbsp;s1'&nbsp;s2')&nbsp;;;&nbsp;s'))&nbsp;|}&nbsp;::&nbsp;ψ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;H)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ϕ:={|&nbsp;vMap&nbsp;:=&nbsp;β;&nbsp;contn&nbsp;:=&nbsp;(c_stmt&nbsp;((s_if&nbsp;e'&nbsp;s1'&nbsp;s2')&nbsp;;;&nbsp;s'))&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e:=e')(s1:=s1')(s2:=s2')(M:=M)(χ:=χ')(ψ:=ψ')(s:=s')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;<span class="inlinecode">σ</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;H<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">reductions_alt</span></span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">?<span class="id" title="var">M2</span></span>
                        <span class="inlinecode">(?χ',</span> <span class="inlinecode">{|</span> <span class="inlinecode"><span class="id" title="var">vMap</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">?<span class="id" title="var">β1</span>;</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">(<span class="id" title="var">c_stmt</span></span> <span class="inlinecode">((<span class="id" title="var">s_rtrn</span></span> <span class="inlinecode">?<span class="id" title="var">x1'</span>)</span> <span class="inlinecode">;;</span> <span class="inlinecode">?<span class="id" title="var">s1'</span>))</span> <span class="inlinecode">|}</span>
                                <span class="inlinecode">::</span> <span class="inlinecode">{|</span> <span class="inlinecode"><span class="id" title="var">vMap</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">?<span class="id" title="var">β2</span>;</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">(<span class="id" title="var">c_hole</span></span> <span class="inlinecode">?<span class="id" title="var">x2'</span></span> <span class="inlinecode">?<span class="id" title="var">s2'</span>)</span> <span class="inlinecode">|}</span>
                                <span class="inlinecode">::</span> <span class="inlinecode">?ψ')</span>
                        <span class="inlinecode">?σ2',</span>
         <span class="inlinecode"><span class="id" title="var">Hlink</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M1</span></span> <span class="inlinecode">⋄</span> <span class="inlinecode">?<span class="id" title="var">M2</span></span> <span class="inlinecode">≜</span> <span class="inlinecode">?<span class="id" title="var">M</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"></span>&nbsp;=&gt;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;σ&nbsp;:=&nbsp;fresh&nbsp;"σ"&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;edestruct&nbsp;(rtrn_1_reductions_step<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;M2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(χ',&nbsp;{|&nbsp;vMap&nbsp;:=&nbsp;β1;&nbsp;contn&nbsp;:=&nbsp;(c_stmt&nbsp;((s_rtrn&nbsp;x1')&nbsp;;;&nbsp;s1'))&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;{|&nbsp;vMap&nbsp;:=&nbsp;β2;&nbsp;contn&nbsp;:=&nbsp;(c_hole&nbsp;x2'&nbsp;s2')&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;ψ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;H)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ϕ1:={|&nbsp;vMap&nbsp;:=&nbsp;β1;&nbsp;contn&nbsp;:=&nbsp;(c_stmt&nbsp;((s_rtrn&nbsp;x1')&nbsp;;;&nbsp;s1'))&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ϕ2:={|&nbsp;vMap&nbsp;:=&nbsp;β2;&nbsp;contn&nbsp;:=&nbsp;(c_hole&nbsp;x2'&nbsp;s2')&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;<span class="inlinecode">σ</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;H<br/>
&nbsp;&nbsp;end.<br/>
<br/>
Module&nbsp;SafeExample.<br/>
<br/>
&nbsp;&nbsp;<span class="comment">(**<br/>
∀s.<span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">Safe</span></span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">s.treasure</span></span> <span class="inlinecode">&lt;&gt;</span> <span class="inlinecode"><span class="id" title="var">null</span></span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">will</span>(<span class="id" title="var">s.treasure</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">null</span>)</span> 
        <span class="inlinecode">⟶</span> <span class="inlinecode">∃<span class="id" title="var">o</span>.[<span class="id" title="var">external</span>(<span class="id" title="var">o</span>)</span> <span class="inlinecode">∧</span> <span class="inlinecode">(<span class="id" title="var">o</span></span> <span class="inlinecode"><span class="id" title="var">access</span></span> <span class="inlinecode"><span class="id" title="var">s.secret</span>)]</span><br/>
&nbsp;&nbsp;&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;<span class="comment">(**&nbsp;Safe&nbsp;Definition&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;Definition&nbsp;Safe&nbsp;:=&nbsp;classID&nbsp;1.<br/>
<br/>
&nbsp;&nbsp;Definition&nbsp;treasure&nbsp;:=&nbsp;fieldID&nbsp;0.<br/>
<br/>
&nbsp;&nbsp;Definition&nbsp;secret&nbsp;:=&nbsp;fieldID&nbsp;1.<br/>
<br/>
&nbsp;&nbsp;Definition&nbsp;take&nbsp;:=&nbsp;methID&nbsp;0.<br/>
<br/>
&nbsp;&nbsp;Definition&nbsp;scr&nbsp;:=&nbsp;bnd&nbsp;1.<br/>
<br/>
&nbsp;&nbsp;Definition&nbsp;x&nbsp;:=&nbsp;bnd&nbsp;2.<br/>
<br/>
&nbsp;&nbsp;Definition&nbsp;y&nbsp;:=&nbsp;bnd&nbsp;3.<br/>
<br/>
&nbsp;&nbsp;Definition&nbsp;takeBody&nbsp;:=&nbsp;((r_&nbsp;x)&nbsp;≔&nbsp;(r_exp&nbsp;(e_val&nbsp;(v_null))))&nbsp;;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(((r_&nbsp;y)&nbsp;≔&nbsp;(this&nbsp;◌&nbsp;treasure))&nbsp;;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((s_if&nbsp;((e_var&nbsp;scr)&nbsp;⩵&nbsp;(e_acc_f&nbsp;(e_var&nbsp;this)&nbsp;secret))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(((this&nbsp;◌&nbsp;treasure)&nbsp;≔&nbsp;(r_&nbsp;x))&nbsp;;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(s_rtrn&nbsp;y))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(s_rtrn&nbsp;x))&nbsp;;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(s_rtrn&nbsp;x))).<br/>
<br/>
&nbsp;&nbsp;Definition&nbsp;SafeDef1&nbsp;:=&nbsp;clazz&nbsp;Safe<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(treasure&nbsp;::&nbsp;secret&nbsp;::&nbsp;nil)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(update<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;take&nbsp;(scr&nbsp;::&nbsp;nil,&nbsp;takeBody)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;empty)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;empty.<br/>
<br/>
&nbsp;&nbsp;<span class="comment">(**&nbsp;MyModule&nbsp;Definition&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;Definition&nbsp;MyModule1&nbsp;:=&nbsp;(update<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Safe&nbsp;SafeDef1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;empty).<br/>
<br/>
&nbsp;&nbsp;Lemma&nbsp;link_MyModule1_Safe&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;M'&nbsp;M,&nbsp;MyModule1&nbsp;⋄&nbsp;M'&nbsp;≜&nbsp;M&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;Safe&nbsp;=&nbsp;Some&nbsp;SafeDef1.<br/>
&nbsp;&nbsp;Proof.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;MyModule1,&nbsp;extend&nbsp;in&nbsp;*;&nbsp;simpl.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;Qed.<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;Lemma&nbsp;take_implies_secret&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;pair_reduction_alt&nbsp;MyModule1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;=&nbsp;MyModule1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;x&nbsp;α&nbsp;β&nbsp;o,&nbsp;method_is_called&nbsp;σ1&nbsp;x&nbsp;α&nbsp;take&nbsp;β&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapp&nbsp;σ1&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cname&nbsp;o&nbsp;=&nbsp;Safe&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;v,&nbsp;flds&nbsp;o&nbsp;secret&nbsp;=&nbsp;Some&nbsp;v.<br/>
&nbsp;&nbsp;Proof.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H4;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H0;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;interpretation_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;mapp,&nbsp;configMapHeap,&nbsp;fst&nbsp;in&nbsp;H5.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?χ</span> <span class="inlinecode">?<span class="id" title="var">α</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
            <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?χ</span> <span class="inlinecode">?<span class="id" title="var">α</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">cname</span></span> <span class="inlinecode">?<span class="id" title="var">o</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
            <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="keyword">context</span>[<span class="id" title="var">cname</span></span> <span class="inlinecode">?<span class="id" title="var">o</span>]</span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;erewrite&nbsp;link_MyModule1_Safe&nbsp;in&nbsp;H13;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H13;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;H14.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;update,&nbsp;t_update&nbsp;in&nbsp;H14;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H14;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;takeBody&nbsp;in&nbsp;H2.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;reduction_step;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Ha0&nbsp;as&nbsp;<span class="inlinecode">|<span class="id" title="var">Htmp</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">destruct</span></span> <span class="inlinecode"><span class="id" title="var">Htmp</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">r_exp</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">r_exp</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;reduction_step;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Ha1&nbsp;as&nbsp;<span class="inlinecode">|<span class="id" title="var">Htmp</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">destruct</span></span> <span class="inlinecode"><span class="id" title="var">Htmp</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode">(?<span class="id" title="var">x</span></span> <span class="inlinecode">◌</span> <span class="inlinecode">?<span class="id" title="var">f</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode">(<span class="id" title="var">_</span></span> <span class="inlinecode">◌</span> <span class="inlinecode"><span class="id" title="var">_</span>)</span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(α0=α);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">map_rewrite</span>;</span>
       <span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">x</span>,</span> <span class="inlinecode"><span class="id" title="var">this</span>;</span>
       <span class="inlinecode"><span class="id" title="var">crush</span></span>
      <span class="inlinecode">|<span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">α0</span></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;reduction_step;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Ha4;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M</span></span> <span class="inlinecode">∙</span> <span class="inlinecode">?σ</span> <span class="inlinecode">⊢</span> <span class="inlinecode">(<span class="id" title="var">_</span></span> <span class="inlinecode">⩵</span> <span class="inlinecode"><span class="id" title="var">e_acc_f</span></span> <span class="inlinecode">(<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">this</span>)</span> <span class="inlinecode"><span class="id" title="var">secret</span>)</span> <span class="inlinecode">↪</span> <span class="inlinecode">?<span class="id" title="var">v</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M</span></span> <span class="inlinecode">∙</span> <span class="inlinecode">?σ</span> <span class="inlinecode">⊢</span> <span class="inlinecode">(<span class="id" title="var">e_acc_f</span></span> <span class="inlinecode">(<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">this</span>)</span> <span class="inlinecode"><span class="id" title="var">secret</span>)</span> <span class="inlinecode">↪</span> <span class="inlinecode">?<span class="id" title="var">v</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M</span></span> <span class="inlinecode">∙</span> <span class="inlinecode">?σ</span> <span class="inlinecode">⊢</span> <span class="inlinecode">(<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">this</span>)</span> <span class="inlinecode">↪</span> <span class="inlinecode">?<span class="id" title="var">v</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;H<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">?<span class="id" title="var">a</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span> <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">?<span class="id" title="var">a</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M</span></span> <span class="inlinecode">∙</span> <span class="inlinecode">?σ</span> <span class="inlinecode">⊢</span> <span class="inlinecode">(<span class="id" title="var">_</span></span> <span class="inlinecode">⩵</span> <span class="inlinecode"><span class="id" title="var">e_acc_f</span></span> <span class="inlinecode">(<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">this</span>)</span> <span class="inlinecode"><span class="id" title="var">secret</span>)</span> <span class="inlinecode">↪</span> <span class="inlinecode">?<span class="id" title="var">v</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M</span></span> <span class="inlinecode">∙</span> <span class="inlinecode">?σ</span> <span class="inlinecode">⊢</span> <span class="inlinecode">(<span class="id" title="var">e_acc_f</span></span> <span class="inlinecode">(<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">this</span>)</span> <span class="inlinecode"><span class="id" title="var">secret</span>)</span> <span class="inlinecode">↪</span> <span class="inlinecode">?<span class="id" title="var">v</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M</span></span> <span class="inlinecode">∙</span> <span class="inlinecode">?σ</span> <span class="inlinecode">⊢</span> <span class="inlinecode">(<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">this</span>)</span> <span class="inlinecode">↪</span> <span class="inlinecode">?<span class="id" title="var">v</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;H<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">?<span class="id" title="var">a</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span> <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">?<span class="id" title="var">a</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;Qed.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;Lemma&nbsp;take_implies_treasure&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;pair_reduction_alt&nbsp;MyModule1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;=&nbsp;MyModule1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;x&nbsp;α&nbsp;β&nbsp;o,&nbsp;method_is_called&nbsp;σ1&nbsp;x&nbsp;α&nbsp;take&nbsp;β&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapp&nbsp;σ1&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cname&nbsp;o&nbsp;=&nbsp;Safe&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;v,&nbsp;flds&nbsp;o&nbsp;treasure&nbsp;=&nbsp;Some&nbsp;v.<br/>
&nbsp;&nbsp;Proof.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H4;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H0;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;interpretation_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;mapp,&nbsp;configMapHeap,&nbsp;fst&nbsp;in&nbsp;H5.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">cname</span></span> <span class="inlinecode">?<span class="id" title="var">o</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
            <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="keyword">context</span>[<span class="id" title="var">cname</span></span> <span class="inlinecode">?<span class="id" title="var">o</span>]</span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;erewrite&nbsp;link_MyModule1_Safe&nbsp;in&nbsp;H13;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H13;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;H14.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;update,&nbsp;t_update&nbsp;in&nbsp;H14;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H14;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;takeBody&nbsp;in&nbsp;H2.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;reduction_step;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Ha0&nbsp;as&nbsp;<span class="inlinecode">|<span class="id" title="var">Htmp</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">destruct</span></span> <span class="inlinecode"><span class="id" title="var">Htmp</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;reduction_step;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Ha0&nbsp;as&nbsp;<span class="inlinecode">|<span class="id" title="var">Htmp</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">destruct</span></span> <span class="inlinecode"><span class="id" title="var">Htmp</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">◌</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">◌</span> <span class="inlinecode"><span class="id" title="var">_</span></span>  <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(this&nbsp;&lt;&gt;&nbsp;x);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">this</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">crush</span>|</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">?<span class="id" title="var">a</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span> <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">?<span class="id" title="var">a</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
&nbsp;&nbsp;Qed.<br/>
<br/>
&nbsp;&nbsp;Lemma&nbsp;pair_reduction_take_is_called&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;MyModule1&nbsp;⦂&nbsp;M&nbsp;⦿&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ&nbsp;ϕ&nbsp;ψ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;x&nbsp;α&nbsp;β&nbsp;o,&nbsp;method_is_called&nbsp;σ1&nbsp;x&nbsp;α&nbsp;take&nbsp;β&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapp&nbsp;σ1&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cname&nbsp;o&nbsp;=&nbsp;Safe.<br/>
&nbsp;&nbsp;Proof.<br/>
&nbsp;&nbsp;Admitted.<br/>
<br/>
&nbsp;&nbsp;Lemma&nbsp;take_pre_post_alt&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2,&nbsp;pair_reduction_alt&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;=&nbsp;MyModule1&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;s1&nbsp;s2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;(s1&nbsp;;;&nbsp;s2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;x&nbsp;α&nbsp;β&nbsp;o,&nbsp;method_is_called&nbsp;σ1&nbsp;x&nbsp;α&nbsp;take&nbsp;β&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapp&nbsp;σ1&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cname&nbsp;o&nbsp;=&nbsp;Safe&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;t&nbsp;s,&nbsp;flds&nbsp;o&nbsp;treasure&nbsp;=&nbsp;Some&nbsp;t&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;o&nbsp;secret&nbsp;=&nbsp;Some&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((β&nbsp;scr&nbsp;=&nbsp;Some&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2&nbsp;=&nbsp;(update&nbsp;α&nbsp;(new&nbsp;Safe&nbsp;(update&nbsp;treasure&nbsp;v_null&nbsp;(flds&nbsp;o)))&nbsp;χ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(frm&nbsp;(update&nbsp;x&nbsp;t&nbsp;(vMap&nbsp;ϕ))&nbsp;(c_stmt&nbsp;s2))&nbsp;::&nbsp;ψ))&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((exists&nbsp;s',&nbsp;β&nbsp;scr&nbsp;=&nbsp;Some&nbsp;s'&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s'&nbsp;&lt;&gt;&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2&nbsp;=&nbsp;(χ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frm&nbsp;(update&nbsp;x&nbsp;v_null&nbsp;(vMap&nbsp;ϕ))&nbsp;(c_stmt&nbsp;s2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;ψ)))).<br/>
&nbsp;&nbsp;Proof.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;M1&nbsp;M2&nbsp;σ1&nbsp;σ2&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hred;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H10;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H0;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;simpl_crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span>
            <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">?<span class="id" title="var">ϕ</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;interpretation_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">(<span class="id" title="var">v_addr</span></span> <span class="inlinecode"><span class="id" title="var">_</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode">(<span class="id" title="var">v_addr</span></span> <span class="inlinecode"><span class="id" title="var">_</span>)</span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(o0&nbsp;=&nbsp;o);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">map_rewrite</span>;</span> <span class="inlinecode"><span class="id" title="var">crush</span>|<span class="id" title="tactic">subst</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">cname</span></span> <span class="inlinecode">?<span class="id" title="var">o</span></span> <span class="inlinecode">=</span> <span class="inlinecode">?<span class="id" title="var">C'</span>,</span>
            <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">M</span></span> <span class="inlinecode">(<span class="id" title="var">cname</span></span> <span class="inlinecode">?<span class="id" title="var">o</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode">?<span class="id" title="var">Def'</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;Ha&nbsp;in&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(C&nbsp;=&nbsp;SafeDef1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">apply</span></span> <span class="inlinecode"><span class="id" title="var">linked_class</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode">(<span class="id" title="var">C</span>:=<span class="id" title="var">Safe</span>)(<span class="id" title="var">Def</span>:=<span class="id" title="var">SafeDef1</span>)</span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">H</span>;</span> <span class="inlinecode"><span class="id" title="tactic">auto</span>;</span>
        <span class="inlinecode">[|<span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">Safe</span>,</span> <span class="inlinecode"><span class="id" title="var">ObjectName</span>;</span> <span class="inlinecode"><span class="id" title="var">crush</span>];</span>
        <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="keyword">goal</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span>
        <span class="inlinecode">|</span> <span class="inlinecode">[<span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">?<span class="id" title="var">a</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span>,</span> <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">m</span></span> <span class="inlinecode">?<span class="id" title="var">a</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span>]</span> <span class="inlinecode">=&gt;</span>
          <span class="inlinecode"><span class="id" title="tactic">rewrite</span></span> <span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">Hb</span>;</span>
          <span class="inlinecode"><span class="id" title="tactic">inversion</span></span> <span class="inlinecode"><span class="id" title="var">Hb</span>;</span>
          <span class="inlinecode"><span class="id" title="tactic">subst</span>;</span>
          <span class="inlinecode"><span class="id" title="tactic">clear</span></span> <span class="inlinecode"><span class="id" title="var">Hb</span></span>
        <span class="inlinecode"><span class="id" title="keyword">end</span>;</span>
        <span class="inlinecode"><span class="id" title="tactic">auto</span>|<span class="id" title="tactic">subst</span></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">c_meths</span></span> <span class="inlinecode"><span class="id" title="var">SafeDef1</span></span> <span class="inlinecode"><span class="id" title="var">take</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">(<span class="id" title="var">_</span>,</span> <span class="inlinecode"><span class="id" title="var">_</span>)</span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;SafeDef1&nbsp;in&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;update,&nbsp;t_update&nbsp;in&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq_auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;H<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">reductions_alt</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">(<span class="id" title="var">_</span>,</span> <span class="inlinecode">{|<span class="id" title="var">vMap</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">_</span>;</span> <span class="inlinecode"><span class="id" title="var">contn</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">c_stmt</span></span> <span class="inlinecode"><span class="id" title="var">takeBody</span></span> <span class="inlinecode">|}</span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">_</span>)</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;takeBody&nbsp;in&nbsp;H<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;reduction_step;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Ha0&nbsp;as&nbsp;<span class="inlinecode">|<span class="id" title="var">Htmp</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">destruct</span></span> <span class="inlinecode"><span class="id" title="var">Htmp</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">r_exp</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">r_exp</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;H<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span>:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⊢</span> <span class="inlinecode"><span class="id" title="var">e_null</span></span> <span class="inlinecode">↪</span> <span class="inlinecode">?<span class="id" title="var">v</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;reduction_step;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Ha0&nbsp;as&nbsp;<span class="inlinecode">|<span class="id" title="var">Htmp</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">destruct</span></span> <span class="inlinecode"><span class="id" title="var">Htmp</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;solve&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(this&nbsp;&lt;&gt;&nbsp;x);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">x</span>,</span> <span class="inlinecode"><span class="id" title="var">this</span>;</span>
       <span class="inlinecode"><span class="id" title="var">crush</span>|</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(α0&nbsp;=&nbsp;α);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">map_rewrite</span>;</span>
       <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">eq_auto</span>;</span>
       <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">simpl_crush</span>;</span>
       <span class="inlinecode"><span class="id" title="tactic">auto</span>|<span class="id" title="tactic">subst</span>;</span> <span class="inlinecode"><span class="id" title="var">simpl_crush</span></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;v.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;reduction_step;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;<span class="comment">(*scr&nbsp;==&nbsp;secret*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(exists&nbsp;s,&nbsp;flds&nbsp;o0&nbsp;secret&nbsp;=&nbsp;Some&nbsp;s&nbsp;/\&nbsp;(ps&nbsp;∘&nbsp;(vMap&nbsp;ϕ0))&nbsp;scr&nbsp;=&nbsp;Some&nbsp;s).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⊢</span> <span class="inlinecode">(<span class="id" title="var">_</span></span> <span class="inlinecode">⩵</span> <span class="inlinecode">(<span class="id" title="var">e_acc_f</span></span> <span class="inlinecode">(<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">this</span>)</span> <span class="inlinecode"><span class="id" title="var">secret</span>))</span> <span class="inlinecode">↪</span> <span class="inlinecode"><span class="id" title="var">v_true</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⊢</span> <span class="inlinecode">(<span class="id" title="var">e_acc_f</span></span> <span class="inlinecode">(<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">this</span>)</span> <span class="inlinecode"><span class="id" title="var">secret</span>)</span> <span class="inlinecode">↪</span> <span class="inlinecode">?<span class="id" title="var">v</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⊢</span> <span class="inlinecode">((<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">this</span>))</span> <span class="inlinecode">↪</span> <span class="inlinecode">?<span class="id" title="var">v</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;v0;&nbsp;split;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⊢</span> <span class="inlinecode">(<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">scr</span>)</span> <span class="inlinecode">↪</span> <span class="inlinecode">?<span class="id" title="var">v</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode">?<span class="id" title="var">v</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;mapp,&nbsp;configMapStack,&nbsp;mapp,&nbsp;stackMap,&nbsp;snd,&nbsp;vMap&nbsp;in&nbsp;H14.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;H14.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;destruct_exists_loo;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;v0;&nbsp;repeat&nbsp;split;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left;&nbsp;split;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reduction_step;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(x&nbsp;&lt;&gt;&nbsp;y);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">y</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">crush</span>|</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;update,&nbsp;t_update&nbsp;in&nbsp;Ha8;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;eq_auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;mapp,&nbsp;configMapHeap,&nbsp;fst&nbsp;in&nbsp;H11.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(y&nbsp;&lt;&gt;&nbsp;this);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">y</span>,</span> <span class="inlinecode"><span class="id" title="var">this</span>;</span> <span class="inlinecode"><span class="id" title="var">crush</span>|</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;update,&nbsp;t_update&nbsp;in&nbsp;Ha9;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;eq_auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">P</span>,</span> <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">P</span></span> <span class="inlinecode">|-<span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reduction_step;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Hb1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;apply&nbsp;is_internal_self_implies_not_is_external&nbsp;in&nbsp;Hb4.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contradiction&nbsp;Hb4.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;is_external_self,&nbsp;is_external.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;is_external_self,&nbsp;is_external&nbsp;in&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;α;&nbsp;split;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">exists</span></span> <span class="inlinecode"><span class="id" title="var">o0</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;mapp,&nbsp;configMapStack,&nbsp;configMapHeap,&nbsp;mapp,&nbsp;snd,&nbsp;fst,&nbsp;stackMap;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">split</span>;</span> <span class="inlinecode"><span class="id" title="tactic">auto</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;update,&nbsp;t_update;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(α&nbsp;&lt;&gt;&nbsp;α0);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">update</span>,</span> <span class="inlinecode"><span class="id" title="var">t_update</span>;</span> <span class="inlinecode"><span class="id" title="var">eq_auto</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;Hcontra;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;mapp,&nbsp;configMapHeap,&nbsp;fst&nbsp;in&nbsp;Ha9.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">cname</span></span> <span class="inlinecode">?<span class="id" title="var">o</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Safe</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;H&nbsp;in&nbsp;*<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">MyModule1</span></span> <span class="inlinecode"><span class="id" title="var">Safe</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">None</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;MyModule1&nbsp;in&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;update,&nbsp;t_update&nbsp;in&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;eq_auto<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;assert&nbsp;(x&nbsp;&lt;&gt;&nbsp;y);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">x</span>,</span> <span class="inlinecode"><span class="id" title="var">y</span>;</span> <span class="inlinecode"><span class="id" title="var">crush</span>|</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;update,&nbsp;t_update&nbsp;in&nbsp;Ha3;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;eq_auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">cname</span></span> <span class="inlinecode">?<span class="id" title="var">o</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Safe</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="keyword">context</span>[<span class="id" title="var">cname</span></span> <span class="inlinecode">?<span class="id" title="var">o</span>]</span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;H<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;<span class="comment">(*scr&nbsp;⩵̸&nbsp;secret*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(exists&nbsp;s&nbsp;s',&nbsp;flds&nbsp;o0&nbsp;secret&nbsp;=&nbsp;Some&nbsp;s&nbsp;/\&nbsp;(ps&nbsp;∘&nbsp;(vMap&nbsp;ϕ0))&nbsp;scr&nbsp;=&nbsp;Some&nbsp;s'&nbsp;/\&nbsp;s&nbsp;&lt;&gt;&nbsp;s').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⊢</span> <span class="inlinecode">(<span class="id" title="var">_</span></span> <span class="inlinecode">⩵</span> <span class="inlinecode">(<span class="id" title="var">e_acc_f</span></span> <span class="inlinecode">(<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">this</span>)</span> <span class="inlinecode"><span class="id" title="var">secret</span>))</span> <span class="inlinecode">↪</span> <span class="inlinecode"><span class="id" title="var">v_false</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⊢</span> <span class="inlinecode">(<span class="id" title="var">e_acc_f</span></span> <span class="inlinecode">(<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">this</span>)</span> <span class="inlinecode"><span class="id" title="var">secret</span>)</span> <span class="inlinecode">↪</span> <span class="inlinecode">?<span class="id" title="var">v</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⊢</span> <span class="inlinecode">((<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">this</span>))</span> <span class="inlinecode">↪</span> <span class="inlinecode">?<span class="id" title="var">v</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;map_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Heval</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">∙</span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">⊢</span> <span class="inlinecode">(<span class="id" title="var">e_var</span></span> <span class="inlinecode"><span class="id" title="var">scr</span>)</span> <span class="inlinecode">↪</span> <span class="inlinecode">?<span class="id" title="var">v</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Heval;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;mapp,&nbsp;configMapStack,&nbsp;mapp,&nbsp;stackMap,&nbsp;snd,&nbsp;vMap&nbsp;in&nbsp;H18.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;H18.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;v2,&nbsp;v1;&nbsp;split;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;repeat&nbsp;destruct_exists_loo;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;v0;&nbsp;repeat&nbsp;split;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right;&nbsp;exists&nbsp;v1;&nbsp;repeat&nbsp;split;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reduction_step;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;&nbsp;eauto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(x&nbsp;&lt;&gt;&nbsp;y);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">y</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">crush</span>|</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;update,&nbsp;t_update&nbsp;in&nbsp;Ha9;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;eq_auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">P</span>,</span> <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">P</span></span> <span class="inlinecode">|-<span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;mapp,&nbsp;configMapHeap,&nbsp;fst&nbsp;in&nbsp;H12.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(y&nbsp;&lt;&gt;&nbsp;this);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">unfold</span></span> <span class="inlinecode"><span class="id" title="var">y</span>,</span> <span class="inlinecode"><span class="id" title="var">this</span>;</span> <span class="inlinecode"><span class="id" title="var">crush</span>|</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;update,&nbsp;t_update&nbsp;in&nbsp;Ha10;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;eq_auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;simpl_crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">Ha</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">P</span>,</span> <span class="inlinecode"><span class="id" title="var">Hb</span></span> <span class="inlinecode">:</span> <span class="inlinecode">?<span class="id" title="var">P</span></span> <span class="inlinecode">|-<span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Hb<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.*)</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Hb5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;is_internal_self_implies_not_is_external&nbsp;in&nbsp;Hb1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contradiction&nbsp;Hb1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;is_external_self,&nbsp;is_external.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;is_external_self,&nbsp;is_external&nbsp;in&nbsp;H1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;α0;&nbsp;split;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">exists</span></span> <span class="inlinecode"><span class="id" title="var">o</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;mapp,&nbsp;configMapStack,&nbsp;configMapHeap,&nbsp;mapp,&nbsp;snd,&nbsp;fst,&nbsp;stackMap;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;update,&nbsp;t_update;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq_auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;Qed.<br/>
<br/>
&nbsp;&nbsp;Lemma&nbsp;take_pre_post&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;M&nbsp;σ1&nbsp;σ2,&nbsp;MyModule1&nbsp;⦂&nbsp;M&nbsp;⦿&nbsp;σ1&nbsp;⤳&nbsp;σ2&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;χ&nbsp;ϕ&nbsp;ψ&nbsp;s1&nbsp;s2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1&nbsp;=&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contn&nbsp;ϕ&nbsp;=&nbsp;c_stmt&nbsp;(s1&nbsp;;;&nbsp;s2)&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;x&nbsp;α&nbsp;β&nbsp;o,&nbsp;method_is_called&nbsp;σ1&nbsp;x&nbsp;α&nbsp;take&nbsp;β&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapp&nbsp;σ1&nbsp;α&nbsp;=&nbsp;Some&nbsp;o&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cname&nbsp;o&nbsp;=&nbsp;Safe&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;t&nbsp;s,&nbsp;flds&nbsp;o&nbsp;treasure&nbsp;=&nbsp;Some&nbsp;t&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flds&nbsp;o&nbsp;secret&nbsp;=&nbsp;Some&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((β&nbsp;scr&nbsp;=&nbsp;Some&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2&nbsp;=&nbsp;(update&nbsp;α&nbsp;(new&nbsp;Safe&nbsp;(update&nbsp;treasure&nbsp;v_null&nbsp;(flds&nbsp;o)))&nbsp;χ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(frm&nbsp;(update&nbsp;x&nbsp;t&nbsp;(vMap&nbsp;ϕ))&nbsp;(c_stmt&nbsp;s2))&nbsp;::&nbsp;ψ))&nbsp;\/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((exists&nbsp;s',&nbsp;β&nbsp;scr&nbsp;=&nbsp;Some&nbsp;s'&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s'&nbsp;&lt;&gt;&nbsp;s&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2&nbsp;=&nbsp;(χ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frm&nbsp;(update&nbsp;x&nbsp;v_null&nbsp;(vMap&nbsp;ϕ))&nbsp;(c_stmt&nbsp;s2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;ψ)))).<br/>
&nbsp;&nbsp;Proof.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;take_pre_post_alt;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;pair_reduction_alt_equiv_2;&nbsp;eauto.<br/>
&nbsp;&nbsp;Qed.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;Definition&nbsp;HolisticSpec&nbsp;:=&nbsp;(∀x∙&nbsp;(∀x∙(((a_class&nbsp;(a♢1)&nbsp;Safe)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((ex_acc_f&nbsp;(e♢1)&nbsp;secret)&nbsp;⩶&nbsp;(e♢0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((ex_acc_f&nbsp;(e♢1)&nbsp;treasure)&nbsp;⩶̸&nbsp;(ex_null))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(a_will&nbsp;((ex_acc_f&nbsp;(e♢1)&nbsp;treasure)&nbsp;⩶&nbsp;(ex_null))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⟶<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(a_will&nbsp;(∃x∙&nbsp;(((a♢0)&nbsp;external)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((a♢0)&nbsp;access&nbsp;(a♢1))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∨<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(∃x∙&nbsp;(((a♢0)&nbsp;external)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((a♢0)&nbsp;access&nbsp;(a♢1))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)))).<br/>
<br/>
&nbsp;&nbsp;Theorem&nbsp;safe_example&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;MyModule1&nbsp;⊨m&nbsp;HolisticSpec.<br/>
&nbsp;&nbsp;Proof.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;mdl_sat;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct_exists_loo.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;HolisticSpec;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a_intros.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;a_prop.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;σ&nbsp;:=&nbsp;fresh&nbsp;"σ"&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(pair_reduction_change&nbsp;MyModule1&nbsp;M'&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;nil)&nbsp;σ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(P&nbsp;:=&nbsp;fun&nbsp;(M1&nbsp;M2&nbsp;:&nbsp;mdl)(σ&nbsp;:&nbsp;config)&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M1&nbsp;⦂&nbsp;M2&nbsp;◎&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;nil)&nbsp;…&nbsp;σ&nbsp;⊨&nbsp;(ex_acc_f&nbsp;(e_&nbsp;α)&nbsp;treasure&nbsp;⩶̸&nbsp;(ex_null)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;<span class="inlinecode">σ</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;eapply&nbsp;sat_head_exp;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;sat_initial_exp;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;intros&nbsp;Hcontra.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H15;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hcontra;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;link_unique_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">is_exp</span></span> <span class="inlinecode">?<span class="id" title="var">e</span></span> <span class="inlinecode">?<span class="id" title="var">e'</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;H<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H20;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H18;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval_rewrite.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crush.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Ha;&nbsp;subst.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;let&nbsp;x&nbsp;:=&nbsp;fresh&nbsp;"x"&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(pair_reduction_take_is_called&nbsp;M'&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;nil)&nbsp;σ1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(χ0:=χ)(ϕ0:=ϕ)(ψ:=@nil&nbsp;frame)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Ha;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;v&nbsp;:=&nbsp;fresh&nbsp;"v"&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(take_pre_post&nbsp;M'&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;nil)&nbsp;σ1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(χ0:=χ)(ϕ0:=ϕ)(ψ:=@nil&nbsp;frame)(x:=x0)(α:=α1)(β:=β0&nbsp;∘&nbsp;vMap&nbsp;ϕ)(o:=o1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(s1:=s_meth&nbsp;x0&nbsp;y0&nbsp;take&nbsp;β0)(s2:=s)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">v</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H7;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"><span class="id" title="var">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">is_exp</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">|-</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;H<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(α1&nbsp;=&nbsp;α);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">admit</span>|<span class="id" title="tactic">subst</span></span>.&nbsp;<span class="comment">(*&nbsp;because&nbsp;α&nbsp;is&nbsp;the&nbsp;one&nbsp;that&nbsp;changes&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(o1&nbsp;=&nbsp;o);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">map_rewrite</span>;</span> <span class="inlinecode"><span class="id" title="var">crush</span>|<span class="id" title="tactic">subst</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H19;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H14;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H16;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H12;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(o1&nbsp;=&nbsp;o);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="var">map_rewrite</span>;</span> <span class="inlinecode"><span class="id" title="var">crush</span>|<span class="id" title="tactic">subst</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(v0&nbsp;=&nbsp;(v_addr&nbsp;α0));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">crush</span>|<span class="id" title="tactic">subst</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Hb2;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**&nbsp;assert&nbsp;(is_external_self&nbsp;MyModule1&nbsp;M'&nbsp;(χ,&nbsp;ϕ&nbsp;::&nbsp;ψ));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">apply</span></span> <span class="inlinecode"><span class="id" title="var">pair_reductions_is_external_2</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode">(σ1:=σ0);</span> <span class="inlinecode"><span class="id" title="tactic">auto</span>|</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;is_external_self,&nbsp;is_external&nbsp;in&nbsp;H8;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;destruct_exists_loo;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;link_unique_auto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;sat_ex_x&nbsp;with&nbsp;(α:=α)(o:=o1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a_prop.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;sat_extrn;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;bind&nbsp;in&nbsp;Ha6;&nbsp;simpl&nbsp;in&nbsp;Ha6.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;x&nbsp;:=&nbsp;fresh&nbsp;"x"&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(partial_map_dec&nbsp;scr&nbsp;β0)&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">x</span>|<span class="id" title="var">Hnone</span></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">destruct_exists_loo</span>|<span class="id" title="tactic">rewrite</span></span> <span class="inlinecode"><span class="id" title="var">Hnone</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">Ha6</span>;</span> <span class="inlinecode"><span class="id" title="tactic">inversion</span></span> <span class="inlinecode"><span class="id" title="var">Ha6</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;sat_access3&nbsp;with&nbsp;(x:=x1);&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;int_x;&nbsp;simpl;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;int_x;&nbsp;simpl;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;H8&nbsp;in&nbsp;Ha6;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;in_stmts_1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;in_meth_3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;scr;&nbsp;auto.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**&nbsp;admit.&nbsp;<span class="comment">(*&nbsp;contradiction:&nbsp;nothing&nbsp;changes,&nbsp;i.e.&nbsp;treasure&nbsp;&lt;&gt;&nbsp;null&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;admit.&nbsp;<span class="comment">(*&nbsp;above&nbsp;but&nbsp;again&nbsp;*)</span><br/>
&nbsp;&nbsp;Admitted.<br/>
<br/>
End&nbsp;SafeExample.<br/>
*)</span><br/>

<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
