
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module rename_equality</title>
<meta name="description" content="Documentation of Coq module rename_equality" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module rename_equality</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">common</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">loo_def</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">function_operations</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">chainmail</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">fundamental_properties</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">CpdtTactics</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coq.Logic.FunctionalExtensionality</span>.<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">exp_equiv</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span> -&gt; <span class="id">exp</span> -&gt; <span class="id">exp</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">eq_val</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">v</span>, <span class="id">exp_equiv</span> <span class="id">f</span> (<span class="id">e_val</span> <span class="id">v</span>) (<span class="id">e_val</span> <span class="id">v</span>)<br/>
| <span class="id">eq_var</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">x2</span>, <span class="id">f</span> <span class="id">x1</span> = <span class="id">Some</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exp_equiv</span> <span class="id">f</span> (<span class="id">e_var</span> <span class="id">x1</span>) (<span class="id">e_var</span> <span class="id">x2</span>)<br/>
| <span class="id">eq_hole</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">n</span>, <span class="id">exp_equiv</span> <span class="id">f</span> (<span class="id">e_hole</span> <span class="id">n</span>) (<span class="id">e_hole</span> <span class="id">n</span>)<br/>
| <span class="id">eq_eq</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">e1</span>' <span class="id">e2</span>', <span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">e1</span>' <span class="id">e2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exp_equiv</span> <span class="id">f</span> (<span class="id">e_eq</span> <span class="id">e1</span> <span class="id">e1</span>') (<span class="id">e_eq</span> <span class="id">e2</span> <span class="id">e2</span>')<br/>
| <span class="id">eq_if</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">ea1</span> <span class="id">eb1</span> <span class="id">ec1</span> <span class="id">ea2</span> <span class="id">eb2</span> <span class="id">ec2</span>, <span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">ea1</span> <span class="id">ea2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">eb1</span> <span class="id">eb2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">ec1</span> <span class="id">ec2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exp_equiv</span> <span class="id">f</span> (<span class="id">e_if</span> <span class="id">ea1</span> <span class="id">eb1</span> <span class="id">ec1</span>) (<span class="id">e_if</span> <span class="id">ea2</span> <span class="id">eb2</span> <span class="id">ec2</span>)<br/>
| <span class="id">eq_acc_f</span> : <span class="kwd">forall</span> <span class="id">fn</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">f</span>, <span class="id">exp_equiv</span> <span class="id">fn</span> <span class="id">e1</span> <span class="id">e2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exp_equiv</span> <span class="id">fn</span> (<span class="id">e_acc_f</span> <span class="id">e1</span> <span class="id">f</span>) (<span class="id">e_acc_f</span> <span class="id">e2</span> <span class="id">f</span>)<br/>
| <span class="id">eq_acc_g</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">e1</span>' <span class="id">e2</span>' <span class="id">g</span>, <span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">e1</span>' <span class="id">e2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exp_equiv</span> <span class="id">f</span> (<span class="id">e_acc_g</span> <span class="id">e1</span> <span class="id">g</span> <span class="id">e1</span>') (<span class="id">e_acc_g</span> <span class="id">e2</span> <span class="id">g</span> <span class="id">e2</span>').<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">ref_equiv</span> : (<span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span>) -&gt; <span class="id">ref</span> -&gt; <span class="id">ref</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">eqr_var</span> : <span class="kwd">forall</span> <span class="id">fn</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">fn</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ref_equiv</span> <span class="id">fn</span> (<span class="id">r_var</span> <span class="id">x</span>) (<span class="id">r_var</span> <span class="id">y</span>)<br/>
| <span class="id">eqr_fld</span> : <span class="kwd">forall</span> <span class="id">fn</span> <span class="id">x</span> <span class="id">y</span> <span class="id">f</span>, <span class="id">fn</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ref_equiv</span> <span class="id">fn</span> (<span class="id">r_fld</span> <span class="id">x</span> <span class="id">f</span>) (<span class="id">r_fld</span> <span class="id">y</span> <span class="id">f</span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">stmt_equiv</span> : (<span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span>) -&gt; <span class="id">stmt</span> -&gt; <span class="id">stmt</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">eq_asgn</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">y1</span> <span class="id">x2</span> <span class="id">y2</span>, <span class="id">ref_equiv</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ref_equiv</span> <span class="id">f</span> <span class="id">y1</span> <span class="id">y2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stmt_equiv</span> <span class="id">f</span> (<span class="id">s_asgn</span> <span class="id">x1</span> <span class="id">y1</span>) (<span class="id">s_asgn</span> <span class="id">x2</span> <span class="id">y2</span>)<br/>
| <span class="id">eq_meth</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">x2</span> <span class="id">y1</span> <span class="id">y2</span> <span class="id">m</span> <span class="id">ps1</span> <span class="id">ps2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> <span class="id">x1</span> = <span class="id">Some</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> <span class="id">y1</span> = <span class="id">Some</span> <span class="id">y2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">p</span> <span class="id">x</span>, <span class="id">ps1</span> <span class="id">p</span> = <span class="id">Some</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">y</span>, <span class="id">f</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">y</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ps2</span> = <span class="id">ps1</span> ∘ <span class="id">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stmt_equiv</span> <span class="id">f</span> (<span class="id">s_meth</span> <span class="id">x1</span> <span class="id">y1</span> <span class="id">m</span> <span class="id">ps1</span>) (<span class="id">s_meth</span> <span class="id">x2</span> <span class="id">y2</span> <span class="id">m</span> <span class="id">ps2</span>)<br/>
| <span class="id">eq_new</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">x2</span> <span class="id">C</span> <span class="id">ps1</span> <span class="id">ps2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> <span class="id">x1</span> = <span class="id">Some</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">p</span> <span class="id">x</span>, <span class="id">ps1</span> <span class="id">p</span> = <span class="id">Some</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">y</span>, <span class="id">f</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">y</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ps2</span> = <span class="id">ps1</span> ∘ <span class="id">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stmt_equiv</span> <span class="id">f</span> (<span class="id">s_new</span> <span class="id">x1</span> <span class="id">C</span> <span class="id">ps1</span>) (<span class="id">s_new</span> <span class="id">x2</span> <span class="id">C</span> <span class="id">ps2</span>)<br/>
| <span class="id">eq_stmts</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">s1</span>' <span class="id">s2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stmt_equiv</span> <span class="id">f</span> <span class="id">s1</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stmt_equiv</span> <span class="id">f</span> <span class="id">s1</span>' <span class="id">s2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stmt_equiv</span> <span class="id">f</span> (<span class="id">s_stmts</span> <span class="id">s1</span> <span class="id">s1</span>') (<span class="id">s_stmts</span> <span class="id">s2</span> <span class="id">s2</span>')<br/>
| <span class="id">eq_rtrn</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">x2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> <span class="id">x1</span> = <span class="id">Some</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stmt_equiv</span> <span class="id">f</span> (<span class="id">s_rtrn</span> <span class="id">x1</span>) (<span class="id">s_rtrn</span> <span class="id">x2</span>).<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">contn_equiv</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span> -&gt; <span class="id">continuation</span> -&gt; <span class="id">continuation</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">eqc_hole</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">x2</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id">f</span> <span class="id">x1</span> = <span class="id">Some</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stmt_equiv</span> <span class="id">f</span> <span class="id">s1</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contn_equiv</span> <span class="id">f</span> (<span class="id">c_hole</span> <span class="id">x1</span> <span class="id">s1</span>) (<span class="id">c_hole</span> <span class="id">x2</span> <span class="id">s2</span>)<br/>
| <span class="id">eqc_stmt</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id">stmt_equiv</span> <span class="id">f</span> <span class="id">s1</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contn_equiv</span> <span class="id">f</span> (<span class="id">c_stmt</span> <span class="id">s1</span>) (<span class="id">c_stmt</span> <span class="id">s2</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">wf_rename</span> (<span class="id">f</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span>) :=<br/>
&nbsp;&nbsp;<span class="id">one_to_one</span> <span class="id">f</span> /\<br/>
&nbsp;&nbsp;<span class="id">f</span> <span class="id">this</span> = <span class="id">Some</span> <span class="id">this</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">map_equiv</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span> -&gt; <span class="id">partial_map</span> <span class="id">var</span> <span class="id">value</span> -&gt; <span class="id">partial_map</span> <span class="id">var</span> <span class="id">value</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">eq_map</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">m1</span> <span class="id">m2</span>, <span class="id">m1</span> = <span class="id">f</span> ∘ <span class="id">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> α, <span class="id">m1</span> <span class="id">x</span> = <span class="id">Some</span> α -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">y</span>, <span class="id">f</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">y</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> α, <span class="id">m2</span> <span class="id">x</span> = <span class="id">Some</span> α -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">y</span>, <span class="id">f</span> <span class="id">y</span> = <span class="id">Some</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_rename</span> <span class="id">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">map_equiv</span> <span class="id">f</span> <span class="id">m1</span> <span class="id">m2</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">wf_one_to_one</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>, <span class="id">wf_rename</span> <span class="id">f</span> -&gt; <span class="id">one_to_one</span> <span class="id">f</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof217')">Proof.</div>
<div class="proofscript" id="proof217">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">unfold</span> <span class="id">wf_rename</span> <span class="kwd">in</span> *; <span class="id">andDestruct</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">wf_one_to_one</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">wf_id</span> :<br/>
&nbsp;&nbsp;<span class="id">wf_rename</span> <span class="id">Some</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof218')">Proof.</div>
<div class="proofscript" id="proof218">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">wf_rename</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">one_to_one</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">id</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">wf_id</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">frame_equiv</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span> -&gt; <span class="id">frame</span> -&gt; <span class="id">frame</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">eq_frm</span> : <span class="kwd">forall</span> <span class="id">f</span> ϕ1 ϕ2, <span class="id">contn_equiv</span> <span class="id">f</span> (<span class="id">contn</span> ϕ1) (<span class="id">contn</span> ϕ2) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">map_equiv</span> <span class="id">f</span> (<span class="id">vMap</span> ϕ1) (<span class="id">vMap</span> ϕ2) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_rename</span> <span class="id">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">frame_equiv</span> <span class="id">f</span> ϕ1 ϕ2.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">stack_equiv</span> : <span class="id">stack</span> -&gt; <span class="id">stack</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">eq_nil</span> : <span class="id">stack_equiv</span> <span class="id">nil</span> <span class="id">nil</span><br/>
| <span class="id">eq_cons</span> : <span class="kwd">forall</span> <span class="id">f</span> ϕ1 ϕ2 ψ1 ψ2, <span class="id">frame_equiv</span> <span class="id">f</span> ϕ1 ϕ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stack_equiv</span> ψ1 ψ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stack_equiv</span> (ϕ1::ψ1) (ϕ2::ψ2).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">config_equiv</span> : <span class="id">config</span> -&gt; <span class="id">config</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">eq_conf</span> : <span class="kwd">forall</span> χ ψ1 ψ2, <span class="id">stack_equiv</span> ψ1 ψ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">config_equiv</span> (χ, ψ1) (χ, ψ2).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">exp_equiv</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">ref_equiv</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">stmt_equiv</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">contn_equiv</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">map_equiv</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">frame_equiv</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">stack_equiv</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">config_equiv</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">equiv_unfold</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">exp_equiv</span> ?<span class="id">f</span> (<span class="id">e_val</span> <span class="id">_</span>) ?<span class="id">e2</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">exp_equiv</span> ?<span class="id">f</span> (<span class="id">e_var</span> <span class="id">_</span>) ?<span class="id">e2</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">exp_equiv</span> ?<span class="id">f</span> (<span class="id">e_hole</span> <span class="id">_</span>) ?<span class="id">e2</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">exp_equiv</span> ?<span class="id">f</span> (<span class="id">e_eq</span> <span class="id">_</span> <span class="id">_</span>) ?<span class="id">e2</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">exp_equiv</span> ?<span class="id">f</span> (<span class="id">e_if</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) ?<span class="id">e2</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">exp_equiv</span> ?<span class="id">f</span> (<span class="id">e_acc_f</span> <span class="id">_</span> <span class="id">_</span>) ?<span class="id">e2</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">exp_equiv</span> ?<span class="id">f</span> (<span class="id">e_acc_g</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) ?<span class="id">e2</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
<br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">ref_equiv</span> ?<span class="id">f</span> ?<span class="id">r1</span> ?<span class="id">r2</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
<br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">stmt_equiv</span> ?<span class="id">f</span> (<span class="id">s_asgn</span> <span class="id">_</span> <span class="id">_</span>) ?<span class="id">s</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">stmt_equiv</span> ?<span class="id">f</span> (<span class="id">s_meth</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) ?<span class="id">s</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">stmt_equiv</span> ?<span class="id">f</span> (<span class="id">s_new</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) ?<span class="id">s</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">stmt_equiv</span> ?<span class="id">f</span> (<span class="id">s_stmts</span> <span class="id">_</span> <span class="id">_</span>) ?<span class="id">s</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">stmt_equiv</span> ?<span class="id">f</span> (<span class="id">s_rtrn</span> <span class="id">_</span>) ?<span class="id">s</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
<br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn_equiv</span> ?<span class="id">f</span> (<span class="id">c_hole</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn_equiv</span> ?<span class="id">f</span> (<span class="id">c_stmt</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">frame_equiv</span> ?<span class="id">f</span> ?ϕ1 ?ϕ2 |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notHyp</span> (<span class="id">contn_equiv</span> <span class="id">f</span> (<span class="id">contn</span> ϕ1) (<span class="id">contn</span> ϕ2));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notHyp</span> (<span class="id">map_equiv</span> <span class="id">f</span> (<span class="id">vMap</span> ϕ1) (<span class="id">vMap</span> ϕ2));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notHyp</span> (<span class="id">wf_rename</span> <span class="id">f</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
<br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">stack_equiv</span> (<span class="id">_</span> :: <span class="id">_</span>) ?ψ2 |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">stack_equiv</span> <span class="id">nil</span> ?ψ2 |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">config_equiv</span> ?σ1 ?σ2 |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
<br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">map_equiv</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">equiv_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [|- <span class="id">config_equiv</span> (?χ, ?ψ1) (?χ, ?ψ2)] =&gt; <span class="tactic">apply</span> <span class="id">eq_conf</span><br/>
&nbsp;&nbsp;| [|- <span class="id">stack_equiv</span> <span class="id">nil</span> <span class="id">nil</span>] =&gt; <span class="tactic">apply</span> <span class="id">eq_nil</span><br/>
&nbsp;&nbsp;| [|- <span class="id">stack_equiv</span> (?ϕ1 :: ?ψ1) (?ϕ2 :: ?ψ2)] =&gt; <span class="tactic">apply</span> <span class="id">eq_cons</span><br/>
&nbsp;&nbsp;| [|- <span class="id">frame_equiv</span> <span class="id">_</span> ?ϕ1 ?ϕ2] =&gt; <span class="tactic">apply</span> <span class="id">eq_frm</span><br/>
<br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> ?ϕ = <span class="id">_</span> |- <span class="id">contn_equiv</span> <span class="id">_</span> (<span class="id">contn</span> ?ϕ) <span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> ?ϕ = <span class="id">_</span> |- <span class="id">contn_equiv</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">contn</span> ?ϕ)] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">_</span> = <span class="id">contn</span> ?ϕ |- <span class="id">contn_equiv</span> <span class="id">_</span> (<span class="id">contn</span> ?ϕ) <span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">_</span> = <span class="id">contn</span> ?ϕ |- <span class="id">contn_equiv</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">contn</span> ?ϕ)] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span><br/>
&nbsp;&nbsp;| [|- <span class="id">contn_equiv</span> <span class="id">_</span> (<span class="id">c_stmt</span> <span class="id">_</span>) (<span class="id">c_stmt</span> <span class="id">_</span>)] =&gt; <span class="tactic">apply</span> <span class="id">eqc_stmt</span><br/>
&nbsp;&nbsp;| [|- <span class="id">contn_equiv</span> <span class="id">_</span> (<span class="id">c_hole</span> <span class="id">_</span> <span class="id">_</span>) (<span class="id">c_hole</span> <span class="id">_</span> <span class="id">_</span>)] =&gt; <span class="tactic">apply</span> <span class="id">eqc_hole</span><br/>
<br/>
&nbsp;&nbsp;| [|- <span class="id">stmt_equiv</span> <span class="id">_</span> (<span class="id">s_asgn</span> <span class="id">_</span> <span class="id">_</span>) (<span class="id">s_asgn</span> <span class="id">_</span> <span class="id">_</span>)] =&gt; <span class="tactic">apply</span> <span class="id">eq_asgn</span><br/>
&nbsp;&nbsp;| [<span class="id">Hdom</span> : <span class="id">dom</span> ?<span class="id">ps</span> ?<span class="id">D</span> |- <span class="id">stmt_equiv</span> <span class="id">_</span> (<span class="id">s_meth</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> ?<span class="id">ps</span>) (<span class="id">s_meth</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>)] =&gt; <span class="tactic">apply</span> <span class="id">eq_meth</span> <span class="kwd">with</span> (<span class="id">D</span>:=<span class="id">D</span>)<br/>
&nbsp;&nbsp;| [<span class="id">Hdom</span> : <span class="id">dom</span> ?<span class="id">ps</span> ?<span class="id">D</span> |- <span class="id">stmt_equiv</span> <span class="id">_</span> (<span class="id">s_meth</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) (<span class="id">s_meth</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> ?<span class="id">ps</span>)] =&gt; <span class="tactic">apply</span> <span class="id">eq_meth</span> <span class="kwd">with</span> (<span class="id">D</span>:=<span class="id">D</span>)<br/>
&nbsp;&nbsp;| [|- <span class="id">stmt_equiv</span> <span class="id">_</span> (<span class="id">s_new</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) (<span class="id">s_new</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>)] =&gt; <span class="tactic">apply</span> <span class="id">eq_new</span><br/>
&nbsp;&nbsp;| [|- <span class="id">stmt_equiv</span> <span class="id">_</span> (<span class="id">s_meth</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) (<span class="id">s_meth</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>)] =&gt; <span class="tactic">apply</span> <span class="id">eq_meth</span><br/>
&nbsp;&nbsp;| [|- <span class="id">stmt_equiv</span> <span class="id">_</span> (<span class="id">s_stmts</span> <span class="id">_</span> <span class="id">_</span>) (<span class="id">s_stmts</span> <span class="id">_</span> <span class="id">_</span>)] =&gt; <span class="tactic">apply</span> <span class="id">eq_stmts</span><br/>
&nbsp;&nbsp;| [|- <span class="id">stmt_equiv</span> <span class="id">_</span> (<span class="id">s_rtrn</span> <span class="id">_</span>) (<span class="id">s_rtrn</span> <span class="id">_</span>)] =&gt; <span class="tactic">apply</span> <span class="id">eq_rtrn</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">id_equiv_reflexive_ref</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span>, <span class="id">ref_equiv</span> <span class="id">Some</span> <span class="id">r</span> <span class="id">r</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof219')">Proof.</div>
<div class="proofscript" id="proof219">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">r</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">r</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">id_equiv_reflexive_ref</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">bind_right_id</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> : <span class="kwd">Type</span>)(<span class="id">m</span> : <span class="id">A</span> -&gt; (<span class="id">option</span> <span class="id">var</span>)) , <span class="id">m</span> ∘ <span class="id">Some</span> = <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof220')">Proof.</div>
<div class="proofscript" id="proof220">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">functional_extensionality</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bind</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [|- <span class="id">_</span> = ?<span class="id">m</span> ?<span class="id">a</span>] =&gt; <span class="tactic">destruct</span> (<span class="id">m</span> <span class="id">a</span>); <span class="tactic">auto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> (<span class="id">bind_right_id</span> <span class="id">var</span>).<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> (<span class="id">bind_right_id</span> <span class="id">fld</span>).<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">bind_right_id</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">bind_left_id</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> : <span class="kwd">Type</span>)(<span class="id">m</span> : <span class="id">var</span> -&gt; (<span class="id">option</span> <span class="id">A</span>)) , <span class="id">Some</span> ∘ <span class="id">m</span> = <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof221')">Proof.</div>
<div class="proofscript" id="proof221">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">functional_extensionality</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bind</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">bind_left_id</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">bind_left_id</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">id_equiv_reflexive_stmt</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, <span class="id">stmt_equiv</span> <span class="id">Some</span> <span class="id">s</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof222')">Proof.</div>
<div class="proofscript" id="proof222">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">eq_meth</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">eq_new</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">id_equiv_reflexive_stmt</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">id_equiv_reflexive_contn</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span>, <span class="id">contn_equiv</span> <span class="id">Some</span> <span class="id">c</span> <span class="id">c</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof223')">Proof.</div>
<div class="proofscript" id="proof223">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">c</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">id_equiv_reflexive_contn</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">id_equiv_reflexive_map</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>, <span class="id">map_equiv</span> <span class="id">Some</span> <span class="id">m</span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof224')">Proof.</div>
<div class="proofscript" id="proof224">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">id_equiv_reflexive_map</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">id_equiv_reflexive_frame</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> ϕ, <span class="id">frame_equiv</span> <span class="id">Some</span> ϕ ϕ.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof225')">Proof.</div>
<div class="proofscript" id="proof225">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">id_equiv_reflexive_frame</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">equiv_reflexive_stack</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> ψ, <span class="id">stack_equiv</span> ψ ψ.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof226')">Proof.</div>
<div class="proofscript" id="proof226">
&nbsp;&nbsp;<span class="tactic">intros</span> ψ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> ψ <span class="kwd">as</span> [|ϕ ψ'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">equiv_reflexive_stack</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">equiv_reflexive_config</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, <span class="id">config_equiv</span> σ σ.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof227')">Proof.</div>
<div class="proofscript" id="proof227">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> σ; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">equiv_reflexive_config</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">notin_unfold</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">notin_exp</span> (<span class="id">e_acc_f</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">notin_exp</span> (<span class="id">e_acc_g</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">notin_exp</span> (<span class="id">e_if</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">notin_exp</span> (<span class="id">e_eq</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">notin_self_contra</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">notin_exp</span> (<span class="id">e_var</span> <span class="id">x</span>) <span class="id">x</span> -&gt; <span class="id">False</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof228')">Proof.</div>
<div class="proofscript" id="proof228">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">notin_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">notin_exp</span> (<span class="id">e_var</span> ?<span class="id">x</span>) ?<span class="id">x</span> |- <span class="id">_</span>] =&gt; <span class="tactic">apply</span> <span class="id">notin_self_contra</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">crush</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">effective_equivalent_evaluation</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> σ <span class="id">e</span> <span class="id">v</span>, <span class="id">M</span> ∙ σ ⊢ <span class="id">e</span> ↪ <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> χ ϕ ψ, σ = (χ, ϕ :: ψ)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ', (<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">mapp</span> σ <span class="id">x</span> = <span class="id">mapp</span> σ' <span class="id">x</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_exp</span> <span class="id">e</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> χ ϕ ψ, σ' = (χ, ϕ :: ψ)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fst</span> σ = <span class="id">fst</span> σ' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ' ⊢ <span class="id">e</span> ↪ <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof229')">Proof.</div>
<div class="proofscript" id="proof229">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> σ <span class="id">e</span> <span class="id">v</span> <span class="id">Heval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Heval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">mapp</span> ?σ ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmap</span> : <span class="kwd">forall</span> <span class="id">y</span>, (<span class="id">mapp</span> ?σ <span class="id">y</span> = <span class="id">mapp</span> ?σ' <span class="id">y</span> \/ <span class="id">notin_exp</span> ?<span class="id">e</span> <span class="id">y</span>) |- <span class="id">_</span> ∙ ?σ' ⊢ ?<span class="id">e</span> ↪ <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Hmap</span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Ha</span> : <span class="id">mapp</span> ?σ<span class="id">a</span> ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hb</span> : <span class="id">mapp</span> ?σ<span class="id">a</span> ?<span class="id">x</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> ?<span class="id">x</span>  |- <span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">Hb</span> <span class="kwd">in</span> <span class="id">Ha</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id">notin_auto</span>].<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">v_f_heap</span> <span class="kwd">with</span> (α:=α)(<span class="id">o</span>:=<span class="id">o</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHeval</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmapp</span> : <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">mapp</span> ?σ<span class="id">a</span> <span class="id">y</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> <span class="id">y</span> \/ <span class="id">notin_exp</span> (<span class="id">e_acc_f</span> ?<span class="id">e</span> ?<span class="id">f</span>) <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">mapp</span> ?σ<span class="id">a</span> ?<span class="id">x</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> ?<span class="id">x</span> \/ <span class="id">notin_exp</span> ?<span class="id">e</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Hmapp</span> <span class="id">x</span>); <span class="tactic">repeat</span> <span class="id">notin_unfold</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> σ <span class="kwd">as</span> [χ' ψ1];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> σ' <span class="kwd">as</span> [χ ψ2];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">v_f_ghost</span> <span class="kwd">with</span> (α:=α)(<span class="id">o</span>:=<span class="id">o</span>)(<span class="id">x</span>:=<span class="id">x</span>)(<span class="id">e</span>':=<span class="id">e</span>')(<span class="id">v</span>:=<span class="id">v</span>)(<span class="id">C</span>:=<span class="id">C</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHHeval1</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmapp</span> : <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">mapp</span> ?σ<span class="id">a</span> <span class="id">y</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> <span class="id">y</span> \/ <span class="id">notin_exp</span> (<span class="id">e_acc_g</span> ?<span class="id">e</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">mapp</span> ?σ<span class="id">a</span> ?<span class="id">x</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> ?<span class="id">x</span> \/ <span class="id">notin_exp</span> ?<span class="id">e</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Hmapp</span> <span class="id">x</span>); <span class="tactic">repeat</span> <span class="id">notin_unfold</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> σ <span class="kwd">as</span> [χ' ψ1];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> σ' <span class="kwd">as</span> [χ ψ2];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHHeval2</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmapp</span> : <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">mapp</span> ?σ<span class="id">a</span> <span class="id">y</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> <span class="id">y</span> \/ <span class="id">notin_exp</span> (<span class="id">e_acc_g</span> <span class="id">_</span> <span class="id">_</span> ?<span class="id">e</span>) <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">mapp</span> ?σ<span class="id">a</span> ?<span class="id">x</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> ?<span class="id">x</span> \/ <span class="id">notin_exp</span> ?<span class="id">e</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Hmapp</span> <span class="id">x</span>); <span class="tactic">repeat</span> <span class="id">notin_unfold</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHHeval3</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> σ <span class="kwd">as</span> [χ' ψ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> σ' <span class="kwd">as</span> [χ ψ'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">destruct_exists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">x0</span> <span class="id">this</span>) <span class="kwd">as</span> [<span class="id">Heq1</span>|<span class="id">Hneq1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> σ <span class="kwd">as</span> [χ' ψ1];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> σ' <span class="kwd">as</span> [χ ψ2];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">map_update_</span>σ; <span class="tactic">auto</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">destruct_exists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">x0</span> <span class="id">x</span>) <span class="kwd">as</span> [<span class="id">Heq2</span>|<span class="id">Hneq2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> σ <span class="kwd">as</span> [χ' ψ1];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> σ' <span class="kwd">as</span> [χ ψ2];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ψ0 : <span class="id">stack</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ0 : <span class="id">heap</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hex</span> : <span class="id">exists</span> χ' ϕ' ψ', (?χ0, ?ψ0) = (χ', ϕ'::ψ') |-<span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> ϕ := <span class="tactic">fresh</span> "ϕ" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> ψ := <span class="tactic">fresh</span> "ψ" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> χ := <span class="tactic">fresh</span> "χ" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Htmp</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hex</span> <span class="kwd">as</span> [χ <span class="id">Htmp</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htmp</span> <span class="kwd">as</span> [ϕ <span class="id">Htmp</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htmp</span> <span class="kwd">as</span> [ψ <span class="id">Htmp</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htmp</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Htmp</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">update_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqb_refl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">HMwf</span> : <span class="id">M_wf</span> ?<span class="id">M</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">HMwf</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">HCwf</span> : <span class="kwd">forall</span> <span class="id">C0</span> <span class="id">CDef0</span>, ?<span class="id">M</span> <span class="id">C0</span> = <span class="id">Some</span> <span class="id">CDef0</span> -&gt; <span class="id">cls_wf</span> <span class="id">CDef0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">HCDef</span> : ?<span class="id">M</span> <span class="id">_</span> = <span class="id">Some</span> ?<span class="id">C</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hghost</span> : <span class="id">c_g_fields</span> ?<span class="id">C</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">HCwf</span> <span class="kwd">in</span> <span class="id">HCDef</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">HCwf</span> : <span class="id">cls_wf</span> ?<span class="id">C</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">HCwf</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hgwf</span> : <span class="id">gFields_wf</span> (<span class="id">c_g_fields</span> ?<span class="id">C</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">Hgwf</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hnotin</span> : <span class="kwd">forall</span> <span class="id">g</span> <span class="id">x</span>' <span class="id">e</span>', <span class="id">c_g_fields</span> ?<span class="id">C</span> <span class="id">g</span> = <span class="id">Some</span> (<span class="id">x</span>', <span class="id">e</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">y</span>, <span class="id">y</span> &lt;&gt; <span class="id">x</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">y</span> &lt;&gt; <span class="id">this</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_exp</span> <span class="id">e</span>' <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hghost</span> : <span class="id">c_g_fields</span> ?<span class="id">C</span> ?<span class="id">f</span> = <span class="id">Some</span> (?<span class="id">x</span>, ?<span class="id">e</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hneq1</span> : ?<span class="id">x0</span> &lt;&gt; ?<span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hneq2</span> : ?<span class="id">x0</span> &lt;&gt; <span class="id">this</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hnotin</span> <span class="kwd">with</span> (<span class="id">y</span>:=<span class="id">x0</span>) <span class="kwd">in</span> <span class="id">Hghost</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">repeat</span> <span class="id">destruct_exists</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">eexists</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">v_if_true</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHHeval1</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmapp</span> : <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">mapp</span> ?σ<span class="id">a</span> <span class="id">y</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> <span class="id">y</span> \/ <span class="id">notin_exp</span> (<span class="id">e_if</span> ?<span class="id">e1</span> ?<span class="id">e2</span> ?<span class="id">e3</span>) <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">mapp</span> ?σ<span class="id">a</span> ?<span class="id">x</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> ?<span class="id">x</span> \/ <span class="id">notin_exp</span> ?<span class="id">e1</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Hmapp</span> <span class="id">x</span>); <span class="tactic">repeat</span> <span class="id">notin_unfold</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHHeval2</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmapp</span> : <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">mapp</span> ?σ<span class="id">a</span> <span class="id">y</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> <span class="id">y</span> \/ <span class="id">notin_exp</span> (<span class="id">e_if</span> ?<span class="id">e1</span> ?<span class="id">e2</span> ?<span class="id">e3</span>) <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">mapp</span> ?σ<span class="id">a</span> ?<span class="id">x</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> ?<span class="id">x</span> \/ <span class="id">notin_exp</span> ?<span class="id">e2</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Hmapp</span> <span class="id">x</span>); <span class="tactic">repeat</span> <span class="id">notin_unfold</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">v_if_false</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHHeval1</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmapp</span> : <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">mapp</span> ?σ<span class="id">a</span> <span class="id">y</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> <span class="id">y</span> \/ <span class="id">notin_exp</span> (<span class="id">e_if</span> ?<span class="id">e1</span> ?<span class="id">e2</span> ?<span class="id">e3</span>) <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">mapp</span> ?σ<span class="id">a</span> ?<span class="id">x</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> ?<span class="id">x</span> \/ <span class="id">notin_exp</span> ?<span class="id">e1</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Hmapp</span> <span class="id">x</span>); <span class="tactic">repeat</span> <span class="id">notin_unfold</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHHeval2</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmapp</span> : <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">mapp</span> ?σ<span class="id">a</span> <span class="id">y</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> <span class="id">y</span> \/ <span class="id">notin_exp</span> (<span class="id">e_if</span> ?<span class="id">e1</span> ?<span class="id">e2</span> ?<span class="id">e3</span>) <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">mapp</span> ?σ<span class="id">a</span> ?<span class="id">x</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> ?<span class="id">x</span> \/ <span class="id">notin_exp</span> ?<span class="id">e3</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Hmapp</span> <span class="id">x</span>); <span class="tactic">repeat</span> <span class="id">notin_unfold</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">v_equals</span> <span class="kwd">with</span> (<span class="id">v</span>:=<span class="id">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHHeval1</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmapp</span> : <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">mapp</span> ?σ<span class="id">a</span> <span class="id">y</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> <span class="id">y</span> \/ <span class="id">notin_exp</span> (<span class="id">e_eq</span> ?<span class="id">e1</span> ?<span class="id">e2</span>) <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">mapp</span> ?σ<span class="id">a</span> ?<span class="id">x</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> ?<span class="id">x</span> \/ <span class="id">notin_exp</span> ?<span class="id">e1</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Hmapp</span> <span class="id">x</span>); <span class="tactic">repeat</span> <span class="id">notin_unfold</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHHeval2</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmapp</span> : <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">mapp</span> ?σ<span class="id">a</span> <span class="id">y</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> <span class="id">y</span> \/ <span class="id">notin_exp</span> (<span class="id">e_eq</span> ?<span class="id">e1</span> ?<span class="id">e2</span>) <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">mapp</span> ?σ<span class="id">a</span> ?<span class="id">x</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> ?<span class="id">x</span> \/ <span class="id">notin_exp</span> ?<span class="id">e2</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Hmapp</span> <span class="id">x</span>); <span class="tactic">repeat</span> <span class="id">notin_unfold</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">v_nequals</span> <span class="kwd">with</span> (<span class="id">v1</span>:=<span class="id">v1</span>)(<span class="id">v2</span>:=<span class="id">v2</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHHeval1</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmapp</span> : <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">mapp</span> ?σ<span class="id">a</span> <span class="id">y</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> <span class="id">y</span> \/ <span class="id">notin_exp</span> (<span class="id">e_eq</span> ?<span class="id">e1</span> ?<span class="id">e2</span>) <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">mapp</span> ?σ<span class="id">a</span> ?<span class="id">x</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> ?<span class="id">x</span> \/ <span class="id">notin_exp</span> ?<span class="id">e1</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Hmapp</span> <span class="id">x</span>); <span class="tactic">repeat</span> <span class="id">notin_unfold</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHHeval2</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmapp</span> : <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">mapp</span> ?σ<span class="id">a</span> <span class="id">y</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> <span class="id">y</span> \/ <span class="id">notin_exp</span> (<span class="id">e_eq</span> ?<span class="id">e1</span> ?<span class="id">e2</span>) <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">mapp</span> ?σ<span class="id">a</span> ?<span class="id">x</span> = <span class="id">mapp</span> ?σ<span class="id">b</span> ?<span class="id">x</span> \/ <span class="id">notin_exp</span> ?<span class="id">e2</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Hmapp</span> <span class="id">x</span>); <span class="tactic">repeat</span> <span class="id">notin_unfold</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_evaluation</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> σ <span class="id">e</span> <span class="id">v</span>, <span class="id">M</span> ∙ σ ⊢ <span class="id">e</span> ↪ <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> χ ϕ ψ, σ = (χ, ϕ :: ψ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> ϕ' ψ' <span class="id">e</span>', <span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">e</span> <span class="id">e</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">frame_equiv</span> <span class="id">f</span> ϕ ϕ' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ (χ, ϕ'::ψ') ⊢ <span class="id">e</span>' ↪ <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof230')">Proof.</div>
<div class="proofscript" id="proof230">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> σ <span class="id">e</span> <span class="id">v</span> <span class="id">Heval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Heval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">v_var</span>; <span class="tactic">repeat</span> <span class="id">map_rewrite</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hm1</span> : ?<span class="id">m1</span> ?<span class="id">x1</span> = <span class="id">Some</span> ?<span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hf</span> : ?<span class="id">f</span> ?<span class="id">x1</span> = <span class="id">Some</span> ?<span class="id">x2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmeq</span> : ?<span class="id">m1</span> = ?<span class="id">f</span> ∘ ?<span class="id">m2</span>|- ?<span class="id">m2</span> ?<span class="id">x2</span> = <span class="id">Some</span> ?<span class="id">v</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">equal_f</span> <span class="kwd">with</span> (<span class="id">x0</span>:=<span class="id">x1</span>) <span class="kwd">in</span> <span class="id">Hmeq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;figure&nbsp;out&nbsp;a&nbsp;better&nbsp;way&nbsp;to&nbsp;do&nbsp;this.&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x0&nbsp;is&nbsp;confusing&nbsp;and&nbsp;potentially&nbsp;fragile,&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;x&nbsp;is&nbsp;conflicting&nbsp;with&nbsp;the&nbsp;outer&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">y</span> |- <span class="id">context</span>[?<span class="id">m</span> ?<span class="id">y</span>]] =&gt;  <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">v_f_ghost</span> <span class="kwd">with</span> (α:=α)(<span class="id">o</span>:=<span class="id">o</span>)(<span class="id">x</span>:=<span class="id">x</span>)(<span class="id">e</span>':=<span class="id">e</span>')(<span class="id">v</span>:=<span class="id">v</span>)(<span class="id">C</span>:=<span class="id">C</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">effective_equivalent_evaluation</span> <span class="kwd">with</span> (σ:=<span class="id">update_</span>σ<span class="id">_map</span> (<span class="id">update_</span>σ<span class="id">_map</span> (χ, ϕ::ψ) <span class="id">x</span> <span class="id">v</span>) <span class="id">this</span> (<span class="id">v_addr</span> α));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">x0</span> <span class="id">this</span>) <span class="kwd">as</span> [<span class="id">Heq1</span>|<span class="id">Hneq1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">map_update_</span>σ; <span class="tactic">auto</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">destruct_exists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">x0</span> <span class="id">x</span>) <span class="kwd">as</span> [<span class="id">Heq2</span>|<span class="id">Hneq2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">update_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqb_refl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">HMwf</span> : <span class="id">M_wf</span> ?<span class="id">M</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">HMwf</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">HCwf</span> : <span class="kwd">forall</span> <span class="id">C0</span> <span class="id">CDef0</span>, ?<span class="id">M</span> <span class="id">C0</span> = <span class="id">Some</span> <span class="id">CDef0</span> -&gt; <span class="id">cls_wf</span> <span class="id">CDef0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">HCDef</span> : ?<span class="id">M</span> <span class="id">_</span> = <span class="id">Some</span> ?<span class="id">C</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hghost</span> : <span class="id">c_g_fields</span> ?<span class="id">C</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">HCwf</span> <span class="kwd">in</span> <span class="id">HCDef</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">HCwf</span> : <span class="id">cls_wf</span> ?<span class="id">C</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">HCwf</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hgwf</span> : <span class="id">gFields_wf</span> (<span class="id">c_g_fields</span> ?<span class="id">C</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">Hgwf</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hnotin</span> : <span class="kwd">forall</span> <span class="id">g</span> <span class="id">x</span>' <span class="id">e</span>', <span class="id">c_g_fields</span> ?<span class="id">C</span> <span class="id">g</span> = <span class="id">Some</span> (<span class="id">x</span>', <span class="id">e</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">y</span>, <span class="id">y</span> &lt;&gt; <span class="id">x</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">y</span> &lt;&gt; <span class="id">this</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_exp</span> <span class="id">e</span>' <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hghost</span> : <span class="id">c_g_fields</span> ?<span class="id">C</span> ?<span class="id">f</span> = <span class="id">Some</span> (?<span class="id">x</span>, ?<span class="id">e</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hneq1</span> : ?<span class="id">x0</span> &lt;&gt; ?<span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hneq2</span> : ?<span class="id">x0</span> &lt;&gt; <span class="id">this</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hnotin</span> <span class="kwd">with</span> (<span class="id">y</span>:=<span class="id">x0</span>) <span class="kwd">in</span> <span class="id">Hghost</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="id">eexists</span>.<br/>
<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">rename_wf_not_this</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>, <span class="id">wf_rename</span> <span class="id">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">f</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;&gt; <span class="id">this</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">y</span> &lt;&gt; <span class="id">this</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof231')">Proof.</div>
<div class="proofscript" id="proof231">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">f</span> <span class="id">Hwf</span> <span class="id">x</span> <span class="id">y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">wf_rename</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hcontra</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H1_1</span> : <span class="id">one_to_one</span> ?<span class="id">f</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Ha</span> : ?<span class="id">f</span> <span class="id">this</span> = <span class="id">Some</span> ?<span class="id">z</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hb</span> : ?<span class="id">f</span> ?<span class="id">y</span> = <span class="id">Some</span> ?<span class="id">z</span> |-<span class="id">_</span>] =&gt; <span class="tactic">eapply</span> <span class="id">H1_1</span> <span class="kwd">in</span> <span class="id">Hb</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_interpretation_x</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> χ ϕ ψ <span class="id">v</span>, ⌊ <span class="id">x</span> ⌋ (χ, ϕ::ψ) ≜ <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">x</span>' ϕ' ψ', <span class="id">f</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">x</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">frame_equiv</span> <span class="id">f</span> ϕ ϕ' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊ <span class="id">x</span>' ⌋ (χ, ϕ'::ψ') ≜ <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof232')">Proof.</div>
<div class="proofscript" id="proof232">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> χ ϕ ψ <span class="id">v</span> <span class="kwd">Hint</span> <span class="id">f</span> <span class="id">x</span>' ϕ' ψ';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="kwd">Hint</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">_</span> :: <span class="id">_</span> = <span class="id">_</span> :: <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [|- ⌊ <span class="id">_</span> ⌋ (<span class="id">_</span>, ?ϕ' :: ?ψ') ≜ <span class="id">_</span>] =&gt; <span class="tactic">apply</span> <span class="id">int_x</span> <span class="kwd">with</span> (ϕ:=ϕ')(ψ:=ψ'); <span class="tactic">auto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Hmap</span> : ?<span class="id">m1</span> = ?<span class="id">f</span> ∘ ?<span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hm1</span> : ?<span class="id">m1</span> ?<span class="id">x</span> = ?<span class="id">o</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hf</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">x</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- ?<span class="id">m2</span> ?<span class="id">x</span>' = ?<span class="id">o</span>] =&gt; <span class="tactic">apply</span> <span class="id">equal_f</span> <span class="kwd">with</span> (<span class="id">x0</span>:=<span class="id">x</span>) <span class="kwd">in</span> <span class="id">Hmap</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hf</span> <span class="kwd">in</span> <span class="id">Hmap</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hm1</span> <span class="kwd">in</span> <span class="id">Hmap</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_interpretation_equal</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> χ ϕ ψ <span class="id">v</span>, ⌊ <span class="id">x</span> ⌋ (χ, ϕ::ψ) ≜ <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">x</span>' ϕ' ψ' <span class="id">v</span>', <span class="id">f</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">x</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">frame_equiv</span> <span class="id">f</span> ϕ ϕ' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊ <span class="id">x</span>' ⌋ (χ, ϕ'::ψ') ≜ <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span>' = <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof233')">Proof.</div>
<div class="proofscript" id="proof233">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H1</span> : ⌊ ?<span class="id">x1</span> ⌋ ?σ1 ≜ ?<span class="id">v1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : ⌊ ?<span class="id">x2</span> ⌋ ?σ2 ≜ ?<span class="id">v2</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H1</span> : ?<span class="id">m1</span> ?<span class="id">x</span> = <span class="id">Some</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : ?<span class="id">m2</span> <span class="id">_</span> = <span class="id">Some</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmap</span> : ?<span class="id">m1</span> = <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hf</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">_</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hmap</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hf</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">crush</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">empty_is_empty</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} `{<span class="id">Eq</span> <span class="id">A</span>} (<span class="id">a</span> : <span class="id">A</span>)(<span class="id">b</span> : <span class="id">B</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">empty</span> <span class="id">a</span> &lt;&gt; <span class="id">Some</span> <span class="id">b</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof234')">Proof.</div>
<div class="proofscript" id="proof234">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">empty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">t_empty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">domain_transitive</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> : <span class="kwd">Type</span>} `{<span class="id">Eq</span> <span class="id">A</span>} (<span class="id">m1</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">B</span>) <span class="id">D</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dom</span> <span class="id">m1</span> <span class="id">D</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">m2</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">C</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dom</span> <span class="id">m2</span> <span class="id">D</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">D</span>', <span class="id">dom</span> <span class="id">m1</span> <span class="id">D</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dom</span> <span class="id">m2</span> <span class="id">D</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof235')">Proof.</div>
<div class="proofscript" id="proof235">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">dom</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : ?<span class="id">m2</span> ?<span class="id">a</span> = <span class="id">Some</span> ?<span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Ha</span> : <span class="kwd">forall</span> <span class="id">a</span>' <span class="id">b</span>', ?<span class="id">m2</span> <span class="id">a</span>' = <span class="id">Some</span> <span class="id">b</span>' -&gt; <span class="id">In</span> <span class="id">a</span>' ?<span class="id">D</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hb</span> : <span class="kwd">forall</span> <span class="id">a</span>'', <span class="id">In</span> <span class="id">a</span>'' ?<span class="id">D</span>' -&gt; <span class="id">exists</span> <span class="id">b</span>'', ?<span class="id">m1</span> <span class="id">a</span>'' = <span class="id">Some</span> <span class="id">b</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hc</span> : <span class="kwd">forall</span> <span class="id">a</span>''', <span class="id">In</span> <span class="id">a</span>''' ?<span class="id">D</span>' -&gt; <span class="id">exists</span> <span class="id">b</span>''', ?<span class="id">m2</span> <span class="id">a</span>''' = <span class="id">Some</span> <span class="id">b</span>''' |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ha</span>, <span class="id">Hb</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">destruct_exists</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Hin</span> : <span class="id">In</span> ?<span class="id">a</span> ?<span class="id">D</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span> : <span class="kwd">forall</span> <span class="id">a</span>', <span class="id">In</span> <span class="id">a</span>' ?<span class="id">D</span> -&gt; ?<span class="id">P</span>  |- <span class="id">exists</span> <span class="id">_</span>, ?<span class="id">m2</span> ?<span class="id">a</span> = <span class="id">Some</span> <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hin</span>; <span class="id">destruct_exists</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_class_of</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> χ ϕ ψ <span class="id">C</span>, <span class="id">classOf</span> <span class="id">x</span> (χ, ϕ::ψ) <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">y</span> ϕ' ψ',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">frame_equiv</span> <span class="id">f</span> ϕ ϕ' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">classOf</span> <span class="id">y</span> (χ, ϕ'::ψ') <span class="id">C</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof236')">Proof.</div>
<div class="proofscript" id="proof236">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;|[<span class="id">H</span> : <span class="id">classOf</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="id">equiv_unfold</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">cls_of</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_class_of_this</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ', <span class="id">config_equiv</span> σ σ' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">classOf</span> <span class="id">this</span> σ' <span class="id">C</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof237')">Proof.</div>
<div class="proofscript" id="proof237">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">stack_equiv</span> <span class="id">_</span> ?ψ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hcls</span> : <span class="id">classOf</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">classOf</span> <span class="id">_</span> (<span class="id">_</span>, ?ψ) <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> ψ' := <span class="tactic">fresh</span> "ψ" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> ϕ := <span class="tactic">fresh</span> "ϕ" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ψ <span class="kwd">as</span> [|ϕ ψ'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hcls</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="kwd">Hint</span> : ⌊ <span class="id">_</span> ⌋ (<span class="id">_</span>, <span class="id">nil</span>) ≜ <span class="id">_</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="kwd">Hint</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>; <span class="id">crush</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>|]<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">classOf</span> <span class="id">this</span> (<span class="id">_</span>, ?ϕ1::?ψ1) <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Heq</span> : <span class="id">frame_equiv</span> ?<span class="id">f</span> ?ϕ1 ?ϕ2 |- <span class="id">classOf</span> <span class="id">this</span> (<span class="id">_</span>, ?ϕ2::<span class="id">_</span>) <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">equivalent_class_of</span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">this</span>)(ϕ:=ϕ1)(ψ:=ψ1)(<span class="id">f</span>:=<span class="id">f</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">wf_rename</span> <span class="kwd">in</span> *; <span class="id">andDestruct</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">equivalent_class_of_this</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_frames_with_equivalent_maps</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> ϕ1 ϕ2, <span class="id">frame_equiv</span> <span class="id">f</span> ϕ1 ϕ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vMap</span> ϕ1) = <span class="id">f</span> ∘ (<span class="id">vMap</span> ϕ2).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof238')">Proof.</div>
<div class="proofscript" id="proof238">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">bind_dom</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>}`{<span class="id">Eq</span> <span class="id">A</span>}(<span class="id">m1</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">var</span>)(<span class="id">m2</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span> <span class="id">x</span>, <span class="id">m1</span> <span class="id">a</span> = <span class="id">Some</span> <span class="id">x</span> -&gt; <span class="id">exists</span> <span class="id">y</span>, <span class="id">m2</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">y</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">d</span>, <span class="id">dom</span> <span class="id">m1</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dom</span> (<span class="id">m1</span> ∘ <span class="id">m2</span>) <span class="id">d</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof239')">Proof.</div>
<div class="proofscript" id="proof239">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">HeqA</span> <span class="id">m1</span> <span class="id">m2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bind</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">dom</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">partial_map_dec</span> <span class="id">a</span> <span class="id">m1</span>) <span class="kwd">as</span> [|<span class="id">Hnone</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">destruct_exists</span>; <span class="tactic">eauto</span>|<span class="tactic">rewrite</span> <span class="id">Hnone</span> <span class="kwd">in</span> *; <span class="id">crush</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">partial_map_dec</span> <span class="id">a</span> <span class="id">m1</span>) <span class="kwd">as</span> [|<span class="id">Hnone</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">destruct_exists</span>|<span class="tactic">rewrite</span> <span class="id">Hnone</span> <span class="kwd">in</span> *; <span class="id">crush</span>].<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : ?<span class="id">m</span> ?<span class="id">a</span> = <span class="id">Some</span> ?<span class="id">x</span> |- <span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Ha</span> : <span class="kwd">forall</span> <span class="id">a</span>', <span class="id">In</span> <span class="id">a</span>' ?<span class="id">d</span> -&gt; <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hb</span> : <span class="id">In</span> ?<span class="id">a</span> ?<span class="id">d</span> |-<span class="id">_</span>] =&gt; <span class="tactic">apply</span> <span class="id">Ha</span> <span class="kwd">in</span> <span class="id">Hb</span>; <span class="id">destruct_exists</span>; <span class="id">crush</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_reduction_exists</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> σ1 σ2, <span class="id">M</span> ∙ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ1', <span class="id">config_equiv</span> σ1 σ1' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> σ2', <span class="id">M</span> ∙ σ1' ⤳ σ2'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof240')">Proof.</div>
<div class="proofscript" id="proof240">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : <span class="id">contn</span> <span class="id">_</span> = <span class="id">c_stmt</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">frm</span> (<span class="id">vMap</span> ϕ2) (<span class="id">c_hole</span> <span class="id">x2</span> <span class="id">s2</span>')) <span class="kwd">as</span> ϕ2'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">frm</span> (<span class="id">update</span> <span class="id">this</span> (<span class="id">v_addr</span> α) ((<span class="id">ps</span> ∘ <span class="id">f</span>) ∘ (<span class="id">vMap</span> ϕ2))) (<span class="id">c_stmt</span> <span class="id">s</span>)) <span class="kwd">as</span> ϕ'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (χ, ϕ' :: ϕ2' :: ψ0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">r_mth</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span>:=<span class="id">s</span>)(<span class="id">C</span>:=<span class="id">C</span>)(<span class="id">o</span>:=<span class="id">o</span>)(α:=α)(<span class="id">zs</span>:=<span class="id">zs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span>:=<span class="id">x2</span>)(<span class="id">y</span>:=<span class="id">y2</span>)(<span class="id">m</span>:=<span class="id">m</span>)(ϕ:=ϕ2)(<span class="id">s</span>':=<span class="id">s2</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ps</span>:=<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">bind</span> (<span class="id">ps</span> <span class="id">x</span>) <span class="id">f</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">rename_wf_not_this</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">bind_dom</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> <span class="id">_</span> = <span class="id">c_stmt</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">c_stmt</span> <span class="id">_</span> = <span class="id">contn</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">update_</span>σ<span class="id">_map</span> (χ, ϕ2::ψ0) <span class="id">y1</span> <span class="id">v</span>) <span class="kwd">as</span> σ'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> σ'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">r_vAssgn</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ϕ:=ϕ2)(ψ:=ψ0)(<span class="id">x</span>:=<span class="id">y1</span>)(<span class="id">v</span>:=<span class="id">v</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">y</span>:=<span class="id">y0</span>)(<span class="id">f</span>:=<span class="id">f</span>)(<span class="id">s</span>:=<span class="id">s2</span>')(χ:=χ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(α:=α)(<span class="id">o</span>:=<span class="id">o</span>)(<span class="id">C</span>:=<span class="id">C</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hwf</span> : <span class="id">wf_rename</span> ?<span class="id">f</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">x</span>' |- ?<span class="id">x</span>' &lt;&gt; <span class="id">this</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hcontra</span>; <span class="tactic">subst</span>; <span class="tactic">unfold</span> <span class="id">wf_rename</span> <span class="kwd">in</span> <span class="id">Hwf</span>; <span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1_1</span> : <span class="id">one_to_one</span> ?<span class="id">f</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hneq</span> : ?<span class="id">x</span> &lt;&gt; <span class="id">this</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmap</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> <span class="id">this</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">one_to_one</span> <span class="kwd">in</span> <span class="id">H1_1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">H1_1</span> <span class="id">x</span> <span class="id">this</span> <span class="id">this</span> <span class="id">Hmap</span>) <span class="kwd">in</span> <span class="id">Hneq</span>; <span class="id">crush</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">_</span> : <span class="id">wf_rename</span> ?<span class="id">f</span>' |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">equivalent_class_of</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">f</span>'); [<span class="tactic">eauto</span>| |]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">wf_rename</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">_</span> : <span class="id">wf_rename</span> ?<span class="id">f</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> : ?<span class="id">f</span>' ?<span class="id">x</span>' = <span class="id">Some</span> ?<span class="id">y</span>  |- <span class="id">classOf</span> ?<span class="id">y</span> <span class="id">_</span> <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">equivalent_class_of</span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">x</span>')(<span class="id">f</span>:=<span class="id">f</span>'); [<span class="tactic">eauto</span>|<span class="tactic">auto</span>|<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">auto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> <span class="id">_</span> = <span class="id">c_stmt</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">c_stmt</span> <span class="id">_</span> = <span class="id">contn</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">new</span> (<span class="id">cname</span> <span class="id">o</span>) (<span class="id">update</span> <span class="id">f</span> <span class="id">v</span> (<span class="id">flds</span> <span class="id">o</span>)) (<span class="id">meths</span> <span class="id">o</span>)) <span class="kwd">as</span> <span class="id">o</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">update</span> α <span class="id">o</span>' χ) <span class="kwd">as</span> χ'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">frm</span> (<span class="id">vMap</span> ϕ2) (<span class="id">c_stmt</span> <span class="id">s2</span>')) <span class="kwd">as</span> ϕ'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (χ', ϕ'::ψ0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">r_fAssgn</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ϕ:=ϕ2)(ϕ':=ϕ')(<span class="id">x</span>:=<span class="id">y0</span>)(<span class="id">y</span>:=<span class="id">y1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span>:=<span class="id">f</span>)(<span class="id">s</span>:=<span class="id">s2</span>')(ψ:=ψ0)(χ:=χ)(<span class="id">v</span>:=<span class="id">v</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(χ':=χ')(α:=α)(<span class="id">o</span>:=<span class="id">o</span>)(<span class="id">o</span>':=<span class="id">o</span>')(<span class="id">C</span>:=<span class="id">C</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">_</span> : <span class="id">wf_rename</span> ?<span class="id">f</span>' |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">equivalent_class_of</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">f</span>'); [<span class="tactic">eauto</span>| |]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">wf_rename</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">_</span> : <span class="id">wf_rename</span> ?<span class="id">f</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> : ?<span class="id">f</span>' ?<span class="id">x</span>' = <span class="id">Some</span> ?<span class="id">y</span>  |- <span class="id">classOf</span> ?<span class="id">y</span> <span class="id">_</span> <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">equivalent_class_of</span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">x</span>')(<span class="id">f</span>:=<span class="id">f</span>'); [<span class="tactic">eauto</span>|<span class="tactic">auto</span>|<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">auto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> <span class="id">_</span> = <span class="id">c_stmt</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">c_stmt</span> <span class="id">_</span> = <span class="id">contn</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">new</span> <span class="id">C</span> ((<span class="id">fMap</span> ∘ <span class="id">f</span>) ∘ (<span class="id">vMap</span> ϕ2)) (<span class="id">c_meths</span> <span class="id">CDef</span>)) <span class="kwd">as</span> <span class="id">o</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">frm</span> (<span class="id">update</span> <span class="id">x2</span> (<span class="id">v_addr</span> α) (<span class="id">vMap</span> ϕ2)) (<span class="id">c_stmt</span> <span class="id">s2</span>')) <span class="kwd">as</span> ϕ'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">update</span> α <span class="id">o</span> χ, ϕ'::ψ0) <span class="kwd">as</span> σ'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> σ'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">r_new</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(χ:=χ)(ψ:=ψ0)(ϕ:=ϕ2)(ϕ':=ϕ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(α:=α)(<span class="id">x</span>:=<span class="id">x2</span>)(<span class="id">C</span>:=<span class="id">C</span>)(<span class="id">s</span>:=<span class="id">s2</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fMap</span>:=<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">bind</span> (<span class="id">fMap</span> <span class="id">x</span>) <span class="id">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">o</span>:=<span class="id">o</span>)(<span class="id">CDef</span>:=<span class="id">CDef</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hwf</span> : <span class="id">wf_rename</span> ?<span class="id">f</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">x</span>' |- ?<span class="id">x</span>' &lt;&gt; <span class="id">this</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hcontra</span>; <span class="tactic">subst</span>; <span class="tactic">unfold</span> <span class="id">wf_rename</span> <span class="kwd">in</span> <span class="id">Hwf</span>; <span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1_1</span> : <span class="id">one_to_one</span> ?<span class="id">f</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hneq</span> : ?<span class="id">x</span> &lt;&gt; <span class="id">this</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmap</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> <span class="id">this</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">one_to_one</span> <span class="kwd">in</span> <span class="id">H1_1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">H1_1</span> <span class="id">x</span> <span class="id">this</span> <span class="id">this</span> <span class="id">Hmap</span>) <span class="kwd">in</span> <span class="id">Hneq</span>; <span class="id">crush</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">bind_dom</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">bind</span> (?<span class="id">m</span> ?<span class="id">f0</span>) ?<span class="id">f</span> = <span class="id">Some</span> ?<span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Ha</span> : <span class="kwd">forall</span> <span class="id">f</span>' <span class="id">x</span>', ?<span class="id">m</span> <span class="id">f</span>' = <span class="id">Some</span> <span class="id">x</span>' -&gt; <span class="id">exists</span> <span class="id">v</span>, <span class="id">vMap</span> ?ϕ <span class="id">x</span>' = <span class="id">Some</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hb</span> : <span class="id">vMap</span> ?ϕ = <span class="id">_</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bind</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hmap</span> := <span class="tactic">fresh</span> <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">partial_map_dec</span> <span class="id">f0</span> <span class="id">m</span>) <span class="kwd">as</span> [|<span class="id">Hmap</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">destruct_exists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="tactic">rewrite</span> <span class="id">Hmap</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">crush</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hc</span> : <span class="id">m</span> <span class="id">f0</span> = <span class="id">Some</span> ?<span class="id">y</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hc</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Ha</span> <span class="kwd">in</span> <span class="id">Hc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct_exists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hb</span> <span class="kwd">in</span> <span class="id">Hc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> <span class="id">_</span> = <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">c_stmt</span> <span class="id">_</span> = <span class="id">contn</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">update_</span>ϕ<span class="id">_contn</span> (<span class="id">update_</span>ϕ<span class="id">_map</span> ϕ0 <span class="id">x2</span> α) (<span class="id">c_stmt</span> <span class="id">s2</span>)) <span class="kwd">as</span> ϕ''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (χ, ϕ''::ψ2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">r_ret1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ϕ:=ϕ2)(ϕ':=ϕ0)(<span class="id">y</span>:=<span class="id">x2</span>)(<span class="id">x</span>:=<span class="id">x0</span>)(α:=α)(<span class="id">s</span>:=<span class="id">s2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hwf</span> : <span class="id">wf_rename</span> ?<span class="id">f</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">x</span>' |- ?<span class="id">x</span>' &lt;&gt; <span class="id">this</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hcontra</span>; <span class="tactic">subst</span>; <span class="tactic">unfold</span> <span class="id">wf_rename</span> <span class="kwd">in</span> <span class="id">Hwf</span>; <span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1_1</span> : <span class="id">one_to_one</span> ?<span class="id">f</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hneq</span> : ?<span class="id">x</span> &lt;&gt; <span class="id">this</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmap</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> <span class="id">this</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">one_to_one</span> <span class="kwd">in</span> <span class="id">H1_1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">H1_1</span> <span class="id">x</span> <span class="id">this</span> <span class="id">this</span> <span class="id">Hmap</span>) <span class="kwd">in</span> <span class="id">Hneq</span>; <span class="id">crush</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;-  <span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> <span class="id">_</span> = <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">c_stmt</span> <span class="id">_</span> = <span class="id">contn</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">update_</span>ϕ<span class="id">_contn</span> (<span class="id">update_</span>ϕ<span class="id">_map</span> ϕ0 <span class="id">x2</span> α) (<span class="id">c_stmt</span> <span class="id">s2</span>)) <span class="kwd">as</span> ϕ''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (χ, ϕ''::ψ2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">r_ret2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ϕ:=ϕ2)(ϕ':=ϕ0)(<span class="id">y</span>:=<span class="id">x2</span>)(<span class="id">x</span>:=<span class="id">x0</span>)(α:=α)(<span class="id">s</span>:=<span class="id">s2</span>)(<span class="id">s</span>':=<span class="id">s2</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hwf</span> : <span class="id">wf_rename</span> ?<span class="id">f</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">x</span>' |- ?<span class="id">x</span>' &lt;&gt; <span class="id">this</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hcontra</span>; <span class="tactic">subst</span>; <span class="tactic">unfold</span> <span class="id">wf_rename</span> <span class="kwd">in</span> <span class="id">Hwf</span>; <span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1_1</span> : <span class="id">one_to_one</span> ?<span class="id">f</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hneq</span> : ?<span class="id">x</span> &lt;&gt; <span class="id">this</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmap</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> <span class="id">this</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">one_to_one</span> <span class="kwd">in</span> <span class="id">H1_1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">H1_1</span> <span class="id">x</span> <span class="id">this</span> <span class="id">this</span> <span class="id">Hmap</span>) <span class="kwd">in</span> <span class="id">Hneq</span>; <span class="id">crush</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">compose_is_bind</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> : <span class="kwd">Type</span>}`{<span class="id">Eq</span> <span class="id">A</span>}`{<span class="id">Eq</span> <span class="id">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m1</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m2</span> : <span class="id">partial_map</span> <span class="id">B</span> <span class="id">C</span>), <span class="id">m1</span> ∘ <span class="id">m2</span> = (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">bind</span> (<span class="id">m1</span> <span class="id">x</span>) <span class="id">m2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof241')">Proof.</div>
<div class="proofscript" id="proof241">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">bind_assoc</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">D</span> : <span class="kwd">Type</span>}`{<span class="id">Eq</span> <span class="id">A</span>}`{<span class="id">Eq</span> <span class="id">B</span>}`{<span class="id">Eq</span> <span class="id">C</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m1</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">B</span>) (<span class="id">m2</span> : <span class="id">partial_map</span> <span class="id">B</span> <span class="id">C</span>) (<span class="id">m3</span> : <span class="id">partial_map</span> <span class="id">C</span> <span class="id">D</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">bind</span> ((<span class="kwd">fun</span> <span class="id">y</span> =&gt; <span class="id">bind</span> (<span class="id">m1</span> <span class="id">y</span>) <span class="id">m2</span>) <span class="id">x</span>) <span class="id">m3</span>) = (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">bind</span> (<span class="id">m1</span> <span class="id">x</span>) (<span class="kwd">fun</span> <span class="id">y</span> =&gt; <span class="id">bind</span> (<span class="id">m2</span> <span class="id">y</span>) <span class="id">m3</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof242')">Proof.</div>
<div class="proofscript" id="proof242">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bind</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">functional_extensionality</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">m1</span> : <span class="id">partial_map</span> ?<span class="id">A</span> <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">a</span> : ?<span class="id">A</span> |- <span class="id">_</span>] =&gt; <span class="tactic">destruct</span> (<span class="id">m1</span> <span class="id">a</span>); <span class="tactic">auto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">bind_assoc</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">bind_update</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> : <span class="kwd">Type</span>}`{<span class="id">Eq</span> <span class="id">A</span>}`{<span class="id">Eq</span> <span class="id">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m1</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">B</span>)(<span class="id">m2</span> : <span class="id">partial_map</span> <span class="id">B</span> <span class="id">C</span>) <span class="id">a</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m1</span> <span class="id">a</span> = <span class="id">Some</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">one_to_one</span> <span class="id">m1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span>, (<span class="id">update</span> <span class="id">a</span> <span class="id">c</span> (<span class="kwd">fun</span> <span class="id">a</span>' =&gt; <span class="id">bind</span> (<span class="id">m1</span> <span class="id">a</span>') <span class="id">m2</span>)) = (<span class="kwd">fun</span> <span class="id">a</span>' =&gt; <span class="id">bind</span> (<span class="id">m1</span> <span class="id">a</span>') (<span class="id">update</span> <span class="id">b</span> <span class="id">c</span> <span class="id">m2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof243')">Proof.</div>
<div class="proofscript" id="proof243">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">functional_extensionality</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">a</span>'.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : ?<span class="id">m</span> ?<span class="id">a</span> = <span class="id">Some</span> ?<span class="id">b</span> |- <span class="id">context</span>[<span class="id">eqb</span> ?<span class="id">a</span>' ?<span class="id">a</span>]] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">a</span>' <span class="id">a</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">rewrite</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_auto</span>|]<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">partial_map_dec</span> <span class="id">a</span>' <span class="id">m1</span>); [<span class="id">destruct_exists</span>; <span class="id">crush</span>|<span class="id">crush</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hneq</span> : <span class="id">x</span> &lt;&gt; <span class="id">b</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intro</span> <span class="id">Hcontra</span>; <span class="tactic">subst</span>; <span class="tactic">unfold</span> <span class="id">one_to_one</span> <span class="kwd">in</span> *|].<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">neq_eqb</span> <span class="kwd">in</span> <span class="id">Hneq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hneq</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">fold_bind</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> : <span class="kwd">Type</span>}`{<span class="id">Eq</span> <span class="id">A</span>}`{<span class="id">Eq</span> <span class="id">B</span>}(<span class="id">f</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">B</span>)(<span class="id">g</span> : <span class="id">partial_map</span> <span class="id">B</span> <span class="id">C</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="kwd">match</span> (<span class="id">f</span> <span class="id">a</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">b</span> =&gt; <span class="id">g</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) = <span class="id">f</span> ∘ <span class="id">g</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof244')">Proof.</div>
<div class="proofscript" id="proof244">
<br/>
Admitted.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">fold_bind</span>' :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">D</span> : <span class="kwd">Type</span>}`{<span class="id">Eq</span> <span class="id">A</span>}`{<span class="id">Eq</span> <span class="id">B</span>}`{<span class="id">Eq</span> <span class="id">C</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">g</span> : <span class="id">partial_map</span> <span class="id">B</span> <span class="id">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">h</span> : <span class="id">partial_map</span> <span class="id">C</span> <span class="id">D</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">bind</span> <span class="kwd">match</span> (<span class="id">f</span> <span class="id">a</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">b</span> =&gt; <span class="id">g</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span> <span class="id">h</span>) = <span class="id">f</span> ∘ <span class="id">g</span> ∘ <span class="id">h</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof245')">Proof.</div>
<div class="proofscript" id="proof245">
<br/>
Admitted.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_reduction</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> σ1 σ2, <span class="id">M</span> ∙ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ1', <span class="id">config_equiv</span> σ1 σ1' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ2', <span class="id">M</span> ∙ σ1' ⤳ σ2' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">config_equiv</span> σ2 σ2'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof246')">Proof.</div>
<div class="proofscript" id="proof246">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> <span class="id">_</span> = <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">_</span> = <span class="id">contn</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hred</span> : <span class="id">_</span> ∙ <span class="id">_</span> ⤳ <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">Hred</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">crush</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> <span class="id">_</span> = <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">_</span> = <span class="id">contn</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">c_stmt</span> <span class="id">_</span> = <span class="id">c_stmt</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ⌊ ?<span class="id">x1</span> ⌋ (?χ, ?ϕ1::?ψ1) ≜ ?<span class="id">v1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : ⌊ ?<span class="id">x2</span> ⌋ (?χ, ?ϕ2::?ψ2) ≜ ?<span class="id">v2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmap</span> : ?<span class="id">f</span> ?<span class="id">x1</span> = <span class="id">Some</span> ?<span class="id">x2</span> |- <span class="id">_</span> ] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">equivalent_interpretation_equal</span> <span class="id">x1</span>  χ ϕ1 ψ1 <span class="id">v1</span> <span class="id">H1</span> <span class="id">f</span>) <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ?χ ?α = <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : ?χ ?α = <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_cons</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">Some</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">fold_bind</span> <span class="kwd">in</span> <span class="id">H27</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">fold_bind</span> <span class="kwd">in</span> <span class="id">H17</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">fold_bind</span>' <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_frm</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">compose_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">eq_cons</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">f</span>); <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hred</span> : <span class="id">_</span> ∙ <span class="id">_</span> ⤳ <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">Hred</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">crush</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> <span class="id">_</span> = <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">_</span> = <span class="id">contn</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">c_stmt</span> <span class="id">_</span> = <span class="id">c_stmt</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ⌊ ?<span class="id">x1</span> ⌋ (?χ, ?ϕ1::?ψ1) ≜ ?<span class="id">v1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : ⌊ ?<span class="id">x2</span> ⌋ (?χ, ?ϕ2::?ψ2) ≜ ?<span class="id">v2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmap</span> : ?<span class="id">f</span> ?<span class="id">x1</span> = <span class="id">Some</span> ?<span class="id">x2</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">equivalent_interpretation_equal</span> <span class="id">x1</span>  χ ϕ1 ψ1 <span class="id">v1</span> <span class="id">H1</span> <span class="id">f</span>) <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ?χ ?α = <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : ?χ ?α = <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">equiv_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">_</span> : <span class="id">wf_rename</span> ?<span class="id">f</span>' |- <span class="id">stack_equiv</span> <span class="id">_</span> <span class="id">_</span>] =&gt; <span class="tactic">apply</span> <span class="id">eq_cons</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">f</span>'); <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_map</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmap</span> : ?<span class="id">m</span> = <span class="id">_</span> |- <span class="id">context</span>[?<span class="id">m</span>]] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">x</span>' |- <span class="id">context</span>[(<span class="kwd">fun</span> <span class="id">a</span>' =&gt; <span class="id">bind</span> (?<span class="id">f</span> <span class="id">a</span>') (<span class="id">update</span> ?<span class="id">x</span>' <span class="id">_</span> <span class="id">_</span>))]] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">bind_update</span> <span class="kwd">with</span> (<span class="id">a</span>:=<span class="id">x</span>); <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">context</span>[<span class="id">eqb</span> ?<span class="id">x</span> ?<span class="id">y</span>] |- <span class="id">exists</span> <span class="id">_</span>, <span class="id">_</span> ?<span class="id">x</span> = <span class="id">Some</span> <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">x</span> <span class="id">y</span>) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">context</span>[<span class="id">eqb</span> ?<span class="id">x</span> ?<span class="id">y</span>] |- <span class="id">exists</span> <span class="id">_</span>, <span class="id">_</span> = <span class="id">Some</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">x</span> <span class="id">y</span>) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hred</span> : <span class="id">_</span> ∙ <span class="id">_</span> ⤳ <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">Hred</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">crush</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> <span class="id">_</span> = <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">_</span> = <span class="id">contn</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">c_stmt</span> <span class="id">_</span> = <span class="id">c_stmt</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ⌊ ?<span class="id">x1</span> ⌋ (?χ, ?ϕ1::?ψ1) ≜ ?<span class="id">v1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : ⌊ ?<span class="id">x2</span> ⌋ (?χ, ?ϕ2::?ψ2) ≜ ?<span class="id">v2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmap</span> : ?<span class="id">f</span> ?<span class="id">x1</span> = <span class="id">Some</span> ?<span class="id">x2</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">equivalent_interpretation_equal</span> <span class="id">x1</span>  χ ϕ1 ψ1 <span class="id">v1</span> <span class="id">H1</span> <span class="id">f</span>) <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ?χ ?α = <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : ?χ ?α = <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ⌊ ?<span class="id">x1</span> ⌋ (?χ, ?ϕ1::?ψ1) ≜ ?<span class="id">v1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : ⌊ ?<span class="id">x2</span> ⌋ (?χ, ?ϕ2::?ψ2) ≜ ?<span class="id">v2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmap</span> : ?<span class="id">f</span> ?<span class="id">x1</span> = <span class="id">Some</span> ?<span class="id">x2</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">equivalent_interpretation_equal</span> <span class="id">x1</span>  χ ϕ1 ψ1 <span class="id">v1</span> <span class="id">H1</span> <span class="id">f</span>) <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">equiv_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">_</span> : <span class="id">wf_rename</span> ?<span class="id">f</span>' |- <span class="id">stack_equiv</span> <span class="id">_</span> <span class="id">_</span>] =&gt; <span class="tactic">apply</span> <span class="id">eq_cons</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">f</span>'); <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hred</span> : <span class="id">_</span> ∙ <span class="id">_</span> ⤳ <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">Hred</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">crush</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> <span class="id">_</span> = <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">_</span> = <span class="id">contn</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">c_stmt</span> <span class="id">_</span> = <span class="id">c_stmt</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ?<span class="id">m</span> ?<span class="id">x</span> = <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : ?<span class="id">m</span> ?<span class="id">x</span> = <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : <span class="id">fresh_</span>χ ?χ ?<span class="id">a1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">fresh_</span>χ ?χ ?<span class="id">a2</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">fresh_heap_unique</span> <span class="kwd">with</span> (α1:=<span class="id">a2</span>) <span class="kwd">in</span> <span class="id">H1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">compose_is_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmap</span> : ?<span class="id">m</span> = (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id">bind</span> <span class="id">_</span> <span class="id">_</span>) |- <span class="id">context</span>[?<span class="id">m</span>]] =&gt; <span class="tactic">rewrite</span> <span class="id">Hmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">bind_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_conf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_cons</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">f</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">equiv_auto</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_map</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- <span class="id">bind_update</span> <span class="kwd">with</span> (<span class="id">a</span>:=<span class="id">x</span>); <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">context</span>[<span class="id">eqb</span> ?<span class="id">x</span> ?<span class="id">y</span>] |- <span class="id">exists</span> <span class="id">_</span>, <span class="id">_</span> ?<span class="id">x</span> = <span class="id">Some</span> <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">x</span> <span class="id">y</span>) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="kwd">match</span> ?<span class="id">f</span> ?<span class="id">x</span> <span class="kwd">with</span> | <span class="id">Some</span> <span class="id">_</span> =&gt; <span class="id">_</span> | <span class="id">None</span> =&gt; <span class="id">None</span> <span class="kwd">end</span> = <span class="id">Some</span> <span class="id">_</span>) |- <span class="id">exists</span> <span class="id">_</span>, ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> <span class="id">_</span>]  =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">x</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eexists</span>; <span class="tactic">eauto</span>|<span class="id">crush</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">context</span>[<span class="id">eqb</span> ?<span class="id">x</span> ?<span class="id">y</span>] |- <span class="id">exists</span> <span class="id">_</span>, <span class="id">_</span> = <span class="id">Some</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">x</span> <span class="id">y</span>) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hred</span> : <span class="id">_</span> ∙ <span class="id">_</span> ⤳ <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">Hred</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">crush</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> <span class="id">_</span> = <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">_</span> = <span class="id">contn</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">c_stmt</span> <span class="id">_</span> = <span class="id">c_stmt</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">c_hole</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">c_hole</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_cons</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">f0</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_map</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmap</span> : ?<span class="id">m</span> = (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id">bind</span> <span class="id">_</span> <span class="id">_</span>) |- <span class="id">context</span>[?<span class="id">m</span>]] =&gt; <span class="tactic">rewrite</span> <span class="id">Hmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ⌊ ?<span class="id">x1</span> ⌋ (?χ, ?ϕ1::?ψ1) ≜ ?<span class="id">v1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : ⌊ ?<span class="id">x2</span> ⌋ (?χ, ?ϕ2::?ψ2) ≜ ?<span class="id">v2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmap</span> : ?<span class="id">f</span> ?<span class="id">x1</span> = <span class="id">Some</span> ?<span class="id">x2</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">equivalent_interpretation_equal</span> <span class="id">x1</span>  χ ϕ1 ψ1 <span class="id">v1</span> <span class="id">H1</span> <span class="id">f</span>) <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bind_update</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">context</span>[<span class="id">eqb</span> ?<span class="id">x</span> ?<span class="id">y</span>] |- <span class="id">exists</span> <span class="id">_</span>, <span class="id">_</span> ?<span class="id">x</span> = <span class="id">Some</span> <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">x</span> <span class="id">y</span>) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">context</span>[<span class="id">eqb</span> ?<span class="id">x</span> ?<span class="id">y</span>] |- <span class="id">exists</span> <span class="id">_</span>, <span class="id">_</span> = <span class="id">Some</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">x</span> <span class="id">y</span>) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hred</span> : <span class="id">_</span> ∙ <span class="id">_</span> ⤳ <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">Hred</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">solve</span> [<span class="id">crush</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn</span> <span class="id">_</span> = <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">_</span> = <span class="id">contn</span> <span class="id">_</span> |-<span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">c_stmt</span> <span class="id">_</span> = <span class="id">c_stmt</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">c_hole</span> <span class="id">_</span> <span class="id">_</span> = <span class="id">c_hole</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_cons</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">f0</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_auto</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_map</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmap</span> : ?<span class="id">m</span> = (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id">bind</span> <span class="id">_</span> <span class="id">_</span>) |- <span class="id">context</span>[?<span class="id">m</span>]] =&gt; <span class="tactic">rewrite</span> <span class="id">Hmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ⌊ ?<span class="id">x1</span> ⌋ (?χ, ?ϕ1::?ψ1) ≜ ?<span class="id">v1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : ⌊ ?<span class="id">x2</span> ⌋ (?χ, ?ϕ2::?ψ2) ≜ ?<span class="id">v2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmap</span> : ?<span class="id">f</span> ?<span class="id">x1</span> = <span class="id">Some</span> ?<span class="id">x2</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">equivalent_interpretation_equal</span> <span class="id">x1</span>  χ ϕ1 ψ1 <span class="id">v1</span> <span class="id">H1</span> <span class="id">f</span>) <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bind_update</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">context</span>[<span class="id">eqb</span> ?<span class="id">x</span> ?<span class="id">y</span>] |- <span class="id">exists</span> <span class="id">_</span>, <span class="id">_</span> ?<span class="id">x</span> = <span class="id">Some</span> <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">x</span> <span class="id">y</span>) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">context</span>[<span class="id">eqb</span> ?<span class="id">x</span> ?<span class="id">y</span>] |- <span class="id">exists</span> <span class="id">_</span>, <span class="id">_</span> = <span class="id">Some</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">x</span> <span class="id">y</span>) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.    <br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">equivalent_reduction</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">ref_equiv_sym</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">r1</span> <span class="id">r2</span>, <span class="id">ref_equiv</span> <span class="id">f</span> <span class="id">r1</span> <span class="id">r2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>', <span class="id">inv</span> <span class="id">f</span> <span class="id">f</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ref_equiv</span> <span class="id">f</span>' <span class="id">r2</span> <span class="id">r1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof247')">Proof.</div>
<div class="proofscript" id="proof247">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">f</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">ref_equiv_sym</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">exp_equiv_sym</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span>, <span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>', <span class="id">inv</span> <span class="id">f</span> <span class="id">f</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exp_equiv</span> <span class="id">f</span>' <span class="id">e2</span> <span class="id">e1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof248')">Proof.</div>
<div class="proofscript" id="proof248">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">exp_equiv_sym</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">stmt_equiv_sym</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id">stmt_equiv</span> <span class="id">f</span> <span class="id">s1</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>', <span class="id">inv</span> <span class="id">f</span> <span class="id">f</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stmt_equiv</span> <span class="id">f</span>' <span class="id">s2</span> <span class="id">s1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof249')">Proof.</div>
<div class="proofscript" id="proof249">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">f</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">equiv_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *; <span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">bind</span> (?<span class="id">m</span> ?<span class="id">p</span>) ?<span class="id">f</span> = <span class="id">Some</span> ?<span class="id">x</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">partial_map_dec</span> <span class="id">p</span> <span class="id">m</span>) <span class="kwd">as</span> [<span class="id">Hsome</span>|<span class="id">Hnone</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">destruct_exists</span>; <span class="tactic">unfold</span> <span class="id">bind</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">rewrite</span> <span class="id">Hnone</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">crush</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Ha</span> : <span class="id">m</span> <span class="id">p</span> = <span class="id">Some</span> ?<span class="id">b</span> |- <span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">Ha</span> <span class="kwd">in</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmap</span> : ?<span class="id">f</span> ?<span class="id">x1</span> = <span class="id">Some</span> ?<span class="id">x2</span>  |- <span class="id">exists</span> <span class="id">y</span>, ?<span class="id">f</span>' ?<span class="id">x2</span> = <span class="id">Some</span> <span class="id">y</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x1</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">inverse_compose_right</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">equiv_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *; <span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">bind</span> (?<span class="id">m</span> ?<span class="id">p</span>) ?<span class="id">f</span> = <span class="id">Some</span> ?<span class="id">x</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">partial_map_dec</span> <span class="id">p</span> <span class="id">m</span>) <span class="kwd">as</span> [<span class="id">Hsome</span>|<span class="id">Hnone</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">destruct_exists</span>; <span class="tactic">unfold</span> <span class="id">bind</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">rewrite</span> <span class="id">Hnone</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">crush</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Ha</span> : <span class="id">m</span> <span class="id">p</span> = <span class="id">Some</span> ?<span class="id">b</span> |- <span class="id">_</span>] =&gt; <span class="tactic">rewrite</span> <span class="id">Ha</span> <span class="kwd">in</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hmap</span> : ?<span class="id">f</span> ?<span class="id">x1</span> = <span class="id">Some</span> ?<span class="id">x2</span>  |- <span class="id">exists</span> <span class="id">y</span>, ?<span class="id">f</span>' ?<span class="id">x2</span> = <span class="id">Some</span> <span class="id">y</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x1</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">inverse_compose_right</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">equiv_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>].<br/>
<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">stmt_equiv_sym</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">map_equiv_sym</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">m1</span> <span class="id">m2</span>, <span class="id">map_equiv</span> <span class="id">f</span> <span class="id">m1</span> <span class="id">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>', <span class="id">inv</span> <span class="id">f</span> <span class="id">f</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">map_equiv</span> <span class="id">f</span>' <span class="id">m2</span> <span class="id">m1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof250')">Proof.</div>
<div class="proofscript" id="proof250">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">f</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_map</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">functional_extensionality</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">_</span> : <span class="id">inv</span> ?<span class="id">f</span> ?<span class="id">f</span>'|- <span class="id">context</span>[?<span class="id">f</span>' ?<span class="id">x</span>]] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hnone</span> := <span class="tactic">fresh</span> <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">partial_map_dec</span> <span class="id">x</span> <span class="id">f</span>') <span class="kwd">as</span> [|<span class="id">Hnone</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="tactic">rewrite</span> <span class="id">Hnone</span>; <span class="tactic">simpl</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct_exists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : ?<span class="id">f</span>' ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">y</span> |- <span class="id">context</span>[?<span class="id">f</span>' ?<span class="id">x</span>]] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">simpl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *; <span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Ha</span> : ?<span class="id">f</span>' ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hb</span> : <span class="kwd">forall</span> <span class="id">a</span>' <span class="id">b</span>', ?<span class="id">f</span>' <span class="id">b</span>' = <span class="id">Some</span> <span class="id">a</span>' -&gt; ?<span class="id">f</span> <span class="id">a</span>' = <span class="id">Some</span> <span class="id">b</span>' |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hb</span> <span class="kwd">in</span> <span class="id">Ha</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ha</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [|- <span class="id">_</span> = ?<span class="id">m</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hnone</span> := <span class="tactic">fresh</span> <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">partial_map_dec</span> <span class="id">x</span> <span class="id">m</span>) <span class="kwd">as</span> [|<span class="id">Hnone</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="tactic">rewrite</span> <span class="id">Hnone</span>; <span class="tactic">auto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct_exists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Ha</span> : <span class="kwd">forall</span> <span class="id">x</span>' α', ?<span class="id">m</span> <span class="id">x</span>' = <span class="id">Some</span> α' -&gt; <span class="id">exists</span> <span class="id">y</span>', ?<span class="id">f</span> <span class="id">y</span>' = <span class="id">Some</span> <span class="id">x</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hb</span> : ?<span class="id">m</span> ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">y</span> |- <span class="id">_</span>] =&gt; <span class="tactic">apply</span> <span class="id">Ha</span> <span class="kwd">in</span> <span class="id">Hb</span>; <span class="id">destruct_exists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *; <span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Ha</span> : <span class="kwd">forall</span> <span class="id">x</span>' <span class="id">y</span>', ?<span class="id">f</span> <span class="id">x</span>' = <span class="id">Some</span> <span class="id">y</span>' -&gt; ?<span class="id">f</span>' <span class="id">y</span>' = <span class="id">Some</span> <span class="id">x</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hb</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hc</span> : ?<span class="id">f</span>' ?<span class="id">y</span> = <span class="id">None</span> |- <span class="id">_</span>] =&gt; <span class="tactic">apply</span> <span class="id">Ha</span> <span class="kwd">in</span> <span class="id">Hb</span>; <span class="id">crush</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *; <span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Ha</span> : <span class="kwd">forall</span> <span class="id">x</span>' α', ?<span class="id">m</span> <span class="id">x</span>' = <span class="id">Some</span> α' -&gt; <span class="id">exists</span> <span class="id">y</span>', ?<span class="id">f</span> <span class="id">y</span>' = <span class="id">Some</span> <span class="id">x</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hb</span> : ?<span class="id">m</span> ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">y</span> |- <span class="id">_</span>] =&gt; <span class="tactic">apply</span> <span class="id">Ha</span> <span class="kwd">in</span> <span class="id">Hb</span>; <span class="id">destruct_exists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Ha</span> : <span class="kwd">forall</span> <span class="id">x</span>' <span class="id">y</span>', ?<span class="id">f</span> <span class="id">x</span>' = <span class="id">Some</span> <span class="id">y</span>' -&gt; ?<span class="id">f</span>' <span class="id">y</span>' = <span class="id">Some</span> <span class="id">x</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hb</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">y</span> |- <span class="id">_</span>] =&gt; <span class="tactic">apply</span> <span class="id">Ha</span> <span class="kwd">in</span> <span class="id">Hb</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Ha</span> : <span class="id">bind</span> (?<span class="id">f</span> ?<span class="id">x</span>) ?<span class="id">m</span> = <span class="id">Some</span> ?α |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hnone</span> := <span class="tactic">fresh</span> <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">partial_map_dec</span> <span class="id">x</span> <span class="id">f</span>) <span class="kwd">as</span> [|<span class="id">Hnone</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *; <span class="id">andDestruct</span>; <span class="id">destruct_exists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">rewrite</span> <span class="id">Hnone</span> <span class="kwd">in</span> <span class="id">Ha</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ha</span>; <span class="id">crush</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Ha</span> : <span class="kwd">forall</span> <span class="id">x</span>' <span class="id">y</span>', ?<span class="id">f</span> <span class="id">x</span>' = <span class="id">Some</span> <span class="id">y</span>' -&gt; ?<span class="id">f</span>' <span class="id">y</span>' = <span class="id">Some</span> <span class="id">x</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hb</span> : ?<span class="id">f</span> ?<span class="id">x</span> = <span class="id">Some</span> ?<span class="id">y</span> |- <span class="id">exists</span> <span class="id">_</span>, ?<span class="id">f</span>' <span class="id">_</span> = <span class="id">Some</span> ?<span class="id">x</span> ] =&gt; <span class="tactic">apply</span> <span class="id">Ha</span> <span class="kwd">in</span> <span class="id">Hb</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">wf_rename</span> <span class="kwd">in</span> *; <span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">inv_one_to_one_2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *; <span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">map_equiv_sym</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">contn_equiv_sym</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">c1</span> <span class="id">c2</span>, <span class="id">contn_equiv</span> <span class="id">f</span> <span class="id">c1</span> <span class="id">c2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>', <span class="id">inv</span> <span class="id">f</span> <span class="id">f</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contn_equiv</span> <span class="id">f</span>' <span class="id">c2</span> <span class="id">c1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof251')">Proof.</div>
<div class="proofscript" id="proof251">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">contn_equiv</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="id">equiv_unfold</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">equiv_auto</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *; <span class="id">andDestruct</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">equiv_unfold</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">equiv_auto</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">contn_equiv_sym</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">wf_rename_inv</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>, <span class="id">wf_rename</span> <span class="id">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>', <span class="id">inv</span> <span class="id">f</span> <span class="id">f</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_rename</span> <span class="id">f</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof252')">Proof.</div>
<div class="proofscript" id="proof252">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">wf_rename</span> <span class="kwd">in</span> *; <span class="id">andDestruct</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">inv_one_to_one_2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">inv</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">wf_rename_inv</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">frame_equiv_sym</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> ϕ1 ϕ2, <span class="id">frame_equiv</span> <span class="id">f</span> ϕ1 ϕ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>', <span class="id">inv</span> <span class="id">f</span> <span class="id">f</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">frame_equiv</span> <span class="id">f</span>' ϕ2 ϕ1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof253')">Proof.</div>
<div class="proofscript" id="proof253">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">equiv_unfold</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_frm</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">frame_equiv_sym</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">stack_equiv_sym</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> ψ1 ψ2, <span class="id">stack_equiv</span> ψ1 ψ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stack_equiv</span> ψ2 ψ1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof254')">Proof.</div>
<div class="proofscript" id="proof254">
&nbsp;&nbsp;<span class="tactic">intros</span> ψ1 ψ2 <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id">one_to_one_exists_inv</span>) <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">f</span>) <span class="kwd">as</span> [<span class="id">f</span>']; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eq_cons</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">f</span>'); <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">stack_equiv_sym</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">config_equiv_sym</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ1 σ2, <span class="id">config_equiv</span> σ1 σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">config_equiv</span> σ2 σ1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof255')">Proof.</div>
<div class="proofscript" id="proof255">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">equiv_unfold</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">config_equiv_sym</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_reductions</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ1', <span class="id">config_equiv</span> σ1 σ1' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> σ2', <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1' ⤳… σ2' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">config_equiv</span> σ2 σ2'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof256')">Proof.</div>
<div class="proofscript" id="proof256">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="id">link_unique_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hred</span> : ?<span class="id">M</span> ∙ ?σ1 ⤳ ?σ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hequiv</span> : <span class="id">config_equiv</span> ?σ1 ?σ1',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hwf</span> : <span class="id">M_wf</span> <span class="id">M</span>|- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> σ2' := <span class="tactic">fresh</span> "σ" <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equivalent_reduction_exists</span> <span class="id">M</span> σ1 σ2 <span class="id">Hred</span> <span class="id">Hwf</span> σ1') <span class="kwd">as</span> [σ2']; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hred1</span> : ?<span class="id">M</span> ∙ ?σ1 ⤳ ?σ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hred2</span> : ?<span class="id">M</span> ∙ ?σ1' ⤳ ?σ2',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hequiv</span> : <span class="id">config_equiv</span> ?σ1 ?σ1',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hwf</span> : <span class="id">M_wf</span> ?<span class="id">M</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hconf</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hconf</span> : <span class="id">config_equiv</span> σ2 σ2');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">eapply</span> <span class="id">equivalent_reduction</span>; <span class="tactic">eauto</span>|]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">pr_single</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="id">link_unique_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">IH</span> : <span class="kwd">forall</span> <span class="id">M</span>, <span class="id">_</span> ⋄ <span class="id">_</span> ≜ <span class="id">_</span> -&gt; <span class="id">_</span> -&gt; <span class="kwd">forall</span> σ1', <span class="id">_</span> -&gt; <span class="id">exists</span> <span class="id">_</span>, <span class="id">_</span> /\ <span class="id">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hlink</span> : <span class="id">_</span> ⋄ <span class="id">_</span> ≜ ?<span class="id">M</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hconf</span> : <span class="id">config_equiv</span> <span class="id">_</span> ?σ |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> σ2 := <span class="tactic">fresh</span> "σ" <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IH</span> <span class="kwd">with</span> (<span class="id">M</span>:=<span class="id">M</span>')(σ1':=σ) <span class="kwd">as</span> [σ2];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">_</span> : <span class="id">config_equiv</span> ?σ<span class="id">a</span> ?σ<span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> : ?<span class="id">M</span>' ∙ ?σ<span class="id">a</span> ⤳ ?σ<span class="id">c</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">H</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> σ := <span class="tactic">fresh</span> "σ" <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">equivalent_reduction_exists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">M</span>:=<span class="id">M</span>')(σ1:=σ<span class="id">a</span>)(σ2:=σ<span class="id">c</span>)(σ1':=σ<span class="id">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [σ <span class="id">H</span>]; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hred1</span> : ?<span class="id">M0</span> ∙ ?σ<span class="id">a</span> ⤳ ?σ<span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hred2</span> : ?<span class="id">M0</span> ∙ ?σ<span class="id">a</span>' ⤳ ?σ<span class="id">b</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hconf</span> : <span class="id">config_equiv</span> ?σ<span class="id">a</span> ?σ<span class="id">a</span>' |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">H</span> := <span class="tactic">fresh</span> <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span> : <span class="id">config_equiv</span> σ<span class="id">b</span> σ<span class="id">b</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">eapply</span> <span class="id">equivalent_reduction</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">M</span>:=<span class="id">M0</span>)(σ1:=σ<span class="id">a</span>)(σ2:=σ<span class="id">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ1':=σ<span class="id">a</span>')(σ2':=σ<span class="id">b</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">_</span> : <span class="id">_</span> ⦂ <span class="id">_</span> ⦿ ?σ1 ⤳… ?σ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> : <span class="id">_</span> ∙ ?σ2 ⤳ ?σ3,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> : <span class="id">_</span> ⦂ <span class="id">_</span> ⦿ ?σ1' ⤳… ?σ2',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> : <span class="id">_</span> ∙ ?σ2' ⤳ ?σ3' |- <span class="id">exists</span> <span class="id">_</span> : <span class="id">config</span>, <span class="id">_</span> /\ <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> σ3'; <span class="tactic">split</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">equiv_reduction_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Hred</span> : ?<span class="id">M</span> ∙ ?σ<span class="id">a</span> ⤳ ?σ<span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hconf</span> : <span class="id">config_equiv</span> ?σ<span class="id">a</span> ?σ<span class="id">a</span>' |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hred</span>' : <span class="id">_</span> ∙ σ<span class="id">a</span>' ⤳ ?σ<span class="id">b</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hconf</span>' : <span class="id">config_equiv</span> σ<span class="id">b</span> ?σ<span class="id">b</span>'|- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">idtac</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hred</span>' : <span class="id">_</span> ∙ σ<span class="id">a</span>' ⤳ ?σ<span class="id">b</span>' |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">config_equiv</span> σ<span class="id">b</span> σ<span class="id">b</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">equivalent_reduction</span> <span class="kwd">with</span> (<span class="id">M</span>:=<span class="id">M</span>)(σ1:=σ<span class="id">a</span>)(σ1':=σ<span class="id">a</span>'); <span class="tactic">auto</span>|]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [|- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> σ := <span class="tactic">fresh</span> "σ" <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">equivalent_reduction_exists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">M</span>:=<span class="id">M</span>)(σ1:=σ<span class="id">a</span>)(σ2:=σ<span class="id">b</span>)(σ1':=σ<span class="id">a</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [σ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">equiv_reductions_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Hred</span> : ?<span class="id">M1</span> ⦂ ?<span class="id">M2</span> ⦿ ?σ<span class="id">a</span> ⤳… ?σ<span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hconf</span> : <span class="id">config_equiv</span> ?σ<span class="id">a</span> ?σ<span class="id">a</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hlink</span> : ?<span class="id">M1</span> ⋄ ?<span class="id">M2</span> ≜ ?<span class="id">M</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hred</span>' :  <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ<span class="id">a</span>' ⤳… ?σ<span class="id">b</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hconf</span>' : <span class="id">config_equiv</span> σ<span class="id">b</span> ?σ<span class="id">b</span>' |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">idtac</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [|- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> σ := <span class="tactic">fresh</span> "σ" <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equivalent_reductions</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">M1</span>:=<span class="id">M1</span>)(<span class="id">M2</span>:=<span class="id">M2</span>)(<span class="id">M</span>:=<span class="id">M</span>)(σ1:=σ<span class="id">a</span>)(σ2:=σ<span class="id">b</span>)(σ1':=σ<span class="id">a</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [σ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_pair_reduction_exists</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ1', <span class="id">config_equiv</span> σ1 σ1' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> σ2', <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1' ⤳ σ2' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">config_equiv</span> σ2 σ2'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof257')">Proof.</div>
<div class="proofscript" id="proof257">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">link_unique_auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_reductions_auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_reduction_auto</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Inductive</span> <span class="id">reductions</span>' : <span class="id">mdl</span> -&gt; <span class="id">mdl</span> -&gt; <span class="id">config</span> -&gt; <span class="id">config</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">reds_single</span> : <span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">CDef</span> : <span class="id">classDef</span>, <span class="id">M1</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">reductions</span>' <span class="id">M1</span> <span class="id">M2</span> σ σ<br/>
| <span class="id">reds_trans</span> : <span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> <span class="id">M</span> σ1 σ2 σ3,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">reductions</span>' <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ2 ⤳ σ3 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ3 <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">CDef</span> : <span class="id">classDef</span>, <span class="id">M1</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">reductions</span>' <span class="id">M1</span> <span class="id">M2</span> σ1 σ3.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">reductions</span>'.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reductions_alt_1</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>, (<span class="id">exists</span> σ, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ1 ⤳ σ /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ1 <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> <span class="id">C</span> = <span class="id">None</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">CDef</span> : <span class="id">classDef</span>, <span class="id">M1</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">reductions</span>' <span class="id">M1</span> <span class="id">M2</span> σ σ2).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof258')">Proof.</div>
<div class="proofscript" id="proof258">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="id">exists</span> σ'; <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="id">link_unique_auto</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">IH</span> : <span class="kwd">forall</span> <span class="id">M</span>, <span class="id">exists</span> σ', ?<span class="id">M1</span> ⋄ ?<span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ ?σ1 ⤳ σ' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span>', <span class="id">classOf</span> <span class="id">this</span> ?σ1 <span class="id">C</span>' -&gt; ?<span class="id">M1</span> <span class="id">C</span>' = <span class="id">None</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ' <span class="id">C</span> -&gt; <span class="id">exists</span> <span class="id">CDef</span>, ?<span class="id">M1</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">reductions</span>' ?<span class="id">M1</span> ?<span class="id">M2</span> σ' ?σ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hlink</span> : ?<span class="id">M1</span> ⋄ ?<span class="id">M2</span> ≜ ?<span class="id">M</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> σ0 := <span class="tactic">fresh</span> "σ" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">H</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IH</span> <span class="id">M</span>) <span class="kwd">as</span> [σ0 <span class="id">H</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H</span> <span class="id">Hlink</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">link_unique_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">reductions_alt_2</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> <span class="id">M</span> σ1 σ2 σ, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ1 ⤳ σ /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ1 <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> <span class="id">C</span> = <span class="id">None</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">CDef</span> : <span class="id">classDef</span>, <span class="id">M1</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">reductions</span>' <span class="id">M1</span> <span class="id">M2</span> σ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof259')">Proof.</div>
<div class="proofscript" id="proof259">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> <span class="id">M</span> σ1 σ2 σ <span class="id">Hred</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Hred</span> : <span class="id">reductions</span>' <span class="id">M1</span> <span class="id">M2</span> ?σ<span class="id">a</span> ?σ<span class="id">b</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reduction_unique</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ2', <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2 = σ2'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof260')">Proof.</div>
<div class="proofscript" id="proof260">
Admitted.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">equiv_pair_reduction_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Hred</span> : ?<span class="id">M1</span> ⦂ ?<span class="id">M2</span> ⦿ ?σ<span class="id">a</span> ⤳ ?σ<span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hconf</span> : <span class="id">config_equiv</span> ?σ<span class="id">a</span> ?σ<span class="id">a</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hlink</span> : ?<span class="id">M1</span> ⋄ ?<span class="id">M2</span> ≜ ?<span class="id">M</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Hred</span>' :  <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ<span class="id">a</span>' ⤳ ?σ<span class="id">b</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hconf</span>' : <span class="id">config_equiv</span> σ<span class="id">b</span> ?σ<span class="id">b</span>' |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">idtac</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [|- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> σ := <span class="tactic">fresh</span> "σ" <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equivalent_pair_reduction_exists</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">M1</span>:=<span class="id">M1</span>)(<span class="id">M2</span>:=<span class="id">M2</span>)(<span class="id">M</span>:=<span class="id">M</span>)(σ1:=σ<span class="id">a</span>)(σ2:=σ<span class="id">b</span>)(σ1':=σ<span class="id">a</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [σ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">reduction_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Hred1</span> : ?<span class="id">M</span> ∙ ?σ ⤳ ?σ<span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hred2</span> : ?<span class="id">M</span> ∙ ?σ ⤳ ?σ<span class="id">b</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">reduction_unique</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ2:=σ<span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span> <span class="id">Hred2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span><br/>
&nbsp;&nbsp;| [<span class="id">Hred1</span> : ?<span class="id">M1</span> ⦂ ?<span class="id">M2</span> ⦿ ?σ ⤳ ?σ<span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hred2</span> : ?<span class="id">M1</span> ⦂ ?<span class="id">M2</span> ⦿ ?σ ⤳ ?σ<span class="id">b</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pair_reduction_unique</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ2:=σ<span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span> <span class="id">Hred2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_pair_reduction</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ1', <span class="id">config_equiv</span> σ1 σ1' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ2', <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1' ⤳ σ2' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">config_equiv</span> σ2 σ2'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof261')">Proof.</div>
<div class="proofscript" id="proof261">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">equiv_pair_reduction_auto</span>.<br/>
&nbsp;&nbsp;<span class="id">reduction_auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Inductive</span> <span class="id">list_equiv</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span> -&gt; <span class="id">list</span> <span class="id">var</span> -&gt; <span class="id">list</span> <span class="id">var</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">eql_nil</span> : <span class="kwd">forall</span> <span class="id">f</span>, <span class="id">list_equiv</span> <span class="id">f</span> <span class="id">nil</span> <span class="id">nil</span><br/>
| <span class="id">eql_cons</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">x</span> <span class="id">y</span> <span class="id">l1</span> <span class="id">l2</span>, <span class="id">f</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">list_equiv</span> <span class="id">f</span> <span class="id">l1</span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">list_equiv</span> <span class="id">f</span> (<span class="id">x</span>::<span class="id">l1</span>) (<span class="id">y</span>::<span class="id">l2</span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">varSet_equiv</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span> -&gt; <span class="id">varSet</span> -&gt; <span class="id">varSet</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">eq_set_hole</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">n</span>, <span class="id">varSet_equiv</span> <span class="id">f</span> (<span class="id">s_hole</span> <span class="id">n</span>) (<span class="id">s_hole</span> <span class="id">n</span>)<br/>
| <span class="id">eq_set_bind</span> : <span class="kwd">forall</span> <span class="id">f</span> Σ1 Σ2, <span class="id">list_equiv</span> <span class="id">f</span> Σ1 Σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">varSet_equiv</span> <span class="id">f</span> (<span class="id">s_bind</span> Σ1) (<span class="id">s_bind</span> Σ2).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">avar_equiv</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span> -&gt; <span class="id">a_var</span> -&gt; <span class="id">a_var</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">eqa_hole</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">n</span>, <span class="id">avar_equiv</span> <span class="id">f</span> (<span class="id">a_hole</span> <span class="id">n</span>) (<span class="id">a_hole</span> <span class="id">n</span>)<br/>
| <span class="id">eqa_bind</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">f</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">avar_equiv</span> <span class="id">f</span> (<span class="id">a_bind</span> <span class="id">x</span>) (<span class="id">a_bind</span> <span class="id">y</span>).<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">avar_equiv_unfold</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">avar_equiv</span> <span class="id">_</span> (<span class="id">a_hole</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">avar_equiv</span> <span class="id">_</span> (<span class="id">a_bind</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">rename_avar</span> (<span class="id">f</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">a_bind</span> <span class="id">x</span> =&gt; <span class="kwd">match</span> (<span class="id">f</span> <span class="id">x</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">y</span> =&gt; <span class="id">Some</span> (<span class="id">a_bind</span> <span class="id">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">Some</span> <span class="id">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">Some</span> <span class="id">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">asrt_equiv</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span> -&gt; <span class="id">asrt</span> -&gt; <span class="id">asrt</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">eqa_exp</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span>, <span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_exp</span> <span class="id">e1</span>) (<span class="id">a_exp</span> <span class="id">e2</span>)<br/>
| <span class="id">eqa_eq</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e1</span>' <span class="id">e2</span> <span class="id">e2</span>', <span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">e1</span>' <span class="id">e2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_eq</span> <span class="id">e1</span> <span class="id">e1</span>') (<span class="id">a_eq</span> <span class="id">e2</span> <span class="id">e2</span>')<br/>
| <span class="id">eqa_class</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">C</span>, <span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_class</span> <span class="id">e1</span> <span class="id">C</span>) (<span class="id">a_class</span> <span class="id">e2</span> <span class="id">C</span>)<br/>
| <span class="id">eqa_set</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span> Σ1 Σ2, <span class="id">exp_equiv</span> <span class="id">f</span> <span class="id">e1</span> <span class="id">e2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">varSet_equiv</span> <span class="id">f</span> Σ1 Σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_set</span> <span class="id">e1</span> Σ1) (<span class="id">a_set</span> <span class="id">e2</span> Σ2)<br/>
| <span class="id">eqa_arr</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A1</span>' <span class="id">A2</span> <span class="id">A2</span>', <span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span>' <span class="id">A2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_arr</span> <span class="id">A1</span> <span class="id">A1</span>') (<span class="id">a_arr</span> <span class="id">A2</span> <span class="id">A2</span>')<br/>
| <span class="id">eqa_and</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A1</span>' <span class="id">A2</span> <span class="id">A2</span>', <span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span>' <span class="id">A2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_and</span> <span class="id">A1</span> <span class="id">A1</span>') (<span class="id">a_and</span> <span class="id">A2</span> <span class="id">A2</span>')<br/>
| <span class="id">eqa_or</span> : <span class="kwd">forall</span>  <span class="id">f</span> <span class="id">A1</span> <span class="id">A1</span>' <span class="id">A2</span> <span class="id">A2</span>', <span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span>' <span class="id">A2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_or</span> <span class="id">A1</span> <span class="id">A1</span>') (<span class="id">a_or</span> <span class="id">A2</span> <span class="id">A2</span>')<br/>
| <span class="id">eqa_neg</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span>, <span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_neg</span> <span class="id">A1</span>) (<span class="id">a_neg</span> <span class="id">A2</span>)<br/>
| <span class="id">eqa_all_x</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span>, <span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_all_x</span> <span class="id">A1</span>) (<span class="id">a_all_x</span> <span class="id">A2</span>)<br/>
| <span class="id">eqa_all_</span>Σ : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span>, <span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_all_</span>Σ <span class="id">A1</span>) (<span class="id">a_all_</span>Σ <span class="id">A2</span>)<br/>
| <span class="id">eqa_ex_x</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span>, <span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_ex_x</span> <span class="id">A1</span>) (<span class="id">a_ex_x</span> <span class="id">A2</span>)<br/>
| <span class="id">eqa_ex_</span>Σ : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span>, <span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_ex_</span>Σ <span class="id">A1</span>) (<span class="id">a_ex_</span>Σ <span class="id">A2</span>)<br/>
| <span class="id">eqa_acc</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">y1</span> <span class="id">x2</span> <span class="id">y2</span>, <span class="id">avar_equiv</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">avar_equiv</span> <span class="id">f</span> <span class="id">y1</span> <span class="id">y2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_acc</span> <span class="id">x1</span> <span class="id">y1</span>) (<span class="id">a_acc</span> <span class="id">x2</span> <span class="id">y2</span>)<br/>
| <span class="id">eqa_call</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">x2</span> <span class="id">y1</span> <span class="id">y2</span> <span class="id">m</span> <span class="id">ps1</span> <span class="id">ps2</span>, <span class="id">avar_equiv</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">avar_equiv</span> <span class="id">f</span> <span class="id">y1</span> <span class="id">y2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">p</span> <span class="id">x</span>, <span class="id">ps1</span> <span class="id">p</span> = <span class="id">Some</span> (<span class="id">a_bind</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">y</span>, <span class="id">f</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">y</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ps2</span> = (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">bind</span> (<span class="id">ps1</span> <span class="id">x</span>) (<span class="id">rename_avar</span> <span class="id">f</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_call</span> <span class="id">x1</span> <span class="id">y1</span> <span class="id">m</span> <span class="id">ps1</span>) (<span class="id">a_call</span> <span class="id">x2</span> <span class="id">y2</span> <span class="id">m</span> <span class="id">ps2</span>)<br/>
<br/>
| <span class="id">eqa_next</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span>, <span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_next</span> <span class="id">A1</span>) (<span class="id">a_next</span> <span class="id">A2</span>)<br/>
<br/>
| <span class="id">eqa_will</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span>, <span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_will</span> <span class="id">A1</span>) (<span class="id">a_will</span> <span class="id">A2</span>)<br/>
<br/>
| <span class="id">eqa_prev</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span>, <span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_prev</span> <span class="id">A1</span>) (<span class="id">a_prev</span> <span class="id">A2</span>)<br/>
<br/>
| <span class="id">eqa_was</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span>, <span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_was</span> <span class="id">A1</span>) (<span class="id">a_was</span> <span class="id">A2</span>)<br/>
<br/>
| <span class="id">eqa_in</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> Σ1 Σ2, <span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">varSet_equiv</span> <span class="id">f</span> Σ1 Σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_in</span> <span class="id">A1</span> Σ1) (<span class="id">a_in</span> <span class="id">A2</span> Σ2)<br/>
| <span class="id">eqa_extrn</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">x2</span>, <span class="id">avar_equiv</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_extrn</span> <span class="id">x1</span>) (<span class="id">a_extrn</span> <span class="id">x2</span>)<br/>
| <span class="id">eqa_intrn</span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">x2</span>, <span class="id">avar_equiv</span> <span class="id">f</span> <span class="id">x1</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> (<span class="id">a_intrn</span> <span class="id">x1</span>) (<span class="id">a_intrn</span> <span class="id">x2</span>).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">asrt_equiv</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">asrt_equiv_unfold</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> ?<span class="id">f</span> (<span class="id">a_exp</span> ?<span class="id">e</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_eq</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_class</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_set</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
<br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_arr</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_and</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_or</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_neg</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
<br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> ?<span class="id">f</span> (<span class="id">a_all_x</span> ?<span class="id">A</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_all_</span>Σ <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_ex_x</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_ex_</span>Σ <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
<br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_acc</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_call</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
<br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_next</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_will</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_prev</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_was</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
<br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_in</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_extrn</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">asrt_equiv</span> <span class="id">_</span> (<span class="id">a_intrn</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">varSet_equiv_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">list_equiv</span> <span class="id">_</span> <span class="id">nil</span> ?<span class="id">l</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">list_equiv</span> <span class="id">_</span> (?<span class="id">x</span>::?<span class="id">l1</span>) ?<span class="id">l2</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">varSet_equiv</span> ?<span class="id">f</span> (<span class="id">s_bind</span> ?Σ1) ?Σ2 |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">varSet_equiv</span> ?<span class="id">f</span> (<span class="id">s_hole</span> ?<span class="id">n1</span>) ?Σ |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">sat_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [|- ?<span class="id">M1</span> ⦂ ?<span class="id">M2</span> ◎ ?σ ⊨ (<span class="id">a_exp</span> <span class="id">_</span>)] =&gt; <span class="tactic">eapply</span> <span class="id">sat_exp</span><br/>
&nbsp;&nbsp;| [<span class="id">H1</span> : <span class="id">exp_equiv</span> ?<span class="id">f</span> ?<span class="id">e1</span> ?<span class="id">e1</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">exp_equiv</span> ?<span class="id">f</span> ?<span class="id">e2</span> ?<span class="id">e2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Heval1</span> : ?<span class="id">M</span> ∙ ?σ ⊢ ?<span class="id">e1</span> ↪ ?<span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Heval2</span> : ?<span class="id">M</span> ∙ ?σ ⊢ ?<span class="id">e2</span> ↪ ?<span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">_</span> ⦂ <span class="id">_</span> ◎ <span class="id">_</span> ⊨ (<span class="id">a_eq</span> ?<span class="id">e1</span>' ?<span class="id">e2</span>')] =&gt; <span class="tactic">eapply</span> <span class="id">sat_eq</span> <span class="kwd">with</span> (<span class="id">v</span>:=<span class="id">v</span>)<br/>
&nbsp;&nbsp;| [|- <span class="id">_</span> ⦂ <span class="id">_</span> ◎ <span class="id">_</span> ⊨ (<span class="id">a_eq</span> <span class="id">_</span> <span class="id">_</span>)] =&gt; <span class="tactic">eapply</span> <span class="id">sat_eq</span><br/>
&nbsp;&nbsp;| [|- <span class="id">_</span> ⦂ <span class="id">_</span> ◎ <span class="id">_</span> ⊨ (<span class="id">a_class</span> <span class="id">_</span> <span class="id">_</span>)] =&gt; <span class="tactic">eapply</span> <span class="id">sat_class</span><br/>
&nbsp;&nbsp;| [|- <span class="id">_</span> ⦂ <span class="id">_</span> ◎ <span class="id">_</span> ⊨ (<span class="id">a_set</span> <span class="id">_</span> <span class="id">_</span>)] =&gt; <span class="tactic">eapply</span> <span class="id">sat_set</span><br/>
<br/>
&nbsp;&nbsp;| [|- <span class="id">_</span> ⦂ <span class="id">_</span> ◎ <span class="id">_</span> ⊨ (<span class="id">a_and</span> <span class="id">_</span> <span class="id">_</span>)] =&gt; <span class="tactic">apply</span> <span class="id">sat_and</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : ?<span class="id">M1</span> ⦂ ?<span class="id">M2</span> ◎ ?σ ⊨ ?<span class="id">A</span> |- <span class="id">_</span> ⦂ <span class="id">_</span> ◎ ?σ ⊨ (<span class="id">a_or</span> ?<span class="id">A</span> <span class="id">_</span>)] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sat_or1</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : ?<span class="id">M1</span> ⦂ ?<span class="id">M2</span> ◎ ?σ ⊨ ?<span class="id">A</span> |- <span class="id">_</span> ⦂ <span class="id">_</span> ◎ ?σ ⊨ (<span class="id">a_or</span> <span class="id">_</span> ?<span class="id">A</span>)] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">sat_or2</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : ?<span class="id">M1</span> ⦂ ?<span class="id">M2</span> ◎ ?σ ⊨ ?<span class="id">A</span> |- <span class="id">_</span> ⦂ <span class="id">_</span> ◎ ?σ ⊨ (<span class="id">a_arr</span> <span class="id">_</span> ?<span class="id">A</span>)] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sat_arr1</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : ?<span class="id">M1</span> ⦂ ?<span class="id">M2</span> ◎ ?σ ⊭ ?<span class="id">A</span> |- <span class="id">_</span> ⦂ <span class="id">_</span> ◎ ?σ ⊨ (<span class="id">a_arr</span> ?<span class="id">A</span> <span class="id">_</span>)] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">sat_arr2</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">eval_equiv_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : ?<span class="id">M</span> ∙ (?χ, ?ϕ::?ψ) ⊢ ?<span class="id">e1</span> ↪ ?<span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Heq</span> : <span class="id">exp_equiv</span> ?<span class="id">f</span> ?<span class="id">e1</span> ?<span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- ?<span class="id">M</span> ∙ (?χ, ?ϕ'::?ψ') ⊢ ?<span class="id">e2</span> ↪ ?<span class="id">v</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">equivalent_evaluation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (σ:=(χ, ϕ::ψ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">e</span>:=<span class="id">e1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_interpretation_</span>Σ :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> Σ χ ϕ ψ <span class="id">As</span>, ⌊ Σ ⌋ (χ, ϕ::ψ) ≜′ <span class="id">As</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> Σ' ϕ' ψ', <span class="id">list_equiv</span> <span class="id">f</span> Σ Σ' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">frame_equiv</span> <span class="id">f</span> ϕ ϕ' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊ Σ' ⌋ (χ, ϕ'::ψ') ≜′ <span class="id">As</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof262')">Proof.</div>
<div class="proofscript" id="proof262">
&nbsp;&nbsp;<span class="tactic">intros</span> Σ χ ϕ ψ <span class="id">As</span> <span class="kwd">Hint</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (χ, ϕ::ψ) <span class="kwd">as</span> σ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> χ, ϕ, ψ, <span class="id">Heq</span>σ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heq</span>σ χ ϕ ψ;  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="kwd">Hint</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> χ ϕ ψ <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">f</span> Σ' ϕ' ψ';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="id">varSet_equiv_auto</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">varSet_equiv_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">int_cons</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">link_exists</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">M</span>, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof263')">Proof.</div>
<div class="proofscript" id="proof263">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">bind_empty</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">B</span> `{<span class="id">Eq</span> <span class="id">A</span>} (<span class="id">m</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">B</span>), (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">bind</span> (<span class="id">empty</span> <span class="id">x</span>) <span class="id">m</span>) = <span class="id">empty</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof264')">Proof.</div>
<div class="proofscript" id="proof264">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">HeqA</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">functional_extensionality</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">a</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">bind_empty</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">bind_empty</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">extend_empty</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">B</span> `{<span class="id">Eq</span> <span class="id">A</span>} (<span class="id">m</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">B</span>), <span class="id">extend</span> <span class="id">empty</span> <span class="id">m</span> = <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof265')">Proof.</div>
<div class="proofscript" id="proof265">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">HeqA</span> <span class="id">m</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">functional_extensionality</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">a</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">extend_empty</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">extend_empty</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">partial_map_dec_alt</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">B</span> `{<span class="id">Eq</span> <span class="id">A</span>} (<span class="id">m</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">B</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">m</span> = <span class="id">empty</span>} + {<span class="id">exists</span> <span class="id">a</span> <span class="id">b</span>, <span class="id">m</span> <span class="id">a</span> = <span class="id">Some</span> <span class="id">b</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof266')">Proof.</div>
<div class="proofscript" id="proof266">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">H</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">exists</span> <span class="id">a</span> <span class="id">b</span>, <span class="id">m</span> <span class="id">a</span> = <span class="id">Some</span> <span class="id">b</span>) <span class="kwd">as</span> <span class="id">P</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">excluded_middle</span> <span class="id">P</span>); <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">functional_extensionality</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">exists_neg_forall</span> <span class="kwd">with</span> (<span class="id">a</span>:=<span class="id">a</span>) <span class="kwd">in</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">not_some_implies_none</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hcontra</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">n</span>; <span class="id">eexists</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Parameter</span> <span class="id">equivalence_preserves_finiteness</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">m1</span> <span class="id">m2</span>, <span class="id">map_equiv</span> <span class="id">f</span> <span class="id">m1</span> <span class="id">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite</span> <span class="id">m1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite</span> <span class="id">m2</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalence_preserves_not_stuck</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">c1</span> <span class="id">c2</span>, <span class="id">contn_equiv</span> <span class="id">f</span> <span class="id">c1</span> <span class="id">c2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck</span> <span class="id">c1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck</span> <span class="id">c2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof267')">Proof.</div>
<div class="proofscript" id="proof267">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">f</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">Heq</span> <span class="id">Hns</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">c1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">equiv_unfold</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hns</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_adaptation_exists</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ1 σ2 σ, σ1 ◁ σ2 ≜ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_</span>σ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> χ1 ϕ1 ψ1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ2 ϕ2 ψ2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ϕ ψ, σ1 = (χ1, ϕ1::ψ1) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2 = (χ2, ϕ2::ψ2) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ = (χ2, ϕ::ψ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f1</span> ϕ1' ψ1'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f2</span> ϕ2' ψ2', <span class="id">frame_equiv</span> <span class="id">f1</span> ϕ1 ϕ1' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">frame_equiv</span> <span class="id">f2</span> ϕ2 ϕ2' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">f</span> <span class="id">f</span>' ϕ' ψ', (χ1, ϕ1'::ψ1') ◁ (χ2, ϕ2'::ψ2') ≜ (χ2, ϕ'::ψ') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">frame_equiv</span> <span class="id">f</span> ϕ ϕ2 /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">frame_equiv</span> <span class="id">f</span>' ϕ2' ϕ' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">frame_equiv</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">bind</span> ((<span class="kwd">fun</span> <span class="id">y</span> =&gt; <span class="id">bind</span> (<span class="id">f</span> <span class="id">y</span>) <span class="id">f2</span>) <span class="id">x</span>) <span class="id">f</span>') ϕ ϕ'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof268')">Proof.</div>
<div class="proofscript" id="proof268">
&nbsp;&nbsp;<span class="tactic">intros</span> σ1 σ2 σ <span class="id">Hadapt</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hadapt</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<br/>
<span class="comment">(*&nbsp;&nbsp;intros&nbsp;σ1&nbsp;σ2&nbsp;σ&nbsp;Hadapt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hadapt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros.<br/>
&nbsp;&nbsp;repeat&nbsp;equiv_unfold.<br/>
&nbsp;&nbsp;destruct&nbsp;adaptation_exists<br/>
&nbsp;&nbsp;&nbsp;&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ1:=(χ,&nbsp;ϕ0::ψ3))(χ1:=χ)(ϕ1:=ϕ0)(ψ1:=ψ3)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ2:=(χ',&nbsp;ϕ2::ψ0))(χ2:=χ')(ϕ2:=ϕ2)(ψ2:=ψ0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;[σ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;apply&nbsp;equivalence_preserves_finiteness<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(f:=f1)(m1:=β);&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;apply&nbsp;equivalence_preserves_finiteness<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(f:=f0)(m1:=β');&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;finite_auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(Hrewrite&nbsp;:&nbsp;β'&nbsp;=&nbsp;vMap&nbsp;(frm&nbsp;β'&nbsp;(c_stmt&nbsp;s)));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[auto|rewrite&nbsp;Hrewrite].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;H;&nbsp;simpl;&nbsp;eauto.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;[H&nbsp;:&nbsp;frame_equiv&nbsp;?f'&nbsp;?ϕ'&nbsp;?ϕ&nbsp;|-&nbsp;not_stuck_ϕ&nbsp;?ϕ]&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;equivalence_preserves_not_stuck&nbsp;with&nbsp;(f:=f');&nbsp;eauto;&nbsp;crush<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
&nbsp;&nbsp;-&nbsp;exists&nbsp;σ;&nbsp;split;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H2;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;[H&nbsp;:&nbsp;(_,_)&nbsp;=&nbsp;(_,_)|-_]&nbsp;=&gt;&nbsp;inversion&nbsp;H;&nbsp;subst;&nbsp;clear&nbsp;H<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;eq_conf.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;H1;&nbsp;subst;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;equiv_unfold.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(Htmp&nbsp;:&nbsp;exists&nbsp;f',&nbsp;inv&nbsp;f&nbsp;f');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[admit|destruct&nbsp;Htmp&nbsp;as&nbsp;[f']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;eq_cons&nbsp;with&nbsp;(f:=(fun&nbsp;x&nbsp;=&gt;&nbsp;bind&nbsp;(f'&nbsp;x)&nbsp;f2));&nbsp;auto.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;<br/>
<br/>
Admitted.</div>
<br/>
&nbsp;&nbsp;<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivalent_satisfaction</span> :<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 <span class="id">A1</span>,  <span class="id">M1</span> ⦂ <span class="id">M2</span> ◎ σ1 ⊨ <span class="id">A1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> χ ϕ1 ψ1,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1 = (χ, ϕ1::ψ1) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">A2</span> ϕ2 ψ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">frame_equiv</span> <span class="id">f</span> ϕ1 ϕ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stack_equiv</span> ψ1 ψ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⦂ <span class="id">M2</span> ◎ (χ, ϕ2::ψ2) ⊨ <span class="id">A2</span>) /\<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 <span class="id">A1</span>,  <span class="id">M1</span> ⦂ <span class="id">M2</span> ◎ σ1 ⊭ <span class="id">A1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> χ ϕ1 ψ1,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1 = (χ, ϕ1::ψ1) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">A2</span> ϕ2 ψ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">asrt_equiv</span> <span class="id">f</span> <span class="id">A1</span> <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">frame_equiv</span> <span class="id">f</span> ϕ1 ϕ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stack_equiv</span> ψ1 ψ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⦂ <span class="id">M2</span> ◎ (χ, ϕ2::ψ2) ⊭ <span class="id">A2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof269')">Proof.</div>
<div class="proofscript" id="proof269">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sat_mutind</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">equiv_unfold</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">asrt_equiv_unfold</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">sat_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">eval_equiv_auto</span>].<br/>
<br/>
&nbsp;&nbsp;- <span class="id">varSet_equiv_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sat_auto</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eval_equiv_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">equivalent_interpretation_</span>Σ; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">sat_all_x</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">mapp</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">configMapStack</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">mapp</span>, <span class="id">stackMap</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H11</span> <span class="id">y</span> <span class="id">v</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hex</span> : <span class="id">exists</span> <span class="id">z</span>', <span class="id">fresh_x</span> <span class="id">z</span>' (χ, ϕ1::ψ1) <span class="id">A</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">admit</span>|<span class="tactic">destruct</span> <span class="id">Hex</span> <span class="kwd">as</span> [<span class="id">z</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">M</span>:=<span class="id">M</span>)(<span class="id">y</span>:=<span class="id">x</span>)(<span class="id">v</span>:=<span class="id">v</span>)(<span class="id">z</span>:=<span class="id">z</span>')(ϕ2:=<span class="id">update_</span>ϕ<span class="id">_map</span> ϕ1 <span class="id">z</span>' <span class="id">v</span>)(ψ2:=ψ1)(<span class="id">f0</span>:=<span class="id">update</span> <span class="id">z</span> <span class="id">z</span>' <span class="id">f</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">admit</span>. <span class="comment">(*&nbsp;substitution&nbsp;preserves&nbsp;equivalence&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">admit</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">sat_ex_x</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">admit</span>. <span class="comment">(*&nbsp;substitution&nbsp;preserves&nbsp;equivalence&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;- <span class="id">admit</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="id">admit</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">avar_equiv_unfold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sat_access1</span> <span class="kwd">with</span> (α:=α); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">y</span>); <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">avar_equiv_unfold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">sat_access2</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">avar_equiv_unfold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>)|- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H6</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">e0</span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">inversion</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">sat_access3</span> <span class="kwd">with</span> (α1:=α1)(α2:=α2)(ϕ:=ϕ2)(ψ:=ψ2)(χ:=χ0)(<span class="id">s</span>:=<span class="id">s2</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">x</span>)(<span class="id">f</span>:=<span class="id">f</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">this</span>)(<span class="id">f</span>:=<span class="id">f</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H8</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">y</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">admit</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">avar_equiv_unfold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">admit</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">avar_equiv_unfold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">sat_extrn</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">avar_equiv_unfold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">sat_intrn</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">equivalent_interpretation_x</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">varSet_equiv_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">sat_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">admit</span>. <span class="comment">(*&nbsp;restriction&nbsp;equivalence&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">admit</span>. <span class="comment">(*&nbsp;apply&nbsp;induction&nbsp;hyp&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">equivalent_pair_reduction_exists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">M</span>:=<span class="id">M</span>)(<span class="id">M1</span>:=<span class="id">M1</span>)(<span class="id">M2</span>:=<span class="id">M2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ1:=(χ0, ϕ1::<span class="id">nil</span>))(σ2:=σ')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ1':=(χ0, ϕ2::<span class="id">nil</span>)) <span class="kwd">as</span> [σ2'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">a</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : (<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>) |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*simpl&nbsp;in&nbsp;*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;someσ:=&nbsp;fresh&nbsp;"σ"&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;equivalent_adaptation_exists<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(σ1:=(χ,&nbsp;{|&nbsp;vMap&nbsp;:=&nbsp;β;&nbsp;contn&nbsp;:=&nbsp;c&nbsp;|}::nil))(σ2:=σ')(σ:=σ'')(σ1':=(χ0,&nbsp;ϕ2::nil))(σ2':=σ2')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[someσ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;andDestruct.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;admit.&nbsp;<span class="comment">(*&nbsp;adaptation&nbsp;ignores&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;stack&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;admit.&nbsp;<span class="comment">(*&nbsp;reduction&nbsp;preserves&nbsp;finiteness&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;eapply&nbsp;eq_conf,&nbsp;eq_cons;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;apply&nbsp;sat_next&nbsp;with&nbsp;(ϕ:=ϕ2)(ψ:=ψ2)(χ:=χ0)(σ':=σ2')(σ'':=σ);&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;admit.&nbsp;<span class="comment">(*&nbsp;adaptation&nbsp;ignores&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;stack&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Ha0;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;Hb0;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H16;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;a;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;[H&nbsp;:&nbsp;(_,&nbsp;_)&nbsp;=&nbsp;(_,&nbsp;_)&nbsp;|-&nbsp;_]&nbsp;=&gt;&nbsp;inversion&nbsp;H;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;goal&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;[H&nbsp;:&nbsp;(_,&nbsp;_)&nbsp;=&nbsp;(_,&nbsp;_)&nbsp;|-&nbsp;_]&nbsp;=&gt;&nbsp;inversion&nbsp;H;&nbsp;subst<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inversion&nbsp;H4;&nbsp;subst.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;H<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;(M:=M)(f:=f1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ϕ1:={|&nbsp;vMap&nbsp;:=&nbsp;extend&nbsp;(fun&nbsp;x&nbsp;:&nbsp;var&nbsp;=&gt;&nbsp;bind&nbsp;(f2&nbsp;x)&nbsp;β'0)&nbsp;β0;&nbsp;contn&nbsp;:=&nbsp;c_stmt&nbsp;(❲&nbsp;f2&nbsp;↦&nbsp;s1&nbsp;❳)&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ψ1:=ψ3);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;H7.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;(equiv_unfold;&nbsp;simpl&nbsp;in&nbsp;*;&nbsp;subst).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(f3&nbsp;=&nbsp;f1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[admit|subst&nbsp;f3].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;(f4&nbsp;=&nbsp;f1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[admit|subst&nbsp;f4].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;admit.&nbsp;<span class="comment">(*&nbsp;all&nbsp;&nbsp;*)</span>*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
Admitted.</div>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
