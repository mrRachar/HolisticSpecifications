
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module fundamental_properties</title>
<meta name="description" content="Documentation of Coq module fundamental_properties" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module fundamental_properties</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">common</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">loo_def</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">chainmail</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">function_operations</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">CpdtTactics</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coq.Logic.FunctionalExtensionality</span>.<br/>
<br/>
<div class="doc"><h1> Basic Arithmetic Assertions: </h1> </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">prop_not_and_distr</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">B</span>, ~(<span class="id">A</span> /\ <span class="id">B</span>) -&gt; ~<span class="id">A</span> \/ ~<span class="id">B</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof67')">Proof.</div>
<div class="proofscript" id="proof67">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">excluded_middle</span> <span class="id">A</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">excluded_middle</span> <span class="id">B</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">prop_implies_not</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Prop</span>), (<span class="id">A</span> -&gt; ~<span class="id">B</span>) -&gt; (<span class="id">B</span> -&gt; ~<span class="id">A</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof68')">Proof.</div>
<div class="proofscript" id="proof68">
&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">prop_not_sat_and_distr</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ <span class="id">A1</span> <span class="id">A2</span>, ~<span class="id">M1</span> ⦂ <span class="id">M2</span> ◎ σ ⊨ (<span class="id">a_and</span> <span class="id">A1</span> <span class="id">A2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(~<span class="id">M1</span> ⦂ <span class="id">M2</span> ◎ σ ⊨ <span class="id">A1</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(~ <span class="id">M1</span> ⦂ <span class="id">M2</span> ◎ σ ⊨ <span class="id">A2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof69')">Proof.</div>
<div class="proofscript" id="proof69">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">prop_not_and_distr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hcontra</span> <span class="kwd">as</span> [<span class="id">Ha</span> <span class="id">Hb</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">forall_exists_neg</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>} <span class="id">P</span>, (<span class="kwd">forall</span> (<span class="id">x</span> : <span class="id">A</span>), ~ <span class="id">P</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id">exists</span> (<span class="id">a</span> : <span class="id">A</span>), <span class="id">P</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof70')">Proof.</div>
<div class="proofscript" id="proof70">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">exists_neg_forall</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id">exists</span> (<span class="id">a</span> : <span class="id">A</span>), <span class="id">P</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">a</span> : <span class="id">A</span>), ~ <span class="id">P</span> <span class="id">a</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof71')">Proof.</div>
<div class="proofscript" id="proof71">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">Hcontra</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">a</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">reduction_preserves_well_formed_heap</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> σ1 σ2, <span class="id">M</span> ∙ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ<span class="id">_wf</span> <span class="id">M</span> (<span class="id">fst</span> σ1) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ<span class="id">_wf</span> <span class="id">M</span> (<span class="id">fst</span> σ2).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof72')">Proof.</div>
<div class="proofscript" id="proof72">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">crush</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">heap_wf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*field&nbsp;assign&nbsp;reduce*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> α0 α) <span class="kwd">as</span> [<span class="id">Heq</span>|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id">eqb_refl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">apply</span> <span class="id">neq_eqb</span> <span class="kwd">in</span> <span class="id">Hneq</span>; <span class="tactic">rewrite</span> <span class="id">Hneq</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H11</span>; <span class="tactic">subst</span>; <span class="tactic">apply</span> (<span class="id">H7</span> α0); <span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H11</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H7</span> α <span class="id">o</span> (<span class="id">cname</span> <span class="id">o</span>)) <span class="kwd">as</span> [<span class="id">CDef</span> <span class="id">Hwf</span>]; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwf</span> <span class="kwd">as</span> [<span class="id">Hwf1</span> <span class="id">Hwf2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwf2</span> <span class="kwd">as</span> [<span class="id">Hwf2</span> <span class="id">Hwf3</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">CDef</span>; <span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">f0</span> <span class="id">f</span>) <span class="kwd">as</span> [<span class="id">Heq</span>|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">destruct</span> <span class="id">f0</span>; <span class="tactic">subst</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">beq_nat_refl</span>; <span class="id">exists</span> <span class="id">v</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">destruct</span> <span class="id">f0</span>, <span class="id">f</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hneq</span>' : <span class="id">n</span> &lt;&gt; <span class="id">n0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span> <span class="id">Hcontra</span>; <span class="tactic">subst</span>; <span class="id">crush</span>| <span class="tactic">apply</span> <span class="id">Nat.eqb_neq</span> <span class="kwd">in</span> <span class="id">Hneq</span>'; <span class="tactic">rewrite</span> <span class="id">Hneq</span>'; <span class="tactic">auto</span>]].<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*new&nbsp;object&nbsp;initialization*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> α0 α) <span class="kwd">as</span> [<span class="id">Heq</span>|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id">eqb_refl</span> <span class="kwd">in</span> <span class="id">H0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">apply</span> <span class="id">neq_eqb</span> <span class="kwd">in</span> <span class="id">Hneq</span>; <span class="tactic">rewrite</span> <span class="id">Hneq</span> <span class="kwd">in</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H9</span>; <span class="tactic">subst</span>; <span class="tactic">apply</span> (<span class="id">H6</span> α0); <span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">CDef</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hin</span> : <span class="id">fMap</span> <span class="id">f</span> = <span class="id">None</span> -&gt; ~ <span class="id">In</span> <span class="id">f</span> (<span class="id">c_flds</span> <span class="id">CDef</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">not_in_map_implies_not_in_dom</span> <span class="kwd">with</span> (<span class="id">m</span>:=<span class="id">fMap</span>); <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">fMap</span> <span class="id">f</span>) <span class="kwd">as</span> <span class="id">res</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">res</span> <span class="kwd">as</span> [<span class="id">y</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id">contradiction</span> <span class="id">Hin</span>; <span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H5</span> <span class="id">f</span> <span class="id">y</span>) <span class="kwd">as</span> [<span class="id">v</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">linking_unique</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> <span class="id">M</span>, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>', <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span>' = <span class="id">M</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof73')">Proof.</div>
<div class="proofscript" id="proof73">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> <span class="id">M</span> <span class="id">Hlink1</span> <span class="id">M</span>' <span class="id">Hlink2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hlink1</span>; <span class="tactic">inversion</span> <span class="id">Hlink2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">link_unique_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H1</span> : ?<span class="id">M1</span> ⋄ ?<span class="id">M2</span> ≜ ?<span class="id">M</span>, <span class="id">H2</span> : ?<span class="id">M1</span> ⋄ ?<span class="id">M2</span> ≜ ?<span class="id">M</span>' |-<span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">M</span>' = <span class="id">M</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">eapply</span> <span class="id">linking_unique</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>|<span class="tactic">subst</span> <span class="id">M</span>']<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.  <br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">reduce_heap_wf_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Hred</span> : ?<span class="id">M</span> ∙ ?σ1 ⤳ ?σ2 |- χ<span class="id">_wf</span> ?<span class="id">M</span> (<span class="id">fst</span> ?σ2)] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">reduction_preserves_well_formed_heap</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reductions_preserves_heap_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ<span class="id">_wf</span> <span class="id">M</span> (<span class="id">fst</span> σ1) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ<span class="id">_wf</span> <span class="id">M</span> (<span class="id">fst</span> σ2).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof74')">Proof.</div>
<div class="proofscript" id="proof74">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">link_unique_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">reduce_heap_wf_auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">reduces_heap_wf_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Hred</span> : ?<span class="id">M1</span> ⦂ ?<span class="id">M2</span> ⦿ ?σ1 ⤳… ?σ2 |- χ<span class="id">_wf</span> ?<span class="id">M</span> (<span class="id">fst</span> ?σ2)] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">reductions_preserves_heap_wf</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reduction_preserves_heap_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ<span class="id">_wf</span> <span class="id">M</span> (<span class="id">fst</span> σ1) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ<span class="id">_wf</span> <span class="id">M</span> (<span class="id">fst</span> σ2).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof75')">Proof.</div>
<div class="proofscript" id="proof75">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">link_unique_auto</span>.<br/>
&nbsp;&nbsp;<span class="id">reduce_heap_wf_auto</span>.<br/>
&nbsp;&nbsp;<span class="id">reduces_heap_wf_auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">pair_reduce_heap_wf_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Hred</span> : ?<span class="id">M1</span> ⦂ ?<span class="id">M2</span> ⦿ ?σ1 ⤳ ?σ2 |- χ<span class="id">_wf</span> ?<span class="id">M</span> (<span class="id">fst</span> ?σ2)] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">pair_reduction_preserves_heap_wf</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reductions_preserves_heap_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳⋆ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ<span class="id">_wf</span> <span class="id">M</span> (<span class="id">fst</span> σ1) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ<span class="id">_wf</span> <span class="id">M</span> (<span class="id">fst</span> σ2).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof76')">Proof.</div>
<div class="proofscript" id="proof76">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> <span class="id">pair_reduce_heap_wf_auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHHred</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pair_reduce_heap_wf_auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">pair_reduces_heap_wf_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Hred</span> : ?<span class="id">M1</span> ⦂ ?<span class="id">M2</span> ⦿ ?σ1 ⤳⋆ ?σ2 |- χ<span class="id">_wf</span> ?<span class="id">M</span> (<span class="id">fst</span> ?σ2)] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">pair_reductions_preserves_heap_wf</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">M_wf_ObjectDefn</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>, <span class="id">M_wf</span> <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> <span class="id">ObjectName</span> = <span class="id">Some</span> <span class="id">ObjectDefn</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof77')">Proof.</div>
<div class="proofscript" id="proof77">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> <span class="id">Hwf</span>; <span class="tactic">inversion</span> <span class="id">Hwf</span>; <span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">obj_defn_rewrite</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">M_wf</span> ?<span class="id">M</span> |- <span class="id">context</span>[?<span class="id">M</span> <span class="id">ObjectName</span>]] =&gt; <span class="tactic">rewrite</span> (<span class="id">M_wf_ObjectDefn</span> <span class="id">M</span> <span class="id">H</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">initial_heap_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, <span class="id">initial</span> σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>, <span class="id">M_wf</span> <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ<span class="id">_wf</span> <span class="id">M</span> (<span class="id">fst</span> σ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof78')">Proof.</div>
<div class="proofscript" id="proof78">
&nbsp;&nbsp;<span class="tactic">intros</span> σ <span class="id">Hinit</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hinit</span> <span class="kwd">as</span> [α <span class="id">Hinit</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hinit</span> <span class="kwd">as</span> [ϕ <span class="id">Hinit</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">heap_wf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">update_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">exists</span> <span class="id">ObjectDefn</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">obj_defn_rewrite</span>; <span class="tactic">auto</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id">empty_auto</span>].<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">initial_heap_wf_auto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">initial</span> ?σ |- χ<span class="id">_wf</span> ?<span class="id">M</span> (<span class="id">fst</span> ?σ)] =&gt; <span class="tactic">eapply</span> <span class="id">initial_heap_wf</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">linked_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> <span class="id">M</span>, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof79')">Proof.</div>
<div class="proofscript" id="proof79">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> <span class="id">M</span> <span class="id">Hlink</span> <span class="id">Hwf1</span> <span class="id">Hwf2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hlink</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hwf1</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hwf2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">module_wf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">extend</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">M1</span> <span class="id">ObjectName</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">extend</span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">M1</span> <span class="id">C</span>) <span class="kwd">as</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="id">crush</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">extend</span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">M1</span> <span class="id">C</span>) <span class="kwd">as</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="id">crush</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">linking_wf</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H1</span> : <span class="id">M_wf</span> ?<span class="id">M1</span>, <span class="id">H2</span> : <span class="id">M_wf</span> ?<span class="id">M2</span>, <span class="id">Hlink</span> : ?<span class="id">M1</span> ⋄ ?<span class="id">M2</span> ≜ ?<span class="id">M</span> |- <span class="id">M_wf</span> ?<span class="id">M</span>] =&gt; <span class="tactic">eapply</span> <span class="id">linked_wf</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">arising_heap_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ, <span class="id">arising</span> <span class="id">M1</span> <span class="id">M2</span> σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>, <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ<span class="id">_wf</span> <span class="id">M</span> (<span class="id">fst</span> σ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof80')">Proof.</div>
<div class="proofscript" id="proof80">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">pair_reduces_heap_wf_auto</span>.<br/>
&nbsp;&nbsp;<span class="id">initial_heap_wf_auto</span>.<br/>
&nbsp;&nbsp;<span class="id">linking_wf</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">le_le_addr</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> α1 α2, <span class="id">le_</span>α α1 α2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">le_</span>α α2 α1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;α1 = α2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof81')">Proof.</div>
<div class="proofscript" id="proof81">
&nbsp;&nbsp;<span class="tactic">intros</span> α1 α2 <span class="id">Hle1</span> <span class="id">Hle2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hle1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hle2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">le_le_addr</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">le_le_addr</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">heap_max_unique</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (χ : <span class="id">heap</span>) α, <span class="id">max_</span>χ χ α -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> α', <span class="id">max_</span>χ χ α' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;α' = α.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof82')">Proof.</div>
<div class="proofscript" id="proof82">
&nbsp;&nbsp;<span class="tactic">intros</span> χ α <span class="id">Hmax1</span> α' <span class="id">Hmax2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hmax1</span>; <span class="tactic">inversion</span> <span class="id">Hmax2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="id">Create</span> <span class="id">HintDb</span> <span class="id">fresh_heap_DB</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">heap_max_unique</span> : <span class="id">fresh_heap_DB</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">heap_max_unique</span> : <span class="id">fresh_heap_DB</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_heap_unique</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> χ α1 α2, <span class="id">fresh_</span>χ χ α1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_</span>χ χ α2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;α1 = α2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof83')">Proof.</div>
<div class="proofscript" id="proof83">
&nbsp;&nbsp;<span class="tactic">intros</span> χ α1 α2 <span class="id">Hfrsh1</span> <span class="id">Hfrsh2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hfrsh1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hfrsh2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H1</span> : <span class="id">max_</span>χ ?χ ?α1,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">max_</span>χ ?χ ?α2 |- <span class="id">_</span>] =&gt; <span class="tactic">apply</span> <span class="id">heap_max_unique</span> <span class="kwd">with</span> (α:=α2) <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">fresh_heap_unique</span> : <span class="id">fresh_heap_DB</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">fresh_heap_unique</span> : <span class="id">fresh_heap_DB</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_heap_none</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> χ α, <span class="id">fresh_</span>χ χ α -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ α = <span class="id">None</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof84')">Proof.</div>
<div class="proofscript" id="proof84">
&nbsp;&nbsp;<span class="tactic">intros</span> χ α <span class="id">Hfrsh</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hfrsh</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">not_some_implies_none</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hcontra</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">Hcontra</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hcontra</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">fresh_heap_none</span> : <span class="id">fresh_heap_DB</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">fresh_heap_none</span> : <span class="id">fresh_heap_DB</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_heap_some_contradict</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> χ α, <span class="id">fresh_</span>χ χ α -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">o</span>, ~ χ α = <span class="id">Some</span> <span class="id">o</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof85')">Proof.</div>
<div class="proofscript" id="proof85">
&nbsp;&nbsp;<span class="tactic">intros</span> χ α <span class="id">Hfrsh</span>; <span class="tactic">intros</span>; <span class="tactic">intro</span> <span class="id">Hcontra</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">fresh_heap_none</span> <span class="kwd">in</span> <span class="id">Hfrsh</span>; <span class="id">crush</span>.  <br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">fresh_heap_some_contradict</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_heap_some_contradiction</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> χ α, <span class="id">fresh_</span>χ χ α -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">o</span>, χ α = <span class="id">Some</span> <span class="id">o</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span>, <span class="id">P</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof86')">Proof.</div>
<div class="proofscript" id="proof86">
&nbsp;&nbsp;<span class="tactic">intros</span> χ α <span class="id">Hfrsh</span> <span class="id">o</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">fresh_heap_some_contradict</span> <span class="kwd">with</span> (<span class="id">o</span>:=<span class="id">o</span>) <span class="kwd">in</span> <span class="id">Hfrsh</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">zip_length_exists</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} (<span class="id">l1</span> : <span class="id">list</span> <span class="id">A</span>) (<span class="id">l2</span> : <span class="id">list</span> <span class="id">B</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">length</span> <span class="id">l1</span> = <span class="id">length</span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">z</span>, <span class="id">zip</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">z</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof87')">Proof.</div>
<div class="proofscript" id="proof87">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">l1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span> <span class="kwd">as</span> [|<span class="id">a</span> <span class="id">l</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">nil</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">auto</span>|<span class="tactic">inversion</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l2</span> <span class="kwd">as</span> [|<span class="id">b</span> <span class="id">l</span>'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">inversion</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IHl</span> <span class="id">l</span>') <span class="kwd">as</span> [<span class="id">z</span> <span class="id">Hzip</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;<span class="id">exists</span> ((<span class="id">a</span>,<span class="id">b</span>)::<span class="id">z</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_in_empty</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>} <span class="id">x</span>, @<span class="id">fresh_in_map</span> <span class="id">A</span> <span class="id">x</span> <span class="id">empty</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof88')">Proof.</div>
<div class="proofscript" id="proof88">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">fresh_in_map</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">pmap_simpl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">fresh_in_empty</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_in_map_not_in_dom</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">m</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">A</span>) <span class="id">d</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dom</span> <span class="id">m</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">fresh_in_map</span> <span class="id">x</span> <span class="id">m</span> &lt;-&gt; ~ <span class="id">In</span> <span class="id">x</span> <span class="id">d</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof89')">Proof.</div>
<div class="proofscript" id="proof89">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">m</span> <span class="id">d</span> <span class="id">Hdom</span> <span class="id">x</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">not_in_map_implies_not_in_dom</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">not_in_dom_implies_not_in_map</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Inductive</span> <span class="id">lt_map</span> {<span class="id">A</span> : <span class="kwd">Type</span>} : <span class="id">nat</span> -&gt; <span class="id">partial_map</span> <span class="id">var</span> <span class="id">A</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">lt_empty</span> : <span class="id">lt_map</span> 0 <span class="id">empty</span><br/>
| <span class="id">lt_update1</span> : <span class="kwd">forall</span> <span class="id">n</span> <span class="id">b</span> <span class="id">m</span> <span class="id">n</span>', <span class="id">lt_map</span> <span class="id">n</span>' <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n</span> &lt; <span class="id">n</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lt_map</span> <span class="id">n</span>' (<span class="id">update</span> (<span class="id">bnd</span> <span class="id">n</span>) <span class="id">b</span> <span class="id">m</span>)<br/>
| <span class="id">lt_update2</span> : <span class="kwd">forall</span> <span class="id">n</span> <span class="id">b</span> <span class="id">m</span> <span class="id">n</span>', <span class="id">lt_map</span> <span class="id">n</span>' <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n</span>' &lt;= <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lt_map</span> (<span class="id">S</span> <span class="id">n</span>) (<span class="id">update</span> (<span class="id">bnd</span> <span class="id">n</span>) <span class="id">b</span> <span class="id">m</span>).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">lt_map</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">exists_limit_for_finite_map</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">m</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite</span> <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span>, <span class="id">lt_map</span> <span class="id">n</span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof90')">Proof.</div>
<div class="proofscript" id="proof90">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">m</span> <span class="id">Hfinite</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hfinite</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">exists</span> 0; <span class="tactic">auto</span>|<span class="tactic">destruct</span> <span class="id">IHHfinite</span> <span class="kwd">as</span> [<span class="id">n</span>]].<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">n</span>'].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">le_lt_dec</span> <span class="id">n</span> <span class="id">n</span>') <span class="kwd">as</span> [<span class="id">Hle</span>|<span class="id">Hlt</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">exists</span> (<span class="id">S</span> <span class="id">n</span>'); <span class="tactic">eapply</span> <span class="id">lt_update2</span>|<span class="id">exists</span> <span class="id">n</span>; <span class="tactic">apply</span> <span class="id">lt_update1</span>]; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">lt_map_implies_var_lt</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>} <span class="id">n</span> (<span class="id">m</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lt_map</span> <span class="id">n</span> <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>' <span class="id">b</span>, <span class="id">m</span> (<span class="id">bnd</span> <span class="id">n</span>') = <span class="id">Some</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n</span>' &lt; <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof91')">Proof.</div>
<div class="proofscript" id="proof91">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">n</span> <span class="id">m</span> <span class="id">Hlt</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hlt</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pmap_simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">n</span>'0 <span class="id">n</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pmap_simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span> <span class="kwd">in</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">neq_eqb</span> <span class="kwd">in</span> <span class="id">H0</span>; [<span class="tactic">eauto</span>|<span class="id">crush</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">n</span>'0 <span class="id">n</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pmap_simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span> <span class="kwd">in</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">neq_eqb</span> <span class="kwd">in</span> <span class="id">H0</span>; [<span class="tactic">eauto</span>|<span class="id">crush</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHlt</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">lt_fresh_in_map</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>} <span class="id">n</span> (<span class="id">m</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lt_map</span> <span class="id">n</span> <span class="id">m</span> -&gt; <span class="kwd">forall</span> <span class="id">n</span>', <span class="id">n</span> &lt;= <span class="id">n</span>' -&gt; <span class="id">fresh_in_map</span> (<span class="id">bnd</span> <span class="id">n</span>') <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof92')">Proof.</div>
<div class="proofscript" id="proof92">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">n</span> <span class="id">m</span> <span class="id">Hlt</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hlt</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">fresh_in_map</span> <span class="kwd">in</span> *;    <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">map_rewrite</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Ha</span> : ?<span class="id">n2</span> &lt; ?<span class="id">n3</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hb</span> : ?<span class="id">n3</span> &lt;= ?<span class="id">n1</span> |-<span class="id">context</span>[?<span class="id">n1</span> =? ?<span class="id">n2</span>]] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hneq</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hneq</span> : <span class="id">n1</span> &lt;&gt; <span class="id">n2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">crush</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">apply</span> <span class="id">Nat.eqb_neq</span> <span class="kwd">in</span> <span class="id">Hneq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hneq</span>; <span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">map_rewrite</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Ha</span> : <span class="id">S</span> ?<span class="id">n2</span> &lt;= ?<span class="id">n1</span> |-<span class="id">context</span>[?<span class="id">n1</span> =? ?<span class="id">n2</span>]] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hneq</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hneq</span> : <span class="id">n1</span> &lt;&gt; <span class="id">n2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">crush</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">apply</span> <span class="id">Nat.eqb_neq</span> <span class="kwd">in</span> <span class="id">Hneq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hneq</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_var_finite</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">m</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite</span> <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>, <span class="id">fresh_in_map</span> <span class="id">x</span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof93')">Proof.</div>
<div class="proofscript" id="proof93">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">exists_limit_for_finite_map</span> <span class="id">m</span>) <span class="kwd">as</span> [<span class="id">n</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">bnd</span> <span class="id">n</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">lt_fresh_in_map</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_var_finite2</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">m1</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite</span> <span class="id">m1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">m2</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">A</span>), <span class="id">finite</span> <span class="id">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>, <span class="id">fresh_in_map</span> <span class="id">x</span> <span class="id">m1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_in_map</span> <span class="id">x</span> <span class="id">m2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof94')">Proof.</div>
<div class="proofscript" id="proof94">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">exists_limit_for_finite_map</span> <span class="id">m1</span>) <span class="kwd">as</span> [<span class="id">n1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">exists_limit_for_finite_map</span> <span class="id">m2</span>) <span class="kwd">as</span> [<span class="id">n2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">le_lt_dec</span> <span class="id">n1</span> <span class="id">n2</span>) <span class="kwd">as</span> [<span class="id">Hle</span>|<span class="id">Hlt</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">exists</span> (<span class="id">bnd</span> <span class="id">n2</span>)|<span class="id">exists</span> (<span class="id">bnd</span> <span class="id">n1</span>)];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">lt_fresh_in_map</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Inductive</span> <span class="id">lt_var</span> : <span class="id">nat</span> -&gt; <span class="id">var</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">lt_bind</span> : <span class="kwd">forall</span> <span class="id">n</span> <span class="id">n</span>', <span class="id">n</span>' &lt; <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lt_var</span> <span class="id">n</span> (<span class="id">bnd</span> <span class="id">n</span>').<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">lt_var</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">exists_limit_var</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">exists</span> <span class="id">n</span>, <span class="id">lt_var</span> <span class="id">n</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof95')">Proof.</div>
<div class="proofscript" id="proof95">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span> <span class="kwd">as</span> [<span class="id">n</span>'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">S</span> <span class="id">n</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">exists_limit_for_list</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>, <span class="id">exists</span> <span class="id">n</span>, <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">In</span> <span class="id">x</span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lt_var</span> <span class="id">n</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof96')">Proof.</div>
<div class="proofscript" id="proof96">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span> <span class="kwd">as</span> [|<span class="id">x</span> <span class="id">l</span>'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">exists</span> 0; <span class="id">crush</span>|<span class="tactic">destruct</span> <span class="id">x</span> <span class="kwd">as</span> [<span class="id">n</span>']].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHl</span>' <span class="kwd">as</span> [<span class="id">n</span> <span class="id">Hltx</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">le_lt_dec</span> <span class="id">n</span> <span class="id">n</span>') <span class="kwd">as</span> [<span class="id">Hle</span>|<span class="id">Hlt</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">exists</span> (<span class="id">S</span> <span class="id">n</span>')|<span class="id">exists</span> <span class="id">n</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">crush</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hltx</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">crush</span>.<br/>
&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_var_finite3</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">m1</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite</span> <span class="id">m1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">m2</span> : <span class="id">partial_map</span> <span class="id">var</span> <span class="id">A</span>), <span class="id">finite</span> <span class="id">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">d</span>, <span class="id">exists</span> <span class="id">x</span>, <span class="id">fresh_in_map</span> <span class="id">x</span> <span class="id">m1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_in_map</span> <span class="id">x</span> <span class="id">m2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">In</span> <span class="id">x</span> <span class="id">d</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof97')">Proof.</div>
<div class="proofscript" id="proof97">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">exists_limit_for_finite_map</span> <span class="id">m1</span>) <span class="kwd">as</span> [<span class="id">n1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">exists_limit_for_finite_map</span> <span class="id">m2</span>) <span class="kwd">as</span> [<span class="id">n2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">exists_limit_for_list</span> <span class="id">d</span>) <span class="kwd">as</span> [<span class="id">n3</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">le_lt_dec</span> <span class="id">n1</span> <span class="id">n2</span>) <span class="kwd">as</span> [<span class="id">Hle1</span>|<span class="id">Hlt1</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">le_lt_dec</span> <span class="id">n1</span> <span class="id">n3</span>) <span class="kwd">as</span> [<span class="id">Hle2</span>|<span class="id">Hlt2</span>].<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">le_lt_dec</span> <span class="id">n3</span> <span class="id">n2</span>) <span class="kwd">as</span> [<span class="id">Hle3</span>|<span class="id">Hlt3</span>];<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">exists</span> (<span class="id">bnd</span> <span class="id">n2</span>); <span class="tactic">split</span>; [|<span class="tactic">split</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">eapply</span> <span class="id">lt_fresh_in_map</span>; <span class="tactic">eauto</span>; <span class="id">crush</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hcontra</span>; <span class="id">crush</span>];<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">exists</span> (<span class="id">bnd</span> <span class="id">n3</span>); <span class="tactic">split</span>; [|<span class="tactic">split</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">eapply</span> <span class="id">lt_fresh_in_map</span>; <span class="tactic">eauto</span>; <span class="id">crush</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hcontra</span>; <span class="id">crush</span>].<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">le_lt_dec</span> <span class="id">n3</span> <span class="id">n2</span>) <span class="kwd">as</span> [<span class="id">Hle3</span>|<span class="id">Hlt3</span>];<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">exists</span> (<span class="id">bnd</span> <span class="id">n2</span>); <span class="tactic">split</span>; [|<span class="tactic">split</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">eapply</span> <span class="id">lt_fresh_in_map</span>; <span class="tactic">eauto</span>; <span class="id">crush</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hcontra</span>; <span class="id">crush</span>];<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">exists</span> (<span class="id">bnd</span> <span class="id">n3</span>); <span class="tactic">split</span>; [|<span class="tactic">split</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">eapply</span> <span class="id">lt_fresh_in_map</span>; <span class="tactic">eauto</span>; <span class="id">crush</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hcontra</span>; <span class="id">crush</span>].<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">le_lt_dec</span> <span class="id">n1</span> <span class="id">n3</span>) <span class="kwd">as</span> [<span class="id">Hle2</span>|<span class="id">Hlt2</span>];<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">exists</span> (<span class="id">bnd</span> <span class="id">n1</span>); <span class="tactic">split</span>; [|<span class="tactic">split</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">eapply</span> <span class="id">lt_fresh_in_map</span>; <span class="tactic">eauto</span>; <span class="id">crush</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hcontra</span>; <span class="id">crush</span>];<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">exists</span> (<span class="id">bnd</span> <span class="id">n3</span>); <span class="tactic">split</span>; [|<span class="tactic">split</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">eapply</span> <span class="id">lt_fresh_in_map</span>; <span class="tactic">eauto</span>; <span class="id">crush</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">Hcontra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hcontra</span>; <span class="id">crush</span>].<br/>
Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">adaptation_exists</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> χ1 ϕ1 ψ1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ2 ϕ2 ψ2, <span class="id">finite_</span>ϕ ϕ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_</span>ϕ ϕ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck_</span>ϕ ϕ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ1 σ2, σ1 = (χ1, ϕ1::ψ1) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2 = (χ2, ϕ2::ψ2) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> σ, σ1 ◁ σ2 ≜ σ.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof98')">Proof.</div>
<div class="proofscript" id="proof98">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">vMap</span> ϕ1) <span class="kwd">as</span> β1.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">vMap</span> ϕ2) <span class="kwd">as</span> β2.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">disjointedness_for_finite_variable_maps</span> <span class="id">value</span> <span class="id">value</span> β1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">g</span>:=β2)(<span class="id">s</span>:=<span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [<span class="id">f</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">finite_auto</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">exists</span> (χ2, (<span class="id">frm</span> (<span class="id">f</span> ∘ β2 ∪ β1) (<span class="id">c_stmt</span> (❲ <span class="id">f</span> ↦ <span class="id">s</span> ❳))::ψ2)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">a_adapt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(χ:=χ1)(ψ:=ψ1)(ϕ:=ϕ1)(ϕ':=ϕ2)(<span class="id">c</span>:=<span class="id">contn</span> ϕ1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(β:=β1)(β':=β2)(β'':=<span class="id">f</span> ∘ β2 ∪ β1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span>:=<span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span>:=<span class="id">f</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> ϕ1; <span class="id">crush</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> ϕ2; <span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">dom_finite</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} `{<span class="id">Eq</span> <span class="id">A</span>} <span class="id">D</span> (<span class="id">ps</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">B</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dom</span> <span class="id">ps</span> <span class="id">D</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite</span> <span class="id">ps</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof99')">Proof.</div>
<div class="proofscript" id="proof99">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">HeqA</span> <span class="id">D</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">D</span> <span class="kwd">as</span> [|<span class="id">a</span> <span class="id">D</span>'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ps</span> <span class="id">Hdom</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">unfold</span> <span class="id">dom</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|].<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">ps</span> = <span class="id">empty</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="tactic">subst</span>; <span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">functional_extensionality</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">not_some_implies_none</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hcontra</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Hmap</span> : ?<span class="id">m</span> ?<span class="id">a</span> = <span class="id">Some</span> ?<span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span> : <span class="kwd">forall</span> <span class="id">a</span>' <span class="id">b</span>', ?<span class="id">m</span> <span class="id">a</span>' = <span class="id">Some</span> <span class="id">b</span>' -&gt; <span class="id">In</span> <span class="id">a</span>' <span class="id">nil</span>  |- <span class="id">_</span>] =&gt; <span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hmap</span>; <span class="id">crush</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">dom</span> <span class="kwd">in</span> <span class="id">Hdom</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Ha0</span> <span class="id">a</span> (<span class="id">in_eq</span> <span class="id">a</span> <span class="id">D</span>')) <span class="kwd">as</span> [<span class="id">b</span> <span class="id">Hmap</span>].<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hps</span> : <span class="id">ps</span> = <span class="id">update</span> <span class="id">a</span> <span class="id">b</span> (<span class="id">t_update</span> <span class="id">ps</span> <span class="id">a</span> <span class="id">None</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">functional_extensionality</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">a</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>|<span class="tactic">subst</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">a</span>' <span class="id">a</span>) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">fin_update</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHD</span>'; <span class="tactic">unfold</span> <span class="id">dom</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">Huniq</span> : <span class="id">unique</span> (<span class="id">_</span>::?<span class="id">D</span>) |- <span class="id">unique</span> ?<span class="id">D</span>] =&gt; <span class="tactic">inversion</span> <span class="id">Huniq</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">a0</span> <span class="id">a</span>) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">crush</span>|].<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : <span class="kwd">forall</span> <span class="id">a</span>' <span class="id">b</span>', ?<span class="id">m</span> <span class="id">a</span>' = <span class="id">Some</span> <span class="id">b</span>' -&gt; <span class="id">In</span> <span class="id">a</span>' (?<span class="id">a</span>::?<span class="id">D</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hmap</span> : ?<span class="id">m</span> ?<span class="id">a0</span> = <span class="id">Some</span> ?<span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hneq</span> : ?<span class="id">a0</span> &lt;&gt; ?<span class="id">a</span> |- <span class="id">_</span>] =&gt; <span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hmap</span>; <span class="tactic">inversion</span> <span class="id">Hmap</span>; <span class="id">crush</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Hin</span> : <span class="id">In</span> ?<span class="id">a0</span> ?<span class="id">D</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span> : <span class="kwd">forall</span> <span class="id">a</span>', <span class="id">In</span> <span class="id">a</span>' (?<span class="id">a</span>::?<span class="id">D</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span>', ?<span class="id">m</span> <span class="id">a</span>' = <span class="id">Some</span> <span class="id">b</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Huniq</span> : <span class="id">unique</span> (?<span class="id">a</span>::?<span class="id">D</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">b</span> := <span class="tactic">fresh</span> "<span class="id">b</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H</span> <span class="id">a0</span> (<span class="id">in_cons</span> <span class="id">a</span> <span class="id">a0</span> <span class="id">D</span> <span class="id">Hin</span>)) <span class="kwd">as</span> [<span class="id">b</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">a</span> <span class="id">a0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">inversion</span> <span class="id">Huniq</span>; <span class="id">crush</span>|<span class="id">crush</span>]<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">dom_finite</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reduction_preserves_config_finiteness</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> σ1 σ2, <span class="id">M</span> ∙ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof100')">Proof.</div>
<div class="proofscript" id="proof100">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">Ha</span>|<span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [<span class="id">Ha</span>|<span class="id">Ha</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">fin_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">finite_map_composition</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">crush</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">update_</span>ψ<span class="id">_map</span>, <span class="id">update_</span>ϕ<span class="id">_map</span> <span class="kwd">in</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">simpl</span>; <span class="tactic">apply</span> <span class="id">fin_update</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H8</span>; <span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span>; [<span class="tactic">subst</span>; <span class="tactic">simpl</span>|]; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H0</span>; <span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">update_</span>ϕ<span class="id">_contn</span>, <span class="id">update_</span>ϕ<span class="id">_map</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">update_</span>ϕ<span class="id">_contn</span>, <span class="id">update_</span>ϕ<span class="id">_map</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reduction_preserves_config_finiteness</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reductions_preserves_config_finiteness</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof101')">Proof.</div>
<div class="proofscript" id="proof101">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reductions_preserves_config_finiteness</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reduction_preserves_config_finiteness</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof102')">Proof.</div>
<div class="proofscript" id="proof102">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">pair_reduction_preserves_config_finiteness</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reductions_preserves_config_finiteness</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳⋆ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof103')">Proof.</div>
<div class="proofscript" id="proof103">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">pair_reductions_preserves_config_finiteness</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reduction_preserves_config_not_stuck</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> σ1 σ2, <span class="id">M</span> ∙ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof104')">Proof.</div>
<div class="proofscript" id="proof104">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">not_stuck_</span>σ <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">eexists</span>; <span class="id">crush</span>; <span class="tactic">eauto</span>].<br/>
<br/>
&nbsp;&nbsp;- <span class="id">exists</span> ϕ'', (ϕ'::ψ); <span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">not_stuck_</span>ϕ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="id">exists</span> ϕ', ψ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">not_stuck_</span>ϕ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span> σ'; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> ϕ', ψ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> ϕ';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">not_stuck_</span>ϕ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="id">exists</span> ϕ'', ψ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">not_stuck_</span>ϕ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="id">exists</span> ϕ'', ψ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> ϕ'';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">not_stuck_</span>ϕ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reduction_preserves_config_not_stuck</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reductions_preserves_config_not_stuck</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof105')">Proof.</div>
<div class="proofscript" id="proof105">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reductions_preserves_config_not_stuck</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reduction_preserves_config_not_stuck</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof106')">Proof.</div>
<div class="proofscript" id="proof106">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">pair_reduction_preserves_config_not_stuck</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reductions_preserves_config_not_stuck</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳⋆ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof107')">Proof.</div>
<div class="proofscript" id="proof107">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">pair_reductions_preserves_config_not_stuck</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reduction_preserves_config_waiting</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> σ1 σ2, <span class="id">M</span> ∙ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">waiting_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">waiting_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof108')">Proof.</div>
<div class="proofscript" id="proof108">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">waiting_</span>σ <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">eexists</span>; <span class="id">crush</span>; <span class="tactic">eauto</span>].<br/>
<br/>
&nbsp;&nbsp;- <span class="id">exists</span> ϕ'', (ϕ'::ψ); <span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">waiting_</span>ψ, <span class="id">waiting_</span>ϕ <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">In</span> ?ϕ0 <span class="id">_</span> |- <span class="id">waiting</span> (<span class="id">contn</span> ?ϕ0)] =&gt; <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">crush</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="id">exists</span> ϕ'', ψ; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">waiting_</span>ψ, <span class="id">waiting_</span>ϕ <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="id">exists</span> ϕ'', ψ; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">waiting_</span>ψ, <span class="id">waiting_</span>ϕ <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reduction_preserves_config_waiting</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reductions_preserves_config_waiting</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">waiting_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">waiting_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof109')">Proof.</div>
<div class="proofscript" id="proof109">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reductions_preserves_config_waiting</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reduction_preserves_config_waiting</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">waiting_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">waiting_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof110')">Proof.</div>
<div class="proofscript" id="proof110">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">pair_reduction_preserves_config_waiting</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reductions_preserves_config_waiting</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳⋆ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">waiting_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">waiting_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof111')">Proof.</div>
<div class="proofscript" id="proof111">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">pair_reductions_preserves_config_waiting</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">has_self_update_</span>ϕ :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> χ ϕ, <span class="id">has_self_</span>ϕ χ ϕ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span>, <span class="id">x</span> &lt;&gt; <span class="id">this</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>ϕ χ (<span class="id">update_</span>ϕ<span class="id">_map</span> ϕ <span class="id">x</span> <span class="id">v</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof112')">Proof.</div>
<div class="proofscript" id="proof112">
&nbsp;&nbsp;<span class="tactic">intros</span> χ ϕ <span class="id">Hself</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hself</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [α <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [<span class="id">o</span> <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_frm</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> α, <span class="id">o</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">neq_eqb</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">has_self_update_</span>σ :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, <span class="id">has_self_</span>σ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span>, <span class="id">x</span> &lt;&gt; <span class="id">this</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>σ (<span class="id">update_</span>σ<span class="id">_map</span> σ <span class="id">x</span> <span class="id">v</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof113')">Proof.</div>
<div class="proofscript" id="proof113">
&nbsp;&nbsp;<span class="tactic">intros</span> σ <span class="id">Hself</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hself</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_config</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update_</span>ψ<span class="id">_map</span> <span class="kwd">in</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ψ <span class="kwd">as</span> [|ϕ' ψ'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">crush</span>|<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">has_self_update_</span>ϕ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>, <span class="id">in_eq</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>, <span class="id">in_cons</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">has_self_update_</span>ϕ<span class="id">_contn</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> χ ϕ, <span class="id">has_self_</span>ϕ χ ϕ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span>, <span class="id">has_self_</span>ϕ χ (<span class="id">update_</span>ϕ<span class="id">_contn</span> ϕ <span class="id">c</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof114')">Proof.</div>
<div class="proofscript" id="proof114">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [α <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [<span class="id">o</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_frm</span>;<br/>
&nbsp;&nbsp;<span class="id">exists</span> α, <span class="id">o</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">has_self_update_</span>σ<span class="id">_contn</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, <span class="id">has_self_</span>σ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span>, <span class="id">has_self_</span>σ (<span class="id">update_</span>σ<span class="id">_contn</span> σ <span class="id">c</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof115')">Proof.</div>
<div class="proofscript" id="proof115">
&nbsp;&nbsp;<span class="tactic">intros</span> σ <span class="id">Hself</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hself</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_config</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update_</span>ψ<span class="id">_contn</span> <span class="kwd">in</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ψ <span class="kwd">as</span> [|ϕ' ψ'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">crush</span>|<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">has_self_update_</span>ϕ<span class="id">_contn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>, <span class="id">in_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>, <span class="id">in_cons</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">reduction_preserves_config_has_self</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> σ1 σ2, <span class="id">M</span> ∙ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof116')">Proof.</div>
<div class="proofscript" id="proof116">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hself</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hself</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;meth&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H10</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_config</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ϕ' <span class="id">Hin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_frm</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> α, <span class="id">o</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hin</span>ϕ : <span class="id">In</span> ϕ (ϕ::ψ));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">in_eq</span>|<span class="tactic">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">Hin</span>ϕ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_frm</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hin</span>ϕ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H9</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;var&nbsp;asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">has_self_update_</span>σ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;field&nbsp;asgn*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H12</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_config</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id">cname</span> := <span class="id">cname</span> <span class="id">o</span>; <span class="id">flds</span> := <span class="id">update</span> <span class="id">f</span> <span class="id">v</span> (<span class="id">flds</span> <span class="id">o</span>); <span class="id">meths</span> := <span class="id">meths</span> <span class="id">o</span> |} <span class="kwd">as</span> <span class="id">o</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hin</span> : <span class="id">In</span> ϕ (ϕ::ψ));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">in_eq</span>|<span class="tactic">apply</span> <span class="id">H11</span> <span class="kwd">in</span> <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H7</span> <span class="kwd">as</span> [α0 <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [<span class="id">o0</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_frm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> α0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> α0 α) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span> α0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">o</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">o0</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">rewrite</span> <span class="id">eqb_refl</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">rewrite</span> <span class="id">neq_eqb</span>; <span class="tactic">auto</span>].  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hin</span> : <span class="id">In</span> ϕ0 (ϕ::ψ));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">in_cons</span>; <span class="tactic">auto</span>|<span class="tactic">apply</span> <span class="id">H11</span> <span class="kwd">in</span> <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [α0 <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [<span class="id">o0</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_frm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> α0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> α0 α) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span> α0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">o</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">o0</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">rewrite</span> <span class="id">eqb_refl</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">rewrite</span> <span class="id">neq_eqb</span>; <span class="tactic">auto</span>].<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;new&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H10</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_config</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id">cname</span> := <span class="id">C</span>; <span class="id">flds</span> := <span class="id">fMap</span> ∘ (<span class="id">vMap</span> ϕ); <span class="id">meths</span> := <span class="id">c_meths</span> <span class="id">CDef</span> |} <span class="kwd">as</span> <span class="id">o</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">self_frm</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hin</span> : <span class="id">In</span> ϕ (ϕ::ψ));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">in_eq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [χ ϕ <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [α0 <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [<span class="id">o0</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> α0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> α0 α) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span> α0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">o</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">o0</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">rewrite</span> <span class="id">neq_eqb</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">rewrite</span> <span class="id">neq_eqb</span>; <span class="tactic">auto</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">rewrite</span> <span class="id">eqb_refl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">rewrite</span> <span class="id">neq_eqb</span>; <span class="tactic">auto</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">self_frm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hin</span> : <span class="id">In</span> ϕ0 (ϕ::ψ));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">in_cons</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">Hin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [χ ϕ' <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [α0 <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [<span class="id">o0</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> α0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> α0 α) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span> α0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">o</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id">exists</span> <span class="id">o0</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">rewrite</span> <span class="id">eqb_refl</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">rewrite</span> <span class="id">neq_eqb</span>; <span class="tactic">auto</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ret&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_config</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H6</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">has_self_update_</span>ϕ<span class="id">_contn</span>, <span class="id">has_self_update_</span>ϕ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H5</span>, <span class="id">in_cons</span>, <span class="id">in_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H5</span>, <span class="id">in_cons</span>, <span class="id">in_cons</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ret&nbsp;2*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_config</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H6</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">has_self_update_</span>ϕ<span class="id">_contn</span>, <span class="id">has_self_update_</span>ϕ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_cons</span>, <span class="id">in_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H5</span>, <span class="id">in_cons</span>, <span class="id">in_cons</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reduction_preserves_config_has_self</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reductions_preserves_config_has_self</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof117')">Proof.</div>
<div class="proofscript" id="proof117">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reduction_preserves_config_has_self</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reduction_preserves_config_has_self</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof118')">Proof.</div>
<div class="proofscript" id="proof118">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">reduction_preserves_config_has_self</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">reductions_preserves_config_has_self</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">pair_reduction_preserves_config_has_self</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reductions_preserves_config_has_self</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳⋆ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>σ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>σ σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof119')">Proof.</div>
<div class="proofscript" id="proof119">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">pair_reductions_preserves_config_has_self</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reduction_preserves_config_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> σ1 σ2, <span class="id">M</span> ∙ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof120')">Proof.</div>
<div class="proofscript" id="proof120">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> σ1 σ2 <span class="id">Hred</span> <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">config_wf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reduction_preserves_config_wf</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reductions_preserves_config_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof121')">Proof.</div>
<div class="proofscript" id="proof121">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reductions_preserves_config_wf</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reduction_preserves_config_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof122')">Proof.</div>
<div class="proofscript" id="proof122">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span> <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">pair_reduction_preserves_config_wf</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reductions_preserves_config_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳⋆ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> σ2.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof123')">Proof.</div>
<div class="proofscript" id="proof123">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span> <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">pair_reductions_preserves_config_wf</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">config_head_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, σ<span class="id">_wf</span> σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> χ ϕ ψ, σ = (χ, ϕ::ψ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> (χ, ϕ::<span class="id">nil</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof124')">Proof.</div>
<div class="proofscript" id="proof124">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">config_wf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_auto</span>; <span class="id">not_stuck_auto</span>; <span class="id">waiting_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">crush</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_config</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ϕ' <span class="id">Hin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H5</span>, <span class="id">in_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="id">exists</span> ϕ, <span class="id">nil</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>; <span class="id">crush</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> ϕ, <span class="id">nil</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>; <span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">config_head_wf</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">config_wf_decompose</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, σ<span class="id">_wf</span> σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> χ ϕ ψ, σ = (χ, ϕ::ψ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof125')">Proof.</div>
<div class="proofscript" id="proof125">
&nbsp;&nbsp;<span class="tactic">intros</span> σ <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck_auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [ϕ <span class="id">Hns</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hns</span> <span class="kwd">as</span> [ψ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">fst</span> σ), ϕ, ψ; <span class="tactic">destruct</span> σ; <span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">initial_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, <span class="id">initial</span> σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> σ.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof126')">Proof.</div>
<div class="proofscript" id="proof126">
&nbsp;&nbsp;<span class="tactic">intros</span> σ <span class="id">Hinit</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [ϕ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">config_wf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_config</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|<span class="id">crush</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_frm</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>, <span class="id">ObjectInstance</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqb_refl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="id">waiting_auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> ϕ, <span class="id">nil</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">initial_wf</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">arising_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ, <span class="id">arising</span> <span class="id">M1</span> <span class="id">M2</span> σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> σ.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof127')">Proof.</div>
<div class="proofscript" id="proof127">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ <span class="id">Harise</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Harise</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">pair_reductions_preserves_config_wf</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">arising_wf</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">limited_config_wf</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> χ ϕ ψ, σ<span class="id">_wf</span> (χ, ϕ::ψ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> (χ, ϕ::<span class="id">nil</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof128')">Proof.</div>
<div class="proofscript" id="proof128">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">config_wf</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_config</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">crush</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H6</span>, <span class="id">in_eq</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">finite_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">crush</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">not_stuck_auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [ϕ' <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [ψ'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ha</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> ϕ', <span class="id">nil</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="id">waiting_auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [ϕ' <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [ψ'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ha</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">eexists</span>; <span class="tactic">eauto</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">limited_config_wf</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">waiting_update_</span>σ<span class="id">_map</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, <span class="id">waiting_</span>σ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span>, <span class="id">waiting_</span>σ (<span class="id">update_</span>σ<span class="id">_map</span> σ <span class="id">x</span> <span class="id">v</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof129')">Proof.</div>
<div class="proofscript" id="proof129">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">waiting_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [ϕ <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [ψ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">update_</span>ϕ<span class="id">_map</span> ϕ <span class="id">x</span> <span class="id">v</span>), ψ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update_</span>ψ<span class="id">_map</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">waiting_update_</span>σ<span class="id">_map</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">not_stuck_update_</span>σ<span class="id">_map</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, <span class="id">not_stuck_</span>σ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span>, <span class="id">not_stuck_</span>σ (<span class="id">update_</span>σ<span class="id">_map</span> σ <span class="id">x</span> <span class="id">v</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof130')">Proof.</div>
<div class="proofscript" id="proof130">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">not_stuck_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [ϕ <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [ψ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">update_</span>ϕ<span class="id">_map</span> ϕ <span class="id">x</span> <span class="id">v</span>), ψ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update_</span>ψ<span class="id">_map</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">not_stuck_update_</span>σ<span class="id">_map</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">finite_update_</span>ϕ<span class="id">_map</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> ϕ, <span class="id">finite_</span>ϕ ϕ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span>, <span class="id">finite_</span>ϕ (<span class="id">update_</span>ϕ<span class="id">_map</span> ϕ <span class="id">x</span> <span class="id">v</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof131')">Proof.</div>
<div class="proofscript" id="proof131">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">finite_auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">fin_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">finite_update_</span>ϕ<span class="id">_map</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">finite_update_</span>σ<span class="id">_map</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, <span class="id">finite_</span>σ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span>, <span class="id">finite_</span>σ (<span class="id">update_</span>σ<span class="id">_map</span> σ <span class="id">x</span> <span class="id">v</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof132')">Proof.</div>
<div class="proofscript" id="proof132">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> σ <span class="kwd">as</span> [χ ψ].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">finite_</span>σ, <span class="id">finite_</span>ψ.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update_</span>ψ<span class="id">_map</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> ψ <span class="kwd">as</span> [|ϕ ψ'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">crush</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">finite_update_</span>ϕ<span class="id">_map</span>.<br/>
&nbsp;&nbsp;<span class="id">finite_auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">finite_auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">finite_update_</span>σ<span class="id">_map</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">has_self_update_</span>ϕ<span class="id">_map</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> χ ϕ, <span class="id">has_self_</span>ϕ χ ϕ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span> ψ <span class="id">A</span>, <span class="id">fresh_x</span> <span class="id">x</span> (χ, ϕ::ψ) <span class="id">A</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>ϕ χ (<span class="id">update_</span>ϕ<span class="id">_map</span> ϕ <span class="id">x</span> <span class="id">v</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof133')">Proof.</div>
<div class="proofscript" id="proof133">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_frm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [α <span class="id">Htmp</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htmp</span> <span class="kwd">as</span> [<span class="id">o</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> α, <span class="id">o</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update_</span>ϕ<span class="id">_map</span>, <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span> <span class="kwd">as</span> [<span class="id">n</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span> <span class="kwd">as</span> [|<span class="id">n</span>'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">mapp</span>, <span class="id">stackMap</span>, <span class="id">mapp</span> <span class="kwd">in</span> <span class="id">H1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">this</span> <span class="kwd">in</span> <span class="id">Ha</span>; <span class="tactic">rewrite</span> <span class="id">Ha</span> <span class="kwd">in</span> <span class="id">H1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">has_self_update_</span>ϕ<span class="id">_map</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">has_self_update_</span>σ<span class="id">_map</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, <span class="id">has_self_</span>σ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span> <span class="id">A</span>, <span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>σ (<span class="id">update_</span>σ<span class="id">_map</span> σ <span class="id">x</span> <span class="id">v</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof134')">Proof.</div>
<div class="proofscript" id="proof134">
&nbsp;&nbsp;<span class="tactic">intros</span> σ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> σ <span class="kwd">as</span> [χ ψ].<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">self_config</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> ψ <span class="kwd">as</span> [|ϕ' ψ'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">crush</span>|<span class="tactic">simpl</span> <span class="kwd">in</span> *].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">has_self_update_</span>ϕ<span class="id">_map</span> <span class="kwd">with</span> (ψ:=ψ')(<span class="id">A</span>:=<span class="id">A</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H2</span>, <span class="id">in_eq</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H3</span>, <span class="id">in_cons</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">has_self_update_</span>σ<span class="id">_map</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">wf_update_</span>σ<span class="id">_map</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, σ<span class="id">_wf</span> σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> α <span class="id">A</span>, <span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> (<span class="id">update_</span>σ<span class="id">_map</span> σ <span class="id">x</span> α).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof135')">Proof.</div>
<div class="proofscript" id="proof135">
&nbsp;&nbsp;<span class="tactic">intros</span> σ <span class="id">Hwf</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">config_wf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">eval_unique</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> σ <span class="id">e</span> <span class="id">v1</span>, <span class="id">M</span> ∙ σ ⊢ <span class="id">e</span> ↪ <span class="id">v1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v2</span>, <span class="id">M</span> ∙ σ ⊢ <span class="id">e</span> ↪ <span class="id">v2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v2</span> = <span class="id">v1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof136')">Proof.</div>
<div class="proofscript" id="proof136">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> σ <span class="id">e</span> <span class="id">v1</span> <span class="id">Heval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Heval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; [<span class="tactic">eauto</span>| <span class="tactic">eauto</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHeval1</span> <span class="kwd">in</span> <span class="id">H6</span>; <span class="tactic">inversion</span> <span class="id">H6</span>].<br/>
<br/>
<div class="doc">Case 1: eval v </div>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
<br/>
<div class="doc">Case 2: eval x </div>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="id">crush</span>.<br/>
<br/>
<div class="doc">Case 3: e.f </div>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="id">crush</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHeval</span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">subst</span>; <span class="id">crush</span>.<br/>
<br/>
<div class="doc">Case 4: e0.g(e) </div>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHeval1</span> <span class="kwd">in</span> <span class="id">H6</span>; <span class="tactic">inversion</span> <span class="id">H6</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H7</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H8</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H11</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHeval2</span> <span class="kwd">in</span> <span class="id">H13</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHeval3</span> <span class="kwd">in</span> <span class="id">H14</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
<br/>
<div class="doc">Case 5: e1 = e2 </div>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHeval1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">apply</span> <span class="id">IHHeval2</span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">subst</span>; <span class="id">crush</span>.<br/>
<br/>
<div class="doc">Case 6: e1 ≠ e2 </div>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHeval1</span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="tactic">apply</span> <span class="id">IHHeval2</span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="tactic">subst</span>; <span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">eval_unique</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">eval_rewrite</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ?<span class="id">M</span> ∙ ?σ ⊢ ?<span class="id">e</span> ↪ ?<span class="id">v1</span>, <span class="id">H2</span> : ?<span class="id">M</span> ∙ ?σ ⊢ ?<span class="id">e</span> ↪ ?<span class="id">v2</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">eval_unique</span> <span class="id">M</span> σ <span class="id">e</span> <span class="id">v1</span> <span class="id">H1</span>) <span class="kwd">in</span> <span class="id">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">unique_interpretation_x</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> σ <span class="id">v1</span>, ⌊ <span class="id">x</span> ⌋ σ ≜ <span class="id">v1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v2</span>, ⌊ <span class="id">x</span> ⌋ σ ≜ <span class="id">v2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v2</span> = <span class="id">v1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof137')">Proof.</div>
<div class="proofscript" id="proof137">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> σ <span class="id">v1</span> <span class="id">Hint1</span> <span class="id">v2</span> <span class="id">Hint2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hint1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hint2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">unique_interpretation_</span>Σ :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> Σ σ α<span class="id">s1</span>, ⌊ Σ ⌋ σ ≜′ α<span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> α<span class="id">s2</span>, ⌊ Σ ⌋ σ ≜′ α<span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;α<span class="id">s2</span> = α<span class="id">s1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof138')">Proof.</div>
<div class="proofscript" id="proof138">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> σ α1 <span class="id">Hint1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hint1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> α<span class="id">s2</span> <span class="id">Hint2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hint2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">unique_interpretation_x</span> <span class="id">x</span> σ α) <span class="kwd">in</span> <span class="id">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">IHHint1</span> α<span class="id">s0</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">interpretation_rewrite</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ⌊ ?<span class="id">x</span> ⌋ ?σ ≜ ?<span class="id">v1</span>, <span class="id">H2</span> : ⌊ ?<span class="id">x</span> ⌋ ?σ ≜ ?<span class="id">v2</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">unique_interpretation_x</span> <span class="id">x</span> σ <span class="id">v1</span> <span class="id">H1</span>) <span class="kwd">in</span> <span class="id">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ⌊ ?Σ ⌋ ?σ ≜′ ?α<span class="id">s1</span>, <span class="id">H2</span> : ⌊ ?Σ ⌋ ?σ ≜′ ?α<span class="id">s2</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">unique_interpretation_</span>Σ Σ σ α<span class="id">s1</span> <span class="id">H1</span>) <span class="kwd">in</span> <span class="id">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Parameter</span> <span class="id">unique_restriction</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ Σ σ1, σ ↓ Σ ≜ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ2, σ ↓ Σ ≜ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2 = σ1.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">restriction_rewrite</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ?σ ↓ ?Σ ≜ ?σ1, <span class="id">H2</span> : ?σ ↓ ?Σ ≜ ?σ2 |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">unique_restriction</span> σ Σ σ1 <span class="id">H1</span>) <span class="kwd">in</span> <span class="id">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">wf_</span>σ<span class="id">_explode</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, σ<span class="id">_wf</span> σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> χ ψ ϕ, σ = (χ, ϕ::ψ) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite</span> (<span class="id">vMap</span> ϕ) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> ϕ', <span class="id">In</span> ϕ' ψ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite</span> (<span class="id">vMap</span> ϕ')) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck</span> (<span class="id">contn</span> ϕ) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> ϕ', <span class="id">In</span> ϕ' ψ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">waiting</span> (<span class="id">contn</span> ϕ')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof139')">Proof.</div>
<div class="proofscript" id="proof139">
&nbsp;&nbsp;<span class="tactic">intros</span> σ <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> σ <span class="kwd">as</span> [χ ψ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">waiting_auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Ltac</span> <span class="id">config_wf_destruct</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">H</span> : σ<span class="id">_wf</span> ?σ |-<span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">wf_</span>σ<span class="id">_explode</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> χ := <span class="tactic">fresh</span> "χ" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> ψ := <span class="tactic">fresh</span> "ψ" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> ϕ := <span class="tactic">fresh</span> "ϕ" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hwf</span> := <span class="tactic">fresh</span> "<span class="id">Hwf</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [χ <span class="id">Hwf</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwf</span> <span class="kwd">as</span> [ψ <span class="id">Hwf</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwf</span> <span class="kwd">as</span> [ϕ <span class="id">Hwf</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Htmp</span> := <span class="tactic">fresh</span> "<span class="id">Htmp</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hfinite</span>ϕ := <span class="tactic">fresh</span> "<span class="id">Hfinite</span>ϕ" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hfinite</span>ψ := <span class="tactic">fresh</span> "<span class="id">Hfinite</span>ψ" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hnot_stuck</span> := <span class="tactic">fresh</span> "<span class="id">Hnot_stuck</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hwaiting</span> := <span class="tactic">fresh</span> "<span class="id">Hwaiting</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwf</span> <span class="kwd">as</span> [<span class="id">Htmp</span> <span class="id">Hwf</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwf</span> <span class="kwd">as</span> [<span class="id">Hfinite</span>ϕ <span class="id">Hwf</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwf</span> <span class="kwd">as</span> [<span class="id">Hfinite</span>ψ <span class="id">Hwf</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwf</span> <span class="kwd">as</span> [<span class="id">Hnot_stuck</span> <span class="id">Hwaiting</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> σ<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">TODO: </div>
<span class="kwd">Parameter</span> <span class="id">function_neq_exists_neq_mapping</span>  :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} (<span class="id">f1</span> <span class="id">f2</span> : <span class="id">A</span> -&gt; <span class="id">B</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f1</span> &lt;&gt; <span class="id">f2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">a</span>, <span class="id">f1</span> <span class="id">a</span> &lt;&gt; <span class="id">f2</span> <span class="id">a</span>.<br/>
<br/>
<br/>
<div class="doc">This theorem is not currently provable since there is not restriction on what the fresh variables could be. I can change this so that the fresh variables are deterministic during adaptation </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<span class="kwd">Parameter</span> <span class="id">adaptation_unique</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ1 σ2 σ, σ1 ◁ σ2 ≜ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ', σ1 ◁ σ2 ≜ σ' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ' = σ.<br/>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">adapt_rewrite</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : ?σ1 ◁ ?σ2 ≜ ?σ, <span class="id">H2</span> : ?σ1 ◁ ?σ2 ≜ ?σ' |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">adaptation_unique</span> σ1 σ2 σ <span class="id">H1</span>) <span class="kwd">in</span> <span class="id">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reductions_transitive</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳⋆ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ3, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ2 ⤳⋆ σ3 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳⋆ σ3.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof140')">Proof.</div>
<div class="proofscript" id="proof140">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">notin_updates</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} `{<span class="id">Eq</span> <span class="id">A</span>} <span class="id">zs</span> <span class="id">zs</span>' (<span class="id">Zs</span> : <span class="id">list</span> (<span class="id">A</span> * <span class="id">A</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">zip</span> <span class="id">zs</span> <span class="id">zs</span>' <span class="id">Zs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">z</span>, ~ <span class="id">In</span> <span class="id">z</span> <span class="id">zs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (β β' : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">B</span>), <span class="id">updates</span> <span class="id">Zs</span> β β' <span class="id">z</span> = β <span class="id">z</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof141')">Proof.</div>
<div class="proofscript" id="proof141">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">HeqClass</span> <span class="id">zs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">zs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">zs</span>' <span class="id">Zs</span> <span class="id">Hzip</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hzip</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">z</span> <span class="id">a</span>) <span class="kwd">as</span> [<span class="id">Heq</span>|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>; <span class="id">contradiction</span> <span class="id">H</span>; <span class="tactic">apply</span> <span class="id">in_eq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">rewrite</span> <span class="id">neq_eqb</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHzs</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">inversion</span> <span class="id">Hzip</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">intro</span> <span class="id">Hcontra</span>; <span class="id">contradiction</span> <span class="id">H</span>; <span class="tactic">apply</span> <span class="id">in_cons</span>; <span class="tactic">auto</span>]].<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">adaptation_preserves_mapping</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ1 σ2 σ, σ1 ◁ σ2 ≜ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">z</span> (<span class="id">v</span> : <span class="id">value</span>), <span class="id">mapp</span> σ1 <span class="id">z</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mapp</span> σ <span class="id">z</span> = <span class="id">Some</span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof142')">Proof.</div>
<div class="proofscript" id="proof142">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">map_rewrite</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">extend_some_2</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">disjoint_dom_symmetry</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">disjoint_composition</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">update_fresh_preserves_map</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> σ <span class="id">A</span>, <span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">z</span> <span class="id">v</span> <span class="id">v</span>', <span class="id">mapp</span> σ <span class="id">z</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mapp</span> (<span class="id">update_</span>σ<span class="id">_map</span> σ <span class="id">x</span> <span class="id">v</span>') <span class="id">z</span> = <span class="id">Some</span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof143')">Proof.</div>
<div class="proofscript" id="proof143">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> σ <span class="id">A</span> <span class="id">Hfrsh</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hfrsh</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> σ <span class="kwd">as</span> [χ ψ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ψ <span class="kwd">as</span> [|ϕ ψ].<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">mapp</span>, <span class="id">configMapStack</span>, <span class="id">mapp</span>, <span class="id">stackMap</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">mapp</span>, <span class="id">configMapStack</span>, <span class="id">mapp</span>, <span class="id">stackMap</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> <span class="id">z</span> <span class="id">x</span>) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>; <span class="id">crush</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">rewrite</span> <span class="id">neq_eqb</span>; <span class="tactic">auto</span>].<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_and_elim</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> σ <span class="id">A1</span> <span class="id">A2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ (<span class="id">A1</span> ∧ <span class="id">A2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A1</span> /\ <span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof144')">Proof.</div>
<div class="proofscript" id="proof144">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_and_intro</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> σ <span class="id">A1</span> <span class="id">A2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A1</span> /\ <span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ (<span class="id">A1</span> ∧ <span class="id">A2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof145')">Proof.</div>
<div class="proofscript" id="proof145">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ha</span>; <span class="tactic">inversion</span> <span class="id">Hb</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">frsh</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_arr_elim</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> σ <span class="id">A1</span> <span class="id">A2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ (<span class="id">A1</span> ⇒ <span class="id">A2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A1</span> /\ <span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof146')">Proof.</div>
<div class="proofscript" id="proof146">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_arr_intro</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> σ <span class="id">A1</span> <span class="id">A2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A1</span> /\ <span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ (<span class="id">A1</span> ⇒ <span class="id">A2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof147')">Proof.</div>
<div class="proofscript" id="proof147">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ha</span>; <span class="tactic">inversion</span> <span class="id">Hb</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">frsh</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_all_elim</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> σ <span class="id">A</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ (∀<span class="id">x</span>∙<span class="id">A</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof148')">Proof.</div>
<div class="proofscript" id="proof148">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_all_intro</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> σ <span class="id">A</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ (∀<span class="id">x</span>∙<span class="id">A</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof149')">Proof.</div>
<div class="proofscript" id="proof149">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">fresh_notin</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> σ <span class="id">A1</span> <span class="id">A2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_Ax</span> <span class="id">A2</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof150')">Proof.</div>
<div class="proofscript" id="proof150">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> σ <span class="id">A1</span> <span class="id">A2</span> <span class="id">Hfrsh</span> <span class="id">Hnotin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hfrsh</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">map_update_</span>σ :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ <span class="id">z</span> <span class="id">v</span>, (<span class="id">exists</span> ϕ ψ, <span class="id">snd</span> σ = ϕ :: ψ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mapp</span> (<span class="id">update_</span>σ<span class="id">_map</span> σ <span class="id">z</span> <span class="id">v</span>) <span class="id">z</span> = <span class="id">Some</span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof151')">Proof.</div>
<div class="proofscript" id="proof151">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">mapp</span>, <span class="id">configMapStack</span>, <span class="id">mapp</span>, <span class="id">stackMap</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> σ <span class="kwd">as</span> [χ ψ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ψ <span class="kwd">as</span> [|ϕ ψ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [ϕ <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [ψ <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqb_refl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">reduction_preserves_addr_classes</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> σ1 σ2, <span class="id">M</span> ∙ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (α : <span class="id">addr</span>) <span class="id">o1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mapp</span> σ1 α = <span class="id">Some</span> <span class="id">o1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">o2</span>, <span class="id">mapp</span> σ2 α = <span class="id">Some</span> <span class="id">o2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cname</span> <span class="id">o2</span> = <span class="id">cname</span> <span class="id">o1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof152')">Proof.</div>
<div class="proofscript" id="proof152">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">mapp</span>, <span class="id">configMapHeap</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;asgn&nbsp;fld*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> α0 α) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> {| <span class="id">cname</span> := <span class="id">cname</span> <span class="id">o</span>; <span class="id">flds</span> := <span class="id">update</span> <span class="id">f</span> <span class="id">v</span> (<span class="id">flds</span> <span class="id">o</span>); <span class="id">meths</span> := <span class="id">meths</span> <span class="id">o</span> |};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqb_refl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">o1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">neq_eqb</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">eq_dec</span> α0 α) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span>; <span class="tactic">eapply</span> <span class="id">fresh_heap_some_contradiction</span>; <span class="tactic">eauto</span>|].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">o1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">neq_eqb</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reduction_preserves_addr_classes</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">reduction_preserves_addr_classes</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reductions_preserves_addr_classes</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (α : <span class="id">addr</span>) <span class="id">o1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mapp</span> σ1 α = <span class="id">Some</span> <span class="id">o1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">o2</span>, <span class="id">mapp</span> σ2 α = <span class="id">Some</span> <span class="id">o2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cname</span> <span class="id">o2</span> = <span class="id">cname</span> <span class="id">o1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof153')">Proof.</div>
<div class="proofscript" id="proof153">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHHred</span> <span class="kwd">with</span> (α:=α)(<span class="id">o1</span>:=<span class="id">o1</span>) <span class="kwd">as</span> [<span class="id">o</span> <span class="id">Hclass</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">reduction_preserves_addr_classes</span> <span class="kwd">as</span> [<span class="id">o</span>' <span class="id">Hclass1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>; <span class="id">crush</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reductions_preserves_addr_classes</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">reductions_preserves_addr_classes</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reduction_preserves_addr_classes</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (α : <span class="id">addr</span>) <span class="id">o1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mapp</span> σ1 α = <span class="id">Some</span> <span class="id">o1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">o2</span>, <span class="id">mapp</span> σ2 α = <span class="id">Some</span> <span class="id">o2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cname</span> <span class="id">o2</span> = <span class="id">cname</span> <span class="id">o1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof154')">Proof.</div>
<div class="proofscript" id="proof154">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">pair_reduction_preserves_addr_classes</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">pair_reduction_preserves_addr_classes</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reductions_preserves_addr_classes</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳⋆ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (α : <span class="id">addr</span>) <span class="id">o1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mapp</span> σ1 α = <span class="id">Some</span> <span class="id">o1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">o2</span>, <span class="id">mapp</span> σ2 α = <span class="id">Some</span> <span class="id">o2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cname</span> <span class="id">o2</span> = <span class="id">cname</span> <span class="id">o1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof155')">Proof.</div>
<div class="proofscript" id="proof155">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">pair_reduction_preserves_addr_classes</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(α:=α)(<span class="id">o1</span>:=<span class="id">o1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [<span class="id">o</span> <span class="id">Hclass1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">IHHred</span> <span class="kwd">as</span> [<span class="id">o</span>' <span class="id">Hclass2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>; <span class="id">crush</span>.<br/>
&nbsp;&nbsp;<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">pair_reductions_preserves_addr_classes</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">pair_reductions_preserves_addr_classes</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reductions_implies_method_call</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> χ ϕ ψ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1 = (χ, ϕ::ψ) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">exists</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span>, (<span class="id">exists</span> <span class="id">C</span> <span class="id">CDef</span>, <span class="id">classOf</span> <span class="id">y</span> σ1 <span class="id">C</span> /\ <span class="id">M1</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">zs</span> <span class="id">s</span>, <span class="id">CDef</span>.(<span class="id">c_meths</span>) <span class="id">m</span> = <span class="id">Some</span> (<span class="id">zs</span>, <span class="id">s</span>))) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">contn</span> ϕ = <span class="id">c_stmt</span> (<span class="id">s_meth</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>, <span class="id">contn</span> ϕ = <span class="id">c_stmt</span> (<span class="id">s_stmts</span> (<span class="id">s_meth</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span>) <span class="id">s</span>))) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">x</span>, (<span class="id">exists</span> <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ1 <span class="id">C</span> /\ <span class="id">M1</span> <span class="id">C</span> = <span class="id">None</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">contn</span> ϕ = <span class="id">c_stmt</span> (<span class="id">s_rtrn</span> <span class="id">x</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>, <span class="id">contn</span> ϕ = <span class="id">c_stmt</span> (<span class="id">s_stmts</span> (<span class="id">s_rtrn</span> <span class="id">x</span>) <span class="id">s</span>)))).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof156')">Proof.</div>
<div class="proofscript" id="proof156">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*meth&nbsp;call*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> χ, ϕ, ψ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">auto</span>|<span class="id">left</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>, <span class="id">y</span>, <span class="id">m</span>, <span class="id">ps</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">cname</span> <span class="id">o</span>), <span class="id">C</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">cls_of</span>) <span class="kwd">with</span> (α:=α)(χ:=χ)(<span class="id">o</span>:=<span class="id">o</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">extend</span> <span class="kwd">in</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">M1</span> (<span class="id">cname</span> <span class="id">o</span>)) <span class="kwd">as</span> <span class="id">M1Lookup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">M1Lookup</span> <span class="kwd">as</span> [<span class="id">CDef</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H2</span> (<span class="id">cname</span> <span class="id">o</span>)) <span class="kwd">as</span> [<span class="id">CDef</span> <span class="id">HCDef</span>]; [|<span class="id">crush</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cls_of</span> <span class="kwd">with</span> (α:=α)(χ:=χ)(<span class="id">o</span>:=<span class="id">o</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id">vMap</span> := <span class="id">update</span> <span class="id">this</span> (<span class="id">v_addr</span> α) (<span class="id">ps</span> ∘ (<span class="id">vMap</span> ϕ)); <span class="id">contn</span> := <span class="id">c_stmt</span> <span class="id">s</span> |} <span class="kwd">as</span> ϕ'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id">vMap</span> := <span class="id">vMap</span> ϕ; <span class="id">contn</span> := <span class="id">c_hole</span> <span class="id">x</span> <span class="id">s</span>' |} <span class="kwd">as</span> ϕ''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">int_x</span> <span class="kwd">with</span> (ϕ:=ϕ')(ψ:=ϕ''::ψ);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> ϕ';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqb_refl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;var&nbsp;asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H7</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">cname</span> <span class="id">o0</span>) <span class="kwd">as</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H2</span> <span class="id">C</span>) <span class="kwd">as</span> [<span class="id">CDef</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cls_of</span> <span class="kwd">with</span> (α:=α0)(χ:=χ)(<span class="id">o</span>:=<span class="id">o0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">int_x</span> <span class="kwd">with</span> (ψ:=ψ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ϕ:=<span class="id">update_</span>ϕ<span class="id">_map</span> ϕ <span class="id">x</span> <span class="id">v</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update_</span>ϕ<span class="id">_map</span>, <span class="id">update</span>, <span class="id">t_update</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span> <span class="kwd">as</span> [<span class="id">n</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span> <span class="kwd">as</span> [|<span class="id">n</span>'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">crush</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H11</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;f&nbsp;asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H7</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">cname</span> <span class="id">o0</span>) <span class="kwd">as</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">with</span> (<span class="id">C</span>:=<span class="id">C</span>) <span class="kwd">as</span> [<span class="id">CDef</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> ({| <span class="id">cname</span> := <span class="id">cname</span> <span class="id">o</span>; <span class="id">flds</span> := <span class="id">update</span> <span class="id">f</span> <span class="id">v</span> (<span class="id">flds</span> <span class="id">o</span>); <span class="id">meths</span> := <span class="id">meths</span> <span class="id">o</span> |})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">o</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> α0 α) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span> α0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cls_of</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(α:=α)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(χ:=<span class="id">update</span> α <span class="id">o</span>' χ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">o</span>:=<span class="id">o</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">apply</span> <span class="id">cls_of</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(α:=α0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(χ:=<span class="id">update</span> α <span class="id">o</span>' χ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">o</span>:=<span class="id">o0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">int_x</span> <span class="kwd">with</span> (ψ:=ψ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ϕ:={| <span class="id">vMap</span> := <span class="id">vMap</span> ϕ; <span class="id">contn</span> := <span class="id">c_stmt</span> <span class="id">s</span> |});<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H11</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">update_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">int_x</span> <span class="kwd">with</span> (ψ:=ψ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ϕ:={| <span class="id">vMap</span> := <span class="id">vMap</span> ϕ; <span class="id">contn</span> := <span class="id">c_stmt</span> <span class="id">s</span> |});<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H11</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">update_auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H12</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;new&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">update</span> α {| <span class="id">cname</span> := <span class="id">C</span>; <span class="id">flds</span> := <span class="id">fMap</span> ∘ (<span class="id">vMap</span> ϕ); <span class="id">meths</span> := <span class="id">c_meths</span> <span class="id">CDef</span> |} χ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id">vMap</span> := <span class="id">update</span> <span class="id">x</span> (<span class="id">v_addr</span> α) (<span class="id">vMap</span> ϕ); <span class="id">contn</span> := <span class="id">c_stmt</span> <span class="id">s</span> |} :: ψ) <span class="kwd">as</span> σ'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hthis</span> : <span class="id">has_self_</span>σ σ');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">eapply</span> <span class="id">reduction_preserves_config_has_self</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hthis</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id">vMap</span> := <span class="id">update</span> <span class="id">x</span> (<span class="id">v_addr</span> α) (<span class="id">vMap</span> ϕ); <span class="id">contn</span> := <span class="id">c_stmt</span> <span class="id">s</span> |} <span class="kwd">as</span> σ'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hin</span> : <span class="id">In</span> σ' (σ'::ψ));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">in_eq</span>|<span class="tactic">apply</span> <span class="id">H11</span> <span class="kwd">in</span> <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H10</span> <span class="kwd">as</span> [α' <span class="id">Ha</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [<span class="id">o</span>'];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span> <span class="kwd">in</span> <span class="id">Ha</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">neq_eqb</span> <span class="kwd">in</span> <span class="id">Ha</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eq_dec</span> α' α) <span class="kwd">as</span> [|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H10</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hin</span>' : <span class="id">In</span> ϕ (ϕ::ψ));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">in_eq</span>|<span class="tactic">apply</span> <span class="id">H16</span> <span class="kwd">in</span> <span class="id">Hin</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hin</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H15</span> <span class="kwd">as</span> [α0 <span class="id">Hx</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hx</span> <span class="kwd">as</span> [<span class="id">o0</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ha0</span> <span class="kwd">in</span> <span class="id">Ha</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ha</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fresh_heap_some_contradiction</span>; <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span> <span class="kwd">in</span> <span class="id">Hb</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">neq_eqb</span> <span class="kwd">in</span> <span class="id">Hb</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id">cname</span> := <span class="id">C</span>; <span class="id">flds</span> := <span class="id">fMap</span> ∘ (<span class="id">vMap</span> ϕ); <span class="id">meths</span> := <span class="id">c_meths</span> <span class="id">CDef</span> |} <span class="kwd">as</span> <span class="id">o</span>α.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>' <span class="kwd">as</span> [<span class="id">C</span>' <span class="id">fs</span> <span class="id">ms</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H2</span> <span class="id">C</span>') <span class="kwd">as</span> [<span class="id">CDef</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">remember</span> {| <span class="id">cname</span> := <span class="id">C</span>'; <span class="id">flds</span> := <span class="id">fs</span>; <span class="id">meths</span> := <span class="id">ms</span> |} <span class="kwd">as</span> <span class="id">o</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cls_of</span> <span class="kwd">with</span> (α:=α')(χ:=<span class="id">update</span> α <span class="id">o</span>α χ)(<span class="id">o</span>:=<span class="id">o</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">remember</span> {| <span class="id">vMap</span> := <span class="id">update</span> <span class="id">x</span> (<span class="id">v_addr</span> α) (<span class="id">vMap</span> ϕ); <span class="id">contn</span> := <span class="id">c_stmt</span> <span class="id">s</span> |} <span class="kwd">as</span> ϕ'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">int_x</span> <span class="kwd">with</span> (ψ:=ψ)(ϕ:=ϕ');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">neq_eqb</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">subst</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">update</span>, <span class="id">t_update</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">repeat</span> <span class="id">map_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eq_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H10</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">crush</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> {| <span class="id">cname</span> := <span class="id">C</span>'; <span class="id">flds</span> := <span class="id">fs</span>; <span class="id">meths</span> := <span class="id">ms</span> |} <span class="kwd">as</span> <span class="id">o</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cls_of</span> <span class="kwd">with</span> (α:=α')(χ:=χ)(<span class="id">o</span>:=<span class="id">o</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">crush</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">int_x</span> <span class="kwd">with</span> (ϕ:=ϕ)(ψ:=ψ);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ret&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H3</span> <span class="id">into</span> <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> χ, ϕ, (ϕ'::ψ);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">auto</span>|<span class="id">right</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H3</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hin</span> : <span class="id">In</span> ϕ (ϕ :: ϕ' :: ψ));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">in_eq</span>|<span class="tactic">apply</span> <span class="id">H12</span> <span class="kwd">in</span> <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H11</span> <span class="kwd">as</span> [α' <span class="id">Htmp</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htmp</span> <span class="kwd">as</span> [<span class="id">o</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">classOf</span> <span class="id">this</span> (χ, ϕ::ϕ'::ψ) (<span class="id">cname</span> <span class="id">o</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cls_of</span> <span class="kwd">with</span> (α:=α')(χ:=χ)(<span class="id">o</span>:=<span class="id">o</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">int_x</span> <span class="kwd">with</span> (ψ:=ϕ' :: ψ)(ϕ:=ϕ);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ret&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">H3</span> <span class="id">into</span> <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> χ, ϕ, (ϕ'::ψ);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">auto</span>|<span class="id">right</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H3</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hin</span> : <span class="id">In</span> ϕ (ϕ :: (ϕ'::ψ)));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id">in_eq</span>|<span class="tactic">apply</span> <span class="id">H12</span> <span class="kwd">in</span> <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H11</span> <span class="kwd">as</span> [α' <span class="id">Htmp</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htmp</span> <span class="kwd">as</span> [<span class="id">o</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">andDestruct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">classOf</span> <span class="id">this</span> (χ, ϕ::ϕ'::ψ) (<span class="id">cname</span> <span class="id">o</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">cls_of</span> <span class="kwd">with</span> (α:=α')(χ:=χ)(<span class="id">o</span>:=<span class="id">o</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">int_x</span> <span class="kwd">with</span> (ψ:=ϕ'::ψ)(ϕ:=ϕ);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reductions_implies_method_call</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">pair_reduction_implies_method_call</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> χ ϕ ψ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ1 = (χ, ϕ::ψ) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">exists</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span>, (<span class="id">exists</span> <span class="id">C</span> <span class="id">CDef</span>, <span class="id">classOf</span> <span class="id">y</span> σ1 <span class="id">C</span> /\ <span class="id">M1</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">zs</span> <span class="id">s</span>, <span class="id">CDef</span>.(<span class="id">c_meths</span>) <span class="id">m</span> = <span class="id">Some</span> (<span class="id">zs</span>, <span class="id">s</span>))) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">contn</span> ϕ = <span class="id">c_stmt</span> (<span class="id">s_meth</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>, <span class="id">contn</span> ϕ = <span class="id">c_stmt</span> (<span class="id">s_stmts</span> (<span class="id">s_meth</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span>) <span class="id">s</span>))) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">x</span>, (<span class="id">exists</span> <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ1 <span class="id">C</span> /\ <span class="id">M1</span> <span class="id">C</span> = <span class="id">None</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">contn</span> ϕ = <span class="id">c_stmt</span> (<span class="id">s_rtrn</span> <span class="id">x</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>, <span class="id">contn</span> ϕ = <span class="id">c_stmt</span> (<span class="id">s_stmts</span> (<span class="id">s_rtrn</span> <span class="id">x</span>) <span class="id">s</span>)))).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof157')">Proof.</div>
<div class="proofscript" id="proof157">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">pair_reduction_implies_method_call</span>.<br/>
<br/>
<span class="kwd">Parameter</span> <span class="id">fresh_exists_for_expression</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span>, <span class="id">exists</span> <span class="id">x</span>, <span class="id">notin_exp</span> <span class="id">e</span> <span class="id">x</span>.<br/>
<br/>
<span class="kwd">Parameter</span> <span class="id">fresh_exists_for_assertion</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span>, <span class="id">exists</span> <span class="id">x</span>, <span class="id">notin_Ax</span> <span class="id">A</span> <span class="id">x</span>.<br/>
<br/>
<br/>
<span class="kwd">Parameter</span> <span class="id">fresh_x_exists_for_finite_config</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> σ, <span class="id">finite_</span>σ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span>, <span class="id">exists</span> <span class="id">x</span>, <span class="id">fresh_x</span> <span class="id">x</span> σ <span class="id">A</span>.<br/>
<br/>
<span class="kwd">Parameter</span> <span class="id">fresh_address_rename_equality_heap</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> α1 α2 (χ : <span class="id">heap</span>),  χ α1 = <span class="id">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ α2 = <span class="id">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">o</span>, <span class="id">update</span> α1 <span class="id">o</span> χ = <span class="id">update</span> α2 <span class="id">o</span> χ.<br/>
<br/>
<span class="kwd">Parameter</span> <span class="id">fresh_address_rename_equality_state</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> α1 α2 (χ : <span class="id">heap</span>),  χ α1 = <span class="id">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ α2 = <span class="id">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> (<span class="id">x</span>:<span class="id">var</span>), <span class="id">update</span> <span class="id">x</span> (<span class="id">v_addr</span> α1) <span class="id">m</span> = <span class="id">update</span> <span class="id">x</span> (<span class="id">v_addr</span> α2) <span class="id">m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">reduction_unique</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span> σ σ1, <span class="id">M</span> ∙ σ ⤳ σ1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> σ2, <span class="id">M</span> ∙ σ ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ2 = σ1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof158')">Proof.</div>
<div class="proofscript" id="proof158">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">M</span> σ σ1 <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hred</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;meth&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H9</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H8</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H10</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">interpretation_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;vAssgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H8</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H10</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H11</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H11</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">interpretation_rewrite</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;fAssgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H11</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H12</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H13</span> <span class="kwd">in</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">interpretation_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;new&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H9</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H11</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H12</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H12</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H1</span> : <span class="id">fresh_</span>χ ?χ ?α<span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span> : <span class="id">fresh_</span>χ ?χ ?α<span class="id">b</span> |- <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">fresh_heap_unique</span> <span class="kwd">with</span> (α1:=α<span class="id">a</span>) <span class="kwd">in</span> <span class="id">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ret1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H5</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">interpretation_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;- <span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H5</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">interpretation_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">reduction_unique</span>.<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
