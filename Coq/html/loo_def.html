
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module loo_def</title>
<meta name="description" content="Documentation of Coq module loo_def" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module loo_def</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Export</span> <span class="id">Arith</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">CpdtTactics</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">common</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coq.Logic.FunctionalExtensionality</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">fld</span> : <span class="kwd">Type</span> := <span class="id">fieldID</span> : <span class="id">nat</span> -&gt; <span class="id">fld</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">mth</span> : <span class="kwd">Type</span> := <span class="id">methID</span> : <span class="id">nat</span> -&gt; <span class="id">mth</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">gfld</span> : <span class="kwd">Type</span> := <span class="id">gFieldID</span> : <span class="id">nat</span> -&gt; <span class="id">gfld</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">cls</span> : <span class="kwd">Type</span> := <span class="id">classID</span> : <span class="id">nat</span> -&gt; <span class="id">cls</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">addr</span> : <span class="kwd">Type</span> := <span class="id">address</span> : <span class="id">nat</span> -&gt; <span class="id">addr</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">value</span> : <span class="kwd">Type</span> :=<br/>
| <span class="id">v_true</span>  : <span class="id">value</span><br/>
| <span class="id">v_false</span> : <span class="id">value</span><br/>
| <span class="id">v_null</span>  : <span class="id">value</span><br/>
| <span class="id">v_addr</span>   : <span class="id">addr</span> -&gt; <span class="id">value</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">state</span> := <span class="id">partial_map</span> <span class="id">var</span> <span class="id">value</span>.<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">eqbFld</span> : <span class="id">Eq</span> <span class="id">fld</span> :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqb</span> := <span class="kwd">fun</span> <span class="id">f1</span> <span class="id">f2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">f1</span>, <span class="id">f2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">fieldID</span> <span class="id">n1</span>, <span class="id">fieldID</span> <span class="id">n2</span> =&gt; <span class="id">n1</span> =? <span class="id">n2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10')">Next Obligation.</div>
<div class="proofscript" id="proof10">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">apply</span> <span class="id">Nat.eqb_refl</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof11')">Next Obligation.</div>
<div class="proofscript" id="proof11">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">a1</span>; <span class="tactic">destruct</span> <span class="id">a2</span>; <span class="tactic">apply</span> <span class="id">Nat.eqb_sym</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof12')">Next Obligation.</div>
<div class="proofscript" id="proof12">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">beq_nat_eq</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof13')">Next Obligation.</div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Nat.eqb_neq</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof14')">Next Obligation.</div>
<div class="proofscript" id="proof14">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Nat.eqb_neq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof15')">Next Obligation.</div>
<div class="proofscript" id="proof15">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span> <span class="kwd">as</span> [<span class="id">n</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span> <span class="kwd">as</span> [<span class="id">m</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Nat.eq_dec</span> <span class="id">n</span> <span class="id">m</span>) <span class="kwd">as</span> [<span class="id">Heq</span>|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">eqbMth</span> : <span class="id">Eq</span> <span class="id">mth</span> :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqb</span> := <span class="kwd">fun</span> <span class="id">m1</span> <span class="id">m2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m1</span>, <span class="id">m2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">methID</span> <span class="id">n1</span>, <span class="id">methID</span> <span class="id">n2</span> =&gt; <span class="id">n1</span> =? <span class="id">n2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof16')">Next Obligation.</div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">apply</span> <span class="id">Nat.eqb_refl</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof17')">Next Obligation.</div>
<div class="proofscript" id="proof17">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">a1</span>; <span class="tactic">destruct</span> <span class="id">a2</span>; <span class="tactic">apply</span> <span class="id">Nat.eqb_sym</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof18')">Next Obligation.</div>
<div class="proofscript" id="proof18">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">beq_nat_eq</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof19')">Next Obligation.</div>
<div class="proofscript" id="proof19">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Nat.eqb_neq</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof20')">Next Obligation.</div>
<div class="proofscript" id="proof20">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Nat.eqb_neq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof21')">Next Obligation.</div>
<div class="proofscript" id="proof21">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span> <span class="kwd">as</span> [<span class="id">n</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span> <span class="kwd">as</span> [<span class="id">m</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Nat.eq_dec</span> <span class="id">n</span> <span class="id">m</span>) <span class="kwd">as</span> [<span class="id">Heq</span>|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">eqbGfld</span> : <span class="id">Eq</span> <span class="id">gfld</span> :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqb</span> := <span class="kwd">fun</span> <span class="id">g1</span> <span class="id">g2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">g1</span>, <span class="id">g2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">gFieldID</span> <span class="id">n1</span>, <span class="id">gFieldID</span> <span class="id">n2</span> =&gt; <span class="id">n1</span> =? <span class="id">n2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof22')">Next Obligation.</div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">apply</span> <span class="id">Nat.eqb_refl</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof23')">Next Obligation.</div>
<div class="proofscript" id="proof23">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">a1</span>; <span class="tactic">destruct</span> <span class="id">a2</span>; <span class="tactic">apply</span> <span class="id">Nat.eqb_sym</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof24')">Next Obligation.</div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">beq_nat_eq</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof25')">Next Obligation.</div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Nat.eqb_neq</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof26')">Next Obligation.</div>
<div class="proofscript" id="proof26">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Nat.eqb_neq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof27')">Next Obligation.</div>
<div class="proofscript" id="proof27">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span> <span class="kwd">as</span> [<span class="id">n</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span> <span class="kwd">as</span> [<span class="id">m</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Nat.eq_dec</span> <span class="id">n</span> <span class="id">m</span>) <span class="kwd">as</span> [<span class="id">Heq</span>|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">eqbCls</span> : <span class="id">Eq</span> <span class="id">cls</span> :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqb</span> := <span class="kwd">fun</span> <span class="id">C1</span> <span class="id">C2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">C1</span>, <span class="id">C2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">classID</span> <span class="id">n1</span>, <span class="id">classID</span> <span class="id">n2</span> =&gt; <span class="id">n1</span> =? <span class="id">n2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof28')">Next Obligation.</div>
<div class="proofscript" id="proof28">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">apply</span> <span class="id">Nat.eqb_refl</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof29')">Next Obligation.</div>
<div class="proofscript" id="proof29">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">a1</span>; <span class="tactic">destruct</span> <span class="id">a2</span>; <span class="tactic">apply</span> <span class="id">Nat.eqb_sym</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof30')">Next Obligation.</div>
<div class="proofscript" id="proof30">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">beq_nat_eq</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof31')">Next Obligation.</div>
<div class="proofscript" id="proof31">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Nat.eqb_neq</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof32')">Next Obligation.</div>
<div class="proofscript" id="proof32">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Nat.eqb_neq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof33')">Next Obligation.</div>
<div class="proofscript" id="proof33">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span> <span class="kwd">as</span> [<span class="id">n</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span> <span class="kwd">as</span> [<span class="id">m</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Nat.eq_dec</span> <span class="id">n</span> <span class="id">m</span>) <span class="kwd">as</span> [<span class="id">Heq</span>|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">eqbAddr</span> : <span class="id">Eq</span> <span class="id">addr</span> :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqb</span> := <span class="kwd">fun</span> <span class="id">a1</span> <span class="id">a2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a1</span>, <span class="id">a2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">address</span> <span class="id">n1</span>, <span class="id">address</span> <span class="id">n2</span> =&gt; <span class="id">n1</span> =? <span class="id">n2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof34')">Next Obligation.</div>
<div class="proofscript" id="proof34">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">apply</span> <span class="id">Nat.eqb_refl</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof35')">Next Obligation.</div>
<div class="proofscript" id="proof35">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">a1</span>; <span class="tactic">destruct</span> <span class="id">a2</span>; <span class="tactic">apply</span> <span class="id">Nat.eqb_sym</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof36')">Next Obligation.</div>
<div class="proofscript" id="proof36">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">beq_nat_eq</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof37')">Next Obligation.</div>
<div class="proofscript" id="proof37">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Nat.eqb_neq</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof38')">Next Obligation.</div>
<div class="proofscript" id="proof38">
&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Nat.eqb_neq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<div class="toggleproof" onclick="toggleDisplay('proof39')">Next Obligation.</div>
<div class="proofscript" id="proof39">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a1</span> <span class="kwd">as</span> [<span class="id">n</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a2</span> <span class="kwd">as</span> [<span class="id">m</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Nat.eq_dec</span> <span class="id">n</span> <span class="id">m</span>) <span class="kwd">as</span> [<span class="id">Heq</span>|<span class="id">Hneq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">this</span> := <span class="id">bnd</span> 0.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">fields</span> := <span class="id">partial_map</span> <span class="id">fld</span> <span class="id">value</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">ref</span> : <span class="kwd">Type</span> :=<br/>
| <span class="id">r_var</span> : <span class="id">var</span> -&gt; <span class="id">ref</span><br/>
| <span class="id">r_fld</span> : <span class="id">var</span> -&gt; <span class="id">fld</span> -&gt; <span class="id">ref</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">ref</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">stmt</span> : <span class="kwd">Type</span> :=<br/>
| <span class="id">s_asgn</span> : <span class="id">ref</span> -&gt; <span class="id">ref</span> -&gt; <span class="id">stmt</span><br/>
| <span class="id">s_meth</span> : <span class="id">var</span> -&gt; <span class="id">var</span> -&gt; <span class="id">mth</span> -&gt; <span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span> -&gt; <span class="id">stmt</span><br/>
| <span class="id">s_new</span>  : <span class="id">var</span> -&gt; <span class="id">cls</span> -&gt; <span class="id">partial_map</span> <span class="id">fld</span> <span class="id">var</span> -&gt; <span class="id">stmt</span><br/>
| <span class="id">s_stmts</span> : <span class="id">stmt</span> -&gt; <span class="id">stmt</span> -&gt; <span class="id">stmt</span><br/>
| <span class="id">s_rtrn</span> : <span class="id">var</span> -&gt; <span class="id">stmt</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">stmt</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">continuation</span> : <span class="kwd">Type</span> :=<br/>
| <span class="id">c_stmt</span> : <span class="id">stmt</span> -&gt; <span class="id">continuation</span><br/>
| <span class="id">c_hole</span> : <span class="id">var</span> -&gt; <span class="id">stmt</span> -&gt; <span class="id">continuation</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">continuation</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">exp</span> : <span class="kwd">Type</span> :=<br/>
| <span class="id">e_val</span>   : <span class="id">value</span> -&gt; <span class="id">exp</span><br/>
| <span class="id">e_var</span>   : <span class="id">var</span> -&gt; <span class="id">exp</span><br/>
| <span class="id">e_hole</span>  : <span class="id">nat</span> -&gt; <span class="id">exp</span><br/>
| <span class="id">e_eq</span>    : <span class="id">exp</span> -&gt; <span class="id">exp</span> -&gt; <span class="id">exp</span><br/>
| <span class="id">e_if</span>    : <span class="id">exp</span> -&gt; <span class="id">exp</span> -&gt; <span class="id">exp</span> -&gt; <span class="id">exp</span><br/>
| <span class="id">e_acc_f</span> : <span class="id">exp</span> -&gt; <span class="id">fld</span> -&gt; <span class="id">exp</span><br/>
| <span class="id">e_acc_g</span> : <span class="id">exp</span> -&gt; <span class="id">gfld</span> -&gt; <span class="id">exp</span> -&gt; <span class="id">exp</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">exp</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Notation</span> "'<span class="id">e_true</span>'" := (<span class="id">e_val</span> <span class="id">v_true</span>)(<span class="tactic">at</span> <span class="id">level</span> 40).<br/>
<span class="kwd">Notation</span> "'<span class="id">e_false</span>'" := (<span class="id">e_val</span> <span class="id">v_false</span>)(<span class="tactic">at</span> <span class="id">level</span> 40).<br/>
<span class="kwd">Notation</span> "'<span class="id">e_null</span>'" := (<span class="id">e_val</span> <span class="id">v_null</span>)(<span class="tactic">at</span> <span class="id">level</span> 40).<br/>
<span class="kwd">Notation</span> "'<span class="id">e_addr</span>' <span class="id">r</span>" := (<span class="id">e_val</span> (<span class="id">v_addr</span> <span class="id">r</span>))(<span class="tactic">at</span> <span class="id">level</span> 40).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">methods</span> := <span class="id">partial_map</span> <span class="id">mth</span> ((<span class="id">list</span> <span class="id">var</span>) * <span class="id">stmt</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ghost_fields</span> := <span class="id">partial_map</span> <span class="id">gfld</span> (<span class="id">var</span> * <span class="id">exp</span>).<br/>
<br/>
<span class="kwd">Record</span> <span class="id">classDef</span> := <span class="id">clazz</span>{<span class="id">c_name</span> : <span class="id">cls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">c_flds</span> : <span class="id">list</span> <span class="id">fld</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">c_meths</span> : <span class="id">methods</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">c_g_fields</span>: <span class="id">ghost_fields</span>}.<br/>
<br/>
<span class="kwd">Record</span> <span class="id">obj</span> := <span class="id">new</span>{<span class="id">cname</span> : <span class="id">cls</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">flds</span> : <span class="id">fields</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">meths</span> : <span class="id">methods</span>}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ObjectName</span> := <span class="id">classID</span> 0.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ObjectDefn</span> := <span class="id">clazz</span> <span class="id">ObjectName</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">empty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">empty</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">ObjectInstance</span> := <span class="id">new</span> <span class="id">ObjectName</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">empty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">empty</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">mdl</span> := <span class="id">partial_map</span> <span class="id">cls</span> <span class="id">classDef</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">heap</span> := <span class="id">partial_map</span> <span class="id">addr</span> <span class="id">obj</span>.<br/>
<br/>
<span class="kwd">Record</span> <span class="id">frame</span> := <span class="id">frm</span>{<span class="id">vMap</span> : <span class="id">state</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contn</span> : <span class="id">continuation</span>}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">stack</span> := <span class="id">list</span> <span class="id">frame</span>.<br/>
<br/>
<br/>
<br/>
<br/>
<span class="kwd">Instance</span> <span class="id">stackMap</span> : <span class="id">Mappable</span> <span class="id">stack</span> <span class="id">var</span> (<span class="id">option</span> <span class="id">value</span>) :=<br/>
&nbsp;&nbsp;{<span class="id">mapp</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fix</span> <span class="id">mapp</span> <span class="id">S</span> <span class="id">x</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">S</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ϕ :: <span class="id">S</span>' =&gt; ϕ.(<span class="id">vMap</span>) <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">config</span> : <span class="kwd">Type</span> := (<span class="id">heap</span> * <span class="id">stack</span>).<br/>
<br/>
<span class="kwd">Instance</span> <span class="id">configMapHeap</span> : <span class="id">Mappable</span> <span class="id">config</span> <span class="id">addr</span> (<span class="id">option</span> <span class="id">obj</span>) :=<br/>
&nbsp;&nbsp;{<span class="id">mapp</span> σ α := (<span class="id">fst</span> σ) α}.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id">configMapStack</span> : <span class="id">Mappable</span> <span class="id">config</span> <span class="id">var</span> (<span class="id">option</span> <span class="id">value</span>) :=<br/>
&nbsp;&nbsp;{<span class="id">mapp</span> σ <span class="id">x</span> := <span class="id">mapp</span> (<span class="id">snd</span> σ) <span class="id">x</span>}.<br/>
<br/>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "'⌊' <span class="id">x</span> '⌋' σ '≜' α" (<span class="tactic">at</span> <span class="id">level</span> 40).<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "'⌊' Σ '⌋' σ '≜′' <span class="id">As</span>" (<span class="tactic">at</span> <span class="id">level</span> 40).<br/>
<br/>
<div class="doc"><h3> Variable and Set Interpretation (Definition 4, OOPSLA2019):</h3> </div>
<br/>
<span class="kwd">Inductive</span> <span class="id">interpret_x</span> : <span class="id">var</span> -&gt; <span class="id">config</span> -&gt; <span class="id">value</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">int_x</span> : <span class="kwd">forall</span> <span class="id">x</span> σ ψ ϕ <span class="id">v</span>, <span class="id">snd</span> σ = ϕ :: ψ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vMap</span> ϕ) <span class="id">x</span> = <span class="id">Some</span> <span class="id">v</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊ <span class="id">x</span> ⌋ σ ≜ <span class="id">v</span><br/>
<span class="kwd">where</span> "'⌊' <span class="id">x</span> '⌋' σ '≜' <span class="id">v</span>" := (<span class="id">interpret_x</span> <span class="id">x</span> σ <span class="id">v</span>).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">interpret_x</span> : <span class="id">loo_db</span>.<br/>
&nbsp;&nbsp;<br/>
<span class="kwd">Inductive</span> <span class="id">interpret_</span>Σ : <span class="id">list</span> <span class="id">var</span> -&gt; <span class="id">config</span> -&gt; <span class="id">list</span> <span class="id">value</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">int_nil</span>  : <span class="kwd">forall</span> σ, ⌊ <span class="id">nil</span> ⌋ σ ≜′ <span class="id">nil</span><br/>
| <span class="id">int_cons</span> : <span class="kwd">forall</span> <span class="id">x</span> Σ σ α α<span class="id">s</span>, ⌊ <span class="id">x</span> ⌋ σ ≜ α -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊ Σ ⌋ σ ≜′ α<span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⌊ <span class="id">x</span>::Σ ⌋ σ ≜′ (α::α<span class="id">s</span>)<br/>
<span class="kwd">where</span> "'⌊' Σ '⌋' σ '≜′' α<span class="id">s</span>" := (<span class="id">interpret_</span>Σ Σ σ α<span class="id">s</span>).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">interpret_</span>Σ : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "σ1 '↓' Σ '≜' σ2" (<span class="tactic">at</span> <span class="id">level</span> 80).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">restrict</span> : <span class="id">config</span> -&gt; <span class="id">list</span> <span class="id">var</span> -&gt; <span class="id">config</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">rstrct</span> : <span class="kwd">forall</span> Σ σ <span class="id">As</span> χ χ', ⌊ Σ ⌋ σ ≜′ <span class="id">As</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> α <span class="id">o</span>, χ' α = <span class="id">Some</span> <span class="id">o</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ α = <span class="id">Some</span> <span class="id">o</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> α <span class="id">o</span>, χ' α = <span class="id">Some</span> <span class="id">o</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> (<span class="id">v_addr</span> α) <span class="id">As</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> α <span class="id">o</span>, <span class="id">In</span> (<span class="id">v_addr</span> α) <span class="id">As</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ' α = <span class="id">Some</span> <span class="id">o</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ ↓ Σ ≜ (χ', <span class="id">snd</span> σ)<br/>
<span class="kwd">where</span> "σ1 '↓' Σ '≜' σ2" := (<span class="id">restrict</span> σ1 Σ σ2).<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">update_</span>ϕ<span class="id">_map</span> (ϕ : <span class="id">frame</span>)(<span class="id">x</span> : <span class="id">var</span>)(<span class="id">v</span> : <span class="id">value</span>) :=<br/>
&nbsp;&nbsp;<span class="id">frm</span> (<span class="id">update</span> <span class="id">x</span> <span class="id">v</span> ϕ.(<span class="id">vMap</span>)) (ϕ.(<span class="id">contn</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">update_</span>ϕ<span class="id">_contn</span> (ϕ : <span class="id">frame</span>)(<span class="id">c</span> : <span class="id">continuation</span>) :=<br/>
&nbsp;&nbsp;<span class="id">frm</span> (ϕ.(<span class="id">vMap</span>)) <span class="id">c</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">update_</span>ψ<span class="id">_map</span> (ψ : <span class="id">stack</span>)(<span class="id">x</span> : <span class="id">var</span>)(<span class="id">v</span> : <span class="id">value</span>) : <span class="id">stack</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> ψ <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;| ϕ :: ψ' =&gt; (<span class="id">update_</span>ϕ<span class="id">_map</span> ϕ <span class="id">x</span> <span class="id">v</span>) :: ψ'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">update_</span>ψ<span class="id">_contn</span> (ψ : <span class="id">stack</span>)(<span class="id">c</span> : <span class="id">continuation</span>) : <span class="id">stack</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> ψ <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;| ϕ :: ψ' =&gt; (<span class="id">update_</span>ϕ<span class="id">_contn</span> ϕ <span class="id">c</span>) :: ψ'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">update_</span>σ<span class="id">_map</span> (σ : <span class="id">config</span>)(<span class="id">x</span> : <span class="id">var</span>)(<span class="id">v</span> : <span class="id">value</span>) :=<br/>
&nbsp;&nbsp;(<span class="id">fst</span> σ, <span class="id">update_</span>ψ<span class="id">_map</span> (<span class="id">snd</span> σ) <span class="id">x</span> <span class="id">v</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">update_</span>σ<span class="id">_contn</span> (σ : <span class="id">config</span>)(<span class="id">c</span> : <span class="id">continuation</span>) :=<br/>
&nbsp;&nbsp;(<span class="id">fst</span> σ, <span class="id">update_</span>ψ<span class="id">_contn</span> (<span class="id">snd</span> σ) <span class="id">c</span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">classOf</span> : <span class="id">var</span> -&gt; <span class="id">config</span> -&gt; <span class="id">cls</span> -&gt; <span class="kwd">Prop</span> :=<br/>
|<span class="id">cls_of</span> : <span class="kwd">forall</span> <span class="id">x</span> σ α χ <span class="id">o</span> <span class="id">C</span>, ⌊ <span class="id">x</span> ⌋ σ ≜ (<span class="id">v_addr</span> α) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fst</span> σ = χ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ α = <span class="id">Some</span> <span class="id">o</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cname</span> <span class="id">o</span> = <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">classOf</span> <span class="id">x</span> σ <span class="id">C</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">finite_</span>ϕ (ϕ : <span class="id">frame</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">finite</span> (<span class="id">vMap</span> ϕ).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">finite_</span>ψ (ψ : <span class="id">stack</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> ϕ, <span class="id">In</span> ϕ ψ -&gt; <span class="id">finite_</span>ϕ ϕ.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">finite_</span>σ (σ : <span class="id">config</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">finite_</span>ψ (<span class="id">snd</span> σ).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">not_stuck</span> : <span class="id">continuation</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">ns_stmt</span> : <span class="kwd">forall</span> <span class="id">s</span>, <span class="id">not_stuck</span> (<span class="id">c_stmt</span> <span class="id">s</span>).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">not_stuck</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">not_stuck_</span>ϕ (ϕ : <span class="id">frame</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">not_stuck</span> (<span class="id">contn</span> ϕ).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">not_stuck_</span>σ (σ : <span class="id">config</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">exists</span> ϕ ψ, <span class="id">snd</span> σ = ϕ::ψ /\ <span class="id">not_stuck_</span>ϕ ϕ.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">waiting</span> : <span class="id">continuation</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">w_hole</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">s</span>, <span class="id">waiting</span> (<span class="id">c_hole</span> <span class="id">x</span> <span class="id">s</span>).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">waiting</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">waiting_</span>ϕ (ϕ : <span class="id">frame</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">waiting</span> (<span class="id">contn</span> ϕ).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">waiting_</span>ψ (ψ: <span class="id">stack</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> ϕ, <span class="id">In</span> ϕ ψ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">waiting_</span>ϕ ϕ.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">waiting_</span>σ (σ : <span class="id">config</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">exists</span> ϕ ψ, <span class="id">snd</span> σ = ϕ :: ψ /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">waiting_</span>ψ ψ.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">val_wf</span> : <span class="id">heap</span> -&gt; <span class="id">value</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">true_wf</span> : <span class="kwd">forall</span> χ, <span class="id">val_wf</span> χ <span class="id">v_true</span><br/>
| <span class="id">false_wf</span> : <span class="kwd">forall</span> χ, <span class="id">val_wf</span> χ <span class="id">v_false</span><br/>
| <span class="id">null_wf</span> : <span class="kwd">forall</span> χ, <span class="id">val_wf</span> χ <span class="id">v_null</span><br/>
| <span class="id">addr_wf</span> : <span class="kwd">forall</span> χ α <span class="id">o</span>, χ α = <span class="id">Some</span> <span class="id">o</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">val_wf</span> χ (<span class="id">v_addr</span> α).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">val_wf</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">state_wf</span> : <span class="id">heap</span> -&gt; <span class="id">state</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">st_wf</span> : <span class="kwd">forall</span> χ <span class="id">m</span>, (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span>, <span class="id">m</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">val_wf</span> χ <span class="id">v</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_wf</span> χ <span class="id">m</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">state_wf</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">has_self_</span>ϕ : <span class="id">heap</span> -&gt; <span class="id">frame</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">self_frm</span> : <span class="kwd">forall</span> χ ϕ, (<span class="id">exists</span> α <span class="id">o</span>, ϕ.(<span class="id">vMap</span>) <span class="id">this</span> = <span class="id">Some</span> (<span class="id">v_addr</span> α) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ α = <span class="id">Some</span> <span class="id">o</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>ϕ χ ϕ.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">has_self_</span>ϕ : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">has_self_</span>σ : <span class="id">config</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">self_config</span> : <span class="kwd">forall</span> χ ψ, (<span class="kwd">forall</span> ϕ, <span class="id">In</span> ϕ ψ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>ϕ χ ϕ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_self_</span>σ (χ, ψ).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">has_self_</span>σ : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> σ<span class="id">_wf</span> : <span class="id">config</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">config_wf</span> : <span class="kwd">forall</span> σ, <span class="id">has_self_</span>σ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_</span>σ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">not_stuck_</span>σ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">waiting_</span>σ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;σ<span class="id">_wf</span> σ.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> σ<span class="id">_wf</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> χ<span class="id">_wf</span> : <span class="id">mdl</span> -&gt; <span class="id">heap</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">heap_wf</span> :  <span class="kwd">forall</span> <span class="id">M</span> χ, (<span class="kwd">forall</span> α <span class="id">o</span> <span class="id">C</span>, χ α = <span class="id">Some</span> <span class="id">o</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cname</span> <span class="id">o</span> = <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">CDef</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">f</span>, <span class="id">In</span> <span class="id">f</span> (<span class="id">c_flds</span> <span class="id">CDef</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>, (<span class="id">flds</span> <span class="id">o</span>) <span class="id">f</span> = <span class="id">Some</span> <span class="id">v</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">meths</span> <span class="id">o</span>) = (<span class="id">c_meths</span> <span class="id">CDef</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;χ<span class="id">_wf</span> <span class="id">M</span> χ.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> χ<span class="id">_wf</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">notin_exp</span> : <span class="id">exp</span> -&gt; <span class="id">var</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">ni_val</span>   : <span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span>, <span class="id">notin_exp</span> (<span class="id">e_val</span> <span class="id">v</span>) <span class="id">x</span><br/>
| <span class="id">ni_var</span>   : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">x</span> &lt;&gt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_exp</span> (<span class="id">e_var</span> <span class="id">x</span>) <span class="id">y</span><br/>
| <span class="id">ni_hole</span>  : <span class="kwd">forall</span> <span class="id">m</span> <span class="id">x</span>, <span class="id">notin_exp</span> (<span class="id">e_hole</span> <span class="id">m</span>) <span class="id">x</span><br/>
| <span class="id">ni_eq</span>    : <span class="kwd">forall</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">x</span>, <span class="id">notin_exp</span> <span class="id">e1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_exp</span> <span class="id">e2</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_exp</span> (<span class="id">e_eq</span> <span class="id">e1</span> <span class="id">e2</span>) <span class="id">x</span><br/>
| <span class="id">ni_if</span>    : <span class="kwd">forall</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">e3</span> <span class="id">x</span>, <span class="id">notin_exp</span> <span class="id">e1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_exp</span> <span class="id">e2</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_exp</span> <span class="id">e3</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_exp</span> (<span class="id">e_if</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">e3</span>) <span class="id">x</span><br/>
| <span class="id">ni_acc_f</span> : <span class="kwd">forall</span> <span class="id">e</span> <span class="id">f</span> <span class="id">x</span>, <span class="id">notin_exp</span> <span class="id">e</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_exp</span> (<span class="id">e_acc_f</span> <span class="id">e</span> <span class="id">f</span>) <span class="id">x</span><br/>
| <span class="id">ni_acc_g</span> : <span class="kwd">forall</span> <span class="id">e</span> <span class="id">f</span> <span class="id">e</span>' <span class="id">x</span>, <span class="id">notin_exp</span> <span class="id">e</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_exp</span> <span class="id">e</span>' <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_exp</span> (<span class="id">e_acc_g</span> <span class="id">e</span> <span class="id">f</span> <span class="id">e</span>') <span class="id">x</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">notin_exp</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">notin_ref</span> : <span class="id">ref</span> -&gt; <span class="id">var</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">ni_ref_var</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">x</span> &lt;&gt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_ref</span> (<span class="id">r_var</span> <span class="id">x</span>) <span class="id">y</span><br/>
| <span class="id">ni_ref_fld</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">f</span>, <span class="id">x</span> &lt;&gt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_ref</span> (<span class="id">r_fld</span> <span class="id">x</span> <span class="id">f</span>) <span class="id">y</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">notin_ref</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">notin_stmt</span> : <span class="id">stmt</span> -&gt; <span class="id">var</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">ni_asgn</span> : <span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">x</span>, <span class="id">notin_ref</span> <span class="id">r1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_ref</span> <span class="id">r2</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_stmt</span> (<span class="id">s_asgn</span> <span class="id">r1</span> <span class="id">r2</span>) <span class="id">x</span><br/>
| <span class="id">ni_meth</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span> <span class="id">z</span>, <span class="id">x</span> &lt;&gt; <span class="id">z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">y</span> &lt;&gt; <span class="id">z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x1</span> <span class="id">x2</span>, <span class="id">ps</span> <span class="id">x1</span> = <span class="id">Some</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x2</span> &lt;&gt; <span class="id">z</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_stmt</span> (<span class="id">s_meth</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span>) <span class="id">z</span><br/>
| <span class="id">ni_new</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">C</span> <span class="id">fs</span> <span class="id">y</span>, <span class="id">x</span> &lt;&gt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">f</span> <span class="id">z</span>, <span class="id">fs</span> <span class="id">f</span> = <span class="id">Some</span> <span class="id">z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">z</span> &lt;&gt; <span class="id">y</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_stmt</span> (<span class="id">s_new</span> <span class="id">x</span> <span class="id">C</span> <span class="id">fs</span>) <span class="id">y</span><br/>
| <span class="id">ni_stmts</span> : <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">x</span>, <span class="id">notin_stmt</span> <span class="id">s1</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_stmt</span> <span class="id">s2</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_stmt</span> (<span class="id">s_stmts</span> <span class="id">s1</span> <span class="id">s2</span>) <span class="id">x</span><br/>
| <span class="id">ni_rtrn</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">x</span> &lt;&gt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_stmt</span> (<span class="id">s_rtrn</span> <span class="id">x</span>) <span class="id">y</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">notin_ref</span> <span class="id">notin_stmt</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">meths_wf</span> : <span class="id">methods</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">mths_wf</span> : <span class="kwd">forall</span> <span class="id">mths</span>, (<span class="kwd">forall</span> <span class="id">m</span> <span class="id">xs</span> <span class="id">s</span>, <span class="id">mths</span> <span class="id">m</span> = <span class="id">Some</span> (<span class="id">xs</span>, <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, ~ <span class="id">In</span> <span class="id">x</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_stmt</span> <span class="id">s</span> <span class="id">x</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">meths_wf</span> <span class="id">mths</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">gFields_wf</span> : <span class="id">ghost_fields</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">g_wf</span> : <span class="kwd">forall</span> <span class="id">gs</span>, (<span class="kwd">forall</span> <span class="id">g</span> <span class="id">x</span> <span class="id">e</span>, <span class="id">gs</span> <span class="id">g</span> = <span class="id">Some</span> (<span class="id">x</span>, <span class="id">e</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">y</span>, <span class="id">y</span> &lt;&gt; <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">y</span> &lt;&gt; <span class="id">this</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">notin_exp</span> <span class="id">e</span> <span class="id">y</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gFields_wf</span> <span class="id">gs</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">cls_wf</span> : <span class="id">classDef</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">cdef_wf</span> : <span class="kwd">forall</span> <span class="id">CDef</span>, <span class="id">meths_wf</span> (<span class="id">c_meths</span> <span class="id">CDef</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gFields_wf</span> (<span class="id">c_g_fields</span> <span class="id">CDef</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cls_wf</span> <span class="id">CDef</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">M_wf</span> : <span class="id">mdl</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">module_wf</span> : <span class="kwd">forall</span> <span class="id">M</span>,  <span class="id">M</span> <span class="id">ObjectName</span> = <span class="id">Some</span> <span class="id">ObjectDefn</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span> <span class="id">CDef</span>, <span class="id">M</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">c_name</span> <span class="id">CDef</span> = <span class="id">C</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span> <span class="id">CDef</span>, <span class="id">M</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cls_wf</span> <span class="id">CDef</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M_wf</span> <span class="id">M</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">M_wf</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "<span class="id">M</span> '∙' σ '⊢' <span class="id">e1</span> '↪' <span class="id">e2</span>" (<span class="tactic">at</span> <span class="id">level</span> 40).<br/>
<br/>
<div class="doc"><h3>Expression evaluation (Fig 4, OOPSLA2019)</h3>  </div>
<br/>
<span class="kwd">Inductive</span> <span class="id">val</span> : <span class="id">mdl</span> -&gt; <span class="id">config</span> -&gt; <span class="id">exp</span> -&gt; <span class="id">value</span> -&gt; <span class="kwd">Prop</span> :=<br/>
<br/>
<div class="doc">M, σ true ↪ true     (True_Val) </div>
<br/>
<div class="doc">M, σ false ↪ false     (False_Val) </div>
<br/>
<div class="doc">M, σ null ↪ null     (Null_Val) </div>
<br/>
<div class="doc">This rule has been added to replace the original rules for values </div>
<div class="doc">i.e. Var_Value replaces Null_Val, False_Val, and True_Val, and </div>
<div class="doc">further extends the val to include evaluation of addresses </div>
<div class="doc">M, σ v ↪ v     (Var_Value) </div>
| <span class="id">v_value</span>     : <span class="kwd">forall</span> <span class="id">M</span> σ <span class="id">v</span>, <span class="id">M</span> ∙ σ ⊢ <span class="id">e_val</span> <span class="id">v</span> ↪ <span class="id">v</span><br/>
<br/>
<div class="doc">M, σ x ↪ σ(x)     (Var_Val) </div>
| <span class="id">v_var</span>      : <span class="kwd">forall</span> <span class="id">M</span> σ <span class="id">x</span> <span class="id">v</span>, <span class="id">mapp</span> σ <span class="id">x</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⊢ <span class="id">e_var</span> <span class="id">x</span> ↪ <span class="id">v</span><br/>
<br/>
<div class="doc">M, σ e.f() ↪ α </div>
<div class="doc">σ(α, f) = v</div>
<div class="doc">---------------- (Field_Heap_Val) </div>
<div class="doc">M, σ ⊢ e.f ↪ v      </div>
| <span class="id">v_f_heap</span>   : <span class="kwd">forall</span> <span class="id">M</span> σ <span class="id">e</span> <span class="id">f</span> α <span class="id">o</span> <span class="id">v</span>, <span class="id">M</span> ∙ σ ⊢ <span class="id">e</span> ↪ (<span class="id">v_addr</span> α) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mapp</span> σ α = <span class="id">Some</span> <span class="id">o</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">o</span>.(<span class="id">flds</span>) <span class="id">f</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⊢ <span class="id">e_acc_f</span> <span class="id">e</span> <span class="id">f</span> ↪ <span class="id">v</span><br/>
<br/>
<br/>
<div class="doc">M, σ e0 ↪ α </div>
<div class="doc">M, σ e ↪ v </div>
<div class="doc">σ(α) = o </div>
<div class="doc">o has class C in M </div>
<div class="doc">G(M, Class(α, σ), f) = f(x) { e' } (note: the x here corresponds with the 0 in the Coq) </div>
<div class="doc">M, σ e ↪ v</div>
<div class="doc">M, σ <span class="bracket"><span class="id">v</span>/<span class="id">x</span></span>e' ↪ v'</div>
<div class="doc">------------------------ (Field_Ghost_Val) </div>
<div class="doc">M, σ ⊢ e0.f(e) ↪ v'      </div>
| <span class="id">v_f_ghost</span>  : <span class="kwd">forall</span> <span class="id">M</span> σ <span class="id">e0</span> <span class="id">e</span> <span class="id">f</span> α <span class="id">o</span> <span class="id">x</span> <span class="id">e</span>' <span class="id">v</span> <span class="id">v</span>' <span class="id">C</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⊢ <span class="id">e0</span> ↪ (<span class="id">v_addr</span> α) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mapp</span> σ α = <span class="id">Some</span> <span class="id">o</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> <span class="id">o</span>.(<span class="id">cname</span>) = <span class="id">Some</span> <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">C</span>.(<span class="id">c_g_fields</span>) <span class="id">f</span> = <span class="id">Some</span> (<span class="id">x</span>, <span class="id">e</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⊢ <span class="id">e</span> ↪ <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ (<span class="id">update_</span>σ<span class="id">_map</span> (<span class="id">update_</span>σ<span class="id">_map</span> σ <span class="id">x</span> <span class="id">v</span>) <span class="id">this</span> (<span class="id">v_addr</span> α)) ⊢ <span class="id">e</span>' ↪ <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⊢ <span class="id">e_acc_g</span> <span class="id">e0</span> <span class="id">f</span> <span class="id">e</span> ↪ <span class="id">v</span>'<br/>
<br/>
<div class="doc">M, σ e ↪ true </div>
<div class="doc">M, σ e1 ↪ v </div>
<div class="doc">-------------------------------- (If_True_Val) </div>
<div class="doc">M, σ ⊢ if e then e1 else e2 ↪ v  </div>
| <span class="id">v_if_true</span>  : <span class="kwd">forall</span> <span class="id">M</span> σ <span class="id">e</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">v</span>, <span class="id">M</span> ∙ σ ⊢ <span class="id">e</span> ↪ <span class="id">v_true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⊢ <span class="id">e1</span> ↪ <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⊢ (<span class="id">e_if</span> <span class="id">e</span> <span class="id">e1</span> <span class="id">e2</span>) ↪ <span class="id">v</span><br/>
<br/>
<div class="doc">M, σ e ↪ false </div>
<div class="doc">M, σ e2 ↪ v </div>
<div class="doc">-------------------------------- (If_False_Val) </div>
<div class="doc">M, σ ⊢ if e then e1 else e2 ↪ v  </div>
| <span class="id">v_if_false</span> : <span class="kwd">forall</span> <span class="id">M</span> σ <span class="id">e</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">v</span>, <span class="id">M</span> ∙ σ ⊢ <span class="id">e</span> ↪ <span class="id">v_false</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⊢ <span class="id">e2</span> ↪ <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⊢ (<span class="id">e_if</span> <span class="id">e</span> <span class="id">e1</span> <span class="id">e2</span>) ↪ <span class="id">v</span><br/>
<br/>
<div class="doc">M, σ e1 ↪ v </div>
<div class="doc">M, σ e2 ↪ v </div>
<div class="doc">------------------------- (Field_Heap_Val) </div>
<div class="doc">M, σ ⊢ e1 = e2 ↪ true </div>
| <span class="id">v_equals</span>   : <span class="kwd">forall</span> <span class="id">M</span> σ <span class="id">e1</span> <span class="id">e2</span> <span class="id">v</span>, <span class="id">M</span> ∙ σ ⊢ <span class="id">e1</span> ↪ <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⊢ <span class="id">e2</span> ↪ <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⊢ (<span class="id">e_eq</span> <span class="id">e1</span> <span class="id">e2</span>) ↪ <span class="id">v_true</span><br/>
<br/>
<div class="doc">M, σ e1 ↪ v1 </div>
<div class="doc">M, σ e2 ↪ v2 </div>
<div class="doc">v ≠ v' </div>
<div class="doc">------------------------ (Field_Heap_Val) </div>
<div class="doc">M, σ ⊢ e1 = e2 ↪ false </div>
| <span class="id">v_nequals</span>  : <span class="kwd">forall</span> <span class="id">M</span> σ <span class="id">e1</span> <span class="id">e2</span> <span class="id">v1</span> <span class="id">v2</span>, <span class="id">M</span> ∙ σ ⊢ <span class="id">e1</span> ↪ <span class="id">v1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⊢ <span class="id">e2</span> ↪ <span class="id">v2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v1</span> &lt;&gt; <span class="id">v2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⊢ (<span class="id">e_eq</span> <span class="id">e1</span> <span class="id">e2</span>) ↪ <span class="id">v_false</span><br/>
<br/>
<span class="kwd">where</span> "<span class="id">M</span> '∙' σ '⊢' <span class="id">e1</span> '↪' <span class="id">e2</span>":= (<span class="id">val</span> <span class="id">M</span> σ <span class="id">e1</span> <span class="id">e2</span>).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">val</span> : <span class="id">loo_db</span>.<br/>
<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">unique</span> {<span class="id">A</span> : <span class="kwd">Type</span>} `{<span class="id">Eq</span> <span class="id">A</span>} : <span class="id">list</span> <span class="id">A</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">u_nil</span> : <span class="id">unique</span> <span class="id">nil</span><br/>
| <span class="id">u_con</span> : <span class="kwd">forall</span> <span class="id">a</span> <span class="id">l</span>, ~ <span class="id">In</span> <span class="id">a</span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unique</span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unique</span> (<span class="id">a</span> :: <span class="id">l</span>).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">unique</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">dom</span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>}`{<span class="id">Eq</span> <span class="id">A</span>} (<span class="id">m</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">B</span>)(<span class="id">d</span> : <span class="id">list</span> <span class="id">A</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span> <span class="id">b</span>, <span class="id">m</span> <span class="id">a</span> = <span class="id">Some</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">a</span> <span class="id">d</span>) /\<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id">In</span> <span class="id">a</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span>, <span class="id">m</span> <span class="id">a</span> = <span class="id">Some</span> <span class="id">b</span>) /\<br/>
&nbsp;&nbsp;<span class="id">unique</span> <span class="id">d</span>.<br/>
<br/>
<br/>
<div class="doc"><h3> Loo Operational Semantics (Fig 6, App A.2, OOPSLA2019):</h3> </div>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "<span class="id">M</span> '∙' σ '⤳' σ'" (<span class="tactic">at</span> <span class="id">level</span> 40).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">le_</span>α : <span class="id">addr</span> -&gt; <span class="id">addr</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">le_addr</span> : <span class="kwd">forall</span> <span class="id">n</span> <span class="id">m</span>, <span class="id">n</span> &lt;= <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">le_</span>α (<span class="id">address</span> <span class="id">n</span>) (<span class="id">address</span> <span class="id">m</span>).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">le_</span>α : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">S_</span>α (α : <span class="id">addr</span>) : <span class="id">addr</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> α <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">address</span> <span class="id">n</span> =&gt; <span class="id">address</span> (<span class="id">S</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">max_</span>χ {<span class="id">B</span> : <span class="kwd">Type</span>} : <span class="id">partial_map</span> <span class="id">addr</span> <span class="id">B</span> -&gt; <span class="id">addr</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">max_heap</span> : <span class="kwd">forall</span> χ α, (<span class="id">exists</span> <span class="id">b</span>, χ α = <span class="id">Some</span> <span class="id">b</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> α' <span class="id">b</span>, χ α' = <span class="id">Some</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">le_</span>α α' α) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">max_</span>χ χ α.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">max_</span>χ : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">fresh_</span>χ : <span class="id">heap</span> -&gt; <span class="id">addr</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">frsh_heap</span> : <span class="kwd">forall</span> χ α, <span class="id">max_</span>χ χ α -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_</span>χ χ (<span class="id">S_</span>α α).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">fresh_</span>χ : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">reduction</span> : <span class="id">mdl</span> -&gt; <span class="id">config</span> -&gt; <span class="id">config</span> -&gt; <span class="kwd">Prop</span> :=<br/>
<br/>
<div class="doc">ϕ.contn = x:=y.m(ps); s' </div>
<div class="doc">⌊y⌋ϕ ≜ α</div>
<div class="doc">ϕ' = ϕ❲contn ↦ x:=∙; s'❳ </div>
<div class="doc">ϕ'' = (ps ∘ (ϕ.(varMap)), s) </div>
<div class="doc">------------------------------------ (Meth_Call_OS) </div>
<div class="doc">M, σ ⤳ (χ, ϕ'' : ϕ' : ψ') </div>
| <span class="id">r_mth</span> : <span class="kwd">forall</span> <span class="id">M</span> ϕ ψ χ <span class="id">x</span> <span class="id">y</span> <span class="id">ps</span> σ <span class="id">m</span> <span class="id">zs</span> α <span class="id">o</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">C</span> ϕ' ϕ'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;&gt; <span class="id">this</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ = (χ, ϕ :: ψ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ.(<span class="id">contn</span>) = <span class="id">c_stmt</span> (<span class="id">s_stmts</span> (<span class="id">s_meth</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span>) <span class="id">s</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;⌊ <span class="id">y</span> ⌋ σ ≜ (<span class="id">v_addr</span> α) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ α = <span class="id">Some</span> <span class="id">o</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">M</span> (<span class="id">o</span>.(<span class="id">cname</span>))) = <span class="id">Some</span> <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">C</span>.(<span class="id">c_meths</span>) <span class="id">m</span> = <span class="id">Some</span> (<span class="id">zs</span>, <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dom</span> <span class="id">ps</span> <span class="id">zs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ' =  <span class="id">frm</span> (<span class="id">vMap</span> ϕ) (<span class="id">c_hole</span> <span class="id">x</span> <span class="id">s</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ'' = <span class="id">frm</span> (<span class="id">update</span> <span class="id">this</span> (<span class="id">v_addr</span> α) (<span class="id">ps</span> ∘ (<span class="id">vMap</span> ϕ))) (<span class="id">c_stmt</span> <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⤳ (χ, ϕ'' :: (ϕ' :: ψ))<br/>
<br/>
<div class="doc">x ≠ this </div>
<div class="doc">σ = (χ, ψ)</div>
<div class="doc">ψ = ϕ : _ </div>
<div class="doc">ϕ.contn = x := y.f; s</div>
<div class="doc">⌊y⌋ϕ ≜ α</div>
<div class="doc">Class(this) in σ = C </div>
<div class="doc">Class(y) in σ = C </div>
<div class="doc">χ(α) = o</div>
<div class="doc">o.f = α' </div>
<div class="doc">σ' = update σ with (x ↦ α) </div>
<div class="doc">------------------------------------ (Var_Assgn_OS) </div>
<div class="doc">M, σ ⤳ σ' </div>
| <span class="id">r_vAssgn</span> : <span class="kwd">forall</span> <span class="id">M</span> σ ϕ <span class="id">x</span> <span class="id">y</span> <span class="id">f</span> <span class="id">s</span> ψ χ α <span class="id">v</span> <span class="id">o</span> ϕ' <span class="id">C</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;&gt; <span class="id">this</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ = (χ, ϕ :: ψ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ.(<span class="id">contn</span>) = (<span class="id">c_stmt</span> (<span class="id">s_stmts</span> (<span class="id">s_asgn</span> (<span class="id">r_var</span> <span class="id">x</span>) (<span class="id">r_fld</span> <span class="id">y</span> <span class="id">f</span>)) <span class="id">s</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;⌊ <span class="id">y</span> ⌋ σ ≜ (<span class="id">v_addr</span> α) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">classOf</span> <span class="id">this</span> σ <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">classOf</span> <span class="id">y</span> σ <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ α = <span class="id">Some</span> <span class="id">o</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">flds</span> <span class="id">o</span>) <span class="id">f</span> = <span class="id">Some</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ' = <span class="id">frm</span> (<span class="id">update</span> <span class="id">x</span> <span class="id">v</span> (<span class="id">vMap</span> ϕ)) (<span class="id">c_stmt</span> <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⤳ (χ, ϕ'::ψ)<br/>
<br/>
<div class="doc">σ = (χ, ϕ : ψ') </div>
<div class="doc">ϕ.contn = y.f := x; s</div>
<div class="doc">χ(α) = C{ flds; mths } </div>
<div class="doc">o' = C{ flds❲f ↦ α❳; mths } </div>
<div class="doc">χ' = update χ with (α ↦ o') </div>
<div class="doc">ϕ' = update ϕ with (contn ↦ s) </div>
<div class="doc">σ' = (χ, ϕ' : ψ') </div>
<div class="doc">---------------------------------------- (Field_Assgn_OS) </div>
<div class="doc">M, σ ⤳ σ' </div>
| <span class="id">r_fAssgn</span> : <span class="kwd">forall</span> <span class="id">M</span> σ ϕ ϕ' <span class="id">x</span> <span class="id">y</span> <span class="id">f</span> <span class="id">s</span> ψ χ α <span class="id">v</span> <span class="id">o</span> σ' χ' <span class="id">o</span>' <span class="id">C</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ = (χ, ϕ :: ψ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ.(<span class="id">contn</span>) = (<span class="id">c_stmt</span> (<span class="id">s_stmts</span> (<span class="id">s_asgn</span> (<span class="id">r_fld</span> <span class="id">y</span> <span class="id">f</span>) (<span class="id">r_var</span> <span class="id">x</span>)) <span class="id">s</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;⌊ <span class="id">y</span> ⌋ σ ≜ (<span class="id">v_addr</span> α) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;⌊ <span class="id">x</span> ⌋ σ ≜ <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">classOf</span> <span class="id">this</span> σ <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">classOf</span> <span class="id">y</span> σ <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ α = <span class="id">Some</span> <span class="id">o</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">v</span>, (<span class="id">flds</span> <span class="id">o</span>) <span class="id">f</span> = <span class="id">Some</span> <span class="id">v</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">o</span>' = <span class="id">new</span> (<span class="id">cname</span> <span class="id">o</span>) (<span class="id">update</span> <span class="id">f</span> <span class="id">v</span> (<span class="id">flds</span> <span class="id">o</span>)) (<span class="id">meths</span> <span class="id">o</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ' = <span class="id">update</span> α <span class="id">o</span>' χ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ' = <span class="id">frm</span> (<span class="id">vMap</span> ϕ) (<span class="id">c_stmt</span> <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ' = (χ', ϕ' :: ψ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⤳ σ'<br/>
<br/>
<div class="doc">ψ = ϕ : ψ' </div>
<div class="doc">ϕ.contn = x := new C(fMap); s </div>
<div class="doc">M C = CDef </div>
<div class="doc">dom(fMap) = flds of C </div>
<div class="doc">ϕ' = update ϕ with (x ↦ α) and (contn ↦ s)</div>
<div class="doc">σ' = (update χ with (α ↦ o), ϕ' : ψ') </div>
<div class="doc">------------------------------------------------ (objCreate_OS) </div>
<div class="doc">M, σ ⤳ σ' </div>
| <span class="id">r_new</span> : <span class="kwd">forall</span> <span class="id">M</span> σ σ' χ ψ ϕ ϕ' α <span class="id">x</span> <span class="id">C</span> <span class="id">fMap</span> <span class="id">s</span> <span class="id">o</span> <span class="id">CDef</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;&gt; <span class="id">this</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ = (χ, ϕ :: ψ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ.(<span class="id">contn</span>) = (<span class="id">c_stmt</span> (<span class="id">s_stmts</span> (<span class="id">s_new</span> <span class="id">x</span> <span class="id">C</span> <span class="id">fMap</span>) <span class="id">s</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fresh_</span>χ χ α -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dom</span> <span class="id">fMap</span> (<span class="id">c_flds</span> <span class="id">CDef</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">f</span> <span class="id">x</span>, <span class="id">fMap</span> <span class="id">f</span> = <span class="id">Some</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>, (<span class="id">vMap</span> ϕ) <span class="id">x</span> = <span class="id">Some</span> <span class="id">v</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">o</span> = <span class="id">new</span> <span class="id">C</span> (<span class="id">fMap</span> ∘ (<span class="id">vMap</span> ϕ)) (<span class="id">c_meths</span> <span class="id">CDef</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ' = <span class="id">frm</span> (<span class="id">update</span> <span class="id">x</span> (<span class="id">v_addr</span> α) (<span class="id">vMap</span> ϕ)) (<span class="id">c_stmt</span> <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ' = (<span class="id">update</span> α <span class="id">o</span> χ, ϕ' :: ψ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⤳ σ'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
<div class="doc">σ = (χ, ϕ : ϕ' : ψ) </div>
<div class="doc">ϕ.contn = return x </div>
<div class="doc">ϕ'.contn = y := ∙; s </div>
<div class="doc">⌊ x ⌋ σ ≜ α </div>
<div class="doc">ϕ'' = update (ϕ') with (y ↦ α) and (contn ↦ s) </div>
<div class="doc">----------------------------------------------------- (Return_OS_1) </div>
<div class="doc">M, σ ⤳ (χ, ϕ'' : ψ </div>
| <span class="id">r_ret1</span> : <span class="kwd">forall</span> <span class="id">M</span> ϕ ϕ' ψ χ <span class="id">y</span> <span class="id">x</span> α ϕ'' σ <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ = (χ, ϕ :: (ϕ' :: ψ)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ.(<span class="id">contn</span>) = <span class="id">c_stmt</span> (<span class="id">s_rtrn</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ'.(<span class="id">contn</span>) = <span class="id">c_hole</span> <span class="id">y</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">y</span> &lt;&gt; <span class="id">this</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;⌊<span class="id">x</span>⌋ σ ≜ α -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ'' = <span class="id">update_</span>ϕ<span class="id">_contn</span> (<span class="id">update_</span>ϕ<span class="id">_map</span> ϕ' <span class="id">y</span> α) (<span class="id">c_stmt</span> <span class="id">s</span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⤳ (χ, ϕ'' :: ψ)<br/>
<br/>
<div class="doc">σ = (χ, ϕ : ϕ' : ψ'') </div>
<div class="doc">ϕ.contn = return x; s' </div>
<div class="doc">ϕ'.contn = y := ∙; s </div>
<div class="doc">⌊ x ⌋ σ ≜ α </div>
<div class="doc">ϕ'' = update (ϕ') with (y ↦ α) and (contn ↦ s) </div>
<div class="doc">--------------------------------------------------- (Return_OS_2) </div>
<div class="doc">M, σ ⤳ (χ, ϕ'', ψ) </div>
| <span class="id">r_ret2</span> : <span class="kwd">forall</span> <span class="id">M</span> ϕ ϕ' ψ χ <span class="id">y</span> <span class="id">x</span> α ϕ'' σ <span class="id">s</span> <span class="id">s</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ = (χ, ϕ :: ϕ' :: ψ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ.(<span class="id">contn</span>) = <span class="id">c_stmt</span> (<span class="id">s_stmts</span> (<span class="id">s_rtrn</span> <span class="id">x</span>) <span class="id">s</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ'.(<span class="id">contn</span>) = <span class="id">c_hole</span> <span class="id">y</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">y</span> &lt;&gt; <span class="id">this</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;⌊<span class="id">x</span>⌋ σ ≜ α -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ϕ'' = <span class="id">update_</span>ϕ<span class="id">_contn</span> (<span class="id">update_</span>ϕ<span class="id">_map</span> ϕ' <span class="id">y</span> α) (<span class="id">c_stmt</span> <span class="id">s</span>)-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⤳ (χ, ϕ'' :: ψ)<br/>
<br/>
<span class="kwd">where</span> "<span class="id">M</span> '∙' σ '⤳' σ'" := (<span class="id">reduction</span> <span class="id">M</span> σ σ').<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">reduction</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "<span class="id">M1</span> '⋄' <span class="id">M2</span> '≜' <span class="id">M</span>" (<span class="tactic">at</span> <span class="id">level</span> 40).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">link</span> : <span class="id">mdl</span> -&gt; <span class="id">mdl</span> -&gt; <span class="id">mdl</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">m_link</span> : <span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span>, (<span class="kwd">forall</span> <span class="id">C</span> <span class="id">def</span>, <span class="id">C</span> &lt;&gt; <span class="id">ObjectName</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">def</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M2</span> <span class="id">C</span> = <span class="id">None</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span> <span class="id">def</span>, <span class="id">C</span> &lt;&gt; <span class="id">ObjectName</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M2</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">def</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> <span class="id">C</span> = <span class="id">None</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ (<span class="id">M1</span> ∪ <span class="id">M2</span>)<br/>
<br/>
<span class="kwd">where</span> "<span class="id">M1</span> '⋄' <span class="id">M2</span> '≜' <span class="id">M</span>" := (<span class="id">link</span> <span class="id">M1</span> <span class="id">M2</span> <span class="id">M</span>).<br/>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "<span class="id">M1</span> '⦂' <span class="id">M2</span> '⦿' σ '⤳…' σ'" (<span class="tactic">at</span> <span class="id">level</span> 40).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<span class="kwd">Inductive</span> <span class="id">reductions</span> : <span class="id">mdl</span> -&gt; <span class="id">mdl</span> -&gt; <span class="id">config</span> -&gt; <span class="id">config</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">pr_single</span> : <span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> <span class="id">M</span> σ σ', <span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⤳ σ' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> <span class="id">C</span> = <span class="id">None</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ' <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">CDef</span>, <span class="id">M1</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ ⤳… σ'<br/>
<br/>
| <span class="id">pr_trans</span> : <span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> <span class="id">M</span> σ1 σ σ<span class="id">n</span>, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⤳ σ<span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ<span class="id">n</span> <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">CDef</span>, <span class="id">M1</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ<span class="id">n</span>                            <br/>
<br/>
<span class="kwd">where</span> "<span class="id">M1</span> '⦂' <span class="id">M2</span> '⦿' σ '⤳…' σ'" := (<span class="id">reductions</span> <span class="id">M1</span> <span class="id">M2</span> σ σ').<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">reductions</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "<span class="id">M1</span> '⦂' <span class="id">M2</span> '⦿' σ '⤳' σ'" (<span class="tactic">at</span> <span class="id">level</span> 40).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<span class="kwd">Inductive</span> <span class="id">pair_reduction</span> : <span class="id">mdl</span> -&gt; <span class="id">mdl</span> -&gt; <span class="id">config</span> -&gt; <span class="id">config</span> -&gt; <span class="kwd">Prop</span> :=<br/>
<br/>
| <span class="id">p_reduce</span> : <span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> <span class="id">M</span> σ1 σ σ<span class="id">n</span>, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳… σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⋄ <span class="id">M2</span> ≜ <span class="id">M</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span> ∙ σ ⤳ σ<span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">C</span>, <span class="id">classOf</span> <span class="id">this</span> σ<span class="id">n</span> <span class="id">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">CDef</span>, <span class="id">M1</span> <span class="id">C</span> = <span class="id">Some</span> <span class="id">CDef</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ<span class="id">n</span>                            <br/>
<br/>
<span class="kwd">where</span> "<span class="id">M1</span> '⦂' <span class="id">M2</span> '⦿' σ '⤳' σ'" := (<span class="id">pair_reduction</span> <span class="id">M1</span> <span class="id">M2</span> σ σ').<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">pair_reduction</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "<span class="id">M1</span> '⦂' <span class="id">M2</span> '⦿' σ '⤳⋆' σ'" (<span class="tactic">at</span> <span class="id">level</span> 40).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<span class="kwd">Inductive</span> <span class="id">pair_reductions</span> : <span class="id">mdl</span> -&gt; <span class="id">mdl</span> -&gt; <span class="id">config</span> -&gt; <span class="id">config</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">prs_single</span> : <span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳⋆ σ2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
| <span class="id">prs_trans</span> : <span class="kwd">forall</span> <span class="id">M1</span> <span class="id">M2</span> σ1 σ σ2, <span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳ σ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ ⤳⋆ σ2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M1</span> ⦂ <span class="id">M2</span> ⦿ σ1 ⤳⋆ σ2<br/>
<br/>
<span class="kwd">where</span> "<span class="id">M1</span> '⦂' <span class="id">M2</span> '⦿' σ '⤳⋆' σ'" := (<span class="id">pair_reductions</span> <span class="id">M1</span> <span class="id">M2</span> σ σ').<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">pair_reductions</span> : <span class="id">loo_db</span>.<br/>
<br/>
<span class="kwd">Class</span> <span class="id">Rename</span> (<span class="id">A</span> : <span class="kwd">Type</span>) :=<br/>
&nbsp;&nbsp;{<span class="id">rname</span> : (<span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span>) -&gt; <span class="id">A</span> -&gt; <span class="id">A</span>;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">empty_rename</span> : <span class="kwd">forall</span> <span class="id">a</span>, <span class="id">rname</span> <span class="id">empty</span> <span class="id">a</span> = <span class="id">a</span><br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Notation</span> "'❲' <span class="id">f</span> '↦' <span class="id">a</span> '❳'" := (<span class="id">rname</span> <span class="id">f</span> <span class="id">a</span>)(<span class="tactic">at</span> <span class="id">level</span> 40).<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">varRename</span> : <span class="id">Rename</span> <span class="id">var</span> :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rname</span> <span class="id">f</span> <span class="id">x</span> := <span class="kwd">match</span> (<span class="id">f</span> <span class="id">x</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">y</span> =&gt; <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> (@<span class="id">empty_rename</span> <span class="id">var</span>) : <span class="id">map_db</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> (@<span class="id">empty_rename</span> <span class="id">var</span>) : <span class="id">map_db</span>.<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">refRename</span> : <span class="id">Rename</span> <span class="id">ref</span> :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rname</span> <span class="id">f</span> <span class="id">r</span> := <span class="kwd">match</span> <span class="id">r</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">r_var</span> <span class="id">x</span> =&gt; <span class="id">r_var</span> (❲<span class="id">f</span> ↦ <span class="id">x</span>❳)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">r_fld</span> <span class="id">x</span> <span class="id">f</span>' =&gt; <span class="id">r_fld</span> (❲<span class="id">f</span> ↦ <span class="id">x</span>❳) <span class="id">f</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof40')">Next Obligation.</div>
<div class="proofscript" id="proof40">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">x</span>|<span class="id">x</span> <span class="id">f</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> (@<span class="id">empty_rename</span> <span class="id">ref</span>) : <span class="id">map_db</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> (@<span class="id">empty_rename</span> <span class="id">ref</span>) : <span class="id">map_db</span>.<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">fldMapRename</span> : <span class="id">Rename</span> (<span class="id">partial_map</span> <span class="id">fld</span> <span class="id">var</span>) :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rname</span> <span class="id">f</span> <span class="id">m</span> := (<span class="kwd">fun</span> <span class="id">f</span>' =&gt; <span class="id">bind</span> (<span class="id">m</span> <span class="id">f</span>') (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">Some</span> (❲ <span class="id">f</span> ↦ <span class="id">x</span> ❳)))<br/>
&nbsp;&nbsp;}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof41')">Next Obligation.</div>
<div class="proofscript" id="proof41">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">functional_extensionality</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">f</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bind</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">a</span> <span class="id">f</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> (@<span class="id">empty_rename</span> (<span class="id">partial_map</span> <span class="id">fld</span> <span class="id">var</span>)) : <span class="id">map_db</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> (@<span class="id">empty_rename</span> (<span class="id">partial_map</span> <span class="id">fld</span> <span class="id">var</span>)) : <span class="id">map_db</span>.<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">varMapRename</span> : <span class="id">Rename</span> (<span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span>) :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rname</span> <span class="id">f</span> <span class="id">m</span> := (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">bind</span> (<span class="id">m</span> <span class="id">x</span>) (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">Some</span> (❲ <span class="id">f</span> ↦ <span class="id">x</span> ❳)))<br/>
&nbsp;&nbsp;}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof42')">Next Obligation.</div>
<div class="proofscript" id="proof42">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">functional_extensionality</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bind</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">a</span> <span class="id">x</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> (@<span class="id">empty_rename</span> (<span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span>)) : <span class="id">map_db</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> (@<span class="id">empty_rename</span> (<span class="id">partial_map</span> <span class="id">var</span> <span class="id">var</span>)) : <span class="id">map_db</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">map_wrap_id</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>}`{<span class="id">Eq</span> <span class="id">A</span>}(<span class="id">f</span> : <span class="id">partial_map</span> <span class="id">A</span> <span class="id">B</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="kwd">match</span> <span class="id">f</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">y</span> =&gt; <span class="id">Some</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span> <span class="kwd">end</span>) = <span class="id">f</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof43')">Proof.</div>
<div class="proofscript" id="proof43">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">Heq</span> <span class="id">f</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">functional_extensionality</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> (@<span class="id">map_wrap_id</span> <span class="id">var</span> <span class="id">var</span>) : <span class="id">map_db</span>.<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">stmtRename</span> : <span class="id">Rename</span> <span class="id">stmt</span> :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rname</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fix</span> <span class="id">rname</span>' <span class="id">f</span> <span class="id">s</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">s</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">s_asgn</span> <span class="id">r1</span> <span class="id">r2</span> =&gt; <span class="id">s_asgn</span> (❲<span class="id">f</span> ↦ <span class="id">r1</span>❳) (❲<span class="id">f</span> ↦ <span class="id">r2</span>❳)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">s_meth</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span>' <span class="id">pMap</span> =&gt; <span class="id">s_meth</span> (❲<span class="id">f</span> ↦ <span class="id">x</span>❳)  (❲<span class="id">f</span> ↦ <span class="id">y</span>❳) <span class="id">m</span>' (❲<span class="id">f</span> ↦ <span class="id">pMap</span>❳)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">s_new</span> <span class="id">x</span> <span class="id">C</span> <span class="id">fMap</span> =&gt; <span class="id">s_new</span> (❲<span class="id">f</span> ↦ <span class="id">x</span>❳) <span class="id">C</span> (❲<span class="id">f</span> ↦ <span class="id">fMap</span>❳)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">s_stmts</span> <span class="id">s1</span> <span class="id">s2</span> =&gt; <span class="id">s_stmts</span> (<span class="id">rname</span>' <span class="id">f</span> <span class="id">s1</span>) (<span class="id">rname</span>' <span class="id">f</span> <span class="id">s2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">s_rtrn</span> <span class="id">x</span> =&gt; <span class="id">s_rtrn</span> (❲<span class="id">f</span> ↦ <span class="id">x</span>❳)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof44')">Next Obligation.</div>
<div class="proofscript" id="proof44">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">r</span>, <span class="id">r0</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">v</span>, <span class="id">v0</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">map_wrap_id</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">map_wrap_id</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">a1</span>, <span class="id">a2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">crush</span>.<br/>
Defined.</div>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> (@<span class="id">empty_rename</span> <span class="id">stmt</span>) : <span class="id">map_db</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> (@<span class="id">empty_rename</span> <span class="id">stmt</span>) : <span class="id">map_db</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">empty_rename</span> : <span class="id">map_db</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">empty_rename</span> : <span class="id">map_db</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">in_ref</span> : <span class="id">var</span> -&gt; <span class="id">ref</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">in_r_var</span> : <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">in_ref</span> <span class="id">x</span> (<span class="id">r_var</span> <span class="id">x</span>)<br/>
| <span class="id">in_r_fld</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">f</span>, <span class="id">in_ref</span> <span class="id">x</span> (<span class="id">r_fld</span> <span class="id">x</span> <span class="id">f</span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">in_stmt</span> : <span class="id">var</span> -&gt; <span class="id">stmt</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">in_asgn_1</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id">in_ref</span> <span class="id">x</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">in_stmt</span> <span class="id">x</span> (<span class="id">s_asgn</span> <span class="id">y</span> <span class="id">z</span>)<br/>
| <span class="id">in_asgn_2</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id">in_ref</span> <span class="id">x</span> <span class="id">z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">in_stmt</span> <span class="id">x</span> (<span class="id">s_asgn</span> <span class="id">y</span> <span class="id">z</span>)<br/>
| <span class="id">in_meth_1</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span>, <span class="id">in_stmt</span> <span class="id">x</span> (<span class="id">s_meth</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span>)<br/>
| <span class="id">in_meth_2</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span>, <span class="id">in_stmt</span> <span class="id">y</span> (<span class="id">s_meth</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span>)<br/>
| <span class="id">in_meth_3</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> <span class="id">m</span> <span class="id">ps</span>, (<span class="id">exists</span> <span class="id">x</span>', <span class="id">ps</span> <span class="id">x</span>' = <span class="id">Some</span> <span class="id">z</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">in_stmt</span> <span class="id">z</span> (<span class="id">s_meth</span> <span class="id">x</span> <span class="id">y</span> <span class="id">m</span> <span class="id">ps</span>)<br/>
| <span class="id">in_new_1</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">C</span> <span class="id">ps</span>, <span class="id">in_stmt</span> <span class="id">x</span> (<span class="id">s_new</span> <span class="id">x</span> <span class="id">C</span> <span class="id">ps</span>)<br/>
| <span class="id">in_new_2</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">C</span> <span class="id">ps</span>, (<span class="id">exists</span> <span class="id">z</span>, <span class="id">ps</span> <span class="id">z</span> = <span class="id">Some</span> <span class="id">y</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">in_stmt</span> <span class="id">y</span> (<span class="id">s_new</span> <span class="id">x</span> <span class="id">C</span> <span class="id">ps</span>)<br/>
| <span class="id">in_stmts_1</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id">in_stmt</span> <span class="id">x</span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">in_stmt</span> <span class="id">x</span> (<span class="id">s_stmts</span> <span class="id">s1</span> <span class="id">s2</span>)<br/>
| <span class="id">in_stmts_2</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id">in_stmt</span> <span class="id">x</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">in_stmt</span> <span class="id">x</span> (<span class="id">s_stmts</span> <span class="id">s1</span> <span class="id">s2</span>)<br/>
| <span class="id">in_retrn</span> : <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">in_stmt</span> <span class="id">x</span> (<span class="id">s_rtrn</span> <span class="id">x</span>).<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">in_ref</span> <span class="id">in_stmt</span> : <span class="id">loo_db</span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
